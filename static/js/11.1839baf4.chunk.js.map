{"version":3,"sources":["../node_modules/ccapture.js-npmfixed/src/CCapture.js","../node_modules/ccapture.js-npmfixed/src/tar.js","../node_modules/ccapture.js-npmfixed/src/download.js","../node_modules/ccapture.js-npmfixed/src/gif.js","../node_modules/ccapture.js-npmfixed/src/webm-writer-0.2.0.js","../node_modules/three/examples/jsm/controls/OrbitControls.js"],"names":["isNodeEnviroment","module","exports","Tar","require","window","download","GIF","WebMWriter","objectTypes","checkGlobal","value","Object","parseFloat","parseInt","freeExports","nodeType","undefined","freeModule","freeGlobal","global","freeSelf","self","freeWindow","thisGlobal","this","Function","pad","n","String","slice","gc","HTMLCanvasElement","prototype","toBlob","defineProperty","callback","type","quality","binStr","atob","toDataURL","split","len","length","arr","Uint8Array","i","charCodeAt","Blob","performance","Date","now","getTime","nowOffset","timing","navigationStart","g_startTime","CCFrameEncoder","settings","_handlers","on","event","handler","emit","apply","Array","call","arguments","filename","name","s4","Math","floor","random","toString","substring","guid","extension","mimeType","CCTarEncoder","fileExtension","baseFilename","tape","count","part","frames","CCPNGEncoder","CCJPEGEncoder","CCWebMEncoder","document","createElement","substr","console","log","framerate","videoWriter","fileWriter","fd","frameRate","CCFFMpegServerEncoder","encoder","FFMpegServer","Video","bind","url","size","cb","progress","onProgress","data","alert","JSON","stringify","CCStreamEncoder","stream","mediaRecorder","chunks","CCGIFEncoder","workers","canvas","ctx","getContext","sizeSet","workerBlob","workerScript","URL","createObjectURL","blob","CCapture","_verbose","_time","_startTime","_performanceTime","_performanceStartTime","_step","_encoder","_settings","_timeouts","_intervals","_frameCount","_intermediateFrameCount","_requestAnimationFrameCallbacks","_capturing","motionBlurFrames","verbose","display","step","timeLimit","frameLimit","startTime","_timeDisplay","style","position","left","top","backgroundColor","fontFamily","fontSize","padding","color","zIndex","body","appendChild","bufferMotionBlur","imageData","canvasMotionBlur","ctxMotionBlur","_log","_encoders","gif","webm","ffmpegserver","png","jpg","ctor","format","keys","join","_process","_emit","_oldSetTimeout","setTimeout","_oldSetInterval","setInterval","_oldClearInterval","clearInterval","_oldClearTimeout","clearTimeout","_oldRequestAnimationFrame","requestAnimationFrame","_oldNow","_oldPerformanceNow","_oldGetTime","media","_stop","stop","_call","fn","p","dt","forEach","v","_hookedTime","seconds","_save","d","setSeconds","textContent","toISOString","_updateTime","j","triggerTime","splice","time","save","message","start","hookCurrentTime","_hooked","currentTime","pause","push","t","id","HTMLVideoElement","get","HTMLAudioElement","err","_init","capture","width","height","Uint16Array","fillStyle","fillRect","_checkFrame","drawImage","getImageData","_blendFrame","putImageData","add","_saveFrame","dispose","safeToProceed","create","fileReader","FileReader","onload","append","result","autoSaveTime","readAsArrayBuffer","addFrame","complete","then","end","captureStream","MediaRecorder","ondataavailable","e","onstop","setOption","copy","delay","render","define","lookup","clean","buffer","utils","num","bytes","base","extend","orig","addLength","multipleOf","set","stringToUint8","input","out","offset","uint8ToBase64","uint8","temp","extraBytes","output","headerFormat","header","structure","str","field","blockSize","recordSize","recordsPerBlock","written","blocks","filepath","opts","checksum","mode","mtime","uid","gid","headerArr","constructor","match","fileName","fileMode","fileSize","ustar","owner","group","key","headerLength","ceil","inputLength","buffers","max","pow","chunk","b","c","clear","strFileName","strMimeType","reader","defaultMime","payload","anchor","a","myBlob","MozBlob","WebKitBlob","pop","href","indexOf","ajax","XMLHttpRequest","open","responseType","target","response","send","test","navigator","msSaveBlob","dataUrlToBlob","saver","tempUiArr","mx","strUrl","parts","binData","decodeURIComponent","uiArr","winMode","setAttribute","className","innerHTML","addEventListener","stopPropagation","removeEventListener","callee","click","removeChild","revokeObjectURL","userAgent","replace","confirm","location","f","src","btoa","y","encodeURIComponent","readAsDataURL","hasOwnProperty","cache","resolve","Error","loaded","parent","children","lastIndexOf","modules","title","version","browser","env","argv","nextTick","setImmediate","cwd","chdir","m","l","k","g","h","EventEmitter","running","options","freeWorkers","activeWorkers","setOptions","__super__","repeat","background","transparent","_canvas","ImageData","CanvasRenderingContext2D","WebGLRenderingContext","getContextData","context","childNodes","image","nextFrame","finishedFrames","imageParts","spawnWorkers","renderNextFrame","abort","shift","terminate","min","Worker","onmessage","frameFinished","index","finishRendering","pageSize","cursor","round","getTask","postMessage","setFill","last","canTransfer","toLowerCase","platform","documentMode","isArray","setMaxListeners","_events","maxListeners","error","addListener","warned","trace","once","removeListener","removeAllListeners","listeners","ArrayBufferDataStream","pos","seek","writeBytes","writeByte","writeU8","writeU16BE","u","writeDoubleBE","Float64Array","writeFloatBE","Float32Array","writeString","s","writeEBMLVarIntWidth","RuntimeException","measureEBMLVarInt","val","writeEBMLVarInt","writeUnsignedIntBE","measureUnsignedInt","getAsDataArray","byteLength","subarray","fs","BlobBuffer","destination","writePromise","Promise","readBlobAsBuffer","reject","convertToUint8Array","thing","ArrayBuffer","isView","measureData","Number","isInteger","FileWriter","isNaN","write","newEntry","isAppend","dataArray","totalWritten","Buffer","from","handleWriteComplete","onwriteend","entry","entryArray","newEntryArray","renderAsWebP","frame","extractKeyframeFromWebP","webP","keyframeStartIndex","EBMLFloat32","EBMLFloat64","writeEBML","bufferFileOffset","ebml","sizePos","dataBegin","dataEnd","dataOffset","videoWidth","videoHeight","ebmlSegment","seekHead","writtenHeader","clusterFrameBuffer","clusterStartTime","clusterDuration","seekPoints","Cues","positionEBML","SegmentInfo","Tracks","segmentDuration","cues","blobBuffer","fileOffsetToSegmentRelative","fileOffset","writeHeader","seekPositionEBMLTemplate","seekPoint","createSeekHead","segmentInfo","tracks","bufferStream","createKeyframeBlock","keyframe","trackNumber","timecode","flushClusterFrameBuffer","rawImageSize","trackIndex","clusterTime","clusterFileOffset","cluster","createCluster","duration","frameDuration","cuesBuffer","writeCues","seekHeadBuffer","oldPos","rewriteSeekHead","rewriteDuration","getWrittenSize","obj","prop","validateOptions","_changeEvent","_startEvent","_endEvent","OrbitControls","object","domElement","warn","touchAction","enabled","Vector3","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","PI","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","clone","position0","zoom0","zoom","_domElementKeyEvents","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","getDistance","distanceTo","listenToKeyEvents","onKeyDown","saveState","scope","reset","updateProjectionMatrix","dispatchEvent","update","state","STATE","NONE","quat","Quaternion","setFromUnitVectors","up","quatInverse","invert","lastPosition","lastQuaternion","twoPI","sub","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","isFinite","makeSafe","radius","scale","addScaledVector","panOffset","setFromSpherical","lookAt","multiplyScalar","zoomChanged","distanceToSquared","EPS","dot","quaternion","onContextMenu","onPointerDown","onPointerCancel","onMouseWheel","onPointerMove","onPointerUp","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","pointers","pointerPositions","getZoomScale","angle","rotateUp","panLeft","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","matrix","isOrthographicCamera","right","clientWidth","bottom","dollyOut","dollyScale","dollyIn","handleMouseDownRotate","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","x","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchMoveRotate","getSecondPointerPosition","subVectors","handleTouchMovePan","handleTouchMoveDolly","setPointerCapture","pointerId","addPointer","pointerType","trackPointer","DOLLY_ROTATE","onTouchStart","mouseAction","button","handleMouseDownDolly","ctrlKey","metaKey","shiftKey","onMouseDown","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","onTouchMove","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","onMouseMove","removePointer","releasePointerCapture","preventDefault","handleMouseWheel","needsUpdate","code","handleKeyDown","pointer","passive","EventDispatcher"],"mappings":";wHAAA,qBAAE,WAEF,aAEA,IAAIA,EAA8E,qBAAnBC,EAAOC,QAElEC,EAAMH,EAAmBI,EAAQ,MAAWC,OAAOF,IACnDG,EAAWN,EAAmBI,EAAQ,MAAgBC,OAAOC,SAC7DC,EAAMP,EAAmBI,EAAQ,MAASG,IAAMF,OAAOE,IACvDC,EAAaR,EAAmBI,EAAQ,MAAyBC,OAAOG,WAExEC,EAAc,CAClB,UAAY,EACZ,QAAU,GAGV,SAASC,EAAYC,GACjB,OAAQA,GAASA,EAAMC,SAAWA,OAAUD,EAAQ,KAInCE,WACJC,SADjB,IAIIC,EAAeN,SAAmBP,IAAYA,IAAYA,EAAQc,SACpEd,OACAe,EAGEC,EAAcT,SAAmBR,IAAWA,IAAWA,EAAOe,SAChEf,OACAgB,EAQEE,GALiBD,GAAcA,EAAWhB,QAK7BQ,EAAYK,GAAeG,GAA+B,iBAAVE,GAAsBA,IAGnFC,EAAWX,EAAYD,SAAmBa,OAASA,MAGnDC,EAAab,EAAYD,SAAmBJ,SAAWA,QAGvDmB,EAAad,EAAYD,SAAmBgB,OAASA,MAQ9CN,GACTI,KAAgBC,GAAcA,EAAWnB,SAAYkB,GACrDF,GAAYG,GAAcE,SAAS,cAATA,GA6D5B,SAASC,EAAKC,GACb,OAAOC,OAAO,UAAYD,GAAGE,OAAO,GA5D/B,OAAQzB,SACbA,OAAO0B,GAAK,cAGRC,kBAAkBC,UAAUC,QAChCtB,OAAOuB,eAAeH,kBAAkBC,UAAW,SAAU,CAC5DtB,MAAO,SAAUyB,EAAUC,EAAMC,GAM/B,IAJA,IAAIC,EAASC,KAAMf,KAAKgB,UAAUJ,EAAMC,GAASI,MAAM,KAAK,IACxDC,EAAMJ,EAAOK,OACbC,EAAM,IAAIC,WAAWH,GAEhBI,EAAE,EAAGA,EAAEJ,EAAKI,IACpBF,EAAIE,GAAKR,EAAOS,WAAWD,GAG5BX,EAAU,IAAIa,KAAM,CAACJ,GAAM,CAACR,KAAMA,GAAQ,kBAiB9C,WAUE,GARI,gBAAiBhC,QAAU,IAC3BA,OAAO6C,YAAc,IAGzBC,KAAKC,IAAOD,KAAKC,KAAO,WACvB,OAAO,IAAID,MAAOE,WAGf,QAAShD,OAAO6C,aAAe,EAAM,CAEvC,IAAII,EAAYH,KAAKC,MAEjBF,YAAYK,QAAUL,YAAYK,OAAOC,kBAC3CF,EAAYJ,YAAYK,OAAOC,iBAGjCnD,OAAO6C,YAAYE,IAAM,WACvB,OAAOD,KAAKC,MAAQE,IAnB1B,GA+BA,IAAIG,EAAcpD,OAAO8C,KAAKC,MAS9B,SAASM,EAAgBC,GAExB,IAAIC,EAAY,GAEhBnC,KAAKkC,SAAWA,EAEhBlC,KAAKoC,GAAK,SAASC,EAAOC,GAEzBH,EAAUE,GAASC,GAIpBtC,KAAKuC,KAAO,SAASF,GAEpB,IAAIC,EAAUH,EAAUE,GACpBC,GAEHA,EAAQE,MAAM,KAAMC,MAAMjC,UAAUH,MAAMqC,KAAKC,UAAW,KAM5D3C,KAAK4C,SAAWV,EAASW,MA9B1B,WACC,SAASC,IACR,OAAOC,KAAKC,MAA4B,OAArB,EAAID,KAAKE,WAAqBC,SAAS,IAAIC,UAAU,GAEzE,OAAOL,IAAOA,IAAO,IAAMA,IAAO,IAAMA,IAAO,IAAMA,IAAO,IAAMA,IAAOA,IAAOA,IA0B/CM,GACjCpD,KAAKqD,UAAY,GACjBrD,KAAKsD,SAAW,GAYjB,SAASC,EAAcrB,GAErBD,EAAeS,KAAM1C,KAAMkC,GAE3BlC,KAAKqD,UAAY,OACjBrD,KAAKsD,SAAW,oBAChBtD,KAAKwD,cAAgB,GACrBxD,KAAKyD,aAAezD,KAAK4C,SAEzB5C,KAAK0D,KAAO,KACZ1D,KAAK2D,MAAQ,EACb3D,KAAK4D,KAAO,EACZ5D,KAAK6D,OAAS,EAsDhB,SAASC,EAAc5B,GAEtBqB,EAAab,KAAM1C,KAAMkC,GAEzBlC,KAAKY,KAAO,YACZZ,KAAKwD,cAAgB,OActB,SAASO,EAAe7B,GAEvBqB,EAAab,KAAM1C,KAAMkC,GAEzBlC,KAAKY,KAAO,aACZZ,KAAKwD,cAAgB,OACrBxD,KAAKa,QAAYqB,EAASrB,QAAU,KAAS,GAoB9C,SAASmD,EAAe9B,GAG+B,eADzC+B,SAASC,cAAe,UAC1BlD,UAAW,cAAemD,OAAO,EAAE,KAC7CC,QAAQC,IAAK,kDAGdpC,EAAeS,KAAM1C,KAAMkC,GAE3BlC,KAAKa,QAAYqB,EAASrB,QAAU,KAAS,GAE7Cb,KAAKqD,UAAY,QACjBrD,KAAKsD,SAAW,aAChBtD,KAAKyD,aAAezD,KAAK4C,SACxB5C,KAAKsE,UAAYpC,EAASoC,UAE3BtE,KAAK6D,OAAS,EACd7D,KAAK4D,KAAO,EAEX5D,KAAKuE,YAAc,IAAIxF,EAAW,CAChC8B,QAASb,KAAKa,QACd2D,WAAY,KACZC,GAAI,KACJC,UAAW1E,KAAKsE,YAmDpB,SAASK,EAAuBzC,GAE/BD,EAAeS,KAAM1C,KAAMkC,GAE3BA,EAASrB,QAAYqB,EAASrB,QAAU,KAAS,GAEjDb,KAAK4E,QAAU,IAAIC,aAAaC,MAAO5C,GACpClC,KAAK4E,QAAQxC,GAAI,UAAW,WACxBpC,KAAKuC,KAAM,YACbwC,KAAM/E,OACRA,KAAK4E,QAAQxC,GAAG,WAAY,SAAU4C,EAAKC,GACvC,IAAIC,EAAKlF,KAAKW,SACTuE,IACDlF,KAAKW,cAAWnB,EAChB0F,EAAIF,EAAKC,KAEfF,KAAM/E,OACRA,KAAK4E,QAAQxC,GAAI,WAAY,SAAU+C,GAC9BnF,KAAKkC,SAASkD,YACfpF,KAAKkC,SAASkD,WAAYD,IAEhCJ,KAAM/E,OACRA,KAAK4E,QAAQxC,GAAI,QAAS,SAAUiD,GAChCC,MAAMC,KAAKC,UAAUH,EAAM,KAAM,KACnCN,KAAM/E,OAiCZ,SAASyF,EAAiBvD,GAEzBD,EAAeS,KAAM1C,KAAMkC,GAE3BlC,KAAKsE,UAAYtE,KAAKkC,SAASoC,UAC/BtE,KAAKY,KAAO,aACZZ,KAAKqD,UAAY,QACjBrD,KAAK0F,OAAS,KACd1F,KAAK2F,cAAgB,KACrB3F,KAAK4F,OAAS,GAmCf,SAASC,EAAc3D,GACtBD,EAAeS,KAAM1C,KAAMkC,GAE3BA,EAASrB,QAAU,IAA4B,GAAnBqB,EAASrB,QAAe,KAAS,IAC7DqB,EAAS4D,QAAU5D,EAAS4D,SAAW,EAEvC9F,KAAKqD,UAAY,OACjBrD,KAAKsD,SAAW,YAEdtD,KAAK+F,OAAS9B,SAASC,cAAe,UACtClE,KAAKgG,IAAMhG,KAAK+F,OAAOE,WAAY,MACnCjG,KAAKkG,SAAU,EAEjB,IACIC,EAAa,IAAI3E,KAAK,CADN,0gSACuB,CAC1CZ,KAAM,2BAEHwF,EAAeC,IAAIC,gBAAgBH,GAErCnG,KAAK4E,QAAU,IAAI9F,EAAI,CACxBgH,QAAS5D,EAAS4D,QAClBjF,QAASqB,EAASrB,QAClBuF,aAAcA,IAGZpG,KAAK4E,QAAQxC,GAAI,WAAY,SAAU+C,GAC9BnF,KAAKkC,SAASkD,YACfpF,KAAKkC,SAASkD,WAAYD,IAEhCJ,KAAM/E,OAERA,KAAK4E,QAAQxC,GAAG,WAAY,SAAUmE,GAClC,IAAIrB,EAAKlF,KAAKW,SACTuE,IACDlF,KAAKW,cAAWnB,EAChB0F,EAAIqB,KAEVxB,KAAM/E,OAoCZ,SAASwG,EAAUtE,GAElB,IAECuE,EAEAC,EACAC,EACAC,EACAC,EACAC,EACMC,EATHC,EAAY9E,GAAY,GAU3B+E,GATQ,IAAIvF,KASA,IACZwF,EAAa,GACbC,EAAc,EACdC,EAA0B,EAE1BC,EAAkC,GAClCC,GAAa,EACPnF,EAAY,GAEnB6E,EAAU1C,UAAY0C,EAAU1C,WAAa,GAC7C0C,EAAUO,iBAAmB,GAAMP,EAAUO,kBAAoB,GACjEd,EAAWO,EAAUQ,UAAW,EACrBR,EAAUS,QACrBT,EAAUU,KAAO,IAASV,EAAU1C,UACpC0C,EAAUW,UAAYX,EAAUW,WAAa,EAC7CX,EAAUY,WAAaZ,EAAUY,YAAc,EAC/CZ,EAAUa,UAAYb,EAAUa,WAAa,EAE7C,IAAIC,EAAe7D,SAASC,cAAe,OAC3C4D,EAAaC,MAAMC,SAAW,WAC9BF,EAAaC,MAAME,KAAOH,EAAaC,MAAMG,IAAM,EACnDJ,EAAaC,MAAMI,gBAAkB,QACrCL,EAAaC,MAAMK,WAAa,YAChCN,EAAaC,MAAMM,SAAW,OAC9BP,EAAaC,MAAMO,QAAU,MAC7BR,EAAaC,MAAMQ,MAAQ,MAC3BT,EAAaC,MAAMS,OAAS,IACxBxB,EAAUS,SAAUxD,SAASwE,KAAKC,YAAaZ,GAEnD,IAEIa,EACAC,EAHAC,EAAmB5E,SAASC,cAAe,UAC3C4E,EAAgBD,EAAiB5C,WAAY,MAIjD8C,EAAM,kBAAoB/B,EAAUU,KAAO,MAExC,IAAIsB,EAAY,CAClBC,IAAKpD,EACLqD,KAAMlF,EACNmF,aAAcxE,EACdyE,IAAKtF,EACLuF,IAAKtF,EACL,qBAAsB0B,GAGhB6D,EAAON,EAAWhC,EAAUuC,QAChC,IAAMD,EACR,KAAM,yDAA2DnK,OAAOqK,KAAKR,GAAWS,KAAK,MAgB9F,IAdG1C,EAAW,IAAIuC,EAAMtC,IACZU,KAAOZ,EAEnBC,EAAS3E,GAAG,UAAWsH,GACpB3C,EAAS3E,GAAG,YAiTZ,SAAoB+C,IAXpB,SAAgB9C,GAEZ,IAAIC,EAAUH,EAAUE,GACnBC,GAEDA,EAAQE,MAAO,KAAMC,MAAMjC,UAAUH,MAAMqC,KAAMC,UAAW,IAQhEgH,CAAO,WAAYxE,MAjTnB,gBAAiBvG,QAAU,IAC9BA,OAAO6C,YAAc,IAGzBC,KAAKC,IAAOD,KAAKC,KAAO,WACvB,OAAO,IAAID,MAAOE,WAGf,QAAShD,OAAO6C,aAAe,EAAM,CAExC,IAAII,EAAYH,KAAKC,MAEjBF,YAAYK,QAAUL,YAAYK,OAAOC,kBAC5CF,EAAYJ,YAAYK,OAAOC,iBAGhCnD,OAAO6C,YAAYE,IAAM,WACxB,OAAOD,KAAKC,MAAQE,GAItB,IAAI+H,EAAiBhL,OAAOiL,WAC3BC,EAAkBlL,OAAOmL,YACrBC,EAAoBpL,OAAOqL,cAC/BC,EAAmBtL,OAAOuL,aAC1BC,EAA4BxL,OAAOyL,sBACnCC,EAAU1L,OAAO8C,KAAKC,IACtB4I,EAAqB3L,OAAO6C,YAAYE,IACxC6I,EAAc5L,OAAO8C,KAAKlB,UAAUoB,QAGjC6I,EAAQ,GAmFZ,SAASC,IACRpD,GAAa,EACbP,EAAS4D,OAcT5B,EAAM,iBACNnK,OAAOiL,WAAaD,EACpBhL,OAAOmL,YAAcD,EACrBlL,OAAOqL,cAAgBD,EACvBpL,OAAOuL,aAAeD,EACtBtL,OAAOyL,sBAAwBD,EAC/BxL,OAAO8C,KAAKlB,UAAUoB,QAAU4I,EAChC5L,OAAO8C,KAAKC,IAAM2I,EAClB1L,OAAO6C,YAAYE,IAAM4I,EAlB1B,SAASK,EAAOC,EAAIC,GACnBlB,EAAgBiB,EAAI,EAAGC,GAGxB,SAAShE,IAER8D,EAAOlB,GAwGR,SAASA,IAER,IAAIhC,EAAO,IAAOV,EAAU1C,UACxByG,GAAO5D,EAAcC,EAA0BJ,EAAUO,kBAAqBG,EAElFhB,EAAQC,EAAaoE,EACrBnE,EAAmBC,EAAwBkE,EAE3CN,EAAMO,SAAS,SAAUC,GACxBA,EAAEC,YAAcH,EAAK,OAlGvB,WACC,IAAII,EAAUhE,EAAcH,EAAU1C,WAChC0C,EAAUY,YAAcT,GAAeH,EAAUY,YAAkBZ,EAAUW,WAAawD,GAAWnE,EAAUW,aACpH+C,IACAU,KAED,IAAIC,EAAI,IAAI3J,KAAM,MAClB2J,EAAEC,WAAYH,GACVnE,EAAUO,iBAAmB,EAChCO,EAAayD,YAAc,YAAcvE,EAAUuC,OAAS,MAAQpC,EAAc,YAAcC,EAA0B,aAAgBiE,EAAEG,cAAcrH,OAAQ,GAAI,GAEtK2D,EAAayD,YAAc,YAAcvE,EAAUuC,OAAS,MAAQpC,EAAc,aAAgBkE,EAAEG,cAAcrH,OAAQ,GAAI,GA0F/HsH,GACA1C,EAAM,UAAY5B,EAAc,IAAMC,GAEtC,IAAK,IAAIsE,EAAI,EAAGA,EAAIzE,EAAU9F,OAAQuK,IACjChF,GAASO,EAAWyE,GAAIC,cAC3Bf,EAAO3D,EAAWyE,GAAI/K,UAEtBsG,EAAU2E,OAAQF,EAAG,IAKvB,IAASA,EAAI,EAAGA,EAAIxE,EAAW/F,OAAQuK,IAClChF,GAASQ,EAAYwE,GAAIC,cAC5Bf,EAAO1D,EAAYwE,GAAI/K,UACvBuG,EAAYwE,GAAIC,aAAezE,EAAYwE,GAAIG,MAMjDxE,EAAgC2D,SAAS,SAAU9F,GAC9C0F,EAAO1F,EAAIwB,EAAQ1E,MAElBqF,EAAkC,GAIzC,SAAS+D,EAAOzK,GAEVA,IACJA,EAAW,SAAU4F,GAEpB,OADA1H,EAAU0H,EAAMQ,EAASnE,SAAWmE,EAAS1D,UAAW0D,EAASzD,WAC1D,IAGTyD,EAAS+E,KAAMnL,GAIhB,SAASoI,EAAMgD,GACVtF,GAAWrC,QAAQC,IAAK0H,GA0B7B,MAAO,CACNC,MA1MD,YA3EA,WAwDC,SAASC,IAOR,OANKjM,KAAKkM,UACTlM,KAAKkM,SAAU,EACflM,KAAKkL,YAAclL,KAAKmM,aAAe,EACvCnM,KAAKoM,QACL3B,EAAM4B,KAAMrM,OAENA,KAAKkL,YAAclE,EAAUa,UA7DrCkB,EAAM,kBAENpC,EAAa/H,OAAO8C,KAAKC,MACzB+E,EAAQC,EAAaK,EAAUa,UAC/BhB,EAAwBjI,OAAO6C,YAAYE,MAC3CiF,EAAmBC,EAAwBG,EAAUa,UAErDjJ,OAAO8C,KAAKlB,UAAUoB,QAAU,WAC/B,OAAO8E,GAER9H,OAAO8C,KAAKC,IAAM,WACjB,OAAO+E,GAGR9H,OAAOiL,WAAa,SAAUlJ,EAAUkL,GACvC,IAAIS,EAAI,CACP3L,SAAUA,EACVkL,KAAMA,EACNF,YAAajF,EAAQmF,GAIb,OAFT5E,EAAUoF,KAAMC,GAChBvD,EAAM,kBAAoBuD,EAAET,MACZS,GAEjB1N,OAAOuL,aAAe,SAAUoC,GAC/B,IAAK,IAAIb,EAAI,EAAGA,EAAIzE,EAAU9F,OAAQuK,IACjCzE,EAAWyE,IAAOa,IACrBtF,EAAU2E,OAAQF,EAAG,GACrB3C,EAAM,qBAKTnK,OAAOmL,YAAc,SAAUpJ,EAAUkL,GACxC,IAAIS,EAAI,CACP3L,SAAUA,EACVkL,KAAMA,EACNF,YAAajF,EAAQmF,GAItB,OAFA3E,EAAWmF,KAAMC,GACjBvD,EAAM,mBAAqBuD,EAAET,MACtBS,GAER1N,OAAOqL,cAAgB,SAAUsC,GAEhC,OADAxD,EAAM,kBACC,MAERnK,OAAOyL,sBAAwB,SAAU1J,GACxC0G,EAAgCgF,KAAM1L,IAEvC/B,OAAO6C,YAAYE,IAAM,WACxB,OAAOiF,GAaR,IACCzH,OAAOuB,eAAgB8L,iBAAiBhM,UAAW,cAAe,CAAEiM,IAAKR,IACzE9M,OAAOuB,eAAgBgM,iBAAiBlM,UAAW,cAAe,CAAEiM,IAAKR,IACxE,MAAOU,GACR5D,EAAK4D,IAMNC,GACA7F,EAASiF,QACT1E,GAAa,GAwMbuF,QA1GD,SAAmB9G,GAEduB,IAECN,EAAUO,iBAAmB,GArDnC,SAAsBxB,GAEjB8C,EAAiBiE,QAAU/G,EAAO+G,OAASjE,EAAiBkE,SAAWhH,EAAOgH,SACjFlE,EAAiBiE,MAAQ/G,EAAO+G,MAChCjE,EAAiBkE,OAAShH,EAAOgH,OACjCpE,EAAmB,IAAIqE,YAAanE,EAAiBkE,OAASlE,EAAiBiE,MAAQ,GACvFhE,EAAcmE,UAAY,KAC1BnE,EAAcoE,SAAU,EAAG,EAAGrE,EAAiBiE,MAAOjE,EAAiBkE,SAgDtEI,CAAapH,GA3ChB,SAAsBA,GAIrB+C,EAAcsE,UAAWrH,EAAQ,EAAG,GACpC6C,EAAYE,EAAcuE,aAAc,EAAG,EAAGxE,EAAiBiE,MAAOjE,EAAiBkE,QACvF,IAAK,IAAIrB,EAAI,EAAGA,EAAI/C,EAAiBxH,OAAQuK,GAAI,EAChD/C,EAAkB+C,IAAO9C,EAAUvD,KAAMqG,GACzC/C,EAAkB+C,EAAI,IAAO9C,EAAUvD,KAAMqG,EAAI,GACjD/C,EAAkB+C,EAAI,IAAO9C,EAAUvD,KAAMqG,EAAI,GAElDtE,IAiCEkG,CAAavH,GAETqB,GAA2B,GAAKJ,EAAUO,iBA/BjD,WAGC,IADA,IAAIlC,EAAOuD,EAAUvD,KACZqG,EAAI,EAAGA,EAAI/C,EAAiBxH,OAAQuK,GAAI,EAChDrG,EAAMqG,GAA8B,EAAxB/C,EAAkB+C,GAAU1E,EAAUO,iBAClDlC,EAAMqG,EAAI,GAAkC,EAA5B/C,EAAkB+C,EAAI,GAAU1E,EAAUO,iBAC1DlC,EAAMqG,EAAI,GAAkC,EAA5B/C,EAAkB+C,EAAI,GAAU1E,EAAUO,iBAO3D,IALAuB,EAAcyE,aAAc3E,EAAW,EAAG,GAC1C7B,EAASyG,IAAK3E,GACd1B,IACAC,EAA0B,EAC1B2B,EAAM,kBAAoB5B,EAAc,IAAOT,GACtCgF,EAAI,EAAGA,EAAI/C,EAAiBxH,OAAQuK,GAAI,EAChD/C,EAAkB+C,GAAM,EACxB/C,EAAkB+C,EAAI,GAAM,EAC5B/C,EAAkB+C,EAAI,GAAM,EAE7BpL,KAcGmN,GAEA3G,MAIDC,EAASyG,IAAKzH,GAEdgD,EAAM,kBADN5B,MA0FFwD,KAAMD,EACNoB,KAAMV,EACAhJ,GA5BJ,SAAcC,EAAOC,GAEjBH,EAAUE,GAASC,IAltB3BL,EAAezB,UAAUwL,MAAQ,aACjC/J,EAAezB,UAAUmK,KAAO,aAChC1I,EAAezB,UAAUgN,IAAM,aAC/BvL,EAAezB,UAAUsL,KAAO,aAChC7J,EAAezB,UAAUkN,QAAU,aACnCzL,EAAezB,UAAUmN,cAAgB,WAAY,OAAO,GAC5D1L,EAAezB,UAAUkH,KAAO,WAAatD,QAAQC,IAAK,kBAkB1Dd,EAAa/C,UAAYrB,OAAOyO,OAAQ3L,EAAezB,WAEvD+C,EAAa/C,UAAUwL,MAAQ,WAE7BhM,KAAK0N,WAIPnK,EAAa/C,UAAUgN,IAAM,SAAUjH,GAErC,IAAIsH,EAAa,IAAIC,WACrBD,EAAWE,OAAS,WAClB/N,KAAK0D,KAAKsK,OAAQ9N,EAAKF,KAAK2D,OAAU3D,KAAKwD,cAAe,IAAInC,WAAYwM,EAAWI,SAEjFjO,KAAKkC,SAASgM,aAAe,GAAOlO,KAAK6D,OAAS7D,KAAKkC,SAASoC,WAAetE,KAAKkC,SAASgM,aAC/FlO,KAAK8L,KAAM,SAAUvF,GACnBvG,KAAK4C,SAAW5C,KAAKyD,aAAe,SAAWvD,EAAKF,KAAK4D,MACzD/E,EAAU0H,EAAMvG,KAAK4C,SAAW5C,KAAKqD,UAAWrD,KAAKsD,UACrD,IAAIK,EAAQ3D,KAAK2D,MACjB3D,KAAK0N,UACL1N,KAAK2D,MAAQA,EAAM,EACnB3D,KAAK4D,OACL5D,KAAK4C,SAAW5C,KAAKyD,aAAe,SAAWvD,EAAKF,KAAK4D,MACzD5D,KAAK6D,OAAS,EACd7D,KAAK0H,QACL3C,KAAM/E,QAERA,KAAK2D,QACL3D,KAAK6D,SACL7D,KAAK0H,SAGP3C,KAAM/E,MACR6N,EAAWM,kBAAkB5H,IAI/BhD,EAAa/C,UAAUsL,KAAO,SAAUnL,GAEtCA,EAAUX,KAAK0D,KAAKoI,SAItBvI,EAAa/C,UAAUkN,QAAU,WAE/B1N,KAAK0D,KAAO,IAAIhF,EAChBsB,KAAK2D,MAAQ,GAafG,EAAatD,UAAYrB,OAAOyO,OAAQrK,EAAa/C,WAErDsD,EAAatD,UAAUgN,IAAM,SAAUzH,GAEtCA,EAAOtF,OAAQ,SAAU8F,GACxBhD,EAAa/C,UAAUgN,IAAI9K,KAAM1C,KAAMuG,IACtCxB,KAAM/E,MAAQA,KAAKY,OActBmD,EAAcvD,UAAYrB,OAAOyO,OAAQrK,EAAa/C,WAEtDuD,EAAcvD,UAAUgN,IAAM,SAAUzH,GAEvCA,EAAOtF,OAAQ,SAAU8F,GACxBhD,EAAa/C,UAAUgN,IAAI9K,KAAM1C,KAAMuG,IACtCxB,KAAM/E,MAAQA,KAAKY,KAAMZ,KAAKa,UAsCjCmD,EAAcxD,UAAYrB,OAAOyO,OAAQ3L,EAAezB,WAExDwD,EAAcxD,UAAUwL,MAAQ,SAAUjG,GAEzC/F,KAAK0N,WAIN1J,EAAcxD,UAAUgN,IAAM,SAAUzH,GAEtC/F,KAAKuE,YAAY6J,SAASrI,GAEvB/F,KAAKkC,SAASgM,aAAe,GAAOlO,KAAK6D,OAAS7D,KAAKkC,SAASoC,WAAetE,KAAKkC,SAASgM,aAChGlO,KAAK8L,KAAM,SAAUvF,GACpBvG,KAAK4C,SAAW5C,KAAKyD,aAAe,SAAWvD,EAAKF,KAAK4D,MACzD/E,EAAU0H,EAAMvG,KAAK4C,SAAW5C,KAAKqD,UAAWrD,KAAKsD,UACrDtD,KAAK0N,UACL1N,KAAK4D,OACL5D,KAAK4C,SAAW5C,KAAKyD,aAAe,SAAWvD,EAAKF,KAAK4D,MACzD5D,KAAK0H,QACJ3C,KAAM/E,QAENA,KAAK6D,SACP7D,KAAK0H,SAKP1D,EAAcxD,UAAUsL,KAAO,SAAUnL,GAEvCX,KAAKuE,YAAY8J,WAAWC,KAAK3N,IAInCqD,EAAcxD,UAAUkN,QAAU,SAAU3H,GAE3C/F,KAAK6D,OAAS,EACb7D,KAAKuE,YAAc,IAAIxF,EAAW,CAChC8B,QAASb,KAAKa,QACd2D,WAAY,KACZC,GAAI,KACJC,UAAW1E,KAAKsE,aAiCpBK,EAAsBnE,UAAYrB,OAAOyO,OAAQ3L,EAAezB,WAEhEmE,EAAsBnE,UAAUwL,MAAQ,WAEvChM,KAAK4E,QAAQoH,MAAOhM,KAAKkC,WAI1ByC,EAAsBnE,UAAUgN,IAAM,SAAUzH,GAE/C/F,KAAK4E,QAAQ4I,IAAKzH,IAInBpB,EAAsBnE,UAAUsL,KAAO,SAAUnL,GAE7CX,KAAKW,SAAWA,EAChBX,KAAK4E,QAAQ2J,OAIjB5J,EAAsBnE,UAAUmN,cAAgB,WAC5C,OAAO3N,KAAK4E,QAAQ+I,iBAoBxBlI,EAAgBjF,UAAYrB,OAAOyO,OAAQ3L,EAAezB,WAE1DiF,EAAgBjF,UAAUgN,IAAM,SAAUzH,GAEpC/F,KAAK0F,SACT1F,KAAK0F,OAASK,EAAOyI,cAAexO,KAAKsE,WACzCtE,KAAK2F,cAAgB,IAAI8I,cAAezO,KAAK0F,QAC7C1F,KAAK2F,cAAcqG,QAEnBhM,KAAK2F,cAAc+I,gBAAkB,SAASC,GAC7C3O,KAAK4F,OAAOyG,KAAKsC,EAAEtJ,OAClBN,KAAM/E,OAGTA,KAAK0H,QAINjC,EAAgBjF,UAAUsL,KAAO,SAAUnL,GAE1CX,KAAK2F,cAAciJ,OAAS,SAAUD,GACrC,IAAIpI,EAAO,IAAI/E,KAAMxB,KAAK4F,OAAQ,CAAE,KAAS,eAC7C5F,KAAK4F,OAAS,GACdjF,EAAU4F,IAETxB,KAAM/E,MAERA,KAAK2F,cAAcgF,QA4CpB9E,EAAarF,UAAYrB,OAAOyO,OAAQ3L,EAAezB,WAEvDqF,EAAarF,UAAUgN,IAAM,SAAUzH,GAEjC/F,KAAKkG,UACTlG,KAAK4E,QAAQiK,UAAW,QAAQ9I,EAAO+G,OACvC9M,KAAK4E,QAAQiK,UAAW,SAAS9I,EAAOgH,QACxC/M,KAAKkG,SAAU,GAGhBlG,KAAK+F,OAAO+G,MAAQ/G,EAAO+G,MAC3B9M,KAAK+F,OAAOgH,OAAShH,EAAOgH,OAC5B/M,KAAKgG,IAAIoH,UAAWrH,EAAQ,EAAG,GAE/B/F,KAAK4E,QAAQwJ,SAAUpO,KAAKgG,IAAK,CAAE8I,MAAM,EAAMC,MAAO/O,KAAKkC,SAASwF,OACpE1H,KAAK0H,QAUN7B,EAAarF,UAAUsL,KAAO,SAAUnL,GAEpCX,KAAKW,SAAWA,EAEnBX,KAAK4E,QAAQoK,WAqYblP,GAAcF,GAAY,IAAI4G,SAAWA,OAMhC,KAANyI,aACC,OAAOzI,GADF,8BAz5BR,K,wECAD,WACA,aAEA,IAAI0I,EAAS,CACX,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAErC,SAASC,EAAMhO,GACd,IAAIG,EAAG8N,EAAS,IAAI/N,WAAWF,GAC/B,IAAKG,EAAI,EAAGA,EAAIH,EAAQG,GAAK,EAC5B8N,EAAO9N,GAAK,EAEb,OAAO8N,EA8DRxQ,OAAOyQ,MAAQ,GACfzQ,OAAOyQ,MAAMF,MAAQA,EACrBvQ,OAAOyQ,MAAMnP,IApDb,SAAaoP,EAAKC,EAAOC,GAExB,OADAF,EAAMA,EAAIpM,SAASsM,GAAQ,GACpB,eAAerL,OAAOmL,EAAInO,OAAS,GAAKoO,GAASD,GAmDzD1Q,OAAOyQ,MAAMI,OA9Db,SAAgBC,EAAMvO,EAAQwO,EAAWC,GACxC,IACCR,EAASD,GAAO9P,UADH8B,EAASwO,GACaC,GAAc,GAAKA,GAIvD,OAFAR,EAAOS,IAAIH,GAEJN,GAyDRxQ,OAAOyQ,MAAMS,cAjDb,SAAwBC,EAAOC,EAAKC,GACnC,IAAI3O,EAAGH,EAKP,IAHA6O,EAAMA,GAAOb,EAAMY,EAAM5O,QAEzB8O,EAASA,GAAU,EACd3O,EAAI,EAAGH,EAAS4O,EAAM5O,OAAQG,EAAIH,EAAQG,GAAK,EACnD0O,EAAIC,GAAUF,EAAMxO,WAAWD,GAC/B2O,GAAU,EAGX,OAAOD,GAuCRpR,OAAOyQ,MAAMa,cApCb,SAAuBC,GACtB,IAAI7O,EAGH8O,EAAMjP,EAEmBmO,EAJzBe,EAAaF,EAAMhP,OAAS,EAC5BmP,EAAS,GAQV,IAAKhP,EAAI,EAAGH,EAASgP,EAAMhP,OAASkP,EAAY/O,EAAIH,EAAQG,GAAK,EAChE8O,GAAQD,EAAM7O,IAAM,KAAO6O,EAAM7O,EAAI,IAAM,GAAM6O,EAAM7O,EAAI,GAC3DgP,GANOpB,GADkBI,EAOCc,IANL,GAAK,IAAQlB,EAAOI,GAAO,GAAK,IAAQJ,EAAOI,GAAO,EAAI,IAAQJ,EAAa,GAANI,GAU/F,OAAQgB,EAAOnP,OAAS,GACvB,KAAK,EACJmP,GAAU,IACV,MACD,KAAK,EACJA,GAAU,KAMZ,OAAOA,GA7ER,GAwFA,WACA,aAwBA,IACCC,EADGlB,EAAQzQ,OAAOyQ,MAGnBkB,EAAe,CACd,CACC,MAAS,WACT,OAAU,KAEX,CACC,MAAS,WACT,OAAU,GAEX,CACC,MAAS,MACT,OAAU,GAEX,CACC,MAAS,MACT,OAAU,GAEX,CACC,MAAS,WACT,OAAU,IAEX,CACC,MAAS,QACT,OAAU,IAEX,CACC,MAAS,WACT,OAAU,GAEX,CACC,MAAS,OACT,OAAU,GAEX,CACC,MAAS,WACT,OAAU,KAEX,CACC,MAAS,QACT,OAAU,GAEX,CACC,MAAS,QACT,OAAU,IAEX,CACC,MAAS,QACT,OAAU,IAEX,CACC,MAAS,cACT,OAAU,GAEX,CACC,MAAS,cACT,OAAU,GAEX,CACC,MAAS,iBACT,OAAU,KAEX,CACC,MAAS,UACT,OAAU,KA0BZ3R,OAAO4R,OAAS,GAChB5R,OAAO4R,OAAOC,UAAYF,EAC1B3R,OAAO4R,OAAOjH,OAxBd,SAAsBlE,EAAMH,GAC3B,IAAIkK,EAASC,EAAMF,MAAM,KACxBc,EAAS,EAcV,OAZAM,EAAavF,SAAQ,SAAU9L,GAC9B,IACCoC,EAAGH,EADAuP,EAAMrL,EAAKnG,EAAMyR,QAAU,GAG/B,IAAKrP,EAAI,EAAGH,EAASuP,EAAIvP,OAAQG,EAAIH,EAAQG,GAAK,EACjD8N,EAAOa,GAAUS,EAAInP,WAAWD,GAChC2O,GAAU,EAGXA,GAAU/Q,EAAMiC,OAASG,KAGR,oBAAP4D,EACHA,EAAGkK,EAAQa,GAEZb,GAlHR,GA0HA,WACA,aAEA,IAGCwB,EAHGJ,EAAS5R,OAAO4R,OACnBnB,EAAQzQ,OAAOyQ,MACfwB,EAAa,IAGd,SAASnS,EAAIoS,GACZ9Q,KAAK+Q,QAAU,EACfH,GAAaE,GAAmB,IAAMD,EACtC7Q,KAAKgQ,IAAMX,EAAMF,MAAMyB,GACvB5Q,KAAKgR,OAAS,GACdhR,KAAKmB,OAAS,EAGfzC,EAAI8B,UAAUwN,OAAS,SAAUiD,EAAUlB,EAAOmB,EAAMvQ,GACvD,IAAI0E,EACH8L,EACAC,EACAC,EACAC,EACAC,EACAC,EAED,GAAqB,kBAAVzB,EACVA,EAAQV,EAAMS,cAAcC,QACtB,GAAIA,EAAM0B,cAAgBpQ,WAAWb,UAAUiR,YACrD,KAAM,oCAAsC1B,EAAM0B,YAAYvO,WAAWwO,MAAM,6CAA6C,GAGzG,oBAATR,IACCA,EACXA,EAAO,IAKRE,GAFAF,EAAOA,GAAQ,IAEHE,MAA6B,KAArB/R,SAAS,MAAO,GACpCgS,EAAQH,EAAKG,OAAStO,KAAKC,OAAO,IAAItB,KAAS,KAC/C4P,EAAMJ,EAAKI,KAAO,EAClBC,EAAML,EAAKK,KAAO,EAElBlM,EAAO,CACNsM,SAAUV,EACVW,SAAUvC,EAAMnP,IAAIkR,EAAM,GAC1BE,IAAKjC,EAAMnP,IAAIoR,EAAK,GACpBC,IAAKlC,EAAMnP,IAAIqR,EAAK,GACpBM,SAAUxC,EAAMnP,IAAI6P,EAAM5O,OAAQ,IAClCkQ,MAAOhC,EAAMnP,IAAImR,EAAO,IACxBF,SAAU,WACVvQ,KAAM,IACNkR,MAAO,UACPC,MAAOb,EAAKa,OAAS,GACrBC,MAAOd,EAAKc,OAAS,IAItBb,EAAW,EACXhS,OAAOqK,KAAKnE,GAAM2F,SAAQ,SAAUiH,GACnC,IAAI3Q,EAAsBH,EAAnBjC,EAAQmG,EAAK4M,GAEpB,IAAK3Q,EAAI,EAAGH,EAASjC,EAAMiC,OAAQG,EAAIH,EAAQG,GAAK,EACnD6P,GAAYjS,EAAMqC,WAAWD,MAI/B+D,EAAK8L,SAAW9B,EAAMnP,IAAIiR,EAAU,GAAK,MAEzCK,EAAYhB,EAAOjH,OAAOlE,GAE1B,IAAI6M,EAAenP,KAAKoP,KAAMX,EAAUrQ,OAAS0P,GAAeA,EAC5DuB,EAAcrP,KAAKoP,KAAMpC,EAAM5O,OAAS0P,GAAeA,EAE3D7Q,KAAKgR,OAAO3E,KAAM,CAAEmE,OAAQgB,EAAWzB,MAAOA,EAAOmC,aAAcA,EAAcE,YAAaA,KAI/F1T,EAAI8B,UAAUsL,KAAO,WAEpB,IAAIuG,EAAU,GACVzM,EAAS,GACTzE,EAAS,EACTmR,EAAMvP,KAAKwP,IAAK,EAAG,IAEnBC,EAAQ,GA4BZ,OA3BAxS,KAAKgR,OAAOhG,SAAS,SAAUyH,GAC1BtR,EAASsR,EAAEP,aAAeO,EAAEL,YAAcE,IAC7C1M,EAAOyG,KAAM,CAAE2E,OAAQwB,EAAOrR,OAAQA,IACtCqR,EAAQ,GACRrR,EAAS,GAEVqR,EAAMnG,KAAMoG,GACZtR,GAAUsR,EAAEP,aAAeO,EAAEL,eAE9BxM,EAAOyG,KAAM,CAAE2E,OAAQwB,EAAOrR,OAAQA,IAEtCyE,EAAOoF,SAAS,SAAU0H,GAEzB,IAAItD,EAAS,IAAI/N,WAAYqR,EAAEvR,QAC3B4P,EAAU,EACd2B,EAAE1B,OAAOhG,SAAS,SAAUyH,GAC3BrD,EAAOS,IAAK4C,EAAEjC,OAAQO,GACtBA,GAAW0B,EAAEP,aACb9C,EAAOS,IAAK4C,EAAE1C,MAAOgB,GACrBA,GAAW0B,EAAEL,eAEdC,EAAQhG,KAAM+C,MAIfiD,EAAQhG,KAAM,IAAIhL,WAAY,OAEvB,IAAIG,KAAM6Q,EAAS,CAAEzR,KAAM,kBAInClC,EAAI8B,UAAUmS,MAAQ,WACrB3S,KAAK+Q,QAAU,EACf/Q,KAAKgQ,IAAMX,EAAMF,MAAMyB,IAGuC,qBAAnBpS,EAAOC,QAClDD,EAAOC,QAAUC,EAEjBE,OAAOF,IAAMA,EA7Hd,I,qBClND,UAYEuQ,EAAO,QAAD,6BAUA,WAEP,OAAO,SAASpQ,EAASwG,EAAMuN,EAAaC,GAE3C,IASCtM,EACAuM,EAVGjT,EAAOjB,OACVmU,EAAc,2BACdzP,EAAWuP,GAAeE,EAC1BC,EAAU3N,EACVL,GAAO4N,IAAgBC,GAAeG,EACtCC,EAAShP,SAASC,cAAc,KAChChB,EAAW,SAASgQ,GAAG,OAAO9S,OAAO8S,IACrCC,EAAUtT,EAAK2B,MAAQ3B,EAAKuT,SAAWvT,EAAKwT,YAAcnQ,EAC1DyO,EAAWiB,GAAe,WAY3B,GATAO,EAAQA,EAAOzQ,KAAOyQ,EAAOpO,KAAKlF,GAAQ2B,KAExB,SAAfpB,OAAOJ,QAETsD,GADA0P,EAAQ,CAACA,EAAS1P,IACD,GACjB0P,EAAQA,EAAQ,IAIdhO,GAAOA,EAAI7D,OAAQ,OACrBwQ,EAAW3M,EAAI/D,MAAM,KAAKqS,MAAMrS,MAAM,KAAK,GAC3CgS,EAAOM,KAAOvO,GACmB,IAA9BiO,EAAOM,KAAKC,QAAQxO,IAAY,CAClC,IAAIyO,EAAK,IAAIC,eAOb,OANAD,EAAKE,KAAM,MAAO3O,GAAK,GACvByO,EAAKG,aAAe,OACpBH,EAAK1F,OAAQ,SAASY,GACrB9P,EAAS8P,EAAEkF,OAAOC,SAAUnC,EAAUoB,IAEvClJ,YAAW,WAAY4J,EAAKM,SAAU,GAC/BN,EAMT,GAAG,iCAAiCO,KAAKhB,GAAS,CAEjD,KAAGA,EAAQ7R,OAAU,aAAoBgS,IAAWjQ,GAInD,OAAO+Q,UAAUC,WAChBD,UAAUC,WAAWC,EAAcnB,GAAUrB,GAC7CyC,EAAMpB,GAJP1P,GADA0P,EAAQmB,EAAcnB,IACLpS,MAAQmS,OAQ1B,GAAG,gBAAgBiB,KAAKhB,GAAS,CAEhC,IADA,IAAI1R,EAAE,EAAG+S,EAAW,IAAIhT,WAAW2R,EAAQ7R,QAASmT,EAAGD,EAAUlT,OAC3DG,EAAEgT,IAAKhT,EAAG+S,EAAU/S,GAAI0R,EAAQzR,WAAWD,GACjD0R,EAAQ,IAAIG,EAAO,CAACkB,GAAY,CAACzT,KAAM0C,IAQzC,SAAS6Q,EAAcI,GAUtB,IATA,IAAIC,EAAOD,EAAOtT,MAAM,SACvBL,EAAM4T,EAAM,GAGZC,GADgC,UAAvBD,EADMD,EAAOf,QAAQ,WAAW,EAAI,EAAG,GACLzS,KAAO2T,oBAChCF,EAAMlB,OACxBgB,EAAIG,EAAQtT,OACZG,EAAG,EACHqT,EAAO,IAAItT,WAAWiT,GAEjBhT,EAAEgT,IAAKhT,EAAGqT,EAAMrT,GAAImT,EAAQlT,WAAWD,GAE7C,OAAO,IAAI6R,EAAO,CAACwB,GAAQ,CAAC/T,KAAMA,IAGnC,SAASwT,EAAMpP,EAAK4P,GAEnB,GAAI,aAAc3B,EAgBjB,OAfAA,EAAOM,KAAOvO,EACdiO,EAAO4B,aAAa,WAAYlD,GAChCsB,EAAO6B,UAAY,mBACnB7B,EAAO8B,UAAY,iBACnB9B,EAAOlL,MAAMN,QAAU,OACvBwL,EAAO+B,iBAAiB,SAAS,SAASrG,GACzCA,EAAEsG,kBACFjV,KAAKkV,oBAAoB,QAASvS,UAAUwS,WAE7ClR,SAASwE,KAAKC,YAAYuK,GAC1BpJ,YAAW,WACVoJ,EAAOmC,QACPnR,SAASwE,KAAK4M,YAAYpC,IACb,IAAV2B,GAAgB/K,YAAW,WAAYhK,EAAKwG,IAAIiP,gBAAgBrC,EAAOM,QAAS,OACjF,KACI,EAIR,GAAG,gDAAgDS,KAAKC,UAAUsB,WAKjE,MAJG,SAASvB,KAAKhP,KAAMA,EAAI,QAAQA,EAAIwQ,QAAQ,sBAAuBzC,IAClEnU,OAAO+U,KAAK3O,IACZyQ,QAAQ,oGAAoGC,SAASnC,KAAKvO,IAEvH,EAIR,IAAI2Q,EAAI1R,SAASC,cAAc,UAC/BD,SAASwE,KAAKC,YAAYiN,IAEtBf,GAAW,SAASZ,KAAKhP,KAC5BA,EAAI,QAAQA,EAAIwQ,QAAQ,sBAAuBzC,IAEhD4C,EAAEC,IAAI5Q,EACN6E,YAAW,WAAY5F,SAASwE,KAAK4M,YAAYM,KAAO,KAOzD,GAjEApP,EAAOyM,aAAmBG,EACzBH,EACA,IAAIG,EAAO,CAACH,GAAU,CAACpS,KAAM0C,IA+D1B2Q,UAAUC,WACb,OAAOD,UAAUC,WAAW3N,EAAMoL,GAGnC,GAAG9R,EAAKwG,IACP+N,EAAMvU,EAAKwG,IAAIC,gBAAgBC,IAAO,OAClC,CAEJ,GAAmB,kBAATA,GAAqBA,EAAKkL,cAAcvO,EACjD,IACC,OAAOkR,EAAO,QAAW9Q,EAAa,WAAezD,EAAKgW,KAAKtP,IAC/D,MAAMuP,GACN,OAAO1B,EAAO,QAAW9Q,EAAa,IAAMyS,mBAAmBxP,KAKjEuM,EAAO,IAAIhF,YACJC,OAAO,SAASY,GACtByF,EAAMpU,KAAKiO,SAEZ6E,EAAOkD,cAAczP,GAEtB,OAAO,KA7JD,gC,oBCZP,SAASmM,GAAG,SAASQ,EAAET,EAAEpH,GAAG,GAAG,GAAG4K,eAAevT,KAAKwQ,EAAEgD,MAAMzD,GAAG,OAAOS,EAAEgD,MAAMzD,GAAG,IAAI9D,EAAEuE,EAAEiD,QAAQ1D,GAAG,IAAI9D,EAAE,MAAM,IAAIyH,MAAM,4BAA4B3D,GAAG,IAAIC,EAAE,CAACnG,GAAGkG,EAAE9T,QAAQuU,EAAEtQ,SAAS6P,EAAEhU,QAAQ,GAAG4X,QAAO,EAAGC,OAAOjL,EAAEkL,SAAS,IAAIlL,GAAGA,EAAEkL,SAASlK,KAAKqG,GAAG,IAAIiD,EAAElD,EAAEpS,MAAM,EAAEoS,EAAE+D,YAAY,KAAK,GAAG,OAAOtD,EAAEgD,MAAMzD,GAAGC,EAAEjU,QAAQkQ,EAAEjM,KAAKgQ,EAAEjU,QAAQiU,EAAEA,EAAEjU,QAAQkX,EAAElD,GAAGC,EAAE2D,QAAO,EAAGnD,EAAEgD,MAAMzD,GAAGC,EAAEjU,QAAQyU,EAAEuD,QAAQ,GAAGvD,EAAEgD,MAAM,GAAGhD,EAAEiD,QAAQ,SAAS1D,GAAG,MAAM,GAAGwD,eAAevT,KAAKwQ,EAAEuD,QAAQhE,GAAGS,EAAEuD,QAAQhE,QAAG,GAAQS,EAAEjE,OAAO,SAASwD,EAAEC,GAAGQ,EAAEuD,QAAQhE,GAAGC,GAAG,IAAID,EAAE,SAASS,GAAG,OAAOA,EAAE,IAAI,CAACwD,MAAM,UAAUC,QAAQ,WAAWC,SAAQ,EAAGC,IAAI,GAAGC,KAAK,GAAGC,SAASrE,EAAEsE,cAAc,SAAS9D,GAAGrJ,WAAWqJ,EAAE,IAAI+D,IAAI,WAAW,OAAO/D,GAAGgE,MAAM,SAASzE,GAAGS,EAAET,IAA1L,GAAiMS,EAAEjE,OAAO,eAAc,SAAS5D,EAAE8L,EAAEC,EAAEC,GAAG,SAASC,EAAEpE,EAAET,GAAG,MAAM,GAAGwD,eAAevT,KAAKwQ,EAAET,GAAsP,IAAI8E,EAAE7E,EAAEiD,EAAElD,EAAE9D,EAAEgH,EAAEzC,EAAE,SAAS7H,GAAGmM,aAAaD,EAAErE,EAAE,kBAAkB7H,GAAGsD,EAAE,SAAStD,GAAG,SAAS6H,EAAE7H,GAAG,IAAI6H,EAAET,EAA8G,IAAIS,KAAhHlT,KAAKyX,SAAQ,EAAGzX,KAAK0X,QAAQ,GAAG1X,KAAK6D,OAAO,GAAG7D,KAAK2X,YAAY,GAAG3X,KAAK4X,cAAc,GAAG5X,KAAK6X,WAAWxM,GAAYqH,EAAED,EAAEC,EAAEQ,GAAG,MAAMlT,KAAK0X,QAAQxE,GAAGlT,KAAK0X,QAAQxE,GAAGlT,KAAK0X,QAAQxE,GAAGT,EAAE,OAA5b,SAAWS,EAAET,GAAG,SAASpH,IAAIrL,KAAKyR,YAAYyB,EAAE,IAAI,IAAIR,KAAKD,EAAE6E,EAAE7E,EAAEC,KAAKQ,EAAER,GAAGD,EAAEC,IAAWrH,EAAE7K,UAAUiS,EAAEjS,UAAU0S,EAAE1S,UAAU,IAAI6K,EAAE6H,EAAE4E,UAAUrF,EAAEjS,UAAiTc,CAAE4R,EAAE7H,GAAGqH,EAAE,CAACtM,aAAa,gBAAgBN,QAAQ,EAAEiS,OAAO,EAAEC,WAAW,OAAOnX,QAAQ,GAAGiM,MAAM,KAAKC,OAAO,KAAKkL,YAAY,MAAMxF,EAAE,CAAC1D,MAAM,IAAID,MAAK,GAAIoE,EAAE1S,UAAUqO,UAAU,SAASqE,EAAET,GAAG,OAAOzS,KAAK0X,QAAQxE,GAAGT,EAAE,MAAMzS,KAAKkY,SAAc,UAAJhF,GAAiB,WAAJA,OAAgC,EAAlBlT,KAAKkY,QAAQhF,GAAGT,GAAUS,EAAE1S,UAAUqX,WAAW,SAASpF,GAAG,IAAIS,EAAER,EAAE,OAAO,SAASrH,GAAG,IAAI6H,KAAKT,EAAO6E,EAAE7E,EAAES,KAAYR,EAAED,EAAES,GAAG7H,EAAEgB,KAAKrM,KAAK6O,UAAUqE,EAAER,KAAI,OAAOrH,GAAG3I,KAAK1C,KAAK,KAAKkT,EAAE1S,UAAU4N,SAAS,SAAS8E,EAAE7H,GAAG,IAAIqH,EAAE/D,EAA8D,IAAIA,KAAhE,MAAMtD,IAAIA,EAAE,KAAIqH,EAAE,IAAKuF,YAAYjY,KAAK0X,QAAQO,YAAqBxF,EAAEC,EAAE/D,GAAGtD,EAAEsD,IAAI8D,EAAE9D,GAAG,GAAG,MAAM3O,KAAK0X,QAAQ5K,OAAO9M,KAAK6O,UAAU,QAAQqE,EAAEpG,OAAO,MAAM9M,KAAK0X,QAAQ3K,QAAQ/M,KAAK6O,UAAU,SAASqE,EAAEnG,QAAQ,qBAAqBoL,WAAW,MAAMA,WAAWjF,aAAaiF,UAAUzF,EAAErN,KAAK6N,EAAE7N,UAAU,GAAG,qBAAqB+S,0BAA0B,MAAMA,0BAA0BlF,aAAakF,0BAA0B,qBAAqBC,uBAAuB,MAAMA,uBAAuBnF,aAAamF,sBAAsBhN,EAAEyD,KAAK4D,EAAErN,KAAKrF,KAAKsY,eAAepF,GAAGR,EAAE6F,QAAQrF,MAAO,IAAG,MAAMA,EAAEsF,WAA6D,MAAM,IAAIpC,MAAM,iBAAlE/K,EAAEyD,KAAK4D,EAAErN,KAAKrF,KAAKqN,aAAa6F,GAAGR,EAAE+F,MAAMvF,EAAwC,OAAOlT,KAAK6D,OAAOwI,KAAKqG,IAAIQ,EAAE1S,UAAUwO,OAAO,WAAW,IAAMkE,EAAE,GAAGlT,KAAKyX,QAAQ,MAAM,IAAIrB,MAAM,mBAAmB,GAAK,MAAMpW,KAAK0X,QAAQ5K,OAAO,MAAM9M,KAAK0X,QAAQ3K,OAAQ,MAAM,IAAIqJ,MAAM,mDAAmDpW,KAAKyX,SAAQ,EAAGzX,KAAK0Y,UAAU,EAAE1Y,KAAK2Y,eAAe,EAAE3Y,KAAK4Y,WAAW,SAASlG,GAAG,IAAI,IAAID,EAAE,WAAW,IAAIA,EAAEA,EAAE,GAAG,IAAI,IAAIS,EAAE,EAAE,GAAGlT,KAAK6D,OAAO1C,OAAO+R,EAAElT,KAAK6D,OAAO1C,OAAO+R,EAAElT,KAAK6D,OAAO1C,OAAO,GAAGnB,KAAK6D,OAAO1C,SAAS+R,IAAIA,EAAET,EAAEpG,KAAK6G,GAAG,OAAOT,GAAGjQ,MAAMxC,KAAK2C,WAAWuQ,EAAE,EAAEvE,EAAE8D,EAAEtR,OAAO+R,EAAEvE,IAAIuE,EAAIT,EAAES,GAAGR,EAAErG,KAAK,MAAM,OAAOqG,GAAGhQ,KAAK1C,KAAK,IAAIkT,EAAElT,KAAK6Y,eAAe,IAAI,IAAInG,EAAE,WAAW,IAAIA,EAAEA,EAAE,GAAG,IAAI,IAAID,EAAE,EAAE,GAAGS,EAAET,EAAES,EAAET,EAAES,EAAE,GAAGA,IAAIT,IAAIA,EAAEC,EAAErG,KAAKoG,GAAG,OAAOC,GAAGlQ,MAAMxC,KAAK2C,WAAW8P,EAAE,EAAE9D,EAAE+D,EAAEvR,OAAOsR,EAAE9D,IAAI8D,EAAIC,EAAED,GAAGzS,KAAK8Y,kBAAkB,OAAO9Y,KAAKuC,KAAK,SAASvC,KAAKuC,KAAK,WAAW,IAAI2Q,EAAE1S,UAAUuY,MAAM,WAAiB,IAAN,IAAI7F,EAA8C,OAA/BA,EAAElT,KAAK4X,cAAcoB,UAAyB5U,QAAQC,IAAI,yBAAyB6O,EAAE+F,YAAY,OAAOjZ,KAAKyX,SAAQ,EAAGzX,KAAKuC,KAAK,UAAU2Q,EAAE1S,UAAUqY,aAAa,WAAW,IAAI3F,EAAE,OAAOA,EAAEnQ,KAAKmW,IAAIlZ,KAAK0X,QAAQ5R,QAAQ9F,KAAK6D,OAAO1C,QAAQ,WAAW,IAAIuR,EAAEA,EAAE,GAAG,IAAI,IAAID,EAAEzS,KAAK2X,YAAYxW,OAAOnB,KAAK2X,YAAYxW,QAAQ+R,EAAET,EAAES,EAAET,EAAES,EAAElT,KAAK2X,YAAYxW,QAAQ+R,IAAIT,IAAIA,EAAEC,EAAErG,KAAKoG,GAAG,OAAOC,GAAGlQ,MAAMxC,KAAK2C,WAAWqI,QAAQ,SAASkI,GAAG,OAAO,SAASR,GAAG,IAAID,EAAE,OAAOrO,QAAQC,IAAI,mBAAmBqO,IAAGD,EAAE,IAAI0G,OAAOjG,EAAEwE,QAAQtR,eAAgBgT,UAAU,SAASlG,GAAG,OAAO,SAASR,GAAG,OAAOQ,EAAE0E,cAAchM,OAAOsH,EAAE0E,cAAcpE,QAAQf,GAAG,GAAGS,EAAEyE,YAAYtL,KAAKoG,GAAGS,EAAEmG,cAAc3G,EAAErN,OAAnI,CAA2I6N,GAAGA,EAAEyE,YAAYtL,KAAKoG,IAAhS,CAAqSzS,OAAOkT,GAAGA,EAAE1S,UAAU6Y,cAAc,SAASnG,GAAG,OAAO9O,QAAQC,IAAI,SAAS6O,EAAEoG,MAAM,eAAetZ,KAAK4X,cAAczW,OAAO,WAAWnB,KAAK2Y,iBAAiB3Y,KAAKuC,KAAK,WAAWvC,KAAK2Y,eAAe3Y,KAAK6D,OAAO1C,QAAQnB,KAAK4Y,WAAW1F,EAAEoG,OAAOpG,EAA97G,SAAW7H,EAAEoH,GAAG,IAAI,IAAIS,EAAE,EAAER,EAAED,EAAEtR,OAAO+R,EAAER,IAAIQ,EAAE,GAAGA,KAAKT,GAAGA,EAAES,KAAK7H,EAAE,OAAM,EAAG,OAAM,EAA82GK,CAAE,KAAK1L,KAAK4Y,YAAY5Y,KAAK8Y,kBAAkB9Y,KAAKuZ,mBAAmBrG,EAAE1S,UAAU+Y,gBAAgB,WAAW,IAAI5K,EAAEuE,EAAEmE,EAAEF,EAAE1E,EAAEpH,EAAEkM,EAAE9E,EAAE,EAAE,IAAI,IAAIkD,EAAE,EAAEjK,EAAE1L,KAAK4Y,WAAWzX,OAAOwU,EAAEjK,IAAIiK,EAAuBlD,KAArBS,EAAElT,KAAK4Y,WAAWjD,IAAStQ,KAAKlE,OAAO,GAAG+R,EAAEsG,SAAStG,EAAEuG,OAAOhH,GAAGS,EAAEsG,SAAStG,EAAEuG,OAAOrV,QAAQC,IAAI,iCAAiCtB,KAAK2W,MAAMjH,EAAE,KAAK,MAAM9D,EAAE,IAAItN,WAAWoR,GAAGpH,EAAE,EAAE,IAAI,IAAIiM,EAAE,EAAEF,EAAEpX,KAAK4Y,WAAWzX,OAAOmW,EAAEF,IAAIE,EAAwB,IAAI,IAAI5E,EAAE,EAAEpR,GAAjC4R,EAAElT,KAAK4Y,WAAWtB,IAAmBjS,KAAKlE,OAAOuR,EAAEpR,IAAIoR,EAAE6E,EAAErE,EAAE7N,KAAKqN,GAAG2E,EAAE3E,EAAE/D,EAAEkB,IAAI0H,EAAElM,GAAGgM,IAAInE,EAAE7N,KAAKlE,OAAO,EAAEkK,GAAG6H,EAAEuG,OAAOpO,GAAG6H,EAAEsG,SAAS,OAAOrC,EAAE,IAAI3V,KAAK,CAACmN,GAAG,CAAC/N,KAAK,cAAcZ,KAAKuC,KAAK,WAAW4U,EAAExI,IAAIuE,EAAE1S,UAAUsY,gBAAgB,WAAW,IAAIpG,EAAEQ,EAAET,EAAE,GAA6B,IAA1BzS,KAAK2X,YAAYxW,OAAW,MAAM,IAAIiV,MAAM,mBAAmB,OAAOpW,KAAK0Y,WAAW1Y,KAAK6D,OAAO1C,YAAO,GAAQuR,EAAE1S,KAAK6D,OAAO7D,KAAK0Y,aAAajG,EAAEzS,KAAK2X,YAAYqB,QAAQ9F,EAAElT,KAAK2Z,QAAQjH,GAAGtO,QAAQC,IAAI,mBAAmB6O,EAAEoG,MAAM,GAAG,OAAOtZ,KAAK6D,OAAO1C,QAAQnB,KAAK4X,cAAcvL,KAAKoG,GAAGA,EAAEmH,YAAY1G,KAAKA,EAAE1S,UAAU8X,eAAe,SAASpF,GAAG,OAAOA,EAAE7F,aAAa,EAAE,EAAErN,KAAK0X,QAAQ5K,MAAM9M,KAAK0X,QAAQ3K,QAAQ1H,MAAM6N,EAAE1S,UAAU6M,aAAa,SAASoF,GAAG,IAAIS,EAAE,OAAO,MAAMlT,KAAKkY,UAAUlY,KAAKkY,QAAQjU,SAASC,cAAc,UAAUlE,KAAKkY,QAAQpL,MAAM9M,KAAK0X,QAAQ5K,MAAM9M,KAAKkY,QAAQnL,OAAO/M,KAAK0X,QAAQ3K,SAAQmG,EAAElT,KAAKkY,QAAQjS,WAAW,OAAQ4T,QAAQ7Z,KAAK0X,QAAQM,WAAW9E,EAAEhG,SAAS,EAAE,EAAElN,KAAK0X,QAAQ5K,MAAM9M,KAAK0X,QAAQ3K,QAAQmG,EAAE9F,UAAUqF,EAAE,EAAE,GAAGzS,KAAKsY,eAAepF,IAAIA,EAAE1S,UAAUmZ,QAAQ,SAASzG,GAAG,IAAIR,EAAED,EAAE,GAA4BA,EAAE,CAAC6G,MAA5B5G,EAAE1S,KAAK6D,OAAO2P,QAAQN,GAAc4G,KAAKpH,IAAI1S,KAAK6D,OAAO1C,OAAO,EAAE4N,MAAMmE,EAAEnE,MAAMkJ,YAAY/E,EAAE+E,YAAYnL,MAAM9M,KAAK0X,QAAQ5K,MAAMC,OAAO/M,KAAK0X,QAAQ3K,OAAOlM,QAAQb,KAAK0X,QAAQ7W,QAAQkX,OAAO/X,KAAK0X,QAAQK,OAAOgC,YAAqB,WAATxC,EAAE1U,MAAiB,MAAMqQ,EAAE7N,KAAKoN,EAAEpN,KAAK6N,EAAE7N,UAAU,GAAG,MAAM6N,EAAEqF,QAAQ9F,EAAEpN,KAAKrF,KAAKsY,eAAepF,EAAEqF,aAAc,IAAG,MAAMrF,EAAEuF,MAA6C,MAAM,IAAIrC,MAAM,iBAAvD3D,EAAEpN,KAAKrF,KAAKqN,aAAa6F,EAAEuF,OAA6C,OAAOhG,GAAGS,EAA5/J,CAA+/JyC,GAAGtK,EAAE5M,QAAQkQ,KAAIuE,EAAEjE,OAAO,mBAAkB,SAAS0G,EAAE2B,EAAEC,EAAEjW,GAAG,IAAI4R,EAAE7H,EAAEsD,EAAE+D,EAAED,EAAEC,EAAEuB,UAAUsB,UAAUyE,cAAcrL,EAAEsF,UAAUgG,SAASD,cAA2I3O,EAAS,QAAtIoH,EAAEC,EAAEhB,MAAM,gGAAgG,CAAC,KAAK,UAAU,IAAO,IAAWzN,SAASiW,cAAahH,EAAE,CAACrQ,KAAY,YAAP4P,EAAE,GAAeA,EAAE,GAAGA,EAAE,GAAGkE,QAAQtL,GAAGjM,WAAkB,UAAPqT,EAAE,IAAcA,EAAE,GAAGA,EAAE,GAAGA,EAAE,IAAIwH,SAAS,CAACpX,KAAK6P,EAAEhB,MAAM,oBAAoB,OAAOgB,EAAEhB,MAAM,sBAAsB/C,EAAE+C,MAAM,kBAAkB,CAAC,UAAU,MAAOwB,EAAErQ,OAAM,EAAGqQ,EAAEA,EAAErQ,KAAKxD,SAAS6T,EAAEyD,QAAQ,MAAK,EAAGzD,EAAE+G,SAAS/G,EAAE+G,SAASpX,OAAM,EAAG8S,EAAElX,QAAQyU,KAAIA,EAAEjE,OAAO,UAAS,SAAS0G,EAAEhH,EAAE2I,EAAEC,GAAG9E,EAAE+E,eAAe/E,EAAE+E,aAAa,cAAc,IAAItE,EAAEvE,EAAE6I,aAAa/E,EAAE+E,aAAa9E,EAAyB,oBAAhBjQ,MAAM0X,QAAqB1X,MAAM0X,QAAQ,SAASjH,GAAG,MAA2C,mBAApC/T,OAAOqB,UAAU0C,SAASR,KAAKwQ,IAA4BA,EAAE1S,UAAU4Z,gBAAgB,SAASlH,GAAGlT,KAAKqa,UAAUra,KAAKqa,QAAQ,IAAIra,KAAKqa,QAAQC,aAAapH,GAAGA,EAAE1S,UAAU+B,KAAK,SAASoT,GAAG,GAAO,UAAJA,KAAgB3V,KAAKqa,UAASra,KAAKqa,QAAQE,OAAQ7H,EAAE1S,KAAKqa,QAAQE,SAASva,KAAKqa,QAAQE,MAAMpZ,QAAQ,MAAMwB,UAAU,aAAayT,MAAMzT,UAAU,GAAG,IAAIyT,MAAM,wCAAwC,IAAIpW,KAAKqa,QAAQ,OAAM,EAAG,IAAInH,EAAElT,KAAKqa,QAAQ1E,GAAG,IAAIzC,EAAE,OAAM,EAAG,GAAe,mBAAHA,EAAe,IAAGR,EAAEQ,GAAG,CAA2D,IAA1D,IAAIT,EAAEhQ,MAAMjC,UAAUH,MAAMqC,KAAKC,UAAU,GAAGgM,EAAEuE,EAAE7S,QAAgBgL,EAAE,EAAEiM,EAAE3I,EAAExN,OAAOkK,EAAEiM,EAAEjM,IAAIsD,EAAEtD,GAAG7I,MAAMxC,KAAKyS,GAAG,OAAM,EAAQ,OAAM,EAAG,OAAO9P,UAAUxB,QAAQ,KAAK,EAAE+R,EAAExQ,KAAK1C,MAAM,MAAM,KAAK,EAAEkT,EAAExQ,KAAK1C,KAAK2C,UAAU,IAAI,MAAM,KAAK,EAAEuQ,EAAExQ,KAAK1C,KAAK2C,UAAU,GAAGA,UAAU,IAAI,MAAM,QAAY8P,EAAEhQ,MAAMjC,UAAUH,MAAMqC,KAAKC,UAAU,GAAGuQ,EAAE1Q,MAAMxC,KAAKyS,GAAG,OAAM,GAAIS,EAAE1S,UAAUga,YAAY,SAAStH,EAAET,GAAG,GAAG,oBAAoBA,EAAE,MAAM,IAAI2D,MAAM,gDAAgD,GAAGpW,KAAKqa,UAAUra,KAAKqa,QAAQ,IAAIra,KAAKuC,KAAK,cAAc2Q,EAAET,GAAIzS,KAAKqa,QAAQnH,GAA0B,GAAGR,EAAE1S,KAAKqa,QAAQnH,IAAI,CAA6B,IAAIvE,EAAhC,IAAI3O,KAAKqa,QAAQnH,GAAGuH,QAAoD9L,OAAVnP,IAA5BQ,KAAKqa,QAAQC,aAA2Bta,KAAKqa,QAAQC,aAAzmC,KAA6nC3L,EAAE,GAAG3O,KAAKqa,QAAQnH,GAAG/R,OAAOwN,IAAI3O,KAAKqa,QAAQnH,GAAGuH,QAAO,EAAGrW,QAAQmW,MAAM,mIAAmIva,KAAKqa,QAAQnH,GAAG/R,QAAQiD,QAAQsW,SAAS1a,KAAKqa,QAAQnH,GAAG7G,KAAKoG,QAAQzS,KAAKqa,QAAQnH,GAAG,CAAClT,KAAKqa,QAAQnH,GAAGT,QAA3czS,KAAKqa,QAAQnH,GAAGT,EAA8b,OAAOzS,MAAMkT,EAAE1S,UAAU4B,GAAG8Q,EAAE1S,UAAUga,YAAYtH,EAAE1S,UAAUma,KAAK,SAASlI,EAAEC,GAAG,IAAIQ,EAAElT,KAAK,OAAOkT,EAAE9Q,GAAGqQ,GAAE,SAASpH,IAAI6H,EAAE0H,eAAenI,EAAEpH,GAAGqH,EAAElQ,MAAMxC,KAAK2C,cAAa3C,MAAMkT,EAAE1S,UAAUoa,eAAe,SAAS1H,EAAE7H,GAAG,GAAG,oBAAoBA,EAAE,MAAM,IAAI+K,MAAM,mDAAmD,IAAKpW,KAAKqa,UAASra,KAAKqa,QAAQnH,GAAI,OAAOlT,KAAK,IAAIyS,EAAEzS,KAAKqa,QAAQnH,GAAG,GAAGR,EAAED,GAAG,CAAC,IAAI9D,EAAE8D,EAAEe,QAAQnI,GAAG,GAAGsD,EAAE,EAAE,OAAO3O,KAAKyS,EAAE7G,OAAO+C,EAAE,GAAa,GAAV8D,EAAEtR,eAAkBnB,KAAKqa,QAAQnH,QAAQlT,KAAKqa,QAAQnH,KAAK7H,UAAUrL,KAAKqa,QAAQnH,GAAG,OAAOlT,MAAMkT,EAAE1S,UAAUqa,mBAAmB,SAAS3H,GAAG,OAAOA,GAAGlT,KAAKqa,SAASra,KAAKqa,QAAQnH,KAAKlT,KAAKqa,QAAQnH,GAAG,MAAMlT,MAAMkT,EAAE1S,UAAUsa,UAAU,SAAS5H,GAAG,OAAOlT,KAAKqa,UAAUra,KAAKqa,QAAQ,IAAIra,KAAKqa,QAAQnH,KAAKlT,KAAKqa,QAAQnH,GAAG,IAAIR,EAAE1S,KAAKqa,QAAQnH,MAAMlT,KAAKqa,QAAQnH,GAAG,CAAClT,KAAKqa,QAAQnH,KAAKlT,KAAKqa,QAAQnH,OAAMR,EAAE5T,IAAIoU,EAAE,iBAAgBxQ,KAAK1C,KAAKA,O,mCCAluS,aAUA,WAEI,IAAIzB,EAA8E,qBAAnBC,EAAOC,QAOlEsc,EAAwB,SAAS5Z,GACjCnB,KAAKqF,KAAO,IAAIhE,WAAWF,GAC3BnB,KAAKgb,IAAM,GAGfD,EAAsBva,UAAUya,KAAO,SAAShL,GAC5CjQ,KAAKgb,IAAM/K,GAGf8K,EAAsBva,UAAU0a,WAAa,SAAS9Z,GAClD,IAAK,IAAIE,EAAI,EAAGA,EAAIF,EAAID,OAAQG,IAC5BtB,KAAKqF,KAAKrF,KAAKgb,OAAS5Z,EAAIE,IAIpCyZ,EAAsBva,UAAU2a,UAAY,SAAS1I,GACjDzS,KAAKqF,KAAKrF,KAAKgb,OAASvI,GAI5BsI,EAAsBva,UAAU4a,QAAUL,EAAsBva,UAAU2a,UAE1EJ,EAAsBva,UAAU6a,WAAa,SAASC,GAClDtb,KAAKqF,KAAKrF,KAAKgb,OAASM,GAAK,EAC7Btb,KAAKqF,KAAKrF,KAAKgb,OAASM,GAG5BP,EAAsBva,UAAU+a,cAAgB,SAASlQ,GAIrD,IAHA,IACIkE,EAAQ,IAAIlO,WAAW,IAAIma,aAAa,CAACnQ,IAAI+D,QAExC9N,EAAIiO,EAAMpO,OAAS,EAAGG,GAAK,EAAGA,IACnCtB,KAAKmb,UAAU5L,EAAMjO,KAI7ByZ,EAAsBva,UAAUib,aAAe,SAASpQ,GAIpD,IAHA,IACIkE,EAAQ,IAAIlO,WAAW,IAAIqa,aAAa,CAACrQ,IAAI+D,QAExC9N,EAAIiO,EAAMpO,OAAS,EAAGG,GAAK,EAAGA,IACnCtB,KAAKmb,UAAU5L,EAAMjO,KAO7ByZ,EAAsBva,UAAUmb,YAAc,SAASC,GACnD,IAAK,IAAIta,EAAI,EAAGA,EAAIsa,EAAEza,OAAQG,IAC1BtB,KAAKqF,KAAKrF,KAAKgb,OAASY,EAAEra,WAAWD,IAa7CyZ,EAAsBva,UAAUqb,qBAAuB,SAASva,EAAGwL,GAC/D,OAAQA,GACJ,KAAK,EACD9M,KAAKob,QAAS,IAAU9Z,GAC5B,MACA,KAAK,EACDtB,KAAKob,QAAS,GAAW9Z,GAAK,GAC9BtB,KAAKob,QAAQ9Z,GACjB,MACA,KAAK,EACDtB,KAAKob,QAAS,GAAW9Z,GAAK,IAC9BtB,KAAKob,QAAQ9Z,GAAK,GAClBtB,KAAKob,QAAQ9Z,GACjB,MACA,KAAK,EACDtB,KAAKob,QAAS,GAAW9Z,GAAK,IAC9BtB,KAAKob,QAAQ9Z,GAAK,IAClBtB,KAAKob,QAAQ9Z,GAAK,GAClBtB,KAAKob,QAAQ9Z,GACjB,MACA,KAAK,EAKDtB,KAAKob,QAAS,EAAY9Z,EAAI,WAAc,GAC5CtB,KAAKob,QAAQ9Z,GAAK,IAClBtB,KAAKob,QAAQ9Z,GAAK,IAClBtB,KAAKob,QAAQ9Z,GAAK,GAClBtB,KAAKob,QAAQ9Z,GACjB,MACA,QACI,MAAM,IAAIwa,iBAAiB,sBAAwBhP,KAO/DiO,EAAsBva,UAAUub,kBAAoB,SAASC,GACzD,GAAIA,EAAM,IAIN,OAAO,EACJ,GAAIA,EAAM,MACb,OAAO,EACJ,GAAIA,EAAM,QACb,OAAO,EACJ,GAAIA,EAAM,UACb,OAAO,EACJ,GAAIA,EAAM,YACb,OAAO,EAEP,MAAM,IAAIF,iBAAiB,gCAAkCE,IAIrEjB,EAAsBva,UAAUyb,gBAAkB,SAAS3a,GACvDtB,KAAK6b,qBAAqBva,EAAGtB,KAAK+b,kBAAkBza,KAYxDyZ,EAAsBva,UAAU0b,mBAAqB,SAASZ,EAAGxO,GAM7D,YALctN,IAAVsN,IACAA,EAAQ9M,KAAKmc,mBAAmBb,IAI5BxO,GACJ,KAAK,EACD9M,KAAKob,QAAQrY,KAAKC,MAAMsY,EAAI,aAChC,KAAK,EACDtb,KAAKob,QAAQE,GAAK,IACtB,KAAK,EACDtb,KAAKob,QAAQE,GAAK,IACtB,KAAK,EACDtb,KAAKob,QAAQE,GAAK,GACtB,KAAK,EACDtb,KAAKob,QAAQE,GACjB,MACA,QACI,MAAM,IAAIQ,iBAAiB,iBAAmBhP,KAO1DiO,EAAsBva,UAAU2b,mBAAqB,SAASH,GAE1D,OAAIA,EAAO,IACA,EACAA,EAAO,MACP,EACAA,EAAO,GAAK,GACZ,EACAA,EAAM,WACN,EAEA,GAOfjB,EAAsBva,UAAU4b,eAAiB,WAC7C,GAAIpc,KAAKgb,IAAMhb,KAAKqF,KAAKgX,WACrB,OAAOrc,KAAKqF,KAAKiX,SAAS,EAAGtc,KAAKgb,KAC/B,GAAIhb,KAAKgb,KAAOhb,KAAKqF,KAAKgX,WAC7B,OAAOrc,KAAKqF,KAEZ,KAAM,yDAIdzG,OAAOmc,sBAAwBA,EAclC,IAA0BwB,EAAtBC,GAAsBD,EA6MxBhe,EAAmBI,EAAQ,MAAQ,KA5M7B,SAAS8d,GACf,IACCrN,EAAS,GACTsN,EAAeC,QAAQxG,UACvB3R,EAAa,KACbC,EAAK,KAeN,SAASmY,EAAiBrW,GACzB,OAAO,IAAIoW,SAAQ,SAAUxG,EAAS0G,GACrC,IACC/J,EAAS,IAAIhF,WAEdgF,EAAOkC,iBAAiB,WAAW,WAClCmB,EAAQrD,EAAO7E,WAGhB6E,EAAO3E,kBAAkB5H,MAI3B,SAASuW,EAAoBC,GAC5B,OAAO,IAAIJ,SAAQ,SAAUxG,EAAS0G,GACjCE,aAAiB1b,WACpB8U,EAAQ4G,GACEA,aAAiBC,aAAeA,YAAYC,OAAOF,GAC7D5G,EAAQ,IAAI9U,WAAW0b,IACbA,aAAiBvb,KAC3B2U,EAAQyG,EAAiBG,GAAOzO,MAAK,SAAUc,GAC9C,OAAO,IAAI/N,WAAW+N,OAIvB+G,EAAQyG,EAAiB,IAAIpb,KAAK,CAACub,KAASzO,MAAK,SAAUc,GAC1D,OAAO,IAAI/N,WAAW+N,UAM1B,SAAS8N,EAAY7X,GACpB,IACC4I,EAAS5I,EAAKgX,YAAchX,EAAKlE,QAAUkE,EAAKJ,KAEjD,IAAKkY,OAAOC,UAAUnP,GACrB,KAAM,sCAGP,OAAOA,EArDkB,qBAAfoP,YAA8BZ,aAAuBY,WAC/D7Y,EAAaiY,EACHF,GAAME,IAChBhY,EAAKgY,GAINzc,KAAKgb,IAAM,EAGXhb,KAAKmB,OAAS,EAoDdnB,KAAKib,KAAO,SAAUhL,GACrB,GAAIA,EAAS,EACZ,KAAM,6BAGP,GAAIqN,MAAMrN,GACT,KAAM,wBAGP,GAAIA,EAASjQ,KAAKmB,OACjB,KAAM,gDAGPnB,KAAKgb,IAAM/K,GASZjQ,KAAKud,MAAQ,SAAUlY,GACtB,IACCmY,EAAW,CACVvN,OAAQjQ,KAAKgb,IACb3V,KAAMA,EACNlE,OAAQ+b,EAAY7X,IAErBoY,EAAWD,EAASvN,QAAUjQ,KAAKmB,OAEpCnB,KAAKgb,KAAOwC,EAASrc,OACrBnB,KAAKmB,OAAS4B,KAAKuP,IAAItS,KAAKmB,OAAQnB,KAAKgb,KAGzC0B,EAAeA,EAAapO,MAAK,WAChC,GAAI7J,EACH,OAAO,IAAIkY,SAAQ,SAASxG,EAAS0G,GACpCC,EAAoBU,EAASnY,MAAMiJ,MAAK,SAASoP,GAChD,IACCC,EAAe,EACfvO,EAASwO,EAAOC,KAAKH,EAAUtO,QAahCmN,EAAGgB,MAAM9Y,EAAI2K,EAAQ,EAAGA,EAAOjO,OAAQqc,EAASvN,QAXzB,SAAtB6N,EAA+BnR,EAAKoE,EAAS3B,IAC5CuO,GAAgB5M,IAEI3B,EAAOjO,OAC1BgV,IAGAoG,EAAGgB,MAAM9Y,EAAI2K,EAAQuO,EAAcvO,EAAOjO,OAASwc,EAAcH,EAASvN,OAAS0N,EAAcG,YAOhG,GAAItZ,EACV,OAAO,IAAImY,SAAQ,SAAUxG,EAAS0G,GACrCrY,EAAWuZ,WAAa5H,EAExB3R,EAAWyW,KAAKuC,EAASvN,QACzBzL,EAAW+Y,MAAM,IAAI/b,KAAK,CAACgc,EAASnY,WAE/B,IAAKoY,EAIX,IAAK,IAAInc,EAAI,EAAGA,EAAI8N,EAAOjO,OAAQG,IAAK,CACvC,IACC0c,EAAQ5O,EAAO9N,GAGhB,KAAMkc,EAASvN,OAASuN,EAASrc,QAAU6c,EAAM/N,QAAUuN,EAASvN,QAAU+N,EAAM/N,OAAS+N,EAAM7c,QAAS,CAC3G,GAAIqc,EAASvN,OAAS+N,EAAM/N,QAAUuN,EAASvN,OAASuN,EAASrc,OAAS6c,EAAM/N,OAAS+N,EAAM7c,OAC9F,MAAM,IAAIiV,MAAM,qCAGjB,OAAIoH,EAASvN,QAAU+N,EAAM/N,QAAUuN,EAASrc,QAAU6c,EAAM7c,YAE/D6c,EAAM3Y,KAAOmY,EAASnY,MAKfyX,EAAoBkB,EAAM3Y,MAC/BiJ,MAAK,SAAU2P,GAGf,OAFAD,EAAM3Y,KAAO4Y,EAENnB,EAAoBU,EAASnY,SAClCiJ,MAAK,SAAU4P,GACjBV,EAASnY,KAAO6Y,EAEhBF,EAAM3Y,KAAKwK,IAAI2N,EAASnY,KAAMmY,EAASvN,OAAS+N,EAAM/N,YAQ5Db,EAAO/C,KAAKmR,OAYdxd,KAAKqO,SAAW,SAAU/K,GAmBzB,OAjBCoZ,EADGjY,GAAMD,EACMkY,EAAapO,MAAK,WAChC,OAAO,QAIOoO,EAAapO,MAAK,WAIhC,IAHA,IACCL,EAAS,GAED3M,EAAI,EAAGA,EAAI8N,EAAOjO,OAAQG,IAClC2M,EAAO5B,KAAK+C,EAAO9N,GAAG+D,MAGvB,OAAO,IAAI7D,KAAKyM,EAAQ,CAAC3K,SAAUA,UASxC1E,OAAO4d,WAAaA,EAgBjB,IAAIzd,EAAa,SAASgc,EAAuByB,GA+C7C,SAAS2B,EAAapY,EAAQlF,GAC1B,IA3B6BmE,EA4BzBoZ,EAAQrY,EAAO/E,UAAU,aAAc,CAACH,QAASA,IAErD,QA7BmB,kBADUmE,EA8BEoZ,KA7BCpZ,EAAI0M,MAAM,gCAInC9S,OAAOmC,KAAKiE,EAAI7B,UAAU,0BAA2BhC,SA4BhE,SAASkd,EAAwBC,GAE7B,IACIC,EAAqBD,EAAK9K,QAAQ,QAEtC,IAA2B,GAAvB+K,EACA,KAAM,yDAMV,OAFAA,GAAsB,OAAOpd,OAAS,EAE/Bmd,EAAKnb,UAAUob,GAI1B,SAASC,EAAYtf,GACjBc,KAAKd,MAAQA,EAGjB,SAASuf,EAAYvf,GACjBc,KAAKd,MAAQA,EAUjB,SAASwf,EAAUtP,EAAQuP,EAAkBC,GAEzC,GAAInc,MAAM0X,QAAQyE,GACd,IAAK,IAAItd,EAAI,EAAGA,EAAIsd,EAAKzd,OAAQG,IAC7Bod,EAAUtP,EAAQuP,EAAkBC,EAAKtd,SAG1C,GAAoB,kBAATsd,EACdxP,EAAOuM,YAAYiD,QAChB,GAAIA,aAAgBvd,WACvB+N,EAAO8L,WAAW0D,OACf,KAAIA,EAAKrS,GAuEZ,KAAM,4BAA8BqS,EAAKvZ,KA5DrC,IACIwZ,EAASC,EAAWC,EAJ5B,GANAH,EAAK3O,OAASb,EAAO4L,IAAM2D,EAE3BvP,EAAO8M,mBAAmB0C,EAAKrS,IAI3B9J,MAAM0X,QAAQyE,EAAKvZ,OAMA,IAAfuZ,EAAK3Z,KAELmK,EAAO+L,UAAU,MAEjB0D,EAAUzP,EAAO4L,IAMjB5L,EAAO8L,WAAW,CAAC,EAAG,EAAG,EAAG,KAGhC4D,EAAY1P,EAAO4L,IAEnB4D,EAAKI,WAAaF,EAAYH,EAC9BD,EAAUtP,EAAQuP,EAAkBC,EAAKvZ,OAEtB,IAAfuZ,EAAK3Z,OACL8Z,EAAU3P,EAAO4L,IAEjB4D,EAAK3Z,KAAO8Z,EAAUD,EAEtB1P,EAAO6L,KAAK4D,GACZzP,EAAOyM,qBAAqB+C,EAAK3Z,KAAM,GAEvCmK,EAAO6L,KAAK8D,SAEb,GAAyB,kBAAdH,EAAKvZ,KACnB+J,EAAO6M,gBAAgB2C,EAAKvZ,KAAKlE,QACjCyd,EAAKI,WAAa5P,EAAO4L,IAAM2D,EAC/BvP,EAAOuM,YAAYiD,EAAKvZ,WACrB,GAAyB,kBAAduZ,EAAKvZ,KAEduZ,EAAK3Z,OACN2Z,EAAK3Z,KAAOmK,EAAO+M,mBAAmByC,EAAKvZ,OAG/C+J,EAAO6M,gBAAgB2C,EAAK3Z,MAC5B2Z,EAAKI,WAAa5P,EAAO4L,IAAM2D,EAC/BvP,EAAO8M,mBAAmB0C,EAAKvZ,KAAMuZ,EAAK3Z,WACvC,GAAI2Z,EAAKvZ,gBAAgBoZ,EAC5BrP,EAAO6M,gBAAgB,GACvB2C,EAAKI,WAAa5P,EAAO4L,IAAM2D,EAC/BvP,EAAOmM,cAAcqD,EAAKvZ,KAAKnG,YAC5B,GAAI0f,EAAKvZ,gBAAgBmZ,EAC5BpP,EAAO6M,gBAAgB,GACvB2C,EAAKI,WAAa5P,EAAO4L,IAAM2D,EAC/BvP,EAAOqM,aAAamD,EAAKvZ,KAAKnG,WAC3B,MAAI0f,EAAKvZ,gBAAgBhE,YAK5B,KAAM,4BAA8Bud,EAAKvZ,KAJzC+J,EAAO6M,gBAAgB2C,EAAKvZ,KAAKgX,YACjCuC,EAAKI,WAAa5P,EAAO4L,IAAM2D,EAC/BvP,EAAO8L,WAAW0D,EAAKvZ,QASnC,OAAO,SAASqS,GACZ,IAKIuH,EAAYC,EAsBZC,EAMAC,EA7BAC,GAAgB,EAGhBC,EAAqB,GACrBC,EAAmB,EACnBC,EAAkB,EAYlBC,EAAa,CACTC,KAAM,CAACnT,GAAI,IAAIlL,WAAW,CAAC,GAAM,GAAM,IAAM,MAAQse,aAAc,MACnEC,YAAa,CAACrT,GAAI,IAAIlL,WAAW,CAAC,GAAM,GAAM,IAAM,MAAQse,aAAc,MAC1EE,OAAQ,CAACtT,GAAI,IAAIlL,WAAW,CAAC,GAAM,GAAM,IAAM,MAAQse,aAAc,OAIzEG,EAAkB,CACd,GAAM,MACN,KAAQ,IAAIrB,EAAY,IAK5BsB,EAAO,GAEPC,EAAa,IAAIxD,EAAW9E,EAAQlT,YAAckT,EAAQjT,IAE9D,SAASwb,EAA4BC,GACjC,OAAOA,EAAaf,EAAYH,WA8CpC,SAASmB,IACLf,EAtCJ,WACI,IACIgB,EAA2B,CACvB,GAAM,MACN,KAAQ,EACR,KAAQ,GAGZnS,EAAS,CACL,GAAM,UACN,KAAQ,IAGhB,IAAK,IAAIpL,KAAQ4c,EAAY,CACzB,IACIY,EAAYZ,EAAW5c,GAE3Bwd,EAAUV,aAAexgB,OAAOyO,OAAOwS,GAEvCnS,EAAO5I,KAAKgH,KAAK,CACZ,GAAM,MACN,KAAQ,CACH,CACI,GAAM,MACN,KAAQgU,EAAU9T,IAEtB8T,EAAUV,gBAKxB,OAAO1R,EAOIqS,GAEX,IAmCIC,EAAc,CACV,GAAM,UACN,KAAQ,CACJ,CACI,GAAM,QACN,KAAQ,KAEZ,CACI,GAAM,MACN,KAAQ,kBAEZ,CACI,GAAM,MACN,KAAQ,kBAEZT,IAIRU,EAAS,CACL,GAAM,UACN,KAAQ,CACJ,CACI,GAAM,IACN,KAAQ,CACJ,CACI,GAAM,IACN,KArJD,GAuJH,CACI,GAAM,MACN,KAzJD,GA2JH,CACI,GAAM,IACN,KAAQ,GAEZ,CACI,GAAM,QACN,KAAQ,OAEZ,CACI,GAAM,IACN,KAAQ,SAEZ,CACI,GAAM,QACN,KAAQ,OAEZ,CACI,GAAM,IACN,KAAQ,GAEZ,CACI,GAAM,IACN,KAAQ,CACJ,CACI,GAAM,IACN,KAAQvB,GAEZ,CACI,GAAM,IACN,KAAQC,SASxCC,EAAc,CACV,GAAM,UACN,MAAS,EACT,KAAQ,CACJC,EACAmB,EACAC,IAIR,IACIC,EAAe,IAAI1F,EAAsB,KAE7C2D,EAAU+B,EAAcT,EAAWhF,IAAK,CAtHvB,CACT,GAAM,UACN,KAAQ,CACJ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,QAEZ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,KAyF6BmE,IACrDa,EAAWzC,MAAMkD,EAAarE,kBAG9BqD,EAAWG,YAAYD,aAAata,KAAO4a,EAA4BM,EAAYtQ,QACnFwP,EAAWI,OAAOF,aAAata,KAAO4a,EAA4BO,EAAOvQ,QAW7E,SAASyQ,EAAoBC,GACzB,IACIF,EAAe,IAAI1F,EAAsB,GAE7C,KAAM4F,EAASC,YAAc,GAAKD,EAASC,YAAc,KACrD,KAAM,oCAWV,OARAH,EAAaxE,gBAAgB0E,EAASC,aACtCH,EAAapF,WAAWsF,EAASE,UAGjCJ,EAAatF,UACT,KAGG,CACH,GAAM,IACN,KAAQ,CACHsF,EAAarE,iBACbuE,EAASvC,QAwEtB,SAAS0C,IACL,GAAiC,GAA7BxB,EAAmBne,OAAvB,CAQA,IAHA,IACI4f,EAAe,EAEVzf,EAAI,EAAGA,EAAIge,EAAmBne,OAAQG,IAC3Cyf,GAAgBzB,EAAmBhe,GAAG8c,MAAMjd,OAGhD,IA7DiB6f,EAAYC,EAAaC,EA8DtC9R,EAAS,IAAI2L,EAAsBgG,EAA2C,GAA5BzB,EAAmBne,QAErEggB,EA5ER,SAAuBA,GACnB,MAAO,CACH,GAAM,UACN,KAAQ,CACH,CACG,GAAM,IACN,KAAQpe,KAAK2W,MAAMyH,EAAQN,aAsEzBO,CAAc,CACpBP,SAAU9d,KAAK2W,MAAM6F,KAG7B,IAASje,EAAI,EAAGA,EAAIge,EAAmBne,OAAQG,IAC3C6f,EAAQ9b,KAAKgH,KAAKqU,EAAoBpB,EAAmBhe,KAG7Dod,EAAUtP,EAAQ4Q,EAAWhF,IAAKmG,GAClCnB,EAAWzC,MAAMnO,EAAOgN,kBAzEP4E,EA1QM,EA0QMC,EA2EKle,KAAK2W,MAAM6F,GA3EH2B,EA2EsBC,EAAQlR,OA1ExE8P,EAAK1T,KAAK,CACN,GAAM,IACN,KAAQ,CACH,CACI,GAAM,IACN,KAAQ4U,GAEZ,CACI,GAAM,IACN,KAAQ,CACH,CACI,GAAM,IACN,KAAQD,GAEZ,CACI,GAAM,IACN,KAAQf,EAA4BiB,SA4D1D5B,EAAqB,GACrBC,GAAoBC,EACpBA,EAAkB,GAsEtBxf,KAAKoO,SAAW,SAASrI,GACrB,GAAIsZ,GACA,GAAItZ,EAAO+G,OAASmS,GAAclZ,EAAOgH,QAAUmS,EAC/C,KAAM,+CAGVD,EAAalZ,EAAO+G,MACpBoS,EAAcnZ,EAAOgH,OAErBoT,IACAd,GAAgB,EAGpB,IArEuBjB,EAsEnBE,EAAOH,EAAapY,EAAQ,CAAClF,QAAS6W,EAAQ7W,UAElD,IAAKyd,EACD,KAAM,8DAzEaF,EA4EL,CACdA,MAAOC,EAAwBC,GAC/B+C,SAAU3J,EAAQ4J,gBA7EhBV,YAxWiB,EA2WvBxC,EAAMyC,SAAW9d,KAAK2W,MAAM8F,GAE5BF,EAAmBjT,KAAK+R,IAExBoB,GAAmBpB,EAAMiD,WAhXG,KAmXxBP,KA6ER9gB,KAAKqO,SAAW,WAOZ,OANAyS,IAzJJ,WACI,IACIlC,EAAO,CACH,GAAM,UACN,KAAQmB,GAGZwB,EAAa,IAAIxG,EAAsB,GAAmB,GAAdgF,EAAK5e,QAErDud,EAAU6C,EAAYvB,EAAWhF,IAAK4D,GACtCoB,EAAWzC,MAAMgE,EAAWnF,kBAG5BqD,EAAWC,KAAKC,aAAata,KAAO4a,EAA4BrB,EAAK3O,QA8IrEuR,GAvEJ,WACI,IACIC,EAAiB,IAAI1G,EAAsBqE,EAASna,MACpDyc,EAAS1B,EAAWhF,IAGxB0D,EAAU+C,EAAgBrC,EAASJ,WAAYI,EAAS/Z,MAGxD2a,EAAW/E,KAAKmE,EAASJ,YACzBgB,EAAWzC,MAAMkE,EAAerF,kBAEhC4D,EAAW/E,KAAKyG,GA4DhBC,GAtDJ,WACI,IACIvS,EAAS,IAAI2L,EAAsB,GACnC2G,EAAS1B,EAAWhF,IAGxB5L,EAAOmM,cAAcgE,GAGrBS,EAAW/E,KAAK6E,EAAgBd,YAChCgB,EAAWzC,MAAMnO,EAAOgN,kBAExB4D,EAAW/E,KAAKyG,GA2ChBE,GAEO5B,EAAW3R,SAAS,eAG/BrO,KAAK6hB,eAAiB,WAClB,OAAO7B,EAAW7e,QAGtBuW,EA1nBJ,SAAgBlI,EAAMtH,GAClB,IACI2L,EAAS,GAUb,MARA,CAACrE,EAAMtH,GAAK8C,SAAQ,SAAS8W,GACzB,IAAK,IAAIC,KAAQD,EACT3iB,OAAOqB,UAAUyV,eAAevT,KAAKof,EAAKC,KAC1ClO,EAAOkO,GAAQD,EAAIC,OAKxBlO,EA8mBGpE,CApcW,CACb5O,QAAS,IACT2D,WAAY,KACZC,GAAI,KAGJ6c,cAAe,KACf5c,UAAW,MA6bcgT,GAAW,IAjH5C,WAEI,IAAKA,EAAQ4J,cAAe,CACxB,IAAI5J,EAAQhT,UAGR,KAAM,sDAFNgT,EAAQ4J,cAAgB,IAAO5J,EAAQhT,WA8GnDsd,KAIJzjB,EACHC,EAAOC,QAAUM,EAAWgc,EAAuByB,GAEnD5d,OAAOG,WAAaA,EAAWgc,EAAuByB,GArjC3D,K,0ICOMyF,EAAe,CAAErhB,KAAM,UACvBshB,EAAc,CAAEthB,KAAM,SACtBuhB,EAAY,CAAEvhB,KAAM,OAEpBwhB,E,kDAEL,WAAaC,EAAQC,GAAa,0BAEjC,oBAEoB9iB,IAAf8iB,GAA2Ble,QAAQme,KAAM,4EACzCD,IAAere,UAAWG,QAAQmW,MAAO,4HAE9C,EAAK8H,OAASA,EACd,EAAKC,WAAaA,EAClB,EAAKA,WAAWva,MAAMya,YAAc,OAGpC,EAAKC,SAAU,EAGf,EAAK5O,OAAS,IAAI6O,UAGlB,EAAKC,YAAc,EACnB,EAAKC,YAAcC,IAGnB,EAAKC,QAAU,EACf,EAAKC,QAAUF,IAIf,EAAKG,cAAgB,EACrB,EAAKC,cAAgBlgB,KAAKmgB,GAI1B,EAAKC,iBAAoBN,IACzB,EAAKO,gBAAkBP,IAIvB,EAAKQ,eAAgB,EACrB,EAAKC,cAAgB,IAIrB,EAAKC,YAAa,EAClB,EAAKC,UAAY,EAGjB,EAAKC,cAAe,EACpB,EAAKC,YAAc,EAGnB,EAAKC,WAAY,EACjB,EAAKC,SAAW,EAChB,EAAKC,oBAAqB,EAC1B,EAAKC,YAAc,EAInB,EAAKC,YAAa,EAClB,EAAKC,gBAAkB,EAGvB,EAAKxa,KAAO,CAAEya,KAAM,YAAaC,GAAI,UAAWC,MAAO,aAAcC,OAAQ,aAG7E,EAAKC,aAAe,CAAEJ,KAAMK,QAAMC,OAAQC,OAAQF,QAAMG,MAAON,MAAOG,QAAMI,KAG5E,EAAKC,QAAU,CAAEC,IAAKC,QAAMN,OAAQO,IAAKD,QAAME,WAG/C,EAAKC,QAAU,EAAKnR,OAAOoR,QAC3B,EAAKC,UAAY,EAAK7C,OAAOra,SAASid,QACtC,EAAKE,MAAQ,EAAK9C,OAAO+C,KAGzB,EAAKC,qBAAuB,KAM5B,EAAKC,cAAgB,WAEpB,OAAOC,EAAUC,KAIlB,EAAKC,kBAAoB,WAExB,OAAOF,EAAUG,OAIlB,EAAKC,YAAc,WAElB,OAAO3lB,KAAKqiB,OAAOra,SAAS4d,WAAY5lB,KAAK6T,SAI9C,EAAKgS,kBAAoB,SAAWvD,GAEnCA,EAAWtN,iBAAkB,UAAW8Q,GACxC9lB,KAAKqlB,qBAAuB/C,GAI7B,EAAKyD,UAAY,WAEhBC,EAAMhB,QAAQlW,KAAMkX,EAAMnS,QAC1BmS,EAAMd,UAAUpW,KAAMkX,EAAM3D,OAAOra,UACnCge,EAAMb,MAAQa,EAAM3D,OAAO+C,MAI5B,EAAKa,MAAQ,WAEZD,EAAMnS,OAAO/E,KAAMkX,EAAMhB,SACzBgB,EAAM3D,OAAOra,SAAS8G,KAAMkX,EAAMd,WAClCc,EAAM3D,OAAO+C,KAAOY,EAAMb,MAE1Ba,EAAM3D,OAAO6D,yBACbF,EAAMG,cAAelE,GAErB+D,EAAMI,SAENC,EAAQC,EAAMC,MAKf,EAAKH,OAAS,WAEb,IAAMnW,EAAS,IAAIyS,UAGb8D,GAAO,IAAIC,cAAaC,mBAAoBrE,EAAOsE,GAAI,IAAIjE,UAAS,EAAG,EAAG,IAC1EkE,EAAcJ,EAAKvB,QAAQ4B,SAE3BC,EAAe,IAAIpE,UACnBqE,EAAiB,IAAIN,aAErBO,EAAQ,EAAIjkB,KAAKmgB,GAEvB,OAAO,WAEN,IAAMlb,EAAWge,EAAM3D,OAAOra,SAE9BiI,EAAOnB,KAAM9G,GAAWif,IAAKjB,EAAMnS,QAGnC5D,EAAOiX,gBAAiBV,GAGxBjB,EAAU4B,eAAgBlX,GAErB+V,EAAMjC,YAAcsC,IAAUC,EAAMC,MAExCa,EAsLK,EAAIrkB,KAAKmgB,GAAK,GAAK,GAAK8C,EAAMhC,iBAlL/BgC,EAAM3C,eAEVkC,EAAUG,OAAS2B,EAAe3B,MAAQM,EAAM1C,cAChDiC,EAAUC,KAAO6B,EAAe7B,IAAMQ,EAAM1C,gBAI5CiC,EAAUG,OAAS2B,EAAe3B,MAClCH,EAAUC,KAAO6B,EAAe7B,KAMjC,IAAItM,EAAM8M,EAAM7C,gBACZ7Q,EAAM0T,EAAM5C,gBA2EhB,OAzEKkE,SAAUpO,IAASoO,SAAUhV,KAE5B4G,GAAQnW,KAAKmgB,GAAKhK,GAAO8N,EAAiB9N,EAAMnW,KAAKmgB,KAAKhK,GAAO8N,GAEjE1U,GAAQvP,KAAKmgB,GAAK5Q,GAAO0U,EAAiB1U,EAAMvP,KAAKmgB,KAAK5Q,GAAO0U,GAIrEzB,EAAUG,MAFNxM,GAAO5G,EAEOvP,KAAKuP,IAAK4G,EAAKnW,KAAKmW,IAAK5G,EAAKiT,EAAUG,QAItCH,EAAUG,OAAUxM,EAAM5G,GAAQ,EACrDvP,KAAKuP,IAAK4G,EAAKqM,EAAUG,OACzB3iB,KAAKmW,IAAK5G,EAAKiT,EAAUG,QAO5BH,EAAUC,IAAMziB,KAAKuP,IAAK0T,EAAMhD,cAAejgB,KAAKmW,IAAK8M,EAAM/C,cAAesC,EAAUC,MAExFD,EAAUgC,WAGVhC,EAAUiC,QAAUC,EAGpBlC,EAAUiC,OAASzkB,KAAKuP,IAAK0T,EAAMrD,YAAa5f,KAAKmW,IAAK8M,EAAMpD,YAAa2C,EAAUiC,UAI1D,IAAxBxB,EAAM3C,cAEV2C,EAAMnS,OAAO6T,gBAAiBC,EAAW3B,EAAM1C,eAI/C0C,EAAMnS,OAAOrG,IAAKma,GAInB1X,EAAO2X,iBAAkBrC,GAGzBtV,EAAOiX,gBAAiBN,GAExB5e,EAAS8G,KAAMkX,EAAMnS,QAASrG,IAAKyC,GAEnC+V,EAAM3D,OAAOwF,OAAQ7B,EAAMnS,SAEE,IAAxBmS,EAAM3C,eAEVgE,EAAe3B,OAAW,EAAIM,EAAM1C,cACpC+D,EAAe7B,KAAS,EAAIQ,EAAM1C,cAElCqE,EAAUG,eAAgB,EAAI9B,EAAM1C,iBAIpC+D,EAAexX,IAAK,EAAG,EAAG,GAE1B8X,EAAU9X,IAAK,EAAG,EAAG,IAItB4X,EAAQ,KAMHM,GACJjB,EAAakB,kBAAmBhC,EAAM3D,OAAOra,UAAaigB,GAC1D,GAAM,EAAIlB,EAAemB,IAAKlC,EAAM3D,OAAO8F,aAAiBF,KAE5DjC,EAAMG,cAAelE,GAErB6E,EAAahY,KAAMkX,EAAM3D,OAAOra,UAChC+e,EAAejY,KAAMkX,EAAM3D,OAAO8F,YAClCJ,GAAc,GAEP,IAnII,GA6Id,EAAKra,QAAU,WAEdsY,EAAM1D,WAAWpN,oBAAqB,cAAekT,GAErDpC,EAAM1D,WAAWpN,oBAAqB,cAAemT,GACrDrC,EAAM1D,WAAWpN,oBAAqB,gBAAiBoT,GACvDtC,EAAM1D,WAAWpN,oBAAqB,QAASqT,GAE/CvC,EAAM1D,WAAWpN,oBAAqB,cAAesT,GACrDxC,EAAM1D,WAAWpN,oBAAqB,YAAauT,GAGf,OAA/BzC,EAAMX,sBAEVW,EAAMX,qBAAqBnQ,oBAAqB,UAAW4Q,IAY7D,IAAME,EAAQ,eAERM,EAAQ,CACbC,MAAQ,EACRhC,OAAQ,EACRE,MAAO,EACPC,IAAK,EACLgE,aAAc,EACdC,UAAW,EACXC,gBAAiB,EACjBC,mBAAoB,GAGjBxC,EAAQC,EAAMC,KAEZ0B,EAAM,KAGN1C,EAAY,IAAIuD,YAChBzB,EAAiB,IAAIyB,YAEvBrB,EAAQ,EACNE,EAAY,IAAIjF,UAClBqF,GAAc,EAEZgB,EAAc,IAAIC,UAClBC,EAAY,IAAID,UAChBE,EAAc,IAAIF,UAElBG,EAAW,IAAIH,UACfI,EAAS,IAAIJ,UACbK,EAAW,IAAIL,UAEfM,EAAa,IAAIN,UACjBO,EAAW,IAAIP,UACfQ,EAAa,IAAIR,UAEjBS,EAAW,GACXC,EAAmB,GAQzB,SAASC,IAER,OAAO5mB,KAAKwP,IAAK,IAAMyT,EAAMxC,WAI9B,SAAS4D,EAAYwC,GAEpBvC,EAAe3B,OAASkE,EAIzB,SAASC,EAAUD,GAElBvC,EAAe7B,KAAOoE,EAIvB,IAAME,EAAU,WAEf,IAAM7e,EAAI,IAAIyX,UAEd,OAAO,SAAkBqH,EAAUC,GAElC/e,EAAEgf,oBAAqBD,EAAc,GACrC/e,EAAE6c,gBAAkBiC,GAEpBpC,EAAUna,IAAKvC,IATD,GAeVif,EAAQ,WAEb,IAAMjf,EAAI,IAAIyX,UAEd,OAAO,SAAgBqH,EAAUC,IAEE,IAA7BhE,EAAMnC,mBAEV5Y,EAAEgf,oBAAqBD,EAAc,IAIrC/e,EAAEgf,oBAAqBD,EAAc,GACrC/e,EAAEkf,aAAcnE,EAAM3D,OAAOsE,GAAI1b,IAIlCA,EAAE6c,eAAgBiC,GAElBpC,EAAUna,IAAKvC,IAnBH,GA0BRmf,EAAM,WAEX,IAAMna,EAAS,IAAIyS,UAEnB,OAAO,SAAc2H,EAAQC,GAE5B,IAAMC,EAAUvE,EAAM1D,WAEtB,GAAK0D,EAAM3D,OAAOmI,oBAAsB,CAGvC,IAAMxiB,EAAWge,EAAM3D,OAAOra,SAC9BiI,EAAOnB,KAAM9G,GAAWif,IAAKjB,EAAMnS,QACnC,IAAI4W,EAAiBxa,EAAO9O,SAG5BspB,GAAkB1nB,KAAK2nB,IAAO1E,EAAM3D,OAAOsI,IAAM,EAAM5nB,KAAKmgB,GAAK,KAGjE4G,EAAS,EAAIO,EAASI,EAAiBF,EAAQK,aAAc5E,EAAM3D,OAAOwI,QAC1EX,EAAO,EAAII,EAASG,EAAiBF,EAAQK,aAAc5E,EAAM3D,OAAOwI,aAE7D7E,EAAM3D,OAAOyI,sBAGxBhB,EAASO,GAAWrE,EAAM3D,OAAO0I,MAAQ/E,EAAM3D,OAAOpa,MAAS+d,EAAM3D,OAAO+C,KAAOmF,EAAQS,YAAahF,EAAM3D,OAAOwI,QACrHX,EAAOI,GAAWtE,EAAM3D,OAAOna,IAAM8d,EAAM3D,OAAO4I,QAAWjF,EAAM3D,OAAO+C,KAAOmF,EAAQK,aAAc5E,EAAM3D,OAAOwI,UAKpHzmB,QAAQme,KAAM,gFACdyD,EAAMrC,WAAY,IAhCT,GAwCZ,SAASuH,EAAUC,GAEbnF,EAAM3D,OAAOmI,oBAEjB/C,GAAS0D,EAEEnF,EAAM3D,OAAOyI,sBAExB9E,EAAM3D,OAAO+C,KAAOriB,KAAKuP,IAAK0T,EAAMlD,QAAS/f,KAAKmW,IAAK8M,EAAMjD,QAASiD,EAAM3D,OAAO+C,KAAO+F,IAC1FnF,EAAM3D,OAAO6D,yBACb6B,GAAc,IAId3jB,QAAQme,KAAM,uFACdyD,EAAMzC,YAAa,GAMrB,SAAS6H,EAASD,GAEZnF,EAAM3D,OAAOmI,oBAEjB/C,GAAS0D,EAEEnF,EAAM3D,OAAOyI,sBAExB9E,EAAM3D,OAAO+C,KAAOriB,KAAKuP,IAAK0T,EAAMlD,QAAS/f,KAAKmW,IAAK8M,EAAMjD,QAASiD,EAAM3D,OAAO+C,KAAO+F,IAC1FnF,EAAM3D,OAAO6D,yBACb6B,GAAc,IAId3jB,QAAQme,KAAM,uFACdyD,EAAMzC,YAAa,GAUrB,SAAS8H,EAAuBhpB,GAE/B0mB,EAAYlZ,IAAKxN,EAAMipB,QAASjpB,EAAMkpB,SAUvC,SAASC,EAAoBnpB,GAE5B8mB,EAAStZ,IAAKxN,EAAMipB,QAASjpB,EAAMkpB,SAwHpC,SAASE,IAER,GAAyB,IAApBhC,EAAStoB,OAEb4nB,EAAYlZ,IAAK4Z,EAAU,GAAIiC,MAAOjC,EAAU,GAAIkC,WAE9C,CAEN,IAAMC,EAAI,IAAQnC,EAAU,GAAIiC,MAAQjC,EAAU,GAAIiC,OAChD5V,EAAI,IAAQ2T,EAAU,GAAIkC,MAAQlC,EAAU,GAAIkC,OAEtD5C,EAAYlZ,IAAK+b,EAAG9V,IAMtB,SAAS+V,IAER,GAAyB,IAApBpC,EAAStoB,OAEbgoB,EAAStZ,IAAK4Z,EAAU,GAAIiC,MAAOjC,EAAU,GAAIkC,WAE3C,CAEN,IAAMC,EAAI,IAAQnC,EAAU,GAAIiC,MAAQjC,EAAU,GAAIiC,OAChD5V,EAAI,IAAQ2T,EAAU,GAAIkC,MAAQlC,EAAU,GAAIkC,OAEtDxC,EAAStZ,IAAK+b,EAAG9V,IAMnB,SAASgW,IAER,IAAMC,EAAKtC,EAAU,GAAIiC,MAAQjC,EAAU,GAAIiC,MACzCM,EAAKvC,EAAU,GAAIkC,MAAQlC,EAAU,GAAIkC,MAEzC5B,EAAWhnB,KAAKkpB,KAAMF,EAAKA,EAAKC,EAAKA,GAE3C1C,EAAWzZ,IAAK,EAAGka,GAoBpB,SAASmC,EAAuB7pB,GAE/B,GAAwB,GAAnBonB,EAAStoB,OAEb8nB,EAAUpZ,IAAKxN,EAAMqpB,MAAOrpB,EAAMspB,WAE5B,CAEN,IAAM3jB,EAAWmkB,GAA0B9pB,GAErCupB,EAAI,IAAQvpB,EAAMqpB,MAAQ1jB,EAAS4jB,GACnC9V,EAAI,IAAQzT,EAAMspB,MAAQ3jB,EAAS8N,GAEzCmT,EAAUpZ,IAAK+b,EAAG9V,GAInBoT,EAAYkD,WAAYnD,EAAWF,GAAcjB,eAAgB9B,EAAMtC,aAEvE,IAAM6G,EAAUvE,EAAM1D,WAEtB8E,EAAY,EAAIrkB,KAAKmgB,GAAKgG,EAAY0C,EAAIrB,EAAQK,cAElDf,EAAU,EAAI9mB,KAAKmgB,GAAKgG,EAAYpT,EAAIyU,EAAQK,cAEhD7B,EAAYja,KAAMma,GAInB,SAASoD,EAAoBhqB,GAE5B,GAAyB,IAApBonB,EAAStoB,OAEbioB,EAAOvZ,IAAKxN,EAAMqpB,MAAOrpB,EAAMspB,WAEzB,CAEN,IAAM3jB,EAAWmkB,GAA0B9pB,GAErCupB,EAAI,IAAQvpB,EAAMqpB,MAAQ1jB,EAAS4jB,GACnC9V,EAAI,IAAQzT,EAAMspB,MAAQ3jB,EAAS8N,GAEzCsT,EAAOvZ,IAAK+b,EAAG9V,GAIhBuT,EAAS+C,WAAYhD,EAAQD,GAAWrB,eAAgB9B,EAAMpC,UAE9DwG,EAAKf,EAASuC,EAAGvC,EAASvT,GAE1BqT,EAASra,KAAMsa,GAIhB,SAASkD,EAAsBjqB,GAE9B,IAAM2F,EAAWmkB,GAA0B9pB,GAErC0pB,EAAK1pB,EAAMqpB,MAAQ1jB,EAAS4jB,EAC5BI,EAAK3pB,EAAMspB,MAAQ3jB,EAAS8N,EAE5BiU,EAAWhnB,KAAKkpB,KAAMF,EAAKA,EAAKC,EAAKA,GAE3CzC,EAAS1Z,IAAK,EAAGka,GAEjBP,EAAW3Z,IAAK,EAAG9M,KAAKwP,IAAKgX,EAASzT,EAAIwT,EAAWxT,EAAGkQ,EAAMxC,YAE9D0H,EAAU1B,EAAW1T,GAErBwT,EAAWxa,KAAMya,GA8BlB,SAASlB,EAAehmB,IAEA,IAAlB2jB,EAAMvD,UAEc,IAApBgH,EAAStoB,SAEb6kB,EAAM1D,WAAWiK,kBAAmBlqB,EAAMmqB,WAE1CxG,EAAM1D,WAAWtN,iBAAkB,cAAewT,GAClDxC,EAAM1D,WAAWtN,iBAAkB,YAAayT,IAsYlD,SAAqBpmB,GAEpBonB,EAASpd,KAAMhK,GAlYfoqB,CAAYpqB,GAEe,UAAtBA,EAAMqqB,YAkOZ,SAAuBrqB,GAItB,OAFAsqB,GAActqB,GAELonB,EAAStoB,QAEjB,KAAK,EAEJ,OAAS6kB,EAAMrB,QAAQC,KAEtB,KAAKC,QAAMN,OAEV,IAA4B,IAAvByB,EAAMvC,aAAyB,OAEpCgI,IAEApF,EAAQC,EAAMoC,aAEd,MAED,KAAK7D,QAAMH,IAEV,IAAyB,IAApBsB,EAAMrC,UAAsB,OAEjCkI,IAEAxF,EAAQC,EAAMqC,UAEd,MAED,QAECtC,EAAQC,EAAMC,KAIhB,MAED,KAAK,EAEJ,OAASP,EAAMrB,QAAQG,KAEtB,KAAKD,QAAME,UAEV,IAA0B,IAArBiB,EAAMzC,aAA4C,IAApByC,EAAMrC,UAAsB,OAhZ9DqC,EAAMzC,YAAauI,IAEnB9F,EAAMrC,WAAYkI,IAkZnBxF,EAAQC,EAAMsC,gBAEd,MAED,KAAK/D,QAAM+H,aAEV,IAA0B,IAArB5G,EAAMzC,aAA+C,IAAvByC,EAAMvC,aAAyB,OAlZjEuC,EAAMzC,YAAauI,IAEnB9F,EAAMvC,cAAegI,IAoZtBpF,EAAQC,EAAMuC,mBAEd,MAED,QAECxC,EAAQC,EAAMC,KAIhB,MAED,QAECF,EAAQC,EAAMC,KAIXF,IAAUC,EAAMC,MAEpBP,EAAMG,cAAejE,GA9SrB2K,CAAcxqB,GA6DhB,SAAsBA,GAErB,IAAIyqB,EAEJ,OAASzqB,EAAM0qB,QAEd,KAAK,EAEJD,EAAc9G,EAAM3B,aAAaJ,KACjC,MAED,KAAK,EAEJ6I,EAAc9G,EAAM3B,aAAaG,OACjC,MAED,KAAK,EAEJsI,EAAc9G,EAAM3B,aAAaF,MACjC,MAED,QAEC2I,GAAgB,EAIlB,OAASA,GAER,KAAKxI,QAAMG,MAEV,IAA0B,IAArBuB,EAAMzC,WAAuB,QA/YrC,SAA+BlhB,GAE9BinB,EAAWzZ,IAAKxN,EAAMipB,QAASjpB,EAAMkpB,SA+YnCyB,CAAsB3qB,GAEtBgkB,EAAQC,EAAM7B,MAEd,MAED,KAAKH,QAAMC,OAEV,GAAKliB,EAAM4qB,SAAW5qB,EAAM6qB,SAAW7qB,EAAM8qB,SAAW,CAEvD,IAAyB,IAApBnH,EAAMrC,UAAsB,OAEjC6H,EAAoBnpB,GAEpBgkB,EAAQC,EAAM5B,QAER,CAEN,IAA4B,IAAvBsB,EAAMvC,aAAyB,OAEpC4H,EAAuBhpB,GAEvBgkB,EAAQC,EAAM/B,OAIf,MAED,KAAKD,QAAMI,IAEV,GAAKriB,EAAM4qB,SAAW5qB,EAAM6qB,SAAW7qB,EAAM8qB,SAAW,CAEvD,IAA4B,IAAvBnH,EAAMvC,aAAyB,OAEpC4H,EAAuBhpB,GAEvBgkB,EAAQC,EAAM/B,WAER,CAEN,IAAyB,IAApByB,EAAMrC,UAAsB,OAEjC6H,EAAoBnpB,GAEpBgkB,EAAQC,EAAM5B,IAIf,MAED,QAEC2B,EAAQC,EAAMC,KAIXF,IAAUC,EAAMC,MAEpBP,EAAMG,cAAejE,GApJrBkL,CAAa/qB,IAMf,SAASmmB,EAAenmB,IAEA,IAAlB2jB,EAAMvD,UAEgB,UAAtBpgB,EAAMqqB,YAsSZ,SAAsBrqB,GAIrB,OAFAsqB,GAActqB,GAELgkB,GAER,KAAKC,EAAMoC,aAEV,IAA4B,IAAvB1C,EAAMvC,aAAyB,OAEpCyI,EAAuB7pB,GAEvB2jB,EAAMI,SAEN,MAED,KAAKE,EAAMqC,UAEV,IAAyB,IAApB3C,EAAMrC,UAAsB,OAEjC0I,EAAoBhqB,GAEpB2jB,EAAMI,SAEN,MAED,KAAKE,EAAMsC,gBAEV,IAA0B,IAArB5C,EAAMzC,aAA4C,IAApByC,EAAMrC,UAAsB,QA7XlE,SAAkCthB,GAE5B2jB,EAAMzC,YAAa+I,EAAsBjqB,GAEzC2jB,EAAMrC,WAAY0I,EAAoBhqB,GA2XzCgrB,CAAyBhrB,GAEzB2jB,EAAMI,SAEN,MAED,KAAKE,EAAMuC,mBAEV,IAA0B,IAArB7C,EAAMzC,aAA+C,IAAvByC,EAAMvC,aAAyB,QA/XrE,SAAqCphB,GAE/B2jB,EAAMzC,YAAa+I,EAAsBjqB,GAEzC2jB,EAAMvC,cAAeyI,EAAuB7pB,GA6X/CirB,CAA4BjrB,GAE5B2jB,EAAMI,SAEN,MAED,QAECC,EAAQC,EAAMC,MApVfgH,CAAalrB,GA8If,SAAsBA,GAErB,IAAuB,IAAlB2jB,EAAMvD,QAAoB,OAE/B,OAAS4D,GAER,KAAKC,EAAM/B,OAEV,IAA4B,IAAvByB,EAAMvC,aAAyB,QA7cvC,SAAgCphB,GAE/B4mB,EAAUpZ,IAAKxN,EAAMipB,QAASjpB,EAAMkpB,SAEpCrC,EAAYkD,WAAYnD,EAAWF,GAAcjB,eAAgB9B,EAAMtC,aAEvE,IAAM6G,EAAUvE,EAAM1D,WAEtB8E,EAAY,EAAIrkB,KAAKmgB,GAAKgG,EAAY0C,EAAIrB,EAAQK,cAElDf,EAAU,EAAI9mB,KAAKmgB,GAAKgG,EAAYpT,EAAIyU,EAAQK,cAEhD7B,EAAYja,KAAMma,GAElBjD,EAAMI,SAicJoH,CAAuBnrB,GAEvB,MAED,KAAKikB,EAAM7B,MAEV,IAA0B,IAArBuB,EAAMzC,WAAuB,QAncrC,SAA+BlhB,GAE9BknB,EAAS1Z,IAAKxN,EAAMipB,QAASjpB,EAAMkpB,SAEnC/B,EAAW4C,WAAY7C,EAAUD,GAE5BE,EAAW1T,EAAI,EAEnBoV,EAAUvB,KAECH,EAAW1T,EAAI,GAE1BsV,EAASzB,KAIVL,EAAWxa,KAAMya,GAEjBvD,EAAMI,SAmbJqH,CAAsBprB,GAEtB,MAED,KAAKikB,EAAM5B,IAEV,IAAyB,IAApBsB,EAAMrC,UAAsB,QArbpC,SAA6BthB,GAE5B+mB,EAAOvZ,IAAKxN,EAAMipB,QAASjpB,EAAMkpB,SAEjClC,EAAS+C,WAAYhD,EAAQD,GAAWrB,eAAgB9B,EAAMpC,UAE9DwG,EAAKf,EAASuC,EAAGvC,EAASvT,GAE1BqT,EAASra,KAAMsa,GAEfpD,EAAMI,SA6aJsH,CAAoBrrB,IApKrBsrB,CAAatrB,IAMf,SAASomB,EAAapmB,IAEE,IAAlB2jB,EAAMvD,UAENpgB,EAAMqqB,YAgVX1G,EAAMG,cAAehE,GAErBkE,EAAQC,EAAMC,KAxUdqH,GAAevrB,GAIU,IAApBonB,EAAStoB,SAEb6kB,EAAM1D,WAAWuL,sBAAuBxrB,EAAMmqB,WAE9CxG,EAAM1D,WAAWpN,oBAAqB,cAAesT,GACrDxC,EAAM1D,WAAWpN,oBAAqB,YAAauT,KAMrD,SAASH,EAAiBjmB,GAEzBurB,GAAevrB,GAiJhB,SAASkmB,EAAclmB,IAEC,IAAlB2jB,EAAMvD,UAA0C,IAArBuD,EAAMzC,YAA0B8C,IAAUC,EAAMC,MAAQF,IAAUC,EAAM/B,SAExGliB,EAAMyrB,iBAEN9H,EAAMG,cAAejE,GA3btB,SAA2B7f,GAErBA,EAAMioB,OAAS,EAEnBc,EAASzB,KAEEtnB,EAAMioB,OAAS,GAE1BY,EAAUvB,KAIX3D,EAAMI,SAibN2H,CAAkB1rB,GAElB2jB,EAAMG,cAAehE,IAItB,SAAS2D,EAAWzjB,IAEI,IAAlB2jB,EAAMvD,UAAyC,IAApBuD,EAAMrC,WArbvC,SAAwBthB,GAEvB,IAAI2rB,GAAc,EAElB,OAAS3rB,EAAM4rB,MAEd,KAAKjI,EAAMxc,KAAK0a,GACfkG,EAAK,EAAGpE,EAAMlC,aACdkK,GAAc,EACd,MAED,KAAKhI,EAAMxc,KAAK4a,OACfgG,EAAK,GAAKpE,EAAMlC,aAChBkK,GAAc,EACd,MAED,KAAKhI,EAAMxc,KAAKya,KACfmG,EAAKpE,EAAMlC,YAAa,GACxBkK,GAAc,EACd,MAED,KAAKhI,EAAMxc,KAAK2a,MACfiG,GAAOpE,EAAMlC,YAAa,GAC1BkK,GAAc,EAKXA,IAGJ3rB,EAAMyrB,iBAEN9H,EAAMI,UAsZP8H,CAAe7rB,GAwJhB,SAAS+lB,EAAe/lB,IAEA,IAAlB2jB,EAAMvD,SAEXpgB,EAAMyrB,iBAUP,SAASF,GAAevrB,UAEhBqnB,EAAkBrnB,EAAMmqB,WAE/B,IAAM,IAAIlrB,EAAI,EAAGA,EAAImoB,EAAStoB,OAAQG,IAErC,GAAKmoB,EAAUnoB,GAAIkrB,WAAanqB,EAAMmqB,UAGrC,YADA/C,EAAS7d,OAAQtK,EAAG,GASvB,SAASqrB,GAActqB,GAEtB,IAAI2F,EAAW0hB,EAAkBrnB,EAAMmqB,gBAErBhtB,IAAbwI,IAEJA,EAAW,IAAIghB,UACfU,EAAkBrnB,EAAMmqB,WAAcxkB,GAIvCA,EAAS6H,IAAKxN,EAAMqpB,MAAOrpB,EAAMspB,OAIlC,SAASQ,GAA0B9pB,GAElC,IAAM8rB,EAAY9rB,EAAMmqB,YAAc/C,EAAU,GAAI+C,UAAc/C,EAAU,GAAMA,EAAU,GAE5F,OAAOC,EAAkByE,EAAQ3B,WAvsCD,OA6sCjCxG,EAAM1D,WAAWtN,iBAAkB,cAAeoT,GAElDpC,EAAM1D,WAAWtN,iBAAkB,cAAeqT,GAClDrC,EAAM1D,WAAWtN,iBAAkB,gBAAiBsT,GACpDtC,EAAM1D,WAAWtN,iBAAkB,QAASuT,EAAc,CAAE6F,SAAS,IAIrE,EAAKhI,SArtC4B,E,UAFPiI","file":"static/js/11.1839baf4.chunk.js","sourcesContent":[";(function() {\r\n\r\n\"use strict\";\r\n\r\nvar isNodeEnviroment = typeof module !== 'undefined' && typeof module.exports !== 'undefined';\r\n\r\nvar Tar = isNodeEnviroment ? require('./tar') : window.Tar;\r\nvar download = isNodeEnviroment ? require('./download') : window.download;\r\nvar GIF = isNodeEnviroment ? require('./gif').GIF : window.GIF;\r\nvar WebMWriter = isNodeEnviroment ? require('./webm-writer-0.2.0') : window.WebMWriter;\r\n\r\nvar objectTypes = {\r\n'function': true,\r\n'object': true\r\n};\r\n\r\nfunction checkGlobal(value) {\r\n    return (value && value.Object === Object) ? value : null;\r\n  }\r\n\r\n/** Built-in method references without a dependency on `root`. */\r\nvar freeParseFloat = parseFloat,\r\n  freeParseInt = parseInt;\r\n\r\n/** Detect free variable `exports`. */\r\nvar freeExports = (objectTypes[typeof exports] && exports && !exports.nodeType)\r\n? exports\r\n: undefined;\r\n\r\n/** Detect free variable `module`. */\r\nvar freeModule = (objectTypes[typeof module] && module && !module.nodeType)\r\n? module\r\n: undefined;\r\n\r\n/** Detect the popular CommonJS extension `module.exports`. */\r\nvar moduleExports = (freeModule && freeModule.exports === freeExports)\r\n? freeExports\r\n: undefined;\r\n\r\n/** Detect free variable `global` from Node.js. */\r\nvar freeGlobal = checkGlobal(freeExports && freeModule && typeof global == 'object' && global);\r\n\r\n/** Detect free variable `self`. */\r\nvar freeSelf = checkGlobal(objectTypes[typeof self] && self);\r\n\r\n/** Detect free variable `window`. */\r\nvar freeWindow = checkGlobal(objectTypes[typeof window] && window);\r\n\r\n/** Detect `this` as the global object. */\r\nvar thisGlobal = checkGlobal(objectTypes[typeof this] && this);\r\n\r\n/**\r\n* Used as a reference to the global object.\r\n*\r\n* The `this` value is used if it's the global object to avoid Greasemonkey's\r\n* restricted `window` object, otherwise the `window` object is used.\r\n*/\r\nvar root = freeGlobal ||\r\n((freeWindow !== (thisGlobal && thisGlobal.window)) && freeWindow) ||\r\n  freeSelf || thisGlobal || Function('return this')();\r\n\r\nif( !('gc' in window ) ) {\r\n\twindow.gc = function(){}\r\n}\r\n\r\nif (!HTMLCanvasElement.prototype.toBlob) {\r\n Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\r\n  value: function (callback, type, quality) {\r\n\r\n    var binStr = atob( this.toDataURL(type, quality).split(',')[1] ),\r\n        len = binStr.length,\r\n        arr = new Uint8Array(len);\r\n\r\n    for (var i=0; i<len; i++ ) {\r\n     arr[i] = binStr.charCodeAt(i);\r\n    }\r\n\r\n    callback( new Blob( [arr], {type: type || 'image/png'} ) );\r\n  }\r\n });\r\n}\r\n\r\n// @license http://opensource.org/licenses/MIT\r\n// copyright Paul Irish 2015\r\n\r\n\r\n// Date.now() is supported everywhere except IE8. For IE8 we use the Date.now polyfill\r\n//   github.com/Financial-Times/polyfill-service/blob/master/polyfills/Date.now/polyfill.js\r\n// as Safari 6 doesn't have support for NavigationTiming, we use a Date.now() timestamp for relative values\r\n\r\n// if you want values similar to what you'd get with real perf.now, place this towards the head of the page\r\n// but in reality, you're just getting the delta between now() calls, so it's not terribly important where it's placed\r\n\r\n\r\n(function(){\r\n\r\n  if (\"performance\" in window == false) {\r\n      window.performance = {};\r\n  }\r\n\r\n  Date.now = (Date.now || function () {  // thanks IE8\r\n\t  return new Date().getTime();\r\n  });\r\n\r\n  if (\"now\" in window.performance == false){\r\n\r\n    var nowOffset = Date.now();\r\n\r\n    if (performance.timing && performance.timing.navigationStart){\r\n      nowOffset = performance.timing.navigationStart\r\n    }\r\n\r\n    window.performance.now = function now(){\r\n      return Date.now() - nowOffset;\r\n    }\r\n  }\r\n\r\n})();\r\n\r\n\r\nfunction pad( n ) {\r\n\treturn String(\"0000000\" + n).slice(-7);\r\n}\r\n// https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Timers\r\n\r\nvar g_startTime = window.Date.now();\r\n\r\nfunction guid() {\r\n\tfunction s4() {\r\n\t\treturn Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\r\n\t}\r\n\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\r\n}\r\n\r\nfunction CCFrameEncoder( settings ) {\r\n\r\n\tvar _handlers = {};\r\n\r\n\tthis.settings = settings;\r\n\r\n\tthis.on = function(event, handler) {\r\n\r\n\t\t_handlers[event] = handler;\r\n\r\n\t};\r\n\r\n\tthis.emit = function(event) {\r\n\r\n\t\tvar handler = _handlers[event];\r\n\t\tif (handler) {\r\n\r\n\t\t\thandler.apply(null, Array.prototype.slice.call(arguments, 1));\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.filename = settings.name || guid();\r\n\tthis.extension = '';\r\n\tthis.mimeType = '';\r\n\r\n}\r\n\r\nCCFrameEncoder.prototype.start = function(){};\r\nCCFrameEncoder.prototype.stop = function(){};\r\nCCFrameEncoder.prototype.add = function(){};\r\nCCFrameEncoder.prototype.save = function(){};\r\nCCFrameEncoder.prototype.dispose = function(){};\r\nCCFrameEncoder.prototype.safeToProceed = function(){ return true; };\r\nCCFrameEncoder.prototype.step = function() { console.log( 'Step not set!' ) }\r\n\r\nfunction CCTarEncoder( settings ) {\r\n\r\n  CCFrameEncoder.call( this, settings );\r\n\r\n  this.extension = '.tar'\r\n  this.mimeType = 'application/x-tar'\r\n  this.fileExtension = '';\r\n  this.baseFilename = this.filename;\r\n\r\n  this.tape = null\r\n  this.count = 0;\r\n  this.part = 1;\r\n  this.frames = 0;\r\n\r\n}\r\n\r\nCCTarEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCTarEncoder.prototype.start = function(){\r\n\r\n  this.dispose();\r\n\r\n};\r\n\r\nCCTarEncoder.prototype.add = function( blob ) {\r\n\r\n  var fileReader = new FileReader();\r\n  fileReader.onload = function() {\r\n    this.tape.append( pad( this.count ) + this.fileExtension, new Uint8Array( fileReader.result ) );\r\n\r\n    if( this.settings.autoSaveTime > 0 && ( this.frames / this.settings.framerate ) >= this.settings.autoSaveTime ) {\r\n      this.save( function( blob ) {\r\n        this.filename = this.baseFilename + '-part-' + pad( this.part );\r\n        download( blob, this.filename + this.extension, this.mimeType );\r\n        var count = this.count;\r\n        this.dispose();\r\n        this.count = count+1;\r\n        this.part++;\r\n        this.filename = this.baseFilename + '-part-' + pad( this.part );\r\n        this.frames = 0;\r\n        this.step();\r\n      }.bind( this ) )\r\n    } else {\r\n      this.count++;\r\n      this.frames++;\r\n      this.step();\r\n    }\r\n\r\n  }.bind( this );\r\n  fileReader.readAsArrayBuffer(blob);\r\n\r\n}\r\n\r\nCCTarEncoder.prototype.save = function( callback ) {\r\n\r\n  callback( this.tape.save() );\r\n\r\n}\r\n\r\nCCTarEncoder.prototype.dispose = function() {\r\n\r\n  this.tape = new Tar();\r\n  this.count = 0;\r\n\r\n}\r\n\r\nfunction CCPNGEncoder( settings ) {\r\n\r\n\tCCTarEncoder.call( this, settings );\r\n\r\n\tthis.type = 'image/png';\r\n\tthis.fileExtension = '.png';\r\n\r\n}\r\n\r\nCCPNGEncoder.prototype = Object.create( CCTarEncoder.prototype );\r\n\r\nCCPNGEncoder.prototype.add = function( canvas ) {\r\n\r\n\tcanvas.toBlob( function( blob ) {\r\n\t\tCCTarEncoder.prototype.add.call( this, blob );\r\n\t}.bind( this ), this.type )\r\n\r\n}\r\n\r\nfunction CCJPEGEncoder( settings ) {\r\n\r\n\tCCTarEncoder.call( this, settings );\r\n\r\n\tthis.type = 'image/jpeg';\r\n\tthis.fileExtension = '.jpg';\r\n\tthis.quality = ( settings.quality / 100 ) || .8;\r\n\r\n}\r\n\r\nCCJPEGEncoder.prototype = Object.create( CCTarEncoder.prototype );\r\n\r\nCCJPEGEncoder.prototype.add = function( canvas ) {\r\n\r\n\tcanvas.toBlob( function( blob ) {\r\n\t\tCCTarEncoder.prototype.add.call( this, blob );\r\n\t}.bind( this ), this.type, this.quality )\r\n\r\n}\r\n\r\n/*\r\n\r\n\tWebM Encoder\r\n\r\n*/\r\n\r\nfunction CCWebMEncoder( settings ) {\r\n\r\n\tvar canvas = document.createElement( 'canvas' );\r\n\tif( canvas.toDataURL( 'image/webp' ).substr(5,10) !== 'image/webp' ){\r\n\t\tconsole.log( \"WebP not supported - try another export format\" )\r\n\t}\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tthis.quality = ( settings.quality / 100 ) || .8;\r\n\r\n\tthis.extension = '.webm'\r\n\tthis.mimeType = 'video/webm'\r\n\tthis.baseFilename = this.filename;\r\n  this.framerate = settings.framerate;\r\n\r\n\tthis.frames = 0;\r\n\tthis.part = 1;\r\n\r\n  this.videoWriter = new WebMWriter({\r\n    quality: this.quality,\r\n    fileWriter: null,\r\n    fd: null,\r\n    frameRate: this.framerate\r\n  });\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCWebMEncoder.prototype.start = function( canvas ) {\r\n\r\n\tthis.dispose();\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype.add = function( canvas ) {\r\n\r\n  this.videoWriter.addFrame(canvas);\r\n\r\n\tif( this.settings.autoSaveTime > 0 && ( this.frames / this.settings.framerate ) >= this.settings.autoSaveTime ) {\r\n\t\tthis.save( function( blob ) {\r\n\t\t\tthis.filename = this.baseFilename + '-part-' + pad( this.part );\r\n\t\t\tdownload( blob, this.filename + this.extension, this.mimeType );\r\n\t\t\tthis.dispose();\r\n\t\t\tthis.part++;\r\n\t\t\tthis.filename = this.baseFilename + '-part-' + pad( this.part );\r\n\t\t\tthis.step();\r\n\t\t}.bind( this ) )\r\n\t} else {\r\n    this.frames++;\r\n\t\tthis.step();\r\n\t}\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype.save = function( callback ) {\r\n\r\n  this.videoWriter.complete().then(callback);\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype.dispose = function( canvas ) {\r\n\r\n\tthis.frames = 0;\r\n  this.videoWriter = new WebMWriter({\r\n    quality: this.quality,\r\n    fileWriter: null,\r\n    fd: null,\r\n    frameRate: this.framerate\r\n  });\r\n\r\n}\r\n\r\nfunction CCFFMpegServerEncoder( settings ) {\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tsettings.quality = ( settings.quality / 100 ) || .8;\r\n\r\n\tthis.encoder = new FFMpegServer.Video( settings );\r\n    this.encoder.on( 'process', function() {\r\n        this.emit( 'process' )\r\n    }.bind( this ) );\r\n    this.encoder.on('finished', function( url, size ) {\r\n        var cb = this.callback;\r\n        if ( cb ) {\r\n            this.callback = undefined;\r\n            cb( url, size );\r\n        }\r\n    }.bind( this ) );\r\n    this.encoder.on( 'progress', function( progress ) {\r\n        if ( this.settings.onProgress ) {\r\n            this.settings.onProgress( progress )\r\n        }\r\n    }.bind( this ) );\r\n    this.encoder.on( 'error', function( data ) {\r\n        alert(JSON.stringify(data, null, 2));\r\n    }.bind( this ) );\r\n\r\n}\r\n\r\nCCFFMpegServerEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCFFMpegServerEncoder.prototype.start = function() {\r\n\r\n\tthis.encoder.start( this.settings );\r\n\r\n};\r\n\r\nCCFFMpegServerEncoder.prototype.add = function( canvas ) {\r\n\r\n\tthis.encoder.add( canvas );\r\n\r\n}\r\n\r\nCCFFMpegServerEncoder.prototype.save = function( callback ) {\r\n\r\n    this.callback = callback;\r\n    this.encoder.end();\r\n\r\n}\r\n\r\nCCFFMpegServerEncoder.prototype.safeToProceed = function() {\r\n    return this.encoder.safeToProceed();\r\n};\r\n\r\n/*\r\n\tHTMLCanvasElement.captureStream()\r\n*/\r\n\r\nfunction CCStreamEncoder( settings ) {\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tthis.framerate = this.settings.framerate;\r\n\tthis.type = 'video/webm';\r\n\tthis.extension = '.webm';\r\n\tthis.stream = null;\r\n\tthis.mediaRecorder = null;\r\n\tthis.chunks = [];\r\n\r\n}\r\n\r\nCCStreamEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCStreamEncoder.prototype.add = function( canvas ) {\r\n\r\n\tif( !this.stream ) {\r\n\t\tthis.stream = canvas.captureStream( this.framerate );\r\n\t\tthis.mediaRecorder = new MediaRecorder( this.stream );\r\n\t\tthis.mediaRecorder.start();\r\n\r\n\t\tthis.mediaRecorder.ondataavailable = function(e) {\r\n\t\t\tthis.chunks.push(e.data);\r\n\t\t}.bind( this );\r\n\r\n\t}\r\n\tthis.step();\r\n\r\n}\r\n\r\nCCStreamEncoder.prototype.save = function( callback ) {\r\n\r\n\tthis.mediaRecorder.onstop = function( e ) {\r\n\t\tvar blob = new Blob( this.chunks, { 'type' : 'video/webm' });\r\n\t\tthis.chunks = [];\r\n\t\tcallback( blob );\r\n\r\n\t}.bind( this );\r\n\r\n\tthis.mediaRecorder.stop();\r\n\r\n}\r\n\r\nfunction CCGIFEncoder( settings ) {\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tsettings.quality = 31 - ( ( settings.quality * 30 / 100 ) || 10 );\r\n\tsettings.workers = settings.workers || 4;\r\n\r\n\tthis.extension = '.gif'\r\n\tthis.mimeType = 'image/gif'\r\n\r\n  \tthis.canvas = document.createElement( 'canvas' );\r\n  \tthis.ctx = this.canvas.getContext( '2d' );\r\n  \tthis.sizeSet = false;\r\n\r\n\tvar gifWorkerText = \"(function(b){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c},a.define('/gif.worker.coffee',function(d,e,f,g){var b,c;b=a('/GIFEncoder.js',d),c=function(a){var c,e,d,f;return c=new b(a.width,a.height),a.index===0?c.writeHeader():c.firstFrame=!1,c.setTransparent(a.transparent),c.setRepeat(a.repeat),c.setDelay(a.delay),c.setQuality(a.quality),c.addFrame(a.data),a.last&&c.finish(),d=c.stream(),a.data=d.pages,a.cursor=d.cursor,a.pageSize=d.constructor.pageSize,a.canTransfer?(f=function(c){for(var b=0,d=a.data.length;b<d;++b)e=a.data[b],c.push(e.buffer);return c}.call(this,[]),self.postMessage(a,f)):self.postMessage(a)},self.onmessage=function(a){return c(a.data)}}),a.define('/GIFEncoder.js',function(e,h,i,j){function c(){this.page=-1,this.pages=[],this.newPage()}function b(a,b){this.width=~~a,this.height=~~b,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new c}var f=a('/TypedNeuQuant.js',e),g=a('/LZWEncoder.js',e);c.pageSize=4096,c.charMap={};for(var d=0;d<256;d++)c.charMap[d]=String.fromCharCode(d);c.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(c.pageSize),this.cursor=0},c.prototype.getData=function(){var d='';for(var a=0;a<this.pages.length;a++)for(var b=0;b<c.pageSize;b++)d+=c.charMap[this.pages[a][b]];return d},c.prototype.writeByte=function(a){this.cursor>=c.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=a},c.prototype.writeUTFBytes=function(b){for(var c=b.length,a=0;a<c;a++)this.writeByte(b.charCodeAt(a))},c.prototype.writeBytes=function(b,d,e){for(var c=e||b.length,a=d||0;a<c;a++)this.writeByte(b[a])},b.prototype.setDelay=function(a){this.delay=Math.round(a/10)},b.prototype.setFrameRate=function(a){this.delay=Math.round(100/a)},b.prototype.setDispose=function(a){a>=0&&(this.dispose=a)},b.prototype.setRepeat=function(a){this.repeat=a},b.prototype.setTransparent=function(a){this.transparent=a},b.prototype.addFrame=function(a){this.image=a,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},b.prototype.finish=function(){this.out.writeByte(59)},b.prototype.setQuality=function(a){a<1&&(a=1),this.sample=a},b.prototype.writeHeader=function(){this.out.writeUTFBytes('GIF89a')},b.prototype.analyzePixels=function(){var g=this.pixels.length,d=g/3;this.indexedPixels=new Uint8Array(d);var a=new f(this.pixels,this.sample);a.buildColormap(),this.colorTab=a.getColormap();var b=0;for(var c=0;c<d;c++){var e=a.lookupRGB(this.pixels[b++]&255,this.pixels[b++]&255,this.pixels[b++]&255);this.usedEntry[e]=!0,this.indexedPixels[c]=e}this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent))},b.prototype.findClosest=function(e){if(this.colorTab===null)return-1;var k=(e&16711680)>>16,l=(e&65280)>>8,m=e&255,c=0,d=16777216,j=this.colorTab.length;for(var a=0;a<j;){var f=k-(this.colorTab[a++]&255),g=l-(this.colorTab[a++]&255),h=m-(this.colorTab[a]&255),i=f*f+g*g+h*h,b=parseInt(a/3);this.usedEntry[b]&&i<d&&(d=i,c=b),a++}return c},b.prototype.getImagePixels=function(){var a=this.width,g=this.height;this.pixels=new Uint8Array(a*g*3);var b=this.image,c=0;for(var d=0;d<g;d++)for(var e=0;e<a;e++){var f=d*a*4+e*4;this.pixels[c++]=b[f],this.pixels[c++]=b[f+1],this.pixels[c++]=b[f+2]}},b.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var b,a;this.transparent===null?(b=0,a=0):(b=1,a=2),this.dispose>=0&&(a=dispose&7),a<<=2,this.out.writeByte(0|a|0|b),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},b.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},b.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},b.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes('NETSCAPE2.0'),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},b.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var b=768-this.colorTab.length;for(var a=0;a<b;a++)this.out.writeByte(0)},b.prototype.writeShort=function(a){this.out.writeByte(a&255),this.out.writeByte(a>>8&255)},b.prototype.writePixels=function(){var a=new g(this.width,this.height,this.indexedPixels,this.colorDepth);a.encode(this.out)},b.prototype.stream=function(){return this.out},e.exports=b}),a.define('/LZWEncoder.js',function(e,g,h,i){function f(y,D,C,B){function w(a,b){r[f++]=a,f>=254&&t(b)}function x(b){u(a),k=i+2,j=!0,l(i,b)}function u(b){for(var a=0;a<b;++a)h[a]=-1}function A(z,r){var g,t,d,e,y,w,s;for(q=z,j=!1,n_bits=q,m=p(n_bits),i=1<<z-1,o=i+1,k=i+2,f=0,e=v(),s=0,g=a;g<65536;g*=2)++s;s=8-s,w=a,u(w),l(i,r);a:while((t=v())!=c){if(g=(t<<b)+e,d=t<<s^e,h[d]===g){e=n[d];continue}if(h[d]>=0){y=w-d,d===0&&(y=1);do if((d-=y)<0&&(d+=w),h[d]===g){e=n[d];continue a}while(h[d]>=0)}l(e,r),e=t,k<1<<b?(n[d]=k++,h[d]=g):x(r)}l(e,r),l(o,r)}function z(a){a.writeByte(s),remaining=y*D,curPixel=0,A(s+1,a),a.writeByte(0)}function t(a){f>0&&(a.writeByte(f),a.writeBytes(r,0,f),f=0)}function p(a){return(1<<a)-1}function v(){if(remaining===0)return c;--remaining;var a=C[curPixel++];return a&255}function l(a,c){g&=d[e],e>0?g|=a<<e:g=a,e+=n_bits;while(e>=8)w(g&255,c),g>>=8,e-=8;if((k>m||j)&&(j?(m=p(n_bits=q),j=!1):(++n_bits,n_bits==b?m=1<<b:m=p(n_bits))),a==o){while(e>0)w(g&255,c),g>>=8,e-=8;t(c)}}var s=Math.max(2,B),r=new Uint8Array(256),h=new Int32Array(a),n=new Int32Array(a),g,e=0,f,k=0,m,j=!1,q,i,o;this.encode=z}var c=-1,b=12,a=5003,d=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=f}),a.define('/TypedNeuQuant.js',function(A,F,E,D){function C(A,B){function I(){o=[],q=new Int32Array(256),t=new Int32Array(a),y=new Int32Array(a),z=new Int32Array(a>>3);var c,d;for(c=0;c<a;c++)d=(c<<b+8)/a,o[c]=new Float64Array([d,d,d,0]),y[c]=e/a,t[c]=0}function J(){for(var c=0;c<a;c++)o[c][0]>>=b,o[c][1]>>=b,o[c][2]>>=b,o[c][3]=c}function K(b,a,c,e,f){o[a][0]-=b*(o[a][0]-c)/d,o[a][1]-=b*(o[a][1]-e)/d,o[a][2]-=b*(o[a][2]-f)/d}function L(j,e,n,l,k){var h=Math.abs(e-j),i=Math.min(e+j,a),g=e+1,f=e-1,m=1,b,d;while(g<i||f>h)d=z[m++],g<i&&(b=o[g++],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c),f>h&&(b=o[f--],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c)}function C(p,s,q){var h=2147483647,k=h,d=-1,m=d,c,j,e,n,l;for(c=0;c<a;c++)j=o[c],e=Math.abs(j[0]-p)+Math.abs(j[1]-s)+Math.abs(j[2]-q),e<h&&(h=e,d=c),n=e-(t[c]>>i-b),n<k&&(k=n,m=c),l=y[c]>>g,y[c]-=l,t[c]+=l<<f;return y[d]+=x,t[d]-=r,m}function D(){var d,b,e,c,h,g,f=0,i=0;for(d=0;d<a;d++){for(e=o[d],h=d,g=e[1],b=d+1;b<a;b++)c=o[b],c[1]<g&&(h=b,g=c[1]);if(c=o[h],d!=h&&(b=c[0],c[0]=e[0],e[0]=b,b=c[1],c[1]=e[1],e[1]=b,b=c[2],c[2]=e[2],e[2]=b,b=c[3],c[3]=e[3],e[3]=b),g!=f){for(q[f]=i+d>>1,b=f+1;b<g;b++)q[b]=d;f=g,i=d}}for(q[f]=i+n>>1,b=f+1;b<256;b++)q[b]=n}function E(j,i,k){var b,d,c,e=1e3,h=-1,f=q[i],g=f-1;while(f<a||g>=0)f<a&&(d=o[f],c=d[1]-i,c>=e?f=a:(f++,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3])))),g>=0&&(d=o[g],c=i-d[1],c>=e?g=-1:(g--,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3]))));return h}function F(){var c,f=A.length,D=30+(B-1)/3,y=f/(3*B),q=~~(y/w),n=d,o=u,a=o>>h;for(a<=1&&(a=0),c=0;c<a;c++)z[c]=n*((a*a-c*c)*m/(a*a));var i;f<s?(B=1,i=3):f%l!==0?i=3*l:f%k!==0?i=3*k:f%p!==0?i=3*p:i=3*j;var r,t,x,e,g=0;c=0;while(c<y)if(r=(A[g]&255)<<b,t=(A[g+1]&255)<<b,x=(A[g+2]&255)<<b,e=C(r,t,x),K(n,e,r,t,x),a!==0&&L(a,e,r,t,x),g+=i,g>=f&&(g-=f),c++,q===0&&(q=1),c%q===0)for(n-=n/D,o-=o/v,a=o>>h,a<=1&&(a=0),e=0;e<a;e++)z[e]=n*((a*a-e*e)*m/(a*a))}function G(){I(),F(),J(),D()}function H(){var b=[],g=[];for(var c=0;c<a;c++)g[o[c][3]]=c;var d=0;for(var e=0;e<a;e++){var f=g[e];b[d++]=o[f][0],b[d++]=o[f][1],b[d++]=o[f][2]}return b}var o,q,t,y,z;this.buildColormap=G,this.getColormap=H,this.lookupRGB=E}var w=100,a=256,n=a-1,b=4,i=16,e=1<<i,f=10,B=1<<f,g=10,x=e>>g,r=e<<f-g,z=a>>3,h=6,t=1<<h,u=z*t,v=30,o=10,d=1<<o,q=8,m=1<<q,y=o+q,c=1<<y,l=499,k=491,p=487,j=503,s=3*j;A.exports=C}),a('/gif.worker.coffee')}.call(this,this))\"\r\n\tvar workerBlob = new Blob([gifWorkerText], {\r\n\t\ttype: 'application/javascript'\r\n\t\t})\r\n\tvar workerScript = URL.createObjectURL(workerBlob)\r\n\r\n  \tthis.encoder = new GIF({\r\n\t\tworkers: settings.workers,\r\n\t\tquality: settings.quality,\r\n\t\tworkerScript: workerScript\r\n\t} );\r\n\r\n    this.encoder.on( 'progress', function( progress ) {\r\n        if ( this.settings.onProgress ) {\r\n            this.settings.onProgress( progress )\r\n        }\r\n    }.bind( this ) );\r\n\r\n    this.encoder.on('finished', function( blob ) {\r\n        var cb = this.callback;\r\n        if ( cb ) {\r\n            this.callback = undefined;\r\n            cb( blob );\r\n        }\r\n    }.bind( this ) );\r\n}\r\n\r\nCCGIFEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCGIFEncoder.prototype.add = function( canvas ) {\r\n\r\n\tif( !this.sizeSet ) {\r\n\t\tthis.encoder.setOption( 'width',canvas.width );\r\n\t\tthis.encoder.setOption( 'height',canvas.height );\r\n\t\tthis.sizeSet = true;\r\n\t}\r\n\r\n\tthis.canvas.width = canvas.width;\r\n\tthis.canvas.height = canvas.height;\r\n\tthis.ctx.drawImage( canvas, 0, 0 );\r\n\r\n\tthis.encoder.addFrame( this.ctx, { copy: true, delay: this.settings.step } );\r\n\tthis.step();\r\n\r\n\t/*this.encoder.setSize( canvas.width, canvas.height );\r\n\tvar readBuffer = new Uint8Array(canvas.width * canvas.height * 4);\r\n\tvar context = canvas.getContext( 'webgl' );\r\n\tcontext.readPixels(0, 0, canvas.width, canvas.height, context.RGBA, context.UNSIGNED_BYTE, readBuffer);\r\n\tthis.encoder.addFrame( readBuffer, true );*/\r\n\r\n}\r\n\r\nCCGIFEncoder.prototype.save = function( callback ) {\r\n\r\n    this.callback = callback;\r\n\r\n\tthis.encoder.render();\r\n\r\n}\r\n\r\nfunction CCapture( settings ) {\r\n\r\n\tvar _settings = settings || {},\r\n\t\t_date = new Date(),\r\n\t\t_verbose,\r\n\t\t_display,\r\n\t\t_time,\r\n\t\t_startTime,\r\n\t\t_performanceTime,\r\n\t\t_performanceStartTime,\r\n\t\t_step,\r\n        _encoder,\r\n\t\t_timeouts = [],\r\n\t\t_intervals = [],\r\n\t\t_frameCount = 0,\r\n\t\t_intermediateFrameCount = 0,\r\n\t\t_lastFrame = null,\r\n\t\t_requestAnimationFrameCallbacks = [],\r\n\t\t_capturing = false,\r\n        _handlers = {};\r\n\r\n\t_settings.framerate = _settings.framerate || 60;\r\n\t_settings.motionBlurFrames = 2 * ( _settings.motionBlurFrames || 1 );\r\n\t_verbose = _settings.verbose || false;\r\n\t_display = _settings.display || false;\r\n\t_settings.step = 1000.0 / _settings.framerate ;\r\n\t_settings.timeLimit = _settings.timeLimit || 0;\r\n\t_settings.frameLimit = _settings.frameLimit || 0;\r\n\t_settings.startTime = _settings.startTime || 0;\r\n\r\n\tvar _timeDisplay = document.createElement( 'div' );\r\n\t_timeDisplay.style.position = 'absolute';\r\n\t_timeDisplay.style.left = _timeDisplay.style.top = 0\r\n\t_timeDisplay.style.backgroundColor = 'black';\r\n\t_timeDisplay.style.fontFamily = 'monospace'\r\n\t_timeDisplay.style.fontSize = '11px'\r\n\t_timeDisplay.style.padding = '5px'\r\n\t_timeDisplay.style.color = 'red';\r\n\t_timeDisplay.style.zIndex = 100000\r\n\tif( _settings.display ) document.body.appendChild( _timeDisplay );\r\n\r\n\tvar canvasMotionBlur = document.createElement( 'canvas' );\r\n\tvar ctxMotionBlur = canvasMotionBlur.getContext( '2d' );\r\n\tvar bufferMotionBlur;\r\n\tvar imageData;\r\n\r\n\t_log( 'Step is set to ' + _settings.step + 'ms' );\r\n\r\n    var _encoders = {\r\n\t\tgif: CCGIFEncoder,\r\n\t\twebm: CCWebMEncoder,\r\n\t\tffmpegserver: CCFFMpegServerEncoder,\r\n\t\tpng: CCPNGEncoder,\r\n\t\tjpg: CCJPEGEncoder,\r\n\t\t'webm-mediarecorder': CCStreamEncoder\r\n    };\r\n\r\n    var ctor = _encoders[ _settings.format ];\r\n    if ( !ctor ) {\r\n\t\tthrow \"Error: Incorrect or missing format: Valid formats are \" + Object.keys(_encoders).join(\", \");\r\n    }\r\n    _encoder = new ctor( _settings );\r\n    _encoder.step = _step\r\n\r\n\t_encoder.on('process', _process);\r\n    _encoder.on('progress', _progress);\r\n\r\n    if (\"performance\" in window == false) {\r\n    \twindow.performance = {};\r\n    }\r\n\r\n\tDate.now = (Date.now || function () {  // thanks IE8\r\n\t\treturn new Date().getTime();\r\n\t});\r\n\r\n\tif (\"now\" in window.performance == false){\r\n\r\n\t\tvar nowOffset = Date.now();\r\n\r\n\t\tif (performance.timing && performance.timing.navigationStart){\r\n\t\t\tnowOffset = performance.timing.navigationStart\r\n\t\t}\r\n\r\n\t\twindow.performance.now = function now(){\r\n\t\t\treturn Date.now() - nowOffset;\r\n\t\t}\r\n\t}\r\n\r\n\tvar _oldSetTimeout = window.setTimeout,\r\n\t\t_oldSetInterval = window.setInterval,\r\n\t    \t_oldClearInterval = window.clearInterval,\r\n\t\t_oldClearTimeout = window.clearTimeout,\r\n\t\t_oldRequestAnimationFrame = window.requestAnimationFrame,\r\n\t\t_oldNow = window.Date.now,\r\n\t\t_oldPerformanceNow = window.performance.now,\r\n\t\t_oldGetTime = window.Date.prototype.getTime;\r\n\t// Date.prototype._oldGetTime = Date.prototype.getTime;\r\n\r\n\tvar media = [];\r\n\r\n\tfunction _init() {\r\n\r\n\t\t_log( 'Capturer start' );\r\n\r\n\t\t_startTime = window.Date.now();\r\n\t\t_time = _startTime + _settings.startTime;\r\n\t\t_performanceStartTime = window.performance.now();\r\n\t\t_performanceTime = _performanceStartTime + _settings.startTime;\r\n\r\n\t\twindow.Date.prototype.getTime = function(){\r\n\t\t\treturn _time;\r\n\t\t};\r\n\t\twindow.Date.now = function() {\r\n\t\t\treturn _time;\r\n\t\t};\r\n\r\n\t\twindow.setTimeout = function( callback, time ) {\r\n\t\t\tvar t = {\r\n\t\t\t\tcallback: callback,\r\n\t\t\t\ttime: time,\r\n\t\t\t\ttriggerTime: _time + time\r\n\t\t\t};\r\n\t\t\t_timeouts.push( t );\r\n\t\t\t_log( 'Timeout set to ' + t.time );\r\n            return t;\r\n\t\t};\r\n\t\twindow.clearTimeout = function( id ) {\r\n\t\t\tfor( var j = 0; j < _timeouts.length; j++ ) {\r\n\t\t\t\tif( _timeouts[ j ] == id ) {\r\n\t\t\t\t\t_timeouts.splice( j, 1 );\r\n\t\t\t\t\t_log( 'Timeout cleared' );\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\twindow.setInterval = function( callback, time ) {\r\n\t\t\tvar t = {\r\n\t\t\t\tcallback: callback,\r\n\t\t\t\ttime: time,\r\n\t\t\t\ttriggerTime: _time + time\r\n\t\t\t};\r\n\t\t\t_intervals.push( t );\r\n\t\t\t_log( 'Interval set to ' + t.time );\r\n\t\t\treturn t;\r\n\t\t};\r\n\t\twindow.clearInterval = function( id ) {\r\n\t\t\t_log( 'clear Interval' );\r\n\t\t\treturn null;\r\n\t\t};\r\n\t\twindow.requestAnimationFrame = function( callback ) {\r\n\t\t\t_requestAnimationFrameCallbacks.push( callback );\r\n\t\t};\r\n\t\twindow.performance.now = function(){\r\n\t\t\treturn _performanceTime;\r\n\t\t};\r\n\r\n\t\tfunction hookCurrentTime() { \r\n\t\t\tif( !this._hooked ) {\r\n\t\t\t\tthis._hooked = true;\r\n\t\t\t\tthis._hookedTime = this.currentTime || 0;\r\n\t\t\t\tthis.pause();\r\n\t\t\t\tmedia.push( this );\r\n\t\t\t}\r\n\t\t\treturn this._hookedTime + _settings.startTime;\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tObject.defineProperty( HTMLVideoElement.prototype, 'currentTime', { get: hookCurrentTime } )\r\n\t\t\tObject.defineProperty( HTMLAudioElement.prototype, 'currentTime', { get: hookCurrentTime } )\r\n\t\t} catch (err) {\r\n\t\t\t_log(err);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _start() {\r\n\t\t_init();\r\n\t\t_encoder.start();\r\n\t\t_capturing = true;\r\n\t}\r\n\r\n\tfunction _stop() {\r\n\t\t_capturing = false;\r\n\t\t_encoder.stop();\r\n\t\t_destroy();\r\n\t}\r\n\r\n\tfunction _call( fn, p ) {\r\n\t\t_oldSetTimeout( fn, 0, p );\r\n\t}\r\n\r\n\tfunction _step() {\r\n\t\t//_oldRequestAnimationFrame( _process );\r\n\t\t_call( _process );\r\n\t}\r\n\r\n\tfunction _destroy() {\r\n\t\t_log( 'Capturer stop' );\r\n\t\twindow.setTimeout = _oldSetTimeout;\r\n\t\twindow.setInterval = _oldSetInterval;\r\n\t\twindow.clearInterval = _oldClearInterval;\r\n\t\twindow.clearTimeout = _oldClearTimeout;\r\n\t\twindow.requestAnimationFrame = _oldRequestAnimationFrame;\r\n\t\twindow.Date.prototype.getTime = _oldGetTime;\r\n\t\twindow.Date.now = _oldNow;\r\n\t\twindow.performance.now = _oldPerformanceNow;\r\n\t}\r\n\r\n\tfunction _updateTime() {\r\n\t\tvar seconds = _frameCount / _settings.framerate;\r\n\t\tif( ( _settings.frameLimit && _frameCount >= _settings.frameLimit ) || ( _settings.timeLimit && seconds >= _settings.timeLimit ) ) {\r\n\t\t\t_stop();\r\n\t\t\t_save();\r\n\t\t}\r\n\t\tvar d = new Date( null );\r\n\t\td.setSeconds( seconds );\r\n\t\tif( _settings.motionBlurFrames > 2 ) {\r\n\t\t\t_timeDisplay.textContent = 'CCapture ' + _settings.format + ' | ' + _frameCount + ' frames (' + _intermediateFrameCount + ' inter) | ' +  d.toISOString().substr( 11, 8 );\r\n\t\t} else {\r\n\t\t\t_timeDisplay.textContent = 'CCapture ' + _settings.format + ' | ' + _frameCount + ' frames | ' +  d.toISOString().substr( 11, 8 );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _checkFrame( canvas ) {\r\n\r\n\t\tif( canvasMotionBlur.width !== canvas.width || canvasMotionBlur.height !== canvas.height ) {\r\n\t\t\tcanvasMotionBlur.width = canvas.width;\r\n\t\t\tcanvasMotionBlur.height = canvas.height;\r\n\t\t\tbufferMotionBlur = new Uint16Array( canvasMotionBlur.height * canvasMotionBlur.width * 4 );\r\n\t\t\tctxMotionBlur.fillStyle = '#0'\r\n\t\t\tctxMotionBlur.fillRect( 0, 0, canvasMotionBlur.width, canvasMotionBlur.height );\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _blendFrame( canvas ) {\r\n\r\n\t\t//_log( 'Intermediate Frame: ' + _intermediateFrameCount );\r\n\r\n\t\tctxMotionBlur.drawImage( canvas, 0, 0 );\r\n\t\timageData = ctxMotionBlur.getImageData( 0, 0, canvasMotionBlur.width, canvasMotionBlur.height );\r\n\t\tfor( var j = 0; j < bufferMotionBlur.length; j+= 4 ) {\r\n\t\t\tbufferMotionBlur[ j ] += imageData.data[ j ];\r\n\t\t\tbufferMotionBlur[ j + 1 ] += imageData.data[ j + 1 ];\r\n\t\t\tbufferMotionBlur[ j + 2 ] += imageData.data[ j + 2 ];\r\n\t\t}\r\n\t\t_intermediateFrameCount++;\r\n\r\n\t}\r\n\r\n\tfunction _saveFrame(){\r\n\r\n\t\tvar data = imageData.data;\r\n\t\tfor( var j = 0; j < bufferMotionBlur.length; j+= 4 ) {\r\n\t\t\tdata[ j ] = bufferMotionBlur[ j ] * 2 / _settings.motionBlurFrames;\r\n\t\t\tdata[ j + 1 ] = bufferMotionBlur[ j + 1 ] * 2 / _settings.motionBlurFrames;\r\n\t\t\tdata[ j + 2 ] = bufferMotionBlur[ j + 2 ] * 2 / _settings.motionBlurFrames;\r\n\t\t}\r\n\t\tctxMotionBlur.putImageData( imageData, 0, 0 );\r\n\t\t_encoder.add( canvasMotionBlur );\r\n\t\t_frameCount++;\r\n\t\t_intermediateFrameCount = 0;\r\n\t\t_log( 'Full MB Frame! ' + _frameCount + ' ' +  _time );\r\n\t\tfor( var j = 0; j < bufferMotionBlur.length; j+= 4 ) {\r\n\t\t\tbufferMotionBlur[ j ] = 0;\r\n\t\t\tbufferMotionBlur[ j + 1 ] = 0;\r\n\t\t\tbufferMotionBlur[ j + 2 ] = 0;\r\n\t\t}\r\n\t\tgc();\r\n\r\n\t}\r\n\r\n\tfunction _capture( canvas ) {\r\n\r\n\t\tif( _capturing ) {\r\n\r\n\t\t\tif( _settings.motionBlurFrames > 2 ) {\r\n\r\n\t\t\t\t_checkFrame( canvas );\r\n\t\t\t\t_blendFrame( canvas );\r\n\r\n\t\t\t\tif( _intermediateFrameCount >= .5 * _settings.motionBlurFrames ) {\r\n\t\t\t\t\t_saveFrame();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_step();\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\t_encoder.add( canvas );\r\n\t\t\t\t_frameCount++;\r\n\t\t\t\t_log( 'Full Frame! ' + _frameCount );\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _process() {\r\n\r\n\t\tvar step = 1000 / _settings.framerate;\r\n\t\tvar dt = ( _frameCount + _intermediateFrameCount / _settings.motionBlurFrames ) * step;\r\n\r\n\t\t_time = _startTime + dt;\r\n\t\t_performanceTime = _performanceStartTime + dt;\r\n\r\n\t\tmedia.forEach( function( v ) {\r\n\t\t\tv._hookedTime = dt / 1000;\r\n\t\t} );\r\n\r\n\t\t_updateTime();\r\n\t\t_log( 'Frame: ' + _frameCount + ' ' + _intermediateFrameCount );\r\n\r\n\t\tfor( var j = 0; j < _timeouts.length; j++ ) {\r\n\t\t\tif( _time >= _timeouts[ j ].triggerTime ) {\r\n\t\t\t\t_call( _timeouts[ j ].callback )\r\n\t\t\t\t//console.log( 'timeout!' );\r\n\t\t\t\t_timeouts.splice( j, 1 );\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor( var j = 0; j < _intervals.length; j++ ) {\r\n\t\t\tif( _time >= _intervals[ j ].triggerTime ) {\r\n\t\t\t\t_call( _intervals[ j ].callback );\r\n\t\t\t\t_intervals[ j ].triggerTime += _intervals[ j ].time;\r\n\t\t\t\t//console.log( 'interval!' );\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_requestAnimationFrameCallbacks.forEach( function( cb ) {\r\n     \t\t_call( cb, _time - g_startTime );\r\n        } );\r\n        _requestAnimationFrameCallbacks = [];\r\n\r\n\t}\r\n\r\n\tfunction _save( callback ) {\r\n\r\n\t\tif( !callback ) {\r\n\t\t\tcallback = function( blob ) {\r\n\t\t\t\tdownload( blob, _encoder.filename + _encoder.extension, _encoder.mimeType );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t_encoder.save( callback );\r\n\r\n\t}\r\n\r\n\tfunction _log( message ) {\r\n\t\tif( _verbose ) console.log( message );\r\n\t}\r\n\r\n    function _on( event, handler ) {\r\n\r\n        _handlers[event] = handler;\r\n\r\n    }\r\n\r\n    function _emit( event ) {\r\n\r\n        var handler = _handlers[event];\r\n        if ( handler ) {\r\n\r\n            handler.apply( null, Array.prototype.slice.call( arguments, 1 ) );\r\n\r\n        }\r\n\r\n    }\r\n\r\n    function _progress( progress ) {\r\n\r\n        _emit( 'progress', progress );\r\n\r\n    }\r\n\r\n\treturn {\r\n\t\tstart: _start,\r\n\t\tcapture: _capture,\r\n\t\tstop: _stop,\r\n\t\tsave: _save,\r\n        on: _on\r\n\t}\r\n}\r\n\r\n(freeWindow || freeSelf || {}).CCapture = CCapture;\r\n\r\n  // Some AMD build optimizers like r.js check for condition patterns like the following:\r\n  if (typeof define == 'function' && typeof define.amd == 'object' && define.amd) {\r\n    // Define as an anonymous module so, through path mapping, it can be\r\n    // referenced as the \"underscore\" module.\r\n    define(function() {\r\n    \treturn CCapture;\r\n    });\r\n}\r\n  // Check for `exports` after `define` in case a build optimizer adds an `exports` object.\r\n  else if (freeExports && freeModule) {\r\n    // Export for Node.js.\r\n    if (moduleExports) {\r\n    \t(freeModule.exports = CCapture).CCapture = CCapture;\r\n    }\r\n    // Export for CommonJS support.\r\n    freeExports.CCapture = CCapture;\r\n}\r\nelse {\r\n    // Export to the global object.\r\n    root.CCapture = CCapture;\r\n}\r\n\r\n}());\r\n","(function () {\n\t\"use strict\";\n\n\tvar lookup = [\n\t\t\t'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',\n\t\t\t'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',\n\t\t\t'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',\n\t\t\t'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',\n\t\t\t'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',\n\t\t\t'o', 'p', 'q', 'r', 's', 't', 'u', 'v',\n\t\t\t'w', 'x', 'y', 'z', '0', '1', '2', '3',\n\t\t\t'4', '5', '6', '7', '8', '9', '+', '/'\n\t\t];\n\tfunction clean(length) {\n\t\tvar i, buffer = new Uint8Array(length);\n\t\tfor (i = 0; i < length; i += 1) {\n\t\t\tbuffer[i] = 0;\n\t\t}\n\t\treturn buffer;\n\t}\n\n\tfunction extend(orig, length, addLength, multipleOf) {\n\t\tvar newSize = length + addLength,\n\t\t\tbuffer = clean((parseInt(newSize / multipleOf) + 1) * multipleOf);\n\n\t\tbuffer.set(orig);\n\n\t\treturn buffer;\n\t}\n\n\tfunction pad(num, bytes, base) {\n\t\tnum = num.toString(base || 8);\n\t\treturn \"000000000000\".substr(num.length + 12 - bytes) + num;\n\t}\t\n\t\n\tfunction stringToUint8 (input, out, offset) {\n\t\tvar i, length;\n\n\t\tout = out || clean(input.length);\n\n\t\toffset = offset || 0;\n\t\tfor (i = 0, length = input.length; i < length; i += 1) {\n\t\t\tout[offset] = input.charCodeAt(i);\n\t\t\toffset += 1;\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tfunction uint8ToBase64(uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length;\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F];\n\t\t};\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2]);\n\t\t\toutput += tripletToBase64(temp);\n\t\t}\n\n\t\t// this prevents an ERR_INVALID_URL in Chrome (Firefox okay)\n\t\tswitch (output.length % 4) {\n\t\t\tcase 1:\n\t\t\t\toutput += '=';\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\toutput += '==';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn output;\n\t}\n\n\twindow.utils = {}\n\twindow.utils.clean = clean;\n\twindow.utils.pad = pad;\n\twindow.utils.extend = extend;\n\twindow.utils.stringToUint8 = stringToUint8;\n\twindow.utils.uint8ToBase64 = uint8ToBase64;\n}());\n\n(function () {\n\t\"use strict\";\n\t\n/*\nstruct posix_header {             // byte offset\n\tchar name[100];               //   0\n\tchar mode[8];                 // 100\n\tchar uid[8];                  // 108\n\tchar gid[8];                  // 116\n\tchar size[12];                // 124\n\tchar mtime[12];               // 136\n\tchar chksum[8];               // 148\n\tchar typeflag;                // 156\n\tchar linkname[100];           // 157\n\tchar magic[6];                // 257\n\tchar version[2];              // 263\n\tchar uname[32];               // 265\n\tchar gname[32];               // 297\n\tchar devmajor[8];             // 329\n\tchar devminor[8];             // 337\n\tchar prefix[155];             // 345\n                                  // 500\n};\n*/\n\n\tvar utils = window.utils,\n\t\theaderFormat;\n\t\n\theaderFormat = [\n\t\t{\n\t\t\t'field': 'fileName',\n\t\t\t'length': 100\n\t\t},\n\t\t{\n\t\t\t'field': 'fileMode',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'uid',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'gid',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'fileSize',\n\t\t\t'length': 12\n\t\t},\n\t\t{\n\t\t\t'field': 'mtime',\n\t\t\t'length': 12\n\t\t},\n\t\t{\n\t\t\t'field': 'checksum',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'type',\n\t\t\t'length': 1\n\t\t},\n\t\t{\n\t\t\t'field': 'linkName',\n\t\t\t'length': 100\n\t\t},\n\t\t{\n\t\t\t'field': 'ustar',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'owner',\n\t\t\t'length': 32\n\t\t},\n\t\t{\n\t\t\t'field': 'group',\n\t\t\t'length': 32\n\t\t},\n\t\t{\n\t\t\t'field': 'majorNumber',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'minorNumber',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'filenamePrefix',\n\t\t\t'length': 155\n\t\t},\n\t\t{\n\t\t\t'field': 'padding',\n\t\t\t'length': 12\n\t\t}\n\t];\n\n\tfunction formatHeader(data, cb) {\n\t\tvar buffer = utils.clean(512),\n\t\t\toffset = 0;\n\n\t\theaderFormat.forEach(function (value) {\n\t\t\tvar str = data[value.field] || \"\",\n\t\t\t\ti, length;\n\n\t\t\tfor (i = 0, length = str.length; i < length; i += 1) {\n\t\t\t\tbuffer[offset] = str.charCodeAt(i);\n\t\t\t\toffset += 1;\n\t\t\t}\n\n\t\t\toffset += value.length - i; // space it out with nulls\n\t\t});\n\n\t\tif (typeof cb === 'function') {\n\t\t\treturn cb(buffer, offset);\n\t\t}\n\t\treturn buffer;\n\t}\n\t\n\twindow.header = {}\n\twindow.header.structure = headerFormat;\n\twindow.header.format = formatHeader;\n}());\n\n(function () {\n\t\"use strict\";\n\n\tvar header = window.header,\n\t\tutils = window.utils,\n\t\trecordSize = 512,\n\t\tblockSize;\n\t\n\tfunction Tar(recordsPerBlock) {\n\t\tthis.written = 0;\n\t\tblockSize = (recordsPerBlock || 20) * recordSize;\n\t\tthis.out = utils.clean(blockSize);\n\t\tthis.blocks = [];\n\t\tthis.length = 0;\n\t}\n\n\tTar.prototype.append = function (filepath, input, opts, callback) {\n\t\tvar data,\n\t\t\tchecksum,\n\t\t\tmode,\n\t\t\tmtime,\n\t\t\tuid,\n\t\t\tgid,\n\t\t\theaderArr;\n\n\t\tif (typeof input === 'string') {\n\t\t\tinput = utils.stringToUint8(input);\n\t\t} else if (input.constructor !== Uint8Array.prototype.constructor) {\n\t\t\tthrow 'Invalid input type. You gave me: ' + input.constructor.toString().match(/function\\s*([$A-Za-z_][0-9A-Za-z_]*)\\s*\\(/)[1];\n\t\t}\n\n\t\tif (typeof opts === 'function') {\n\t\t\tcallback = opts;\n\t\t\topts = {};\n\t\t}\n\n\t\topts = opts || {};\n\n\t\tmode = opts.mode || parseInt('777', 8) & 0xfff;\n\t\tmtime = opts.mtime || Math.floor(+new Date() / 1000);\n\t\tuid = opts.uid || 0;\n\t\tgid = opts.gid || 0;\n\n\t\tdata = {\n\t\t\tfileName: filepath,\n\t\t\tfileMode: utils.pad(mode, 7),\n\t\t\tuid: utils.pad(uid, 7),\n\t\t\tgid: utils.pad(gid, 7),\n\t\t\tfileSize: utils.pad(input.length, 11),\n\t\t\tmtime: utils.pad(mtime, 11),\n\t\t\tchecksum: '        ',\n\t\t\ttype: '0', // just a file\n\t\t\tustar: 'ustar  ',\n\t\t\towner: opts.owner || '',\n\t\t\tgroup: opts.group || ''\n\t\t};\n\n\t\t// calculate the checksum\n\t\tchecksum = 0;\n\t\tObject.keys(data).forEach(function (key) {\n\t\t\tvar i, value = data[key], length;\n\n\t\t\tfor (i = 0, length = value.length; i < length; i += 1) {\n\t\t\t\tchecksum += value.charCodeAt(i);\n\t\t\t}\n\t\t});\n\n\t\tdata.checksum = utils.pad(checksum, 6) + \"\\u0000 \";\n\n\t\theaderArr = header.format(data);\n\n\t\tvar headerLength = Math.ceil( headerArr.length / recordSize ) * recordSize; \n\t\tvar inputLength = Math.ceil( input.length / recordSize ) * recordSize;\n\n\t\tthis.blocks.push( { header: headerArr, input: input, headerLength: headerLength, inputLength: inputLength } );\n\n\t};\n\n\tTar.prototype.save = function() {\n\n\t\tvar buffers = [];\n\t\tvar chunks = [];\n\t\tvar length = 0;\n\t\tvar max = Math.pow( 2, 20 );\n\n\t\tvar chunk = [];\n\t\tthis.blocks.forEach( function( b ) {\n\t\t\tif( length + b.headerLength + b.inputLength > max ) {\n\t\t\t\tchunks.push( { blocks: chunk, length: length } );\n\t\t\t\tchunk = [];\n\t\t\t\tlength = 0;\n\t\t\t}\n\t\t\tchunk.push( b );\n\t\t\tlength += b.headerLength + b.inputLength;\n\t\t} );\n\t\tchunks.push( { blocks: chunk, length: length } );\n\n\t\tchunks.forEach( function( c ) {\n\n\t\t\tvar buffer = new Uint8Array( c.length );\n\t\t\tvar written = 0;\n\t\t\tc.blocks.forEach( function( b ) {\n\t\t\t\tbuffer.set( b.header, written );\n\t\t\t\twritten += b.headerLength;\n\t\t\t\tbuffer.set( b.input, written );\n\t\t\t\twritten += b.inputLength;\n\t\t\t} );\n\t\t\tbuffers.push( buffer );\n\n\t\t} );\n\n\t\tbuffers.push( new Uint8Array( 2 * recordSize ) );\n\n\t\treturn new Blob( buffers, { type: 'octet/stream' } );\n\t\t\n\t};\n\n\tTar.prototype.clear = function () {\n\t\tthis.written = 0;\n\t\tthis.out = utils.clean(blockSize);\n\t};\n\n\tif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n\t\tmodule.exports = Tar;\n\t} else {\n\t\twindow.Tar = Tar;\n\t}\n}());\n","//download.js v4.21, by dandavis; 2008-2018. [MIT] see http://danml.com/download.html for tests/usage\n// v1 landed a FF+Chrome compatible way of downloading strings to local un-named files, upgraded to use a hidden frame and optional mime\n// v2 added named files via a[download], msSaveBlob, IE (10+) support, and window.URL support for larger+faster saves than dataURLs\n// v3 added dataURL and Blob Input, bind-toggle arity, and legacy dataURL fallback was improved with force-download mime and base64 support. 3.1 improved safari handling.\n// v4 adds AMD/UMD, commonJS, and plain browser support\n// v4.1 adds url download capability via solo URL argument (same domain/CORS only)\n// v4.2 adds semantic variable names, long (over 2MB) dataURL support, and hidden by default temp anchors\n// https://github.com/rndme/download\n\n(function (root, factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD. Register as an anonymous module.\n\t\tdefine([], factory);\n\t} else if (typeof exports === 'object') {\n\t\t// Node. Does not work with strict CommonJS, but\n\t\t// only CommonJS-like environments that support module.exports,\n\t\t// like Node.\n\t\tmodule.exports = factory();\n\t} else {\n\t\t// Browser globals (root is window)\n\t\troot.download = factory();\n\t}\n}(this, function () {\n\n\treturn function download(data, strFileName, strMimeType) {\n\n\t\tvar self = window, // this script is only for browsers anyway...\n\t\t\tdefaultMime = \"application/octet-stream\", // this default mime also triggers iframe downloads\n\t\t\tmimeType = strMimeType || defaultMime,\n\t\t\tpayload = data,\n\t\t\turl = !strFileName && !strMimeType && payload,\n\t\t\tanchor = document.createElement(\"a\"),\n\t\t\ttoString = function(a){return String(a);},\n\t\t\tmyBlob = (self.Blob || self.MozBlob || self.WebKitBlob || toString),\n\t\t\tfileName = strFileName || \"download\",\n\t\t\tblob,\n\t\t\treader;\n\t\tmyBlob= myBlob.call ? myBlob.bind(self) : Blob ;\n\n\t\tif(String(this)===\"true\"){ //reverse arguments, allowing download.bind(true, \"text/xml\", \"export.xml\") to act as a callback\n\t\t\tpayload=[payload, mimeType];\n\t\t\tmimeType=payload[0];\n\t\t\tpayload=payload[1];\n\t\t}\n\n\n\t\tif(url && url.length< 2048){ // if no filename and no mime, assume a url was passed as the only argument\n\t\t\tfileName = url.split(\"/\").pop().split(\"?\")[0];\n\t\t\tanchor.href = url; // assign href prop to temp anchor\n\t\t\tif(anchor.href.indexOf(url) !== -1){ // if the browser determines that it's a potentially valid url path:\n\t\t\t\tvar ajax=new XMLHttpRequest();\n\t\t\t\tajax.open( \"GET\", url, true);\n\t\t\t\tajax.responseType = 'blob';\n\t\t\t\tajax.onload= function(e){\n\t\t\t\t\tdownload(e.target.response, fileName, defaultMime);\n\t\t\t\t};\n\t\t\t\tsetTimeout(function(){ ajax.send();}, 0); // allows setting custom ajax headers using the return:\n\t\t\t\treturn ajax;\n\t\t\t} // end if valid url?\n\t\t} // end if url?\n\n\n\t\t//go ahead and download dataURLs right away\n\t\tif(/^data:([\\w+-]+\\/[\\w+.-]+)?[,;]/.test(payload)){\n\n\t\t\tif(payload.length > (1024*1024*1.999) && myBlob !== toString ){\n\t\t\t\tpayload=dataUrlToBlob(payload);\n\t\t\t\tmimeType=payload.type || defaultMime;\n\t\t\t}else{\n\t\t\t\treturn navigator.msSaveBlob ?  // IE10 can't do a[download], only Blobs:\n\t\t\t\t\tnavigator.msSaveBlob(dataUrlToBlob(payload), fileName) :\n\t\t\t\t\tsaver(payload) ; // everyone else can save dataURLs un-processed\n\t\t\t}\n\n\t\t}else{//not data url, is it a string with special needs?\n\t\t\tif(/([\\x80-\\xff])/.test(payload)){\n\t\t\t\tvar i=0, tempUiArr= new Uint8Array(payload.length), mx=tempUiArr.length;\n\t\t\t\tfor(i;i<mx;++i) tempUiArr[i]= payload.charCodeAt(i);\n\t\t\t\tpayload=new myBlob([tempUiArr], {type: mimeType});\n\t\t\t}\n\t\t}\n\t\tblob = payload instanceof myBlob ?\n\t\t\tpayload :\n\t\t\tnew myBlob([payload], {type: mimeType}) ;\n\n\n\t\tfunction dataUrlToBlob(strUrl) {\n\t\t\tvar parts= strUrl.split(/[:;,]/),\n\t\t\t\ttype= parts[1],\n\t\t\t\tindexDecoder = strUrl.indexOf(\"charset\")>0 ? 3: 2,\n\t\t\t\tdecoder= parts[indexDecoder] == \"base64\" ? atob : decodeURIComponent,\n\t\t\t\tbinData= decoder( parts.pop() ),\n\t\t\t\tmx= binData.length,\n\t\t\t\ti= 0,\n\t\t\t\tuiArr= new Uint8Array(mx);\n\n\t\t\tfor(i;i<mx;++i) uiArr[i]= binData.charCodeAt(i);\n\n\t\t\treturn new myBlob([uiArr], {type: type});\n\t\t}\n\n\t\tfunction saver(url, winMode){\n\n\t\t\tif ('download' in anchor) { //html5 A[download]\n\t\t\t\tanchor.href = url;\n\t\t\t\tanchor.setAttribute(\"download\", fileName);\n\t\t\t\tanchor.className = \"download-js-link\";\n\t\t\t\tanchor.innerHTML = \"downloading...\";\n\t\t\t\tanchor.style.display = \"none\";\n\t\t\t\tanchor.addEventListener('click', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.removeEventListener('click', arguments.callee);\n\t\t\t\t});\n\t\t\t\tdocument.body.appendChild(anchor);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tanchor.click();\n\t\t\t\t\tdocument.body.removeChild(anchor);\n\t\t\t\t\tif(winMode===true){setTimeout(function(){ self.URL.revokeObjectURL(anchor.href);}, 250 );}\n\t\t\t\t}, 66);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// handle non-a[download] safari as best we can:\n\t\t\tif(/(Version)\\/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari\\//.test(navigator.userAgent)) {\n\t\t\t\tif(/^data:/.test(url))\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t\tif(!window.open(url)){ // popup blocked, offer direct download:\n\t\t\t\t\tif(confirm(\"Displaying New Document\\n\\nUse Save As... to download, then click back to return to this page.\")){ location.href=url; }\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//do iframe dataURL download (old ch+FF):\n\t\t\tvar f = document.createElement(\"iframe\");\n\t\t\tdocument.body.appendChild(f);\n\n\t\t\tif(!winMode && /^data:/.test(url)){ // force a mime that will download:\n\t\t\t\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t}\n\t\t\tf.src=url;\n\t\t\tsetTimeout(function(){ document.body.removeChild(f); }, 333);\n\n\t\t}//end saver\n\n\n\n\n\t\tif (navigator.msSaveBlob) { // IE10+ : (has Blob, but not a[download] or URL)\n\t\t\treturn navigator.msSaveBlob(blob, fileName);\n\t\t}\n\n\t\tif(self.URL){ // simple fast and modern way using Blob and URL:\n\t\t\tsaver(self.URL.createObjectURL(blob), true);\n\t\t}else{\n\t\t\t// handle non-Blob()+non-URL browsers:\n\t\t\tif(typeof blob === \"string\" || blob.constructor===toString ){\n\t\t\t\ttry{\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \";base64,\"  +  self.btoa(blob)  );\n\t\t\t\t}catch(y){\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \",\" + encodeURIComponent(blob)  );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Blob but not URL support:\n\t\t\treader=new FileReader();\n\t\t\treader.onload=function(e){\n\t\t\t\tsaver(this.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(blob);\n\t\t}\n\t\treturn true;\n\t}; /* end download() */\n}));","(function(c){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c};var b=function(a){return a='/',{title:'browser',version:'v0.10.26',browser:!0,env:{},argv:[],nextTick:c.setImmediate||function(a){setTimeout(a,0)},cwd:function(){return a},chdir:function(b){a=b}}}();a.define('/gif.coffee',function(d,m,l,k){function g(a,b){return{}.hasOwnProperty.call(a,b)}function j(d,b){for(var a=0,c=b.length;a<c;++a)if(a in b&&b[a]===d)return!0;return!1}function i(a,b){function d(){this.constructor=a}for(var c in b)g(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a}var h,c,f,b,e;f=a('events',d).EventEmitter,h=a('/browser.coffee',d),e=function(d){function a(d){var a,b;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(d);for(a in c)b=c[a],null!=this.options[a]?this.options[a]:this.options[a]=b}return i(a,d),c={workerScript:'gif.worker.js',workers:2,repeat:0,background:'#fff',quality:10,width:null,height:null,transparent:null},b={delay:500,copy:!1},a.prototype.setOption=function(a,b){return this.options[a]=b,null!=this._canvas&&(a==='width'||a==='height')?this._canvas[a]=b:void 0},a.prototype.setOptions=function(b){var a,c;return function(d){for(a in b){if(!g(b,a))continue;c=b[a],d.push(this.setOption(a,c))}return d}.call(this,[])},a.prototype.addFrame=function(a,d){var c,e;null==d&&(d={}),c={},c.transparent=this.options.transparent;for(e in b)c[e]=d[e]||b[e];if(null!=this.options.width||this.setOption('width',a.width),null!=this.options.height||this.setOption('height',a.height),'undefined'!==typeof ImageData&&null!=ImageData&&a instanceof ImageData)c.data=a.data;else if('undefined'!==typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&a instanceof CanvasRenderingContext2D||'undefined'!==typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&a instanceof WebGLRenderingContext)d.copy?c.data=this.getContextData(a):c.context=a;else if(null!=a.childNodes)d.copy?c.data=this.getImageData(a):c.image=a;else throw new Error('Invalid image');return this.frames.push(c)},a.prototype.render=function(){var d,a;if(this.running)throw new Error('Already running');if(!(null!=this.options.width&&null!=this.options.height))throw new Error('Width and height must be set prior to rendering');this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(c){for(var b=function(){var b;b=[];for(var a=0;0<=this.frames.length?a<this.frames.length:a>this.frames.length;0<=this.frames.length?++a:--a)b.push(a);return b}.apply(this,arguments),a=0,e=b.length;a<e;++a)d=b[a],c.push(null);return c}.call(this,[]),a=this.spawnWorkers();for(var c=function(){var c;c=[];for(var b=0;0<=a?b<a:b>a;0<=a?++b:--b)c.push(b);return c}.apply(this,arguments),b=0,e=c.length;b<e;++b)d=c[b],this.renderNextFrame();return this.emit('start'),this.emit('progress',0)},a.prototype.abort=function(){var a;while(!0){if(a=this.activeWorkers.shift(),!(null!=a))break;console.log('killing active worker'),a.terminate()}return this.running=!1,this.emit('abort')},a.prototype.spawnWorkers=function(){var a;return a=Math.min(this.options.workers,this.frames.length),function(){var c;c=[];for(var b=this.freeWorkers.length;this.freeWorkers.length<=a?b<a:b>a;this.freeWorkers.length<=a?++b:--b)c.push(b);return c}.apply(this,arguments).forEach(function(a){return function(c){var b;return console.log('spawning worker '+c),b=new Worker(a.options.workerScript),b.onmessage=function(a){return function(c){return a.activeWorkers.splice(a.activeWorkers.indexOf(b),1),a.freeWorkers.push(b),a.frameFinished(c.data)}}(a),a.freeWorkers.push(b)}}(this)),a},a.prototype.frameFinished=function(a){return console.log('frame '+a.index+' finished - '+this.activeWorkers.length+' active'),this.finishedFrames++,this.emit('progress',this.finishedFrames/this.frames.length),this.imageParts[a.index]=a,j(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},a.prototype.finishRendering=function(){var e,a,k,m,b,d,h;b=0;for(var f=0,j=this.imageParts.length;f<j;++f)a=this.imageParts[f],b+=(a.data.length-1)*a.pageSize+a.cursor;b+=a.pageSize-a.cursor,console.log('rendering finished - filesize '+Math.round(b/1e3)+'kb'),e=new Uint8Array(b),d=0;for(var g=0,l=this.imageParts.length;g<l;++g){a=this.imageParts[g];for(var c=0,i=a.data.length;c<i;++c)h=a.data[c],k=c,e.set(h,d),k===a.data.length-1?d+=a.cursor:d+=a.pageSize}return m=new Blob([e],{type:'image/gif'}),this.emit('finished',m,e)},a.prototype.renderNextFrame=function(){var c,a,b;if(this.freeWorkers.length===0)throw new Error('No free workers');return this.nextFrame>=this.frames.length?void 0:(c=this.frames[this.nextFrame++],b=this.freeWorkers.shift(),a=this.getTask(c),console.log('starting frame '+(a.index+1)+' of '+this.frames.length),this.activeWorkers.push(b),b.postMessage(a))},a.prototype.getContextData=function(a){return a.getImageData(0,0,this.options.width,this.options.height).data},a.prototype.getImageData=function(b){var a;return null!=this._canvas||(this._canvas=document.createElement('canvas'),this._canvas.width=this.options.width,this._canvas.height=this.options.height),a=this._canvas.getContext('2d'),a.setFill=this.options.background,a.fillRect(0,0,this.options.width,this.options.height),a.drawImage(b,0,0),this.getContextData(a)},a.prototype.getTask=function(a){var c,b;if(c=this.frames.indexOf(a),b={index:c,last:c===this.frames.length-1,delay:a.delay,transparent:a.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:h.name==='chrome'},null!=a.data)b.data=a.data;else if(null!=a.context)b.data=this.getContextData(a.context);else if(null!=a.image)b.data=this.getImageData(a.image);else throw new Error('Invalid frame');return b},a}(f),d.exports=e}),a.define('/browser.coffee',function(f,g,h,i){var a,d,e,c,b;c=navigator.userAgent.toLowerCase(),e=navigator.platform.toLowerCase(),b=c.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/)||[null,'unknown',0],d=b[1]==='ie'&&document.documentMode,a={name:b[1]==='version'?b[3]:b[1],version:d||parseFloat(b[1]==='opera'&&b[4]?b[4]:b[2]),platform:{name:c.match(/ip(?:ad|od|hone)/)?'ios':(c.match(/(?:webos|android)/)||e.match(/mac|win|linux/)||['other'])[0]}},a[a.name]=!0,a[a.name+parseInt(a.version,10)]=!0,a.platform[a.platform.name]=!0,f.exports=a}),a.define('events',function(f,e,g,h){b.EventEmitter||(b.EventEmitter=function(){});var a=e.EventEmitter=b.EventEmitter,c=typeof Array.isArray==='function'?Array.isArray:function(a){return Object.prototype.toString.call(a)==='[object Array]'},d=10;a.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._events.maxListeners=a},a.prototype.emit=function(f){if(f==='error'&&(!(this._events&&this._events.error)||c(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error(\"Uncaught, unspecified 'error' event.\");if(!this._events)return!1;var a=this._events[f];if(!a)return!1;if(!(typeof a=='function'))if(c(a)){var b=Array.prototype.slice.call(arguments,1),e=a.slice();for(var d=0,g=e.length;d<g;d++)e[d].apply(this,b);return!0}else return!1;switch(arguments.length){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:var b=Array.prototype.slice.call(arguments,1);a.apply(this,b)}return!0},a.prototype.addListener=function(a,b){if('function'!==typeof b)throw new Error('addListener only takes instances of Function');if(this._events||(this._events={}),this.emit('newListener',a,b),!this._events[a])this._events[a]=b;else if(c(this._events[a])){if(!this._events[a].warned){var e;this._events.maxListeners!==undefined?e=this._events.maxListeners:e=d,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[a].length),console.trace())}this._events[a].push(b)}else this._events[a]=[this._events[a],b];return this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(b,c){var a=this;return a.on(b,function d(){a.removeListener(b,d),c.apply(this,arguments)}),this},a.prototype.removeListener=function(a,d){if('function'!==typeof d)throw new Error('removeListener only takes instances of Function');if(!(this._events&&this._events[a]))return this;var b=this._events[a];if(c(b)){var e=b.indexOf(d);if(e<0)return this;b.splice(e,1),b.length==0&&delete this._events[a]}else this._events[a]===d&&delete this._events[a];return this},a.prototype.removeAllListeners=function(a){return a&&this._events&&this._events[a]&&(this._events[a]=null),this},a.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),c(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]}}),c.GIF=a('/gif.coffee')}.call(this,this))\r\n//# sourceMappingURL=gif.js.map\r\n// gif.js 0.1.6 - https://github.com/jnordberg/gif.js","/**\n * A tool for presenting an ArrayBuffer as a stream for writing some simple data types.\n * \n * By Nicholas Sherlock\n * \n * Released under the WTFPLv2 https://en.wikipedia.org/wiki/WTFPL\n */\n\n\"use strict\";\n\n(function(){\n\n    var isNodeEnviroment = typeof module !== 'undefined' && typeof module.exports !== 'undefined';\n\n    /**\n     * Create an ArrayBuffer of the given length and present it as a writable stream with methods\n     * for writing data in different formats.\n     */\n\n    var ArrayBufferDataStream = function(length) {\n        this.data = new Uint8Array(length);\n        this.pos = 0;\n    };\n    \n    ArrayBufferDataStream.prototype.seek = function(offset) {\n        this.pos = offset;\n    };\n\n    ArrayBufferDataStream.prototype.writeBytes = function(arr) {\n        for (var i = 0; i < arr.length; i++) {\n            this.data[this.pos++] = arr[i];\n        }\n    };\n\n    ArrayBufferDataStream.prototype.writeByte = function(b) {\n        this.data[this.pos++] = b;\n    };\n    \n    //Synonym:\n    ArrayBufferDataStream.prototype.writeU8 = ArrayBufferDataStream.prototype.writeByte;\n    \n    ArrayBufferDataStream.prototype.writeU16BE = function(u) {\n        this.data[this.pos++] = u >> 8;\n        this.data[this.pos++] = u;\n    };\n\n    ArrayBufferDataStream.prototype.writeDoubleBE = function(d) {\n        var \n            bytes = new Uint8Array(new Float64Array([d]).buffer);\n        \n        for (var i = bytes.length - 1; i >= 0; i--) {\n            this.writeByte(bytes[i]);\n        }\n    };\n\n    ArrayBufferDataStream.prototype.writeFloatBE = function(d) {\n        var \n            bytes = new Uint8Array(new Float32Array([d]).buffer);\n        \n        for (var i = bytes.length - 1; i >= 0; i--) {\n            this.writeByte(bytes[i]);\n        }\n    };\n\n    /**\n     * Write an ASCII string to the stream\n     */\n    ArrayBufferDataStream.prototype.writeString = function(s) {\n        for (var i = 0; i < s.length; i++) {\n            this.data[this.pos++] = s.charCodeAt(i);\n        }\n    };\n\n    /**\n     * Write the given 32-bit integer to the stream as an EBML variable-length integer using the given byte width \n     * (use measureEBMLVarInt).\n     * \n     * No error checking is performed to ensure that the supplied width is correct for the integer.\n     * \n     * @param i Integer to be written\n     * @param width Number of bytes to write to the stream\n     */\n    ArrayBufferDataStream.prototype.writeEBMLVarIntWidth = function(i, width) {\n        switch (width) {\n            case 1:\n                this.writeU8((1 << 7) | i);\n            break;\n            case 2:\n                this.writeU8((1 << 6) | (i >> 8));\n                this.writeU8(i);\n            break;\n            case 3:\n                this.writeU8((1 << 5) | (i >> 16));\n                this.writeU8(i >> 8);\n                this.writeU8(i);\n            break;\n            case 4:\n                this.writeU8((1 << 4) | (i >> 24));\n                this.writeU8(i >> 16);\n                this.writeU8(i >> 8);\n                this.writeU8(i);\n            break;\n            case 5:\n                /* \n                 * JavaScript converts its doubles to 32-bit integers for bitwise operations, so we need to do a \n                 * division by 2^32 instead of a right-shift of 32 to retain those top 3 bits\n                 */\n                this.writeU8((1 << 3) | ((i / 4294967296) & 0x7)); \n                this.writeU8(i >> 24);\n                this.writeU8(i >> 16);\n                this.writeU8(i >> 8);\n                this.writeU8(i);\n            break;\n            default:\n                throw new RuntimeException(\"Bad EBML VINT size \" + width);\n        }\n    };\n    \n    /**\n     * Return the number of bytes needed to encode the given integer as an EBML VINT.\n     */\n    ArrayBufferDataStream.prototype.measureEBMLVarInt = function(val) {\n        if (val < (1 << 7) - 1) { \n            /* Top bit is set, leaving 7 bits to hold the integer, but we can't store 127 because\n             * \"all bits set to one\" is a reserved value. Same thing for the other cases below:\n             */\n            return 1;\n        } else if (val < (1 << 14) - 1) {\n            return 2;\n        } else if (val < (1 << 21) - 1) {\n            return 3;\n        } else if (val < (1 << 28) - 1) {\n            return 4;\n        } else if (val < 34359738367) { // 2 ^ 35 - 1 (can address 32GB)\n            return 5;\n        } else {\n            throw new RuntimeException(\"EBML VINT size not supported \" + val);\n        }\n    };\n    \n    ArrayBufferDataStream.prototype.writeEBMLVarInt = function(i) {\n        this.writeEBMLVarIntWidth(i, this.measureEBMLVarInt(i));\n    };\n    \n    /**\n     * Write the given unsigned 32-bit integer to the stream in big-endian order using the given byte width.\n     * No error checking is performed to ensure that the supplied width is correct for the integer.\n     * \n     * Omit the width parameter to have it determined automatically for you.\n     * \n     * @param u Unsigned integer to be written\n     * @param width Number of bytes to write to the stream\n     */\n    ArrayBufferDataStream.prototype.writeUnsignedIntBE = function(u, width) {\n        if (width === undefined) {\n            width = this.measureUnsignedInt(u);\n        }\n        \n        // Each case falls through:\n        switch (width) {\n            case 5:\n                this.writeU8(Math.floor(u / 4294967296)); // Need to use division to access >32 bits of floating point var\n            case 4:\n                this.writeU8(u >> 24);\n            case 3:\n                this.writeU8(u >> 16);\n            case 2:\n                this.writeU8(u >> 8);\n            case 1:\n                this.writeU8(u);\n            break;\n            default:\n                throw new RuntimeException(\"Bad UINT size \" + width);\n        }\n    };\n    \n    /**\n     * Return the number of bytes needed to hold the non-zero bits of the given unsigned integer.\n     */\n    ArrayBufferDataStream.prototype.measureUnsignedInt = function(val) {\n        // Force to 32-bit unsigned integer\n        if (val < (1 << 8)) {\n            return 1;\n        } else if (val < (1 << 16)) {\n            return 2;\n        } else if (val < (1 << 24)) {\n            return 3;\n        } else if (val < 4294967296) {\n            return 4;\n        } else {\n            return 5;\n        }\n    };\n\n    /**\n     * Return a view on the portion of the buffer from the beginning to the current seek position as a Uint8Array.\n     */\n    ArrayBufferDataStream.prototype.getAsDataArray = function() {\n        if (this.pos < this.data.byteLength) {\n            return this.data.subarray(0, this.pos);\n        } else if (this.pos == this.data.byteLength) {\n            return this.data;\n        } else {\n            throw \"ArrayBufferDataStream's pos lies beyond end of buffer\";\n        }\n    };\n\n    window.ArrayBufferDataStream = ArrayBufferDataStream;\n\n    /**\n     * Allows a series of Blob-convertible objects (ArrayBuffer, Blob, String, etc) to be added to a buffer. Seeking and\n     * overwriting of blobs is allowed.\n     *\n     * You can supply a FileWriter, in which case the BlobBuffer is just used as temporary storage before it writes it\n     * through to the disk.\n     *\n     * By Nicholas Sherlock\n     *\n     * Released under the WTFPLv2 https://en.wikipedia.org/wiki/WTFPL\n     */\n\n\tvar BlobBuffer = function(fs) {\n\t\treturn function(destination) {\n\t\t\tvar\n\t\t\t\tbuffer = [],\n\t\t\t\twritePromise = Promise.resolve(),\n\t\t\t\tfileWriter = null,\n\t\t\t\tfd = null;\n\t\t\t\n\t\t\tif (typeof FileWriter !== \"undefined\" && destination instanceof FileWriter) {\n\t\t\t\tfileWriter = destination;\n\t\t\t} else if (fs && destination) {\n\t\t\t\tfd = destination;\n\t\t\t}\n\t\t\t\n\t\t\t// Current seek offset\n\t\t\tthis.pos = 0;\n\t\t\t\n\t\t\t// One more than the index of the highest byte ever written\n\t\t\tthis.length = 0;\n\t\t\t\n\t\t\t// Returns a promise that converts the blob to an ArrayBuffer\n\t\t\tfunction readBlobAsBuffer(blob) {\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tvar\n\t\t\t\t\t\treader = new FileReader();\n\t\t\t\t\t\n\t\t\t\t\treader.addEventListener(\"loadend\", function () {\n\t\t\t\t\t\tresolve(reader.result);\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\treader.readAsArrayBuffer(blob);\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tfunction convertToUint8Array(thing) {\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tif (thing instanceof Uint8Array) {\n\t\t\t\t\t\tresolve(thing);\n\t\t\t\t\t} else if (thing instanceof ArrayBuffer || ArrayBuffer.isView(thing)) {\n\t\t\t\t\t\tresolve(new Uint8Array(thing));\n\t\t\t\t\t} else if (thing instanceof Blob) {\n\t\t\t\t\t\tresolve(readBlobAsBuffer(thing).then(function (buffer) {\n\t\t\t\t\t\t\treturn new Uint8Array(buffer);\n\t\t\t\t\t\t}));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Assume that Blob will know how to read this thing\n\t\t\t\t\t\tresolve(readBlobAsBuffer(new Blob([thing])).then(function (buffer) {\n\t\t\t\t\t\t\treturn new Uint8Array(buffer);\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tfunction measureData(data) {\n\t\t\t\tvar\n\t\t\t\t\tresult = data.byteLength || data.length || data.size;\n\t\t\t\t\n\t\t\t\tif (!Number.isInteger(result)) {\n\t\t\t\t\tthrow \"Failed to determine size of element\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\t\n\t\t\t/**\n\t\t\t * Seek to the given absolute offset.\n\t\t\t *\n\t\t\t * You may not seek beyond the end of the file (this would create a hole and/or allow blocks to be written in non-\n\t\t\t * sequential order, which isn't currently supported by the memory buffer backend).\n\t\t\t */\n\t\t\tthis.seek = function (offset) {\n\t\t\t\tif (offset < 0) {\n\t\t\t\t\tthrow \"Offset may not be negative\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (isNaN(offset)) {\n\t\t\t\t\tthrow \"Offset may not be NaN\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (offset > this.length) {\n\t\t\t\t\tthrow \"Seeking beyond the end of file is not allowed\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.pos = offset;\n\t\t\t};\n\t\t\t\n\t\t\t/**\n\t\t\t * Write the Blob-convertible data to the buffer at the current seek position.\n\t\t\t *\n\t\t\t * Note: If overwriting existing data, the write must not cross preexisting block boundaries (written data must\n\t\t\t * be fully contained by the extent of a previous write).\n\t\t\t */\n\t\t\tthis.write = function (data) {\n\t\t\t\tvar\n\t\t\t\t\tnewEntry = {\n\t\t\t\t\t\toffset: this.pos,\n\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\tlength: measureData(data)\n\t\t\t\t\t},\n\t\t\t\t\tisAppend = newEntry.offset >= this.length;\n\t\t\t\t\n\t\t\t\tthis.pos += newEntry.length;\n\t\t\t\tthis.length = Math.max(this.length, this.pos);\n\t\t\t\t\n\t\t\t\t// After previous writes complete, perform our write\n\t\t\t\twritePromise = writePromise.then(function () {\n\t\t\t\t\tif (fd) {\n\t\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\t\tconvertToUint8Array(newEntry.data).then(function(dataArray) {\n\t\t\t\t\t\t\t\tvar\n\t\t\t\t\t\t\t\t\ttotalWritten = 0,\n\t\t\t\t\t\t\t\t\tbuffer = Buffer.from(dataArray.buffer),\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\thandleWriteComplete = function(err, written, buffer) {\n\t\t\t\t\t\t\t\t\t\ttotalWritten += written;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (totalWritten >= buffer.length) {\n\t\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t// We still have more to write...\n\t\t\t\t\t\t\t\t\t\t\tfs.write(fd, buffer, totalWritten, buffer.length - totalWritten, newEntry.offset + totalWritten, handleWriteComplete);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tfs.write(fd, buffer, 0, buffer.length, newEntry.offset, handleWriteComplete);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (fileWriter) {\n\t\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\t\tfileWriter.onwriteend = resolve;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfileWriter.seek(newEntry.offset);\n\t\t\t\t\t\t\tfileWriter.write(new Blob([newEntry.data]));\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (!isAppend) {\n\t\t\t\t\t\t// We might be modifying a write that was already buffered in memory.\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Slow linear search to find a block we might be overwriting\n\t\t\t\t\t\tfor (var i = 0; i < buffer.length; i++) {\n\t\t\t\t\t\t\tvar\n\t\t\t\t\t\t\t\tentry = buffer[i];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// If our new entry overlaps the old one in any way...\n\t\t\t\t\t\t\tif (!(newEntry.offset + newEntry.length <= entry.offset || newEntry.offset >= entry.offset + entry.length)) {\n\t\t\t\t\t\t\t\tif (newEntry.offset < entry.offset || newEntry.offset + newEntry.length > entry.offset + entry.length) {\n\t\t\t\t\t\t\t\t\tthrow new Error(\"Overwrite crosses blob boundaries\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (newEntry.offset == entry.offset && newEntry.length == entry.length) {\n\t\t\t\t\t\t\t\t\t// We overwrote the entire block\n\t\t\t\t\t\t\t\t\tentry.data = newEntry.data;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// We're done\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn convertToUint8Array(entry.data)\n\t\t\t\t\t\t\t\t\t\t.then(function (entryArray) {\n\t\t\t\t\t\t\t\t\t\t\tentry.data = entryArray;\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\treturn convertToUint8Array(newEntry.data);\n\t\t\t\t\t\t\t\t\t\t}).then(function (newEntryArray) {\n\t\t\t\t\t\t\t\t\t\t\tnewEntry.data = newEntryArray;\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\tentry.data.set(newEntry.data, newEntry.offset - entry.offset);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Else fall through to do a simple append, as we didn't overwrite any pre-existing blocks\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tbuffer.push(newEntry);\n\t\t\t\t});\n\t\t\t};\n\t\t\t\n\t\t\t/**\n\t\t\t * Finish all writes to the buffer, returning a promise that signals when that is complete.\n\t\t\t *\n\t\t\t * If a FileWriter was not provided, the promise is resolved with a Blob that represents the completed BlobBuffer\n\t\t\t * contents. You can optionally pass in a mimeType to be used for this blob.\n\t\t\t *\n\t\t\t * If a FileWriter was provided, the promise is resolved with null as the first argument.\n\t\t\t */\n\t\t\tthis.complete = function (mimeType) {\n\t\t\t\tif (fd || fileWriter) {\n\t\t\t\t\twritePromise = writePromise.then(function () {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// After writes complete we need to merge the buffer to give to the caller\n\t\t\t\t\twritePromise = writePromise.then(function () {\n\t\t\t\t\t\tvar\n\t\t\t\t\t\t\tresult = [];\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor (var i = 0; i < buffer.length; i++) {\n\t\t\t\t\t\t\tresult.push(buffer[i].data);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn new Blob(result, {mimeType: mimeType});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn writePromise;\n\t\t\t};\n\t\t};\n\t}(isNodeEnviroment ? require('fs') : null);\n\t\n\twindow.BlobBuffer = BlobBuffer;\n\n    /**\n     * WebM video encoder for Google Chrome. This implementation is suitable for creating very large video files, because\n     * it can stream Blobs directly to a FileWriter without buffering the entire video in memory.\n     *\n     * When FileWriter is not available or not desired, it can buffer the video in memory as a series of Blobs which are\n     * eventually returned as one composite Blob.\n     *\n     * By Nicholas Sherlock.\n     *\n     * Based on the ideas from Whammy: https://github.com/antimatter15/whammy\n     *\n     * Released under the WTFPLv2 https://en.wikipedia.org/wiki/WTFPL\n     */\n\n    var WebMWriter = function(ArrayBufferDataStream, BlobBuffer) {\n        function extend(base, top) {\n            var\n                target = {};\n            \n            [base, top].forEach(function(obj) {\n                for (var prop in obj) {\n                    if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n                        target[prop] = obj[prop];\n                    }\n                }\n            });\n            \n            return target;\n        }\n        \n        /**\n         * Decode a Base64 data URL into a binary string.\n         *\n         * Returns the binary string, or false if the URL could not be decoded.\n         */\n        function decodeBase64WebPDataURL(url) {\n            if (typeof url !== \"string\" || !url.match(/^data:image\\/webp;base64,/i)) {\n                return false;\n            }\n            \n            return window.atob(url.substring(\"data:image\\/webp;base64,\".length));\n        }\n        \n        /**\n         * Convert a raw binary string (one character = one output byte) to an ArrayBuffer\n         */\n        function stringToArrayBuffer(string) {\n            var\n                buffer = new ArrayBuffer(string.length),\n                int8Array = new Uint8Array(buffer);\n            \n            for (var i = 0; i < string.length; i++) {\n                int8Array[i] = string.charCodeAt(i);\n            }\n            \n            return buffer;\n        }\n        \n        /**\n         * Convert the given canvas to a WebP encoded image and return the image data as a string.\n         */\n        function renderAsWebP(canvas, quality) {\n            var\n                frame = canvas.toDataURL('image/webp', {quality: quality});\n            \n            return decodeBase64WebPDataURL(frame);\n        }\n        \n        function extractKeyframeFromWebP(webP) {\n            // Assume that Chrome will generate a Simple Lossy WebP which has this header:\n            var\n                keyframeStartIndex = webP.indexOf('VP8 ');\n            \n            if (keyframeStartIndex == -1) {\n                throw \"Failed to identify beginning of keyframe in WebP image\";\n            }\n            \n            // Skip the header and the 4 bytes that encode the length of the VP8 chunk\n            keyframeStartIndex += 'VP8 '.length + 4;\n            \n            return webP.substring(keyframeStartIndex);\n        }\n        \n        // Just a little utility so we can tag values as floats for the EBML encoder's benefit\n        function EBMLFloat32(value) {\n            this.value = value;\n        }\n        \n        function EBMLFloat64(value) {\n            this.value = value;\n        }\n        \n        /**\n         * Write the given EBML object to the provided ArrayBufferStream.\n         *\n         * The buffer's first byte is at bufferFileOffset inside the video file. This is used to complete offset and\n         * dataOffset fields in each EBML structure, indicating the file offset of the first byte of the EBML element and\n         * its data payload.\n         */\n        function writeEBML(buffer, bufferFileOffset, ebml) {\n            // Is the ebml an array of sibling elements?\n            if (Array.isArray(ebml)) {\n                for (var i = 0; i < ebml.length; i++) {\n                    writeEBML(buffer, bufferFileOffset, ebml[i]);\n                }\n            // Is this some sort of raw data that we want to write directly?\n            } else if (typeof ebml === \"string\") {\n                buffer.writeString(ebml);\n            } else if (ebml instanceof Uint8Array) {\n                buffer.writeBytes(ebml);\n            } else if (ebml.id){\n                // We're writing an EBML element\n                ebml.offset = buffer.pos + bufferFileOffset;\n                \n                buffer.writeUnsignedIntBE(ebml.id); // ID field\n                \n                // Now we need to write the size field, so we must know the payload size:\n                \n                if (Array.isArray(ebml.data)) {\n                    // Writing an array of child elements. We won't try to measure the size of the children up-front\n                    \n                    var\n                        sizePos, dataBegin, dataEnd;\n                    \n                    if (ebml.size === -1) {\n                        // Write the reserved all-one-bits marker to note that the size of this element is unknown/unbounded\n                        buffer.writeByte(0xFF);\n                    } else {\n                        sizePos = buffer.pos;\n                        \n                        /* Write a dummy size field to overwrite later. 4 bytes allows an element maximum size of 256MB,\n                         * which should be plenty (we don't want to have to buffer that much data in memory at one time\n                         * anyway!)\n                         */\n                        buffer.writeBytes([0, 0, 0, 0]);\n                    }\n                    \n                    dataBegin = buffer.pos;\n                    \n                    ebml.dataOffset = dataBegin + bufferFileOffset;\n                    writeEBML(buffer, bufferFileOffset, ebml.data);\n                    \n                    if (ebml.size !== -1) {\n                        dataEnd = buffer.pos;\n                        \n                        ebml.size = dataEnd - dataBegin;\n                        \n                        buffer.seek(sizePos);\n                        buffer.writeEBMLVarIntWidth(ebml.size, 4); // Size field\n                        \n                        buffer.seek(dataEnd);\n                    }\n                } else if (typeof ebml.data === \"string\") {\n                    buffer.writeEBMLVarInt(ebml.data.length); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeString(ebml.data);\n                } else if (typeof ebml.data === \"number\") {\n                    // Allow the caller to explicitly choose the size if they wish by supplying a size field\n                    if (!ebml.size) {\n                        ebml.size = buffer.measureUnsignedInt(ebml.data);\n                    }\n                    \n                    buffer.writeEBMLVarInt(ebml.size); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeUnsignedIntBE(ebml.data, ebml.size);\n                } else if (ebml.data instanceof EBMLFloat64) {\n                    buffer.writeEBMLVarInt(8); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeDoubleBE(ebml.data.value);\n                } else if (ebml.data instanceof EBMLFloat32) {\n                    buffer.writeEBMLVarInt(4); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeFloatBE(ebml.data.value);\n                } else if (ebml.data instanceof Uint8Array) {\n                    buffer.writeEBMLVarInt(ebml.data.byteLength); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeBytes(ebml.data);\n                } else {\n                    throw \"Bad EBML datatype \" + typeof ebml.data;\n                }\n            } else {\n                throw \"Bad EBML datatype \" + typeof ebml.data;\n            }\n        }\n        \n        return function(options) {\n            var\n                MAX_CLUSTER_DURATION_MSEC = 5000,\n                DEFAULT_TRACK_NUMBER = 1,\n            \n                writtenHeader = false,\n                videoWidth, videoHeight,\n                \n                clusterFrameBuffer = [],\n                clusterStartTime = 0,\n                clusterDuration = 0,\n                \n                optionDefaults = {\n                    quality: 0.95,       // WebM image quality from 0.0 (worst) to 1.0 (best)\n                    fileWriter: null,    // Chrome FileWriter in order to stream to a file instead of buffering to memory (optional)\n                    fd: null,            // Node.JS file descriptor to write to instead of buffering (optional)\n                    \n                    // You must supply one of:\n                    frameDuration: null, // Duration of frames in milliseconds\n                    frameRate: null,     // Number of frames per second\n                },\n                \n                seekPoints = {\n                    Cues: {id: new Uint8Array([0x1C, 0x53, 0xBB, 0x6B]), positionEBML: null},\n                    SegmentInfo: {id: new Uint8Array([0x15, 0x49, 0xA9, 0x66]), positionEBML: null},\n                    Tracks: {id: new Uint8Array([0x16, 0x54, 0xAE, 0x6B]), positionEBML: null},\n                },\n                \n                ebmlSegment,\n                segmentDuration = {\n                    \"id\": 0x4489, // Duration\n                    \"data\": new EBMLFloat64(0)\n                },\n                \n                seekHead,\n                \n                cues = [],\n                \n                blobBuffer = new BlobBuffer(options.fileWriter || options.fd);\n    \n            function fileOffsetToSegmentRelative(fileOffset) {\n                return fileOffset - ebmlSegment.dataOffset;\n            }\n            \n            /**\n             * Create a SeekHead element with descriptors for the points in the global seekPoints array.\n             *\n             * 5 bytes of position values are reserved for each node, which lie at the offset point.positionEBML.dataOffset,\n             * to be overwritten later.\n             */\n            function createSeekHead() {\n                var\n                    seekPositionEBMLTemplate = {\n                        \"id\": 0x53AC, // SeekPosition\n                        \"size\": 5, // Allows for 32GB video files\n                        \"data\": 0 // We'll overwrite this when the file is complete\n                    },\n                    \n                    result = {\n                        \"id\": 0x114D9B74, // SeekHead\n                        \"data\": []\n                    };\n                \n                for (var name in seekPoints) {\n                    var\n                        seekPoint = seekPoints[name];\n                \n                    seekPoint.positionEBML = Object.create(seekPositionEBMLTemplate);\n                    \n                    result.data.push({\n                         \"id\": 0x4DBB, // Seek\n                         \"data\": [\n                              {\n                                  \"id\": 0x53AB, // SeekID\n                                  \"data\": seekPoint.id\n                              },\n                              seekPoint.positionEBML\n                         ]\n                    });\n                }\n                \n                return result;\n            }\n            \n            /**\n             * Write the WebM file header to the stream.\n             */\n            function writeHeader() {\n                seekHead = createSeekHead();\n                \n                var\n                    ebmlHeader = {\n                        \"id\": 0x1a45dfa3, // EBML\n                        \"data\": [\n                            {\n                                \"id\": 0x4286, // EBMLVersion\n                                \"data\": 1\n                            },\n                            {\n                                \"id\": 0x42f7, // EBMLReadVersion\n                                \"data\": 1\n                            },\n                            {\n                                \"id\": 0x42f2, // EBMLMaxIDLength\n                                \"data\": 4\n                            },\n                            {\n                                \"id\": 0x42f3, // EBMLMaxSizeLength\n                                \"data\": 8\n                            },\n                            {\n                                \"id\": 0x4282, // DocType\n                                \"data\": \"webm\"\n                            },\n                            {\n                                \"id\": 0x4287, // DocTypeVersion\n                                \"data\": 2\n                            },\n                            {\n                                \"id\": 0x4285, // DocTypeReadVersion\n                                \"data\": 2\n                            }\n                        ]\n                    },\n                    \n                    segmentInfo = {\n                        \"id\": 0x1549a966, // Info\n                        \"data\": [\n                            {\n                                \"id\": 0x2ad7b1, // TimecodeScale\n                                \"data\": 1e6 // Times will be in miliseconds (1e6 nanoseconds per step = 1ms)\n                            },\n                            {\n                                \"id\": 0x4d80, // MuxingApp\n                                \"data\": \"webm-writer-js\",\n                            },\n                            {\n                                \"id\": 0x5741, // WritingApp\n                                \"data\": \"webm-writer-js\"\n                            },\n                            segmentDuration // To be filled in later\n                        ]\n                    },\n                    \n                    tracks = {\n                        \"id\": 0x1654ae6b, // Tracks\n                        \"data\": [\n                            {\n                                \"id\": 0xae, // TrackEntry\n                                \"data\": [\n                                    {\n                                        \"id\": 0xd7, // TrackNumber\n                                        \"data\": DEFAULT_TRACK_NUMBER\n                                    },\n                                    {\n                                        \"id\": 0x73c5, // TrackUID\n                                        \"data\": DEFAULT_TRACK_NUMBER\n                                    },\n                                    {\n                                        \"id\": 0x9c, // FlagLacing\n                                        \"data\": 0\n                                    },\n                                    {\n                                        \"id\": 0x22b59c, // Language\n                                        \"data\": \"und\"\n                                    },\n                                    {\n                                        \"id\": 0x86, // CodecID\n                                        \"data\": \"V_VP8\"\n                                    },\n                                    {\n                                        \"id\": 0x258688, // CodecName\n                                        \"data\": \"VP8\"\n                                    },\n                                    {\n                                        \"id\": 0x83, // TrackType\n                                        \"data\": 1\n                                    },\n                                    {\n                                        \"id\": 0xe0,  // Video\n                                        \"data\": [\n                                            {\n                                                \"id\": 0xb0, // PixelWidth\n                                                \"data\": videoWidth\n                                            },\n                                            {\n                                                \"id\": 0xba, // PixelHeight\n                                                \"data\": videoHeight\n                                            }\n                                        ]\n                                    }\n                                ]\n                            }\n                        ]\n                    };\n                \n                ebmlSegment = {\n                    \"id\": 0x18538067, // Segment\n                    \"size\": -1, // Unbounded size\n                    \"data\": [\n                        seekHead,\n                        segmentInfo,\n                        tracks,\n                    ]\n                };\n                \n                var\n                    bufferStream = new ArrayBufferDataStream(256);\n                    \n                writeEBML(bufferStream, blobBuffer.pos, [ebmlHeader, ebmlSegment]);\n                blobBuffer.write(bufferStream.getAsDataArray());\n                \n                // Now we know where these top-level elements lie in the file:\n                seekPoints.SegmentInfo.positionEBML.data = fileOffsetToSegmentRelative(segmentInfo.offset);\n                seekPoints.Tracks.positionEBML.data = fileOffsetToSegmentRelative(tracks.offset);\n            };\n            \n            /**\n             * Create a SimpleBlock keyframe header using these fields:\n             *     timecode    - Time of this keyframe\n             *     trackNumber - Track number from 1 to 126 (inclusive)\n             *     frame       - Raw frame data payload string\n             *\n             * Returns an EBML element.\n             */\n            function createKeyframeBlock(keyframe) {\n                var\n                    bufferStream = new ArrayBufferDataStream(1 + 2 + 1);\n                \n                if (!(keyframe.trackNumber > 0 && keyframe.trackNumber < 127)) {\n                    throw \"TrackNumber must be > 0 and < 127\";\n                }\n    \n                bufferStream.writeEBMLVarInt(keyframe.trackNumber); // Always 1 byte since we limit the range of trackNumber\n                bufferStream.writeU16BE(keyframe.timecode);\n                \n                // Flags byte\n                bufferStream.writeByte(\n                    1 << 7 // Keyframe\n                );\n                \n                return {\n                    \"id\": 0xA3, // SimpleBlock\n                    \"data\": [\n                         bufferStream.getAsDataArray(),\n                         keyframe.frame\n                    ]\n                };\n            }\n            \n            /**\n             * Create a Cluster node using these fields:\n             *\n             *    timecode    - Start time for the cluster\n             *\n             * Returns an EBML element.\n             */\n            function createCluster(cluster) {\n                return {\n                    \"id\": 0x1f43b675,\n                    \"data\": [\n                         {\n                            \"id\": 0xe7, // Timecode\n                            \"data\": Math.round(cluster.timecode)\n                         }\n                    ]\n                };\n            }\n            \n            function addCuePoint(trackIndex, clusterTime, clusterFileOffset) {\n                cues.push({\n                    \"id\": 0xBB, // Cue\n                    \"data\": [\n                         {\n                             \"id\": 0xB3, // CueTime\n                             \"data\": clusterTime\n                         },\n                         {\n                             \"id\": 0xB7, // CueTrackPositions\n                             \"data\": [\n                                  {\n                                      \"id\": 0xF7, // CueTrack\n                                      \"data\": trackIndex\n                                  },\n                                  {\n                                      \"id\": 0xF1, // CueClusterPosition\n                                      \"data\": fileOffsetToSegmentRelative(clusterFileOffset)\n                                  }\n                             ]\n                         }\n                    ]\n                });\n            }\n            \n            /**\n             * Write a Cues element to the blobStream using the global `cues` array of CuePoints (use addCuePoint()).\n             * The seek entry for the Cues in the SeekHead is updated.\n             */\n            function writeCues() {\n                var\n                    ebml = {\n                        \"id\": 0x1C53BB6B,\n                        \"data\": cues\n                    },\n                    \n                    cuesBuffer = new ArrayBufferDataStream(16 + cues.length * 32); // Pretty crude estimate of the buffer size we'll need\n                \n                writeEBML(cuesBuffer, blobBuffer.pos, ebml);\n                blobBuffer.write(cuesBuffer.getAsDataArray());\n                \n                // Now we know where the Cues element has ended up, we can update the SeekHead\n                seekPoints.Cues.positionEBML.data = fileOffsetToSegmentRelative(ebml.offset);\n            }\n            \n            /**\n             * Flush the frames in the current clusterFrameBuffer out to the stream as a Cluster.\n             */\n            function flushClusterFrameBuffer() {\n                if (clusterFrameBuffer.length == 0) {\n                    return;\n                }\n    \n                // First work out how large of a buffer we need to hold the cluster data\n                var\n                    rawImageSize = 0;\n                \n                for (var i = 0; i < clusterFrameBuffer.length; i++) {\n                    rawImageSize += clusterFrameBuffer[i].frame.length;\n                }\n                \n                var\n                    buffer = new ArrayBufferDataStream(rawImageSize + clusterFrameBuffer.length * 32), // Estimate 32 bytes per SimpleBlock header\n    \n                    cluster = createCluster({\n                        timecode: Math.round(clusterStartTime),\n                    });\n                    \n                for (var i = 0; i < clusterFrameBuffer.length; i++) {\n                    cluster.data.push(createKeyframeBlock(clusterFrameBuffer[i]));\n                }\n                \n                writeEBML(buffer, blobBuffer.pos, cluster);\n                blobBuffer.write(buffer.getAsDataArray());\n                \n                addCuePoint(DEFAULT_TRACK_NUMBER, Math.round(clusterStartTime), cluster.offset);\n                \n                clusterFrameBuffer = [];\n                clusterStartTime += clusterDuration;\n                clusterDuration = 0;\n            }\n            \n            function validateOptions() {\n                // Derive frameDuration setting if not already supplied\n                if (!options.frameDuration) {\n                    if (options.frameRate) {\n                        options.frameDuration = 1000 / options.frameRate;\n                    } else {\n                        throw \"Missing required frameDuration or frameRate setting\";\n                    }\n                }\n            }\n            \n            function addFrameToCluster(frame) {\n                frame.trackNumber = DEFAULT_TRACK_NUMBER;\n                \n                // Frame timecodes are relative to the start of their cluster:\n                frame.timecode = Math.round(clusterDuration);\n    \n                clusterFrameBuffer.push(frame);\n                \n                clusterDuration += frame.duration;\n                \n                if (clusterDuration >= MAX_CLUSTER_DURATION_MSEC) {\n                    flushClusterFrameBuffer();\n                }\n            }\n            \n            /**\n             * Rewrites the SeekHead element that was initially written to the stream with the offsets of top level elements.\n             *\n             * Call once writing is complete (so the offset of all top level elements is known).\n             */\n            function rewriteSeekHead() {\n                var\n                    seekHeadBuffer = new ArrayBufferDataStream(seekHead.size),\n                    oldPos = blobBuffer.pos;\n                \n                // Write the rewritten SeekHead element's data payload to the stream (don't need to update the id or size)\n                writeEBML(seekHeadBuffer, seekHead.dataOffset, seekHead.data);\n                \n                // And write that through to the file\n                blobBuffer.seek(seekHead.dataOffset);\n                blobBuffer.write(seekHeadBuffer.getAsDataArray());\n    \n                blobBuffer.seek(oldPos);\n            }\n            \n            /**\n             * Rewrite the Duration field of the Segment with the newly-discovered video duration.\n             */\n            function rewriteDuration() {\n                var\n                    buffer = new ArrayBufferDataStream(8),\n                    oldPos = blobBuffer.pos;\n                \n                // Rewrite the data payload (don't need to update the id or size)\n                buffer.writeDoubleBE(clusterStartTime);\n                \n                // And write that through to the file\n                blobBuffer.seek(segmentDuration.dataOffset);\n                blobBuffer.write(buffer.getAsDataArray());\n        \n                blobBuffer.seek(oldPos);\n            }\n            \n            /**\n             * Add a frame to the video. Currently the frame must be a Canvas element.\n             */\n            this.addFrame = function(canvas) {\n                if (writtenHeader) {\n                    if (canvas.width != videoWidth || canvas.height != videoHeight) {\n                        throw \"Frame size differs from previous frames\";\n                    }\n                } else {\n                    videoWidth = canvas.width;\n                    videoHeight = canvas.height;\n    \n                    writeHeader();\n                    writtenHeader = true;\n                }\n    \n                var\n                    webP = renderAsWebP(canvas, {quality: options.quality});\n                \n                if (!webP) {\n                    throw \"Couldn't decode WebP frame, does the browser support WebP?\";\n                }\n                \n                addFrameToCluster({\n                    frame: extractKeyframeFromWebP(webP),\n                    duration: options.frameDuration\n                });\n            };\n            \n            /**\n             * Finish writing the video and return a Promise to signal completion.\n             *\n             * If the destination device was memory (i.e. options.fileWriter was not supplied), the Promise is resolved with\n             * a Blob with the contents of the entire video.\n             */\n            this.complete = function() {\n                flushClusterFrameBuffer();\n                \n                writeCues();\n                rewriteSeekHead();\n                rewriteDuration();\n                \n                return blobBuffer.complete('video/webm');\n            };\n            \n            this.getWrittenSize = function() {\n                return blobBuffer.length;\n            };\n    \n            options = extend(optionDefaults, options || {});\n            validateOptions();\n        };\n    };\n\n    if (isNodeEnviroment) {\n\t    module.exports = WebMWriter(ArrayBufferDataStream, BlobBuffer);\n    } else {\n\t    window.WebMWriter = WebMWriter(ArrayBufferDataStream, BlobBuffer);\n    }\n})();\n","import {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3\n} from 'three';\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = { type: 'change' };\nconst _startEvent = { type: 'start' };\nconst _endEvent = { type: 'end' };\n\nclass OrbitControls extends EventDispatcher {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper();\n\n\t\tif ( domElement === undefined ) console.warn( 'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.' );\n\t\tif ( domElement === document ) console.error( 'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t\t// Set to false to disable this control\n\t\tthis.enabled = true;\n\n\t\t// \"target\" sets the location of focus, where the object orbits around\n\t\tthis.target = new Vector3();\n\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\n\t\tthis.minZoom = 0;\n\t\tthis.maxZoom = Infinity;\n\n\t\t// How far you can orbit vertically, upper and lower limits.\n\t\t// Range is 0 to Math.PI radians.\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\t// How far you can orbit horizontally, upper and lower limits.\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n\t\tthis.minAzimuthAngle = - Infinity; // radians\n\t\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t\t// Set to true to enable damping (inertia)\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\n\t\tthis.enableDamping = false;\n\t\tthis.dampingFactor = 0.05;\n\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t\t// Set to false to disable zooming\n\t\tthis.enableZoom = true;\n\t\tthis.zoomSpeed = 1.0;\n\n\t\t// Set to false to disable rotating\n\t\tthis.enableRotate = true;\n\t\tthis.rotateSpeed = 1.0;\n\n\t\t// Set to false to disable panning\n\t\tthis.enablePan = true;\n\t\tthis.panSpeed = 1.0;\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t\t// Set to true to automatically rotate around the target\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\t\tthis.autoRotate = false;\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n\t\t// The four arrow keys\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\n\n\t\t// Mouse buttons\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t// Touch fingers\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t\t// for reset\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// the target DOM element for key events\n\t\tthis._domElementKeyEvents = null;\n\n\t\t//\n\t\t// public methods\n\t\t//\n\n\t\tthis.getPolarAngle = function () {\n\n\t\t\treturn spherical.phi;\n\n\t\t};\n\n\t\tthis.getAzimuthalAngle = function () {\n\n\t\t\treturn spherical.theta;\n\n\t\t};\n\n\t\tthis.getDistance = function () {\n\n\t\t\treturn this.object.position.distanceTo( this.target );\n\n\t\t};\n\n\t\tthis.listenToKeyEvents = function ( domElement ) {\n\n\t\t\tdomElement.addEventListener( 'keydown', onKeyDown );\n\t\t\tthis._domElementKeyEvents = domElement;\n\n\t\t};\n\n\t\tthis.saveState = function () {\n\n\t\t\tscope.target0.copy( scope.target );\n\t\t\tscope.position0.copy( scope.object.position );\n\t\t\tscope.zoom0 = scope.object.zoom;\n\n\t\t};\n\n\t\tthis.reset = function () {\n\n\t\t\tscope.target.copy( scope.target0 );\n\t\t\tscope.object.position.copy( scope.position0 );\n\t\t\tscope.object.zoom = scope.zoom0;\n\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\tscope.update();\n\n\t\t\tstate = STATE.NONE;\n\n\t\t};\n\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\n\t\tthis.update = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\t// so camera.up is the orbit axis\n\t\t\tconst quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\t\tconst quatInverse = quat.clone().invert();\n\n\t\t\tconst lastPosition = new Vector3();\n\t\t\tconst lastQuaternion = new Quaternion();\n\n\t\t\tconst twoPI = 2 * Math.PI;\n\n\t\t\treturn function update() {\n\n\t\t\t\tconst position = scope.object.position;\n\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t\t// angle from z-axis around y-axis\n\t\t\t\tspherical.setFromVector3( offset );\n\n\t\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\t\trotateLeft( getAutoRotationAngle() );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scope.enableDamping ) {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t\t}\n\n\t\t\t\t// restrict theta to be between desired limits\n\n\t\t\t\tlet min = scope.minAzimuthAngle;\n\t\t\t\tlet max = scope.maxAzimuthAngle;\n\n\t\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\n\n\t\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\n\n\t\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\n\n\t\t\t\t\tif ( min <= max ) {\n\n\t\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\n\t\t\t\t\t\t\tMath.max( min, spherical.theta ) :\n\t\t\t\t\t\t\tMath.min( max, spherical.theta );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// restrict phi to be between desired limits\n\t\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\t\tspherical.makeSafe();\n\n\n\t\t\t\tspherical.radius *= scale;\n\n\t\t\t\t// restrict radius to be between desired limits\n\t\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n\t\t\t\t// move target to panned location\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tscope.target.add( panOffset );\n\n\t\t\t\t}\n\n\t\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t\t}\n\n\t\t\t\tscale = 1;\n\n\t\t\t\t// update condition is:\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\t\tif ( zoomChanged ||\n\t\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\t\tzoomChanged = false;\n\n\t\t\t\t\treturn true;\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.dispose = function () {\n\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu );\n\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\n\t\t\tscope.domElement.removeEventListener( 'pointercancel', onPointerCancel );\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\n\n\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\n\t\t\tif ( scope._domElementKeyEvents !== null ) {\n\n\t\t\t\tscope._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\n\n\t\t\t}\n\n\t\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t\t};\n\n\t\t//\n\t\t// internals\n\t\t//\n\n\t\tconst scope = this;\n\n\t\tconst STATE = {\n\t\t\tNONE: - 1,\n\t\t\tROTATE: 0,\n\t\t\tDOLLY: 1,\n\t\t\tPAN: 2,\n\t\t\tTOUCH_ROTATE: 3,\n\t\t\tTOUCH_PAN: 4,\n\t\t\tTOUCH_DOLLY_PAN: 5,\n\t\t\tTOUCH_DOLLY_ROTATE: 6\n\t\t};\n\n\t\tlet state = STATE.NONE;\n\n\t\tconst EPS = 0.000001;\n\n\t\t// current position in spherical coordinates\n\t\tconst spherical = new Spherical();\n\t\tconst sphericalDelta = new Spherical();\n\n\t\tlet scale = 1;\n\t\tconst panOffset = new Vector3();\n\t\tlet zoomChanged = false;\n\n\t\tconst rotateStart = new Vector2();\n\t\tconst rotateEnd = new Vector2();\n\t\tconst rotateDelta = new Vector2();\n\n\t\tconst panStart = new Vector2();\n\t\tconst panEnd = new Vector2();\n\t\tconst panDelta = new Vector2();\n\n\t\tconst dollyStart = new Vector2();\n\t\tconst dollyEnd = new Vector2();\n\t\tconst dollyDelta = new Vector2();\n\n\t\tconst pointers = [];\n\t\tconst pointerPositions = {};\n\n\t\tfunction getAutoRotationAngle() {\n\n\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t\t}\n\n\t\tfunction getZoomScale() {\n\n\t\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t\t}\n\n\t\tfunction rotateLeft( angle ) {\n\n\t\t\tsphericalDelta.theta -= angle;\n\n\t\t}\n\n\t\tfunction rotateUp( angle ) {\n\n\t\t\tsphericalDelta.phi -= angle;\n\n\t\t}\n\n\t\tconst panLeft = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\t\tv.multiplyScalar( - distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tconst panUp = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t\t}\n\n\t\t\t\tv.multiplyScalar( distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\t// deltaX and deltaY are in pixels; right and down are positive\n\t\tconst pan = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\t\tconst element = scope.domElement;\n\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t// perspective\n\t\t\t\t\tconst position = scope.object.position;\n\t\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\t\tlet targetDistance = offset.length();\n\n\t\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t// orthographic\n\t\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\t\tscope.enablePan = false;\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}();\n\n\t\tfunction dollyOut( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale /= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction dollyIn( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale *= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\t\t// event callbacks - update the object state\n\t\t//\n\n\t\tfunction handleMouseDownRotate( event ) {\n\n\t\t\trotateStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownDolly( event ) {\n\n\t\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownPan( event ) {\n\n\t\t\tpanStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseMoveRotate( event ) {\n\n\t\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMoveDolly( event ) {\n\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMovePan( event ) {\n\n\t\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseUp( /*event*/ ) {\n\n\t\t\t// no-op\n\n\t\t}\n\n\t\tfunction handleMouseWheel( event ) {\n\n\t\t\tif ( event.deltaY < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleKeyDown( event ) {\n\n\t\t\tlet needsUpdate = false;\n\n\t\t\tswitch ( event.code ) {\n\n\t\t\t\tcase scope.keys.UP:\n\t\t\t\t\tpan( 0, scope.keyPanSpeed );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.LEFT:\n\t\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.RIGHT:\n\t\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( needsUpdate ) {\n\n\t\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tscope.update();\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tfunction handleTouchStartRotate() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\trotateStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\trotateStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartPan() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\tpanStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartDolly() {\n\n\t\t\tconst dx = pointers[ 0 ].pageX - pointers[ 1 ].pageX;\n\t\t\tconst dy = pointers[ 0 ].pageY - pointers[ 1 ].pageY;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyStart.set( 0, distance );\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyPan() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enablePan ) handleTouchStartPan();\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyRotate() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enableRotate ) handleTouchStartRotate();\n\n\t\t}\n\n\t\tfunction handleTouchMoveRotate( event ) {\n\n\t\t\tif ( pointers.length == 1 ) {\n\n\t\t\t\trotateEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\trotateEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMovePan( event ) {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\tpanEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDolly( event ) {\n\n\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\tconst dx = event.pageX - position.x;\n\t\t\tconst dy = event.pageY - position.y;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyEnd.set( 0, distance );\n\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\t\tdollyOut( dollyDelta.y );\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enablePan ) handleTouchMovePan( event );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyRotate( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\n\n\t\t}\n\n\t\tfunction handleTouchEnd( /*event*/ ) {\n\n\t\t\t// no-op\n\n\t\t}\n\n\t\t//\n\t\t// event handlers - FSM: listen for events and reset state\n\t\t//\n\n\t\tfunction onPointerDown( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.setPointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.addEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.addEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\taddPointer( event );\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchStart( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseDown( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchMove( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseMove( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerUp( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchEnd();\n\n\t\t\t} else {\n\n\t\t\t\tonMouseUp( event );\n\n\t\t\t}\n\n\t\t\tremovePointer( event );\n\n\t\t\t//\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.releasePointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerCancel( event ) {\n\n\t\t\tremovePointer( event );\n\n\t\t}\n\n\t\tfunction onMouseDown( event ) {\n\n\t\t\tlet mouseAction;\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase 0:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tmouseAction = - 1;\n\n\t\t\t}\n\n\t\t\tswitch ( mouseAction ) {\n\n\t\t\t\tcase MOUSE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseUp( event ) {\n\n\t\t\thandleMouseUp( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onMouseWheel( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\thandleMouseWheel( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction onKeyDown( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enablePan === false ) return;\n\n\t\t\thandleKeyDown( event );\n\n\t\t}\n\n\t\tfunction onTouchStart( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( pointers.length ) {\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tswitch ( scope.touches.ONE ) {\n\n\t\t\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tswitch ( scope.touches.TWO ) {\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchMove( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMovePan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchEnd( event ) {\n\n\t\t\thandleTouchEnd( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onContextMenu( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tfunction addPointer( event ) {\n\n\t\t\tpointers.push( event );\n\n\t\t}\n\n\t\tfunction removePointer( event ) {\n\n\t\t\tdelete pointerPositions[ event.pointerId ];\n\n\t\t\tfor ( let i = 0; i < pointers.length; i ++ ) {\n\n\t\t\t\tif ( pointers[ i ].pointerId == event.pointerId ) {\n\n\t\t\t\t\tpointers.splice( i, 1 );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction trackPointer( event ) {\n\n\t\t\tlet position = pointerPositions[ event.pointerId ];\n\n\t\t\tif ( position === undefined ) {\n\n\t\t\t\tposition = new Vector2();\n\t\t\t\tpointerPositions[ event.pointerId ] = position;\n\n\t\t\t}\n\n\t\t\tposition.set( event.pageX, event.pageY );\n\n\t\t}\n\n\t\tfunction getSecondPointerPosition( event ) {\n\n\t\t\tconst pointer = ( event.pointerId === pointers[ 0 ].pointerId ) ? pointers[ 1 ] : pointers[ 0 ];\n\n\t\t\treturn pointerPositions[ pointer.pointerId ];\n\n\t\t}\n\n\t\t//\n\n\t\tscope.domElement.addEventListener( 'contextmenu', onContextMenu );\n\n\t\tscope.domElement.addEventListener( 'pointerdown', onPointerDown );\n\t\tscope.domElement.addEventListener( 'pointercancel', onPointerCancel );\n\t\tscope.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\n\n\t\t// force an update at start\n\n\t\tthis.update();\n\n\t}\n\n}\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nclass MapControls extends OrbitControls {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper( object, domElement );\n\n\t\tthis.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\n\n\t\tthis.mouseButtons.LEFT = MOUSE.PAN;\n\t\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\n\n\t\tthis.touches.ONE = TOUCH.PAN;\n\t\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\n\n\t}\n\n}\n\nexport { OrbitControls, MapControls };\n"],"sourceRoot":""}