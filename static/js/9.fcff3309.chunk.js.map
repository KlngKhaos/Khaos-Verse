{"version":3,"sources":["../node_modules/three/examples/jsm/controls/OrbitControls.js","../node_modules/ccapture.js-npmfixed/src/CCapture.js","../node_modules/ccapture.js-npmfixed/src/tar.js","../node_modules/ccapture.js-npmfixed/src/download.js","../node_modules/ccapture.js-npmfixed/src/gif.js","../node_modules/ccapture.js-npmfixed/src/webm-writer-0.2.0.js"],"names":["_changeEvent","type","_startEvent","_endEvent","OrbitControls","object","domElement","undefined","console","warn","document","error","style","touchAction","enabled","target","Vector3","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","Math","PI","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","keys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","clone","position0","position","zoom0","zoom","_domElementKeyEvents","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","getDistance","this","distanceTo","listenToKeyEvents","addEventListener","onKeyDown","saveState","scope","copy","reset","updateProjectionMatrix","dispatchEvent","update","state","STATE","NONE","offset","quat","Quaternion","setFromUnitVectors","up","quatInverse","invert","lastPosition","lastQuaternion","twoPI","sub","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","min","max","isFinite","makeSafe","radius","scale","addScaledVector","panOffset","add","setFromSpherical","lookAt","multiplyScalar","set","zoomChanged","distanceToSquared","EPS","dot","quaternion","dispose","removeEventListener","onContextMenu","onPointerDown","onPointerCancel","onMouseWheel","onPointerMove","onPointerUp","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","pointers","pointerPositions","getZoomScale","pow","angle","rotateUp","panLeft","v","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","length","tan","fov","clientHeight","matrix","isOrthographicCamera","right","left","clientWidth","top","bottom","dollyOut","dollyScale","dollyIn","handleMouseDownRotate","event","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","x","y","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchMoveRotate","getSecondPointerPosition","subVectors","handleTouchMovePan","handleTouchMoveDolly","setPointerCapture","pointerId","push","addPointer","pointerType","trackPointer","DOLLY_ROTATE","onTouchStart","mouseAction","button","handleMouseDownDolly","ctrlKey","metaKey","shiftKey","onMouseDown","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","onTouchMove","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","onMouseMove","removePointer","releasePointerCapture","preventDefault","handleMouseWheel","needsUpdate","code","handleKeyDown","i","splice","pointer","passive","EventDispatcher","isNodeEnviroment","module","exports","Tar","require","window","download","GIF","WebMWriter","objectTypes","checkGlobal","value","Object","parseFloat","parseInt","freeExports","nodeType","freeModule","freeGlobal","global","freeSelf","self","freeWindow","thisGlobal","Function","pad","n","String","slice","gc","HTMLCanvasElement","prototype","toBlob","defineProperty","callback","quality","binStr","atob","toDataURL","split","len","arr","Uint8Array","charCodeAt","Blob","performance","Date","now","getTime","nowOffset","timing","navigationStart","g_startTime","CCFrameEncoder","settings","_handlers","on","handler","emit","apply","Array","call","arguments","filename","name","s4","floor","random","toString","substring","guid","extension","mimeType","CCTarEncoder","fileExtension","baseFilename","tape","count","part","frames","CCPNGEncoder","CCJPEGEncoder","CCWebMEncoder","createElement","substr","log","framerate","videoWriter","fileWriter","fd","frameRate","CCFFMpegServerEncoder","encoder","FFMpegServer","Video","bind","url","size","cb","progress","onProgress","data","alert","JSON","stringify","CCStreamEncoder","stream","mediaRecorder","chunks","CCGIFEncoder","workers","canvas","ctx","getContext","sizeSet","workerBlob","workerScript","URL","createObjectURL","blob","CCapture","_verbose","_time","_startTime","_performanceTime","_performanceStartTime","_step","_encoder","_settings","_timeouts","_intervals","_frameCount","_intermediateFrameCount","_requestAnimationFrameCallbacks","_capturing","motionBlurFrames","verbose","display","step","timeLimit","frameLimit","startTime","_timeDisplay","backgroundColor","fontFamily","fontSize","padding","color","zIndex","body","appendChild","bufferMotionBlur","imageData","canvasMotionBlur","ctxMotionBlur","_log","_encoders","gif","webm","ffmpegserver","png","jpg","ctor","format","join","_process","_emit","_oldSetTimeout","setTimeout","_oldSetInterval","setInterval","_oldClearInterval","clearInterval","_oldClearTimeout","clearTimeout","_oldRequestAnimationFrame","requestAnimationFrame","_oldNow","_oldPerformanceNow","_oldGetTime","media","_stop","stop","_call","fn","p","dt","forEach","_hookedTime","seconds","_save","d","setSeconds","textContent","toISOString","_updateTime","j","triggerTime","time","save","message","start","hookCurrentTime","_hooked","currentTime","pause","t","id","HTMLVideoElement","get","HTMLAudioElement","err","_init","capture","width","height","Uint16Array","fillStyle","fillRect","_checkFrame","drawImage","getImageData","_blendFrame","putImageData","_saveFrame","safeToProceed","create","fileReader","FileReader","onload","append","result","autoSaveTime","readAsArrayBuffer","addFrame","complete","then","end","captureStream","MediaRecorder","ondataavailable","e","onstop","setOption","delay","render","define","lookup","clean","buffer","utils","num","bytes","base","extend","orig","addLength","multipleOf","stringToUint8","input","out","uint8ToBase64","uint8","temp","extraBytes","output","headerFormat","header","structure","str","field","blockSize","recordSize","recordsPerBlock","written","blocks","filepath","opts","checksum","mode","mtime","uid","gid","headerArr","constructor","match","fileName","fileMode","fileSize","ustar","owner","group","key","headerLength","ceil","inputLength","buffers","chunk","b","c","clear","strFileName","strMimeType","reader","defaultMime","payload","anchor","a","myBlob","MozBlob","WebKitBlob","pop","href","indexOf","ajax","XMLHttpRequest","open","responseType","response","send","test","navigator","msSaveBlob","dataUrlToBlob","saver","tempUiArr","mx","strUrl","parts","binData","decodeURIComponent","uiArr","winMode","setAttribute","className","innerHTML","stopPropagation","callee","click","removeChild","revokeObjectURL","userAgent","replace","confirm","location","f","src","btoa","encodeURIComponent","readAsDataURL","hasOwnProperty","cache","resolve","Error","loaded","parent","children","lastIndexOf","modules","title","version","browser","env","argv","nextTick","setImmediate","cwd","chdir","m","l","k","g","h","EventEmitter","running","options","freeWorkers","activeWorkers","setOptions","__super__","repeat","background","transparent","_canvas","ImageData","CanvasRenderingContext2D","WebGLRenderingContext","getContextData","context","childNodes","image","nextFrame","finishedFrames","imageParts","spawnWorkers","renderNextFrame","abort","shift","terminate","Worker","onmessage","frameFinished","index","finishRendering","pageSize","cursor","round","getTask","postMessage","setFill","last","canTransfer","toLowerCase","platform","documentMode","isArray","setMaxListeners","_events","maxListeners","addListener","warned","trace","once","removeListener","removeAllListeners","listeners","ArrayBufferDataStream","pos","seek","writeBytes","writeByte","writeU8","writeU16BE","u","writeDoubleBE","Float64Array","writeFloatBE","Float32Array","writeString","s","writeEBMLVarIntWidth","RuntimeException","measureEBMLVarInt","val","writeEBMLVarInt","writeUnsignedIntBE","measureUnsignedInt","getAsDataArray","byteLength","subarray","fs","BlobBuffer","destination","writePromise","Promise","readBlobAsBuffer","reject","convertToUint8Array","thing","ArrayBuffer","isView","measureData","Number","isInteger","FileWriter","isNaN","write","newEntry","isAppend","dataArray","totalWritten","Buffer","from","handleWriteComplete","onwriteend","entry","entryArray","newEntryArray","renderAsWebP","frame","extractKeyframeFromWebP","webP","keyframeStartIndex","EBMLFloat32","EBMLFloat64","writeEBML","bufferFileOffset","ebml","sizePos","dataBegin","dataEnd","dataOffset","videoWidth","videoHeight","ebmlSegment","seekHead","writtenHeader","clusterFrameBuffer","clusterStartTime","clusterDuration","seekPoints","Cues","positionEBML","SegmentInfo","Tracks","segmentDuration","cues","blobBuffer","fileOffsetToSegmentRelative","fileOffset","writeHeader","seekPositionEBMLTemplate","seekPoint","createSeekHead","segmentInfo","tracks","bufferStream","createKeyframeBlock","keyframe","trackNumber","timecode","flushClusterFrameBuffer","rawImageSize","trackIndex","clusterTime","clusterFileOffset","cluster","createCluster","duration","frameDuration","cuesBuffer","writeCues","seekHeadBuffer","oldPos","rewriteSeekHead","rewriteDuration","getWrittenSize","obj","prop","validateOptions"],"mappings":";wMAiBMA,EAAe,CAAEC,KAAM,UACvBC,EAAc,CAAED,KAAM,SACtBE,EAAY,CAAEF,KAAM,OAEpBG,E,kDAEL,WAAaC,EAAQC,GAAa,0BAEjC,oBAEoBC,IAAfD,GAA2BE,QAAQC,KAAM,4EACzCH,IAAeI,UAAWF,QAAQG,MAAO,4HAE9C,EAAKN,OAASA,EACd,EAAKC,WAAaA,EAClB,EAAKA,WAAWM,MAAMC,YAAc,OAGpC,EAAKC,SAAU,EAGf,EAAKC,OAAS,IAAIC,UAGlB,EAAKC,YAAc,EACnB,EAAKC,YAAcC,IAGnB,EAAKC,QAAU,EACf,EAAKC,QAAUF,IAIf,EAAKG,cAAgB,EACrB,EAAKC,cAAgBC,KAAKC,GAI1B,EAAKC,iBAAoBP,IACzB,EAAKQ,gBAAkBR,IAIvB,EAAKS,eAAgB,EACrB,EAAKC,cAAgB,IAIrB,EAAKC,YAAa,EAClB,EAAKC,UAAY,EAGjB,EAAKC,cAAe,EACpB,EAAKC,YAAc,EAGnB,EAAKC,WAAY,EACjB,EAAKC,SAAW,EAChB,EAAKC,oBAAqB,EAC1B,EAAKC,YAAc,EAInB,EAAKC,YAAa,EAClB,EAAKC,gBAAkB,EAGvB,EAAKC,KAAO,CAAEC,KAAM,YAAaC,GAAI,UAAWC,MAAO,aAAcC,OAAQ,aAG7E,EAAKC,aAAe,CAAEJ,KAAMK,QAAMC,OAAQC,OAAQF,QAAMG,MAAON,MAAOG,QAAMI,KAG5E,EAAKC,QAAU,CAAEC,IAAKC,QAAMN,OAAQO,IAAKD,QAAME,WAG/C,EAAKC,QAAU,EAAKzC,OAAO0C,QAC3B,EAAKC,UAAY,EAAKrD,OAAOsD,SAASF,QACtC,EAAKG,MAAQ,EAAKvD,OAAOwD,KAGzB,EAAKC,qBAAuB,KAM5B,EAAKC,cAAgB,WAEpB,OAAOC,EAAUC,KAIlB,EAAKC,kBAAoB,WAExB,OAAOF,EAAUG,OAIlB,EAAKC,YAAc,WAElB,OAAOC,KAAKhE,OAAOsD,SAASW,WAAYD,KAAKtD,SAI9C,EAAKwD,kBAAoB,SAAWjE,GAEnCA,EAAWkE,iBAAkB,UAAWC,GACxCJ,KAAKP,qBAAuBxD,GAI7B,EAAKoE,UAAY,WAEhBC,EAAMnB,QAAQoB,KAAMD,EAAM5D,QAC1B4D,EAAMjB,UAAUkB,KAAMD,EAAMtE,OAAOsD,UACnCgB,EAAMf,MAAQe,EAAMtE,OAAOwD,MAI5B,EAAKgB,MAAQ,WAEZF,EAAM5D,OAAO6D,KAAMD,EAAMnB,SACzBmB,EAAMtE,OAAOsD,SAASiB,KAAMD,EAAMjB,WAClCiB,EAAMtE,OAAOwD,KAAOc,EAAMf,MAE1Be,EAAMtE,OAAOyE,yBACbH,EAAMI,cAAe/E,GAErB2E,EAAMK,SAENC,EAAQC,EAAMC,MAKf,EAAKH,OAAS,WAEb,IAAMI,EAAS,IAAIpE,UAGbqE,GAAO,IAAIC,cAAaC,mBAAoBlF,EAAOmF,GAAI,IAAIxE,UAAS,EAAG,EAAG,IAC1EyE,EAAcJ,EAAK5B,QAAQiC,SAE3BC,EAAe,IAAI3E,UACnB4E,EAAiB,IAAIN,aAErBO,EAAQ,EAAIrE,KAAKC,GAEvB,OAAO,WAEN,IAAMkC,EAAWgB,EAAMtE,OAAOsD,SAE9ByB,EAAOR,KAAMjB,GAAWmC,IAAKnB,EAAM5D,QAGnCqE,EAAOW,gBAAiBV,GAGxBrB,EAAUgC,eAAgBZ,GAErBT,EAAMrC,YAAc2C,IAAUC,EAAMC,MAExCc,EAsLK,EAAIzE,KAAKC,GAAK,GAAK,GAAKkD,EAAMpC,iBAlL/BoC,EAAM/C,eAEVoC,EAAUG,OAAS+B,EAAe/B,MAAQQ,EAAM9C,cAChDmC,EAAUC,KAAOiC,EAAejC,IAAMU,EAAM9C,gBAI5CmC,EAAUG,OAAS+B,EAAe/B,MAClCH,EAAUC,KAAOiC,EAAejC,KAMjC,IAAIkC,EAAMxB,EAAMjD,gBACZ0E,EAAMzB,EAAMhD,gBA2EhB,OAzEK0E,SAAUF,IAASE,SAAUD,KAE5BD,GAAQ3E,KAAKC,GAAK0E,GAAON,EAAiBM,EAAM3E,KAAKC,KAAK0E,GAAON,GAEjEO,GAAQ5E,KAAKC,GAAK2E,GAAOP,EAAiBO,EAAM5E,KAAKC,KAAK2E,GAAOP,GAIrE7B,EAAUG,MAFNgC,GAAOC,EAEO5E,KAAK4E,IAAKD,EAAK3E,KAAK2E,IAAKC,EAAKpC,EAAUG,QAItCH,EAAUG,OAAUgC,EAAMC,GAAQ,EACrD5E,KAAK4E,IAAKD,EAAKnC,EAAUG,OACzB3C,KAAK2E,IAAKC,EAAKpC,EAAUG,QAO5BH,EAAUC,IAAMzC,KAAK4E,IAAKzB,EAAMrD,cAAeE,KAAK2E,IAAKxB,EAAMpD,cAAeyC,EAAUC,MAExFD,EAAUsC,WAGVtC,EAAUuC,QAAUC,EAGpBxC,EAAUuC,OAAS/E,KAAK4E,IAAKzB,EAAM1D,YAAaO,KAAK2E,IAAKxB,EAAMzD,YAAa8C,EAAUuC,UAI1D,IAAxB5B,EAAM/C,cAEV+C,EAAM5D,OAAO0F,gBAAiBC,EAAW/B,EAAM9C,eAI/C8C,EAAM5D,OAAO4F,IAAKD,GAInBtB,EAAOwB,iBAAkB5C,GAGzBoB,EAAOW,gBAAiBN,GAExB9B,EAASiB,KAAMD,EAAM5D,QAAS4F,IAAKvB,GAEnCT,EAAMtE,OAAOwG,OAAQlC,EAAM5D,SAEE,IAAxB4D,EAAM/C,eAEVsE,EAAe/B,OAAW,EAAIQ,EAAM9C,cACpCqE,EAAejC,KAAS,EAAIU,EAAM9C,cAElC6E,EAAUI,eAAgB,EAAInC,EAAM9C,iBAIpCqE,EAAea,IAAK,EAAG,EAAG,GAE1BL,EAAUK,IAAK,EAAG,EAAG,IAItBP,EAAQ,KAMHQ,GACJrB,EAAasB,kBAAmBtC,EAAMtE,OAAOsD,UAAauD,GAC1D,GAAM,EAAItB,EAAeuB,IAAKxC,EAAMtE,OAAO+G,aAAiBF,KAE5DvC,EAAMI,cAAe/E,GAErB2F,EAAaf,KAAMD,EAAMtE,OAAOsD,UAChCiC,EAAehB,KAAMD,EAAMtE,OAAO+G,YAClCJ,GAAc,GAEP,IAnII,GA6Id,EAAKK,QAAU,WAEd1C,EAAMrE,WAAWgH,oBAAqB,cAAeC,GAErD5C,EAAMrE,WAAWgH,oBAAqB,cAAeE,GACrD7C,EAAMrE,WAAWgH,oBAAqB,gBAAiBG,GACvD9C,EAAMrE,WAAWgH,oBAAqB,QAASI,GAE/C/C,EAAMrE,WAAWgH,oBAAqB,cAAeK,GACrDhD,EAAMrE,WAAWgH,oBAAqB,YAAaM,GAGf,OAA/BjD,EAAMb,sBAEVa,EAAMb,qBAAqBwD,oBAAqB,UAAW7C,IAY7D,IAAME,EAAQ,eAERO,EAAQ,CACbC,MAAQ,EACRpC,OAAQ,EACRE,MAAO,EACPC,IAAK,EACL2E,aAAc,EACdC,UAAW,EACXC,gBAAiB,EACjBC,mBAAoB,GAGjB/C,EAAQC,EAAMC,KAEZ+B,EAAM,KAGNlD,EAAY,IAAIiE,YAChB/B,EAAiB,IAAI+B,YAEvBzB,EAAQ,EACNE,EAAY,IAAI1F,UAClBgG,GAAc,EAEZkB,EAAc,IAAIC,UAClBC,EAAY,IAAID,UAChBE,EAAc,IAAIF,UAElBG,EAAW,IAAIH,UACfI,EAAS,IAAIJ,UACbK,EAAW,IAAIL,UAEfM,EAAa,IAAIN,UACjBO,EAAW,IAAIP,UACfQ,EAAa,IAAIR,UAEjBS,EAAW,GACXC,EAAmB,GAQzB,SAASC,IAER,OAAOtH,KAAKuH,IAAK,IAAMpE,EAAM5C,WAI9B,SAASkE,EAAY+C,GAEpB9C,EAAe/B,OAAS6E,EAIzB,SAASC,EAAUD,GAElB9C,EAAejC,KAAO+E,EAIvB,IAAME,EAAU,WAEf,IAAMC,EAAI,IAAInI,UAEd,OAAO,SAAkBoI,EAAUC,GAElCF,EAAEG,oBAAqBD,EAAc,GACrCF,EAAErC,gBAAkBsC,GAEpB1C,EAAUC,IAAKwC,IATD,GAeVI,EAAQ,WAEb,IAAMJ,EAAI,IAAInI,UAEd,OAAO,SAAgBoI,EAAUC,IAEE,IAA7B1E,EAAMvC,mBAEV+G,EAAEG,oBAAqBD,EAAc,IAIrCF,EAAEG,oBAAqBD,EAAc,GACrCF,EAAEK,aAAc7E,EAAMtE,OAAOmF,GAAI2D,IAIlCA,EAAErC,eAAgBsC,GAElB1C,EAAUC,IAAKwC,IAnBH,GA0BRM,EAAM,WAEX,IAAMrE,EAAS,IAAIpE,UAEnB,OAAO,SAAc0I,EAAQC,GAE5B,IAAMC,EAAUjF,EAAMrE,WAEtB,GAAKqE,EAAMtE,OAAOwJ,oBAAsB,CAGvC,IAAMlG,EAAWgB,EAAMtE,OAAOsD,SAC9ByB,EAAOR,KAAMjB,GAAWmC,IAAKnB,EAAM5D,QACnC,IAAI+I,EAAiB1E,EAAO2E,SAG5BD,GAAkBtI,KAAKwI,IAAOrF,EAAMtE,OAAO4J,IAAM,EAAMzI,KAAKC,GAAK,KAGjEyH,EAAS,EAAIQ,EAASI,EAAiBF,EAAQM,aAAcvF,EAAMtE,OAAO8J,QAC1EZ,EAAO,EAAII,EAASG,EAAiBF,EAAQM,aAAcvF,EAAMtE,OAAO8J,aAE7DxF,EAAMtE,OAAO+J,sBAGxBlB,EAASQ,GAAW/E,EAAMtE,OAAOgK,MAAQ1F,EAAMtE,OAAOiK,MAAS3F,EAAMtE,OAAOwD,KAAO+F,EAAQW,YAAa5F,EAAMtE,OAAO8J,QACrHZ,EAAOI,GAAWhF,EAAMtE,OAAOmK,IAAM7F,EAAMtE,OAAOoK,QAAW9F,EAAMtE,OAAOwD,KAAO+F,EAAQM,aAAcvF,EAAMtE,OAAO8J,UAKpH3J,QAAQC,KAAM,gFACdkE,EAAMzC,WAAY,IAhCT,GAwCZ,SAASwI,EAAUC,GAEbhG,EAAMtE,OAAOwJ,oBAEjBrD,GAASmE,EAEEhG,EAAMtE,OAAO+J,sBAExBzF,EAAMtE,OAAOwD,KAAOrC,KAAK4E,IAAKzB,EAAMvD,QAASI,KAAK2E,IAAKxB,EAAMtD,QAASsD,EAAMtE,OAAOwD,KAAO8G,IAC1FhG,EAAMtE,OAAOyE,yBACbkC,GAAc,IAIdxG,QAAQC,KAAM,uFACdkE,EAAM7C,YAAa,GAMrB,SAAS8I,EAASD,GAEZhG,EAAMtE,OAAOwJ,oBAEjBrD,GAASmE,EAEEhG,EAAMtE,OAAO+J,sBAExBzF,EAAMtE,OAAOwD,KAAOrC,KAAK4E,IAAKzB,EAAMvD,QAASI,KAAK2E,IAAKxB,EAAMtD,QAASsD,EAAMtE,OAAOwD,KAAO8G,IAC1FhG,EAAMtE,OAAOyE,yBACbkC,GAAc,IAIdxG,QAAQC,KAAM,uFACdkE,EAAM7C,YAAa,GAUrB,SAAS+I,EAAuBC,GAE/B5C,EAAYnB,IAAK+D,EAAMC,QAASD,EAAME,SAUvC,SAASC,EAAoBH,GAE5BxC,EAASvB,IAAK+D,EAAMC,QAASD,EAAME,SAwHpC,SAASE,IAER,GAAyB,IAApBtC,EAASmB,OAEb7B,EAAYnB,IAAK6B,EAAU,GAAIuC,MAAOvC,EAAU,GAAIwC,WAE9C,CAEN,IAAMC,EAAI,IAAQzC,EAAU,GAAIuC,MAAQvC,EAAU,GAAIuC,OAChDG,EAAI,IAAQ1C,EAAU,GAAIwC,MAAQxC,EAAU,GAAIwC,OAEtDlD,EAAYnB,IAAKsE,EAAGC,IAMtB,SAASC,IAER,GAAyB,IAApB3C,EAASmB,OAEbzB,EAASvB,IAAK6B,EAAU,GAAIuC,MAAOvC,EAAU,GAAIwC,WAE3C,CAEN,IAAMC,EAAI,IAAQzC,EAAU,GAAIuC,MAAQvC,EAAU,GAAIuC,OAChDG,EAAI,IAAQ1C,EAAU,GAAIwC,MAAQxC,EAAU,GAAIwC,OAEtD9C,EAASvB,IAAKsE,EAAGC,IAMnB,SAASE,IAER,IAAMC,EAAK7C,EAAU,GAAIuC,MAAQvC,EAAU,GAAIuC,MACzCO,EAAK9C,EAAU,GAAIwC,MAAQxC,EAAU,GAAIwC,MAEzChC,EAAW5H,KAAKmK,KAAMF,EAAKA,EAAKC,EAAKA,GAE3CjD,EAAW1B,IAAK,EAAGqC,GAoBpB,SAASwC,EAAuBd,GAE/B,GAAwB,GAAnBlC,EAASmB,OAEb3B,EAAUrB,IAAK+D,EAAMK,MAAOL,EAAMM,WAE5B,CAEN,IAAMzH,EAAWkI,GAA0Bf,GAErCO,EAAI,IAAQP,EAAMK,MAAQxH,EAAS0H,GACnCC,EAAI,IAAQR,EAAMM,MAAQzH,EAAS2H,GAEzClD,EAAUrB,IAAKsE,EAAGC,GAInBjD,EAAYyD,WAAY1D,EAAWF,GAAcpB,eAAgBnC,EAAM1C,aAEvE,IAAM2H,EAAUjF,EAAMrE,WAEtB2F,EAAY,EAAIzE,KAAKC,GAAK4G,EAAYgD,EAAIzB,EAAQM,cAElDjB,EAAU,EAAIzH,KAAKC,GAAK4G,EAAYiD,EAAI1B,EAAQM,cAEhDhC,EAAYtD,KAAMwD,GAInB,SAAS2D,EAAoBjB,GAE5B,GAAyB,IAApBlC,EAASmB,OAEbxB,EAAOxB,IAAK+D,EAAMK,MAAOL,EAAMM,WAEzB,CAEN,IAAMzH,EAAWkI,GAA0Bf,GAErCO,EAAI,IAAQP,EAAMK,MAAQxH,EAAS0H,GACnCC,EAAI,IAAQR,EAAMM,MAAQzH,EAAS2H,GAEzC/C,EAAOxB,IAAKsE,EAAGC,GAIhB9C,EAASsD,WAAYvD,EAAQD,GAAWxB,eAAgBnC,EAAMxC,UAE9DsH,EAAKjB,EAAS6C,EAAG7C,EAAS8C,GAE1BhD,EAAS1D,KAAM2D,GAIhB,SAASyD,EAAsBlB,GAE9B,IAAMnH,EAAWkI,GAA0Bf,GAErCW,EAAKX,EAAMK,MAAQxH,EAAS0H,EAC5BK,EAAKZ,EAAMM,MAAQzH,EAAS2H,EAE5BlC,EAAW5H,KAAKmK,KAAMF,EAAKA,EAAKC,EAAKA,GAE3ChD,EAAS3B,IAAK,EAAGqC,GAEjBT,EAAW5B,IAAK,EAAGvF,KAAKuH,IAAKL,EAAS4C,EAAI7C,EAAW6C,EAAG3G,EAAM5C,YAE9D2I,EAAU/B,EAAW2C,GAErB7C,EAAW7D,KAAM8D,GA8BlB,SAASlB,EAAesD,IAEA,IAAlBnG,EAAM7D,UAEc,IAApB8H,EAASmB,SAEbpF,EAAMrE,WAAW2L,kBAAmBnB,EAAMoB,WAE1CvH,EAAMrE,WAAWkE,iBAAkB,cAAemD,GAClDhD,EAAMrE,WAAWkE,iBAAkB,YAAaoD,IAsYlD,SAAqBkD,GAEpBlC,EAASuD,KAAMrB,GAlYfsB,CAAYtB,GAEe,UAAtBA,EAAMuB,YAkOZ,SAAuBvB,GAItB,OAFAwB,GAAcxB,GAELlC,EAASmB,QAEjB,KAAK,EAEJ,OAASpF,EAAMxB,QAAQC,KAEtB,KAAKC,QAAMN,OAEV,IAA4B,IAAvB4B,EAAM3C,aAAyB,OAEpCkJ,IAEAjG,EAAQC,EAAM2C,aAEd,MAED,KAAKxE,QAAMH,IAEV,IAAyB,IAApByB,EAAMzC,UAAsB,OAEjCqJ,IAEAtG,EAAQC,EAAM4C,UAEd,MAED,QAEC7C,EAAQC,EAAMC,KAIhB,MAED,KAAK,EAEJ,OAASR,EAAMxB,QAAQG,KAEtB,KAAKD,QAAME,UAEV,IAA0B,IAArBoB,EAAM7C,aAA4C,IAApB6C,EAAMzC,UAAsB,OAhZ9DyC,EAAM7C,YAAa0J,IAEnB7G,EAAMzC,WAAYqJ,IAkZnBtG,EAAQC,EAAM6C,gBAEd,MAED,KAAK1E,QAAMkJ,aAEV,IAA0B,IAArB5H,EAAM7C,aAA+C,IAAvB6C,EAAM3C,aAAyB,OAlZjE2C,EAAM7C,YAAa0J,IAEnB7G,EAAM3C,cAAekJ,IAoZtBjG,EAAQC,EAAM8C,mBAEd,MAED,QAEC/C,EAAQC,EAAMC,KAIhB,MAED,QAECF,EAAQC,EAAMC,KAIXF,IAAUC,EAAMC,MAEpBR,EAAMI,cAAe7E,GA9SrBsM,CAAc1B,GA6DhB,SAAsBA,GAErB,IAAI2B,EAEJ,OAAS3B,EAAM4B,QAEd,KAAK,EAEJD,EAAc9H,EAAM9B,aAAaJ,KACjC,MAED,KAAK,EAEJgK,EAAc9H,EAAM9B,aAAaG,OACjC,MAED,KAAK,EAEJyJ,EAAc9H,EAAM9B,aAAaF,MACjC,MAED,QAEC8J,GAAgB,EAIlB,OAASA,GAER,KAAK3J,QAAMG,MAEV,IAA0B,IAArB0B,EAAM7C,WAAuB,QA/YrC,SAA+BgJ,GAE9BrC,EAAW1B,IAAK+D,EAAMC,QAASD,EAAME,SA+YnC2B,CAAsB7B,GAEtB7F,EAAQC,EAAMjC,MAEd,MAED,KAAKH,QAAMC,OAEV,GAAK+H,EAAM8B,SAAW9B,EAAM+B,SAAW/B,EAAMgC,SAAW,CAEvD,IAAyB,IAApBnI,EAAMzC,UAAsB,OAEjC+I,EAAoBH,GAEpB7F,EAAQC,EAAMhC,QAER,CAEN,IAA4B,IAAvByB,EAAM3C,aAAyB,OAEpC6I,EAAuBC,GAEvB7F,EAAQC,EAAMnC,OAIf,MAED,KAAKD,QAAMI,IAEV,GAAK4H,EAAM8B,SAAW9B,EAAM+B,SAAW/B,EAAMgC,SAAW,CAEvD,IAA4B,IAAvBnI,EAAM3C,aAAyB,OAEpC6I,EAAuBC,GAEvB7F,EAAQC,EAAMnC,WAER,CAEN,IAAyB,IAApB4B,EAAMzC,UAAsB,OAEjC+I,EAAoBH,GAEpB7F,EAAQC,EAAMhC,IAIf,MAED,QAEC+B,EAAQC,EAAMC,KAIXF,IAAUC,EAAMC,MAEpBR,EAAMI,cAAe7E,GApJrB6M,CAAajC,IAMf,SAASnD,EAAemD,IAEA,IAAlBnG,EAAM7D,UAEgB,UAAtBgK,EAAMuB,YAsSZ,SAAsBvB,GAIrB,OAFAwB,GAAcxB,GAEL7F,GAER,KAAKC,EAAM2C,aAEV,IAA4B,IAAvBlD,EAAM3C,aAAyB,OAEpC4J,EAAuBd,GAEvBnG,EAAMK,SAEN,MAED,KAAKE,EAAM4C,UAEV,IAAyB,IAApBnD,EAAMzC,UAAsB,OAEjC6J,EAAoBjB,GAEpBnG,EAAMK,SAEN,MAED,KAAKE,EAAM6C,gBAEV,IAA0B,IAArBpD,EAAM7C,aAA4C,IAApB6C,EAAMzC,UAAsB,QA7XlE,SAAkC4I,GAE5BnG,EAAM7C,YAAakK,EAAsBlB,GAEzCnG,EAAMzC,WAAY6J,EAAoBjB,GA2XzCkC,CAAyBlC,GAEzBnG,EAAMK,SAEN,MAED,KAAKE,EAAM8C,mBAEV,IAA0B,IAArBrD,EAAM7C,aAA+C,IAAvB6C,EAAM3C,aAAyB,QA/XrE,SAAqC8I,GAE/BnG,EAAM7C,YAAakK,EAAsBlB,GAEzCnG,EAAM3C,cAAe4J,EAAuBd,GA6X/CmC,CAA4BnC,GAE5BnG,EAAMK,SAEN,MAED,QAECC,EAAQC,EAAMC,MApVf+H,CAAapC,GA8If,SAAsBA,GAErB,IAAuB,IAAlBnG,EAAM7D,QAAoB,OAE/B,OAASmE,GAER,KAAKC,EAAMnC,OAEV,IAA4B,IAAvB4B,EAAM3C,aAAyB,QA7cvC,SAAgC8I,GAE/B1C,EAAUrB,IAAK+D,EAAMC,QAASD,EAAME,SAEpC3C,EAAYyD,WAAY1D,EAAWF,GAAcpB,eAAgBnC,EAAM1C,aAEvE,IAAM2H,EAAUjF,EAAMrE,WAEtB2F,EAAY,EAAIzE,KAAKC,GAAK4G,EAAYgD,EAAIzB,EAAQM,cAElDjB,EAAU,EAAIzH,KAAKC,GAAK4G,EAAYiD,EAAI1B,EAAQM,cAEhDhC,EAAYtD,KAAMwD,GAElBzD,EAAMK,SAicJmI,CAAuBrC,GAEvB,MAED,KAAK5F,EAAMjC,MAEV,IAA0B,IAArB0B,EAAM7C,WAAuB,QAncrC,SAA+BgJ,GAE9BpC,EAAS3B,IAAK+D,EAAMC,QAASD,EAAME,SAEnCrC,EAAWmD,WAAYpD,EAAUD,GAE5BE,EAAW2C,EAAI,EAEnBZ,EAAU5B,KAECH,EAAW2C,EAAI,GAE1BV,EAAS9B,KAIVL,EAAW7D,KAAM8D,GAEjB/D,EAAMK,SAmbJoI,CAAsBtC,GAEtB,MAED,KAAK5F,EAAMhC,IAEV,IAAyB,IAApByB,EAAMzC,UAAsB,QArbpC,SAA6B4I,GAE5BvC,EAAOxB,IAAK+D,EAAMC,QAASD,EAAME,SAEjCxC,EAASsD,WAAYvD,EAAQD,GAAWxB,eAAgBnC,EAAMxC,UAE9DsH,EAAKjB,EAAS6C,EAAG7C,EAAS8C,GAE1BhD,EAAS1D,KAAM2D,GAEf5D,EAAMK,SA6aJqI,CAAoBvC,IApKrBwC,CAAaxC,IAMf,SAASlD,EAAakD,IAEE,IAAlBnG,EAAM7D,UAENgK,EAAMuB,YAgVX1H,EAAMI,cAAe5E,GAErB8E,EAAQC,EAAMC,KAxUdoI,GAAezC,GAIU,IAApBlC,EAASmB,SAEbpF,EAAMrE,WAAWkN,sBAAuB1C,EAAMoB,WAE9CvH,EAAMrE,WAAWgH,oBAAqB,cAAeK,GACrDhD,EAAMrE,WAAWgH,oBAAqB,YAAaM,KAMrD,SAASH,EAAiBqD,GAEzByC,GAAezC,GAiJhB,SAASpD,EAAcoD,IAEC,IAAlBnG,EAAM7D,UAA0C,IAArB6D,EAAM7C,YAA0BmD,IAAUC,EAAMC,MAAQF,IAAUC,EAAMnC,SAExG+H,EAAM2C,iBAEN9I,EAAMI,cAAe7E,GA3btB,SAA2B4K,GAErBA,EAAMnB,OAAS,EAEnBiB,EAAS9B,KAEEgC,EAAMnB,OAAS,GAE1Be,EAAU5B,KAIXnE,EAAMK,SAibN0I,CAAkB5C,GAElBnG,EAAMI,cAAe5E,IAItB,SAASsE,EAAWqG,IAEI,IAAlBnG,EAAM7D,UAAyC,IAApB6D,EAAMzC,WArbvC,SAAwB4I,GAEvB,IAAI6C,GAAc,EAElB,OAAS7C,EAAM8C,MAEd,KAAKjJ,EAAMnC,KAAKE,GACf+G,EAAK,EAAG9E,EAAMtC,aACdsL,GAAc,EACd,MAED,KAAKhJ,EAAMnC,KAAKI,OACf6G,EAAK,GAAK9E,EAAMtC,aAChBsL,GAAc,EACd,MAED,KAAKhJ,EAAMnC,KAAKC,KACfgH,EAAK9E,EAAMtC,YAAa,GACxBsL,GAAc,EACd,MAED,KAAKhJ,EAAMnC,KAAKG,MACf8G,GAAO9E,EAAMtC,YAAa,GAC1BsL,GAAc,EAKXA,IAGJ7C,EAAM2C,iBAEN9I,EAAMK,UAsZP6I,CAAe/C,GAwJhB,SAASvD,EAAeuD,IAEA,IAAlBnG,EAAM7D,SAEXgK,EAAM2C,iBAUP,SAASF,GAAezC,UAEhBjC,EAAkBiC,EAAMoB,WAE/B,IAAM,IAAI4B,EAAI,EAAGA,EAAIlF,EAASmB,OAAQ+D,IAErC,GAAKlF,EAAUkF,GAAI5B,WAAapB,EAAMoB,UAGrC,YADAtD,EAASmF,OAAQD,EAAG,GASvB,SAASxB,GAAcxB,GAEtB,IAAInH,EAAWkF,EAAkBiC,EAAMoB,gBAErB3L,IAAboD,IAEJA,EAAW,IAAIwE,UACfU,EAAkBiC,EAAMoB,WAAcvI,GAIvCA,EAASoD,IAAK+D,EAAMK,MAAOL,EAAMM,OAIlC,SAASS,GAA0Bf,GAElC,IAAMkD,EAAYlD,EAAMoB,YAActD,EAAU,GAAIsD,UAActD,EAAU,GAAMA,EAAU,GAE5F,OAAOC,EAAkBmF,EAAQ9B,WAvsCD,OA6sCjCvH,EAAMrE,WAAWkE,iBAAkB,cAAe+C,GAElD5C,EAAMrE,WAAWkE,iBAAkB,cAAegD,GAClD7C,EAAMrE,WAAWkE,iBAAkB,gBAAiBiD,GACpD9C,EAAMrE,WAAWkE,iBAAkB,QAASkD,EAAc,CAAEuG,SAAS,IAIrE,EAAKjJ,SArtC4B,E,UAFPkJ,oB,sBCrB5B,qBAAE,WAEF,aAEA,IAAIC,EAA8E,qBAAnBC,EAAOC,QAElEC,EAAMH,EAAmBI,EAAQ,MAAWC,OAAOF,IACnDG,EAAWN,EAAmBI,EAAQ,MAAgBC,OAAOC,SAC7DC,EAAMP,EAAmBI,EAAQ,MAASG,IAAMF,OAAOE,IACvDC,EAAaR,EAAmBI,EAAQ,MAAyBC,OAAOG,WAExEC,EAAc,CAClB,UAAY,EACZ,QAAU,GAGV,SAASC,EAAYC,GACjB,OAAQA,GAASA,EAAMC,SAAWA,OAAUD,EAAQ,KAInCE,WACJC,SADjB,IAIIC,EAAeN,SAAmBP,IAAYA,IAAYA,EAAQc,SACpEd,OACA9N,EAGE6O,EAAcR,SAAmBR,IAAWA,IAAWA,EAAOe,SAChEf,OACA7N,EAQE8O,GALiBD,GAAcA,EAAWf,QAK7BQ,EAAYK,GAAeE,GAA+B,iBAAVE,GAAsBA,IAGnFC,EAAWV,EAAYD,SAAmBY,OAASA,MAGnDC,EAAaZ,EAAYD,SAAmBJ,SAAWA,QAGvDkB,EAAab,EAAYD,SAAmBvK,OAASA,MAQ9CgL,GACTI,KAAgBC,GAAcA,EAAWlB,SAAYiB,GACrDF,GAAYG,GAAcC,SAAS,cAATA,GA6D5B,SAASC,EAAKC,GACb,OAAOC,OAAO,UAAYD,GAAGE,OAAO,GA5D/B,OAAQvB,SACbA,OAAOwB,GAAK,cAGRC,kBAAkBC,UAAUC,QAChCpB,OAAOqB,eAAeH,kBAAkBC,UAAW,SAAU,CAC5DpB,MAAO,SAAUuB,EAAUpQ,EAAMqQ,GAM/B,IAJA,IAAIC,EAASC,KAAMnM,KAAKoM,UAAUxQ,EAAMqQ,GAASI,MAAM,KAAK,IACxDC,EAAMJ,EAAOxG,OACb6G,EAAM,IAAIC,WAAWF,GAEhB7C,EAAE,EAAGA,EAAE6C,EAAK7C,IACpB8C,EAAI9C,GAAKyC,EAAOO,WAAWhD,GAG5BuC,EAAU,IAAIU,KAAM,CAACH,GAAM,CAAC3Q,KAAMA,GAAQ,kBAiB9C,WAUE,GARI,gBAAiBuO,QAAU,IAC3BA,OAAOwC,YAAc,IAGzBC,KAAKC,IAAOD,KAAKC,KAAO,WACvB,OAAO,IAAID,MAAOE,WAGf,QAAS3C,OAAOwC,aAAe,EAAM,CAEvC,IAAII,EAAYH,KAAKC,MAEjBF,YAAYK,QAAUL,YAAYK,OAAOC,kBAC3CF,EAAYJ,YAAYK,OAAOC,iBAGjC9C,OAAOwC,YAAYE,IAAM,WACvB,OAAOD,KAAKC,MAAQE,IAnB1B,GA+BA,IAAIG,EAAc/C,OAAOyC,KAAKC,MAS9B,SAASM,EAAgBC,GAExB,IAAIC,EAAY,GAEhBrN,KAAKoN,SAAWA,EAEhBpN,KAAKsN,GAAK,SAAS7G,EAAO8G,GAEzBF,EAAU5G,GAAS8G,GAIpBvN,KAAKwN,KAAO,SAAS/G,GAEpB,IAAI8G,EAAUF,EAAU5G,GACpB8G,GAEHA,EAAQE,MAAM,KAAMC,MAAM7B,UAAUH,MAAMiC,KAAKC,UAAW,KAM5D5N,KAAK6N,SAAWT,EAASU,MA9B1B,WACC,SAASC,IACR,OAAO5Q,KAAK6Q,MAA4B,OAArB,EAAI7Q,KAAK8Q,WAAqBC,SAAS,IAAIC,UAAU,GAEzE,OAAOJ,IAAOA,IAAO,IAAMA,IAAO,IAAMA,IAAO,IAAMA,IAAO,IAAMA,IAAOA,IAAOA,IA0B/CK,GACjCpO,KAAKqO,UAAY,GACjBrO,KAAKsO,SAAW,GAYjB,SAASC,EAAcnB,GAErBD,EAAeQ,KAAM3N,KAAMoN,GAE3BpN,KAAKqO,UAAY,OACjBrO,KAAKsO,SAAW,oBAChBtO,KAAKwO,cAAgB,GACrBxO,KAAKyO,aAAezO,KAAK6N,SAEzB7N,KAAK0O,KAAO,KACZ1O,KAAK2O,MAAQ,EACb3O,KAAK4O,KAAO,EACZ5O,KAAK6O,OAAS,EAsDhB,SAASC,EAAc1B,GAEtBmB,EAAaZ,KAAM3N,KAAMoN,GAEzBpN,KAAKpE,KAAO,YACZoE,KAAKwO,cAAgB,OActB,SAASO,EAAe3B,GAEvBmB,EAAaZ,KAAM3N,KAAMoN,GAEzBpN,KAAKpE,KAAO,aACZoE,KAAKwO,cAAgB,OACrBxO,KAAKiM,QAAYmB,EAASnB,QAAU,KAAS,GAoB9C,SAAS+C,EAAe5B,GAG+B,eADzC/Q,SAAS4S,cAAe,UAC1B7C,UAAW,cAAe8C,OAAO,EAAE,KAC7C/S,QAAQgT,IAAK,kDAGdhC,EAAeQ,KAAM3N,KAAMoN,GAE3BpN,KAAKiM,QAAYmB,EAASnB,QAAU,KAAS,GAE7CjM,KAAKqO,UAAY,QACjBrO,KAAKsO,SAAW,aAChBtO,KAAKyO,aAAezO,KAAK6N,SACxB7N,KAAKoP,UAAYhC,EAASgC,UAE3BpP,KAAK6O,OAAS,EACd7O,KAAK4O,KAAO,EAEX5O,KAAKqP,YAAc,IAAI/E,EAAW,CAChC2B,QAASjM,KAAKiM,QACdqD,WAAY,KACZC,GAAI,KACJC,UAAWxP,KAAKoP,YAmDpB,SAASK,EAAuBrC,GAE/BD,EAAeQ,KAAM3N,KAAMoN,GAE3BA,EAASnB,QAAYmB,EAASnB,QAAU,KAAS,GAEjDjM,KAAK0P,QAAU,IAAIC,aAAaC,MAAOxC,GACpCpN,KAAK0P,QAAQpC,GAAI,UAAW,WACxBtN,KAAKwN,KAAM,YACbqC,KAAM7P,OACRA,KAAK0P,QAAQpC,GAAG,WAAY,SAAUwC,EAAKC,GACvC,IAAIC,EAAKhQ,KAAKgM,SACTgE,IACDhQ,KAAKgM,cAAW9P,EAChB8T,EAAIF,EAAKC,KAEfF,KAAM7P,OACRA,KAAK0P,QAAQpC,GAAI,WAAY,SAAU2C,GAC9BjQ,KAAKoN,SAAS8C,YACflQ,KAAKoN,SAAS8C,WAAYD,IAEhCJ,KAAM7P,OACRA,KAAK0P,QAAQpC,GAAI,QAAS,SAAU6C,GAChCC,MAAMC,KAAKC,UAAUH,EAAM,KAAM,KACnCN,KAAM7P,OAiCZ,SAASuQ,EAAiBnD,GAEzBD,EAAeQ,KAAM3N,KAAMoN,GAE3BpN,KAAKoP,UAAYpP,KAAKoN,SAASgC,UAC/BpP,KAAKpE,KAAO,aACZoE,KAAKqO,UAAY,QACjBrO,KAAKwQ,OAAS,KACdxQ,KAAKyQ,cAAgB,KACrBzQ,KAAK0Q,OAAS,GAmCf,SAASC,EAAcvD,GACtBD,EAAeQ,KAAM3N,KAAMoN,GAE3BA,EAASnB,QAAU,IAA4B,GAAnBmB,EAASnB,QAAe,KAAS,IAC7DmB,EAASwD,QAAUxD,EAASwD,SAAW,EAEvC5Q,KAAKqO,UAAY,OACjBrO,KAAKsO,SAAW,YAEdtO,KAAK6Q,OAASxU,SAAS4S,cAAe,UACtCjP,KAAK8Q,IAAM9Q,KAAK6Q,OAAOE,WAAY,MACnC/Q,KAAKgR,SAAU,EAEjB,IACIC,EAAa,IAAIvE,KAAK,CADN,0gSACuB,CAC1C9Q,KAAM,2BAEHsV,EAAeC,IAAIC,gBAAgBH,GAErCjR,KAAK0P,QAAU,IAAIrF,EAAI,CACxBuG,QAASxD,EAASwD,QAClB3E,QAASmB,EAASnB,QAClBiF,aAAcA,IAGZlR,KAAK0P,QAAQpC,GAAI,WAAY,SAAU2C,GAC9BjQ,KAAKoN,SAAS8C,YACflQ,KAAKoN,SAAS8C,WAAYD,IAEhCJ,KAAM7P,OAERA,KAAK0P,QAAQpC,GAAG,WAAY,SAAU+D,GAClC,IAAIrB,EAAKhQ,KAAKgM,SACTgE,IACDhQ,KAAKgM,cAAW9P,EAChB8T,EAAIqB,KAEVxB,KAAM7P,OAoCZ,SAASsR,EAAUlE,GAElB,IAECmE,EAEAC,EACAC,EACAC,EACAC,EACAC,EACMC,EATHC,EAAY1E,GAAY,GAU3B2E,GATQ,IAAInF,KASA,IACZoF,EAAa,GACbC,EAAc,EACdC,EAA0B,EAE1BC,EAAkC,GAClCC,GAAa,EACP/E,EAAY,GAEnByE,EAAU1C,UAAY0C,EAAU1C,WAAa,GAC7C0C,EAAUO,iBAAmB,GAAMP,EAAUO,kBAAoB,GACjEd,EAAWO,EAAUQ,UAAW,EACrBR,EAAUS,QACrBT,EAAUU,KAAO,IAASV,EAAU1C,UACpC0C,EAAUW,UAAYX,EAAUW,WAAa,EAC7CX,EAAUY,WAAaZ,EAAUY,YAAc,EAC/CZ,EAAUa,UAAYb,EAAUa,WAAa,EAE7C,IAAIC,EAAevW,SAAS4S,cAAe,OAC3C2D,EAAarW,MAAM+C,SAAW,WAC9BsT,EAAarW,MAAM0J,KAAO2M,EAAarW,MAAM4J,IAAM,EACnDyM,EAAarW,MAAMsW,gBAAkB,QACrCD,EAAarW,MAAMuW,WAAa,YAChCF,EAAarW,MAAMwW,SAAW,OAC9BH,EAAarW,MAAMyW,QAAU,MAC7BJ,EAAarW,MAAM0W,MAAQ,MAC3BL,EAAarW,MAAM2W,OAAS,IACxBpB,EAAUS,SAAUlW,SAAS8W,KAAKC,YAAaR,GAEnD,IAEIS,EACAC,EAHAC,EAAmBlX,SAAS4S,cAAe,UAC3CuE,EAAgBD,EAAiBxC,WAAY,MAIjD0C,EAAM,kBAAoB3B,EAAUU,KAAO,MAExC,IAAIkB,EAAY,CAClBC,IAAKhD,EACLiD,KAAM5E,EACN6E,aAAcpE,EACdqE,IAAKhF,EACLiF,IAAKhF,EACL,qBAAsBwB,GAGhByD,EAAON,EAAW5B,EAAUmC,QAChC,IAAMD,EACR,KAAM,yDAA2DtJ,OAAOvM,KAAKuV,GAAWQ,KAAK,MAgB9F,IAdGrC,EAAW,IAAImC,EAAMlC,IACZU,KAAOZ,EAEnBC,EAASvE,GAAG,UAAW6G,GACpBtC,EAASvE,GAAG,YAiTZ,SAAoB2C,IAXpB,SAAgBxJ,GAEZ,IAAI8G,EAAUF,EAAU5G,GACnB8G,GAEDA,EAAQE,MAAO,KAAMC,MAAM7B,UAAUH,MAAMiC,KAAMC,UAAW,IAQhEwG,CAAO,WAAYnE,MAjTnB,gBAAiB9F,QAAU,IAC9BA,OAAOwC,YAAc,IAGzBC,KAAKC,IAAOD,KAAKC,KAAO,WACvB,OAAO,IAAID,MAAOE,WAGf,QAAS3C,OAAOwC,aAAe,EAAM,CAExC,IAAII,EAAYH,KAAKC,MAEjBF,YAAYK,QAAUL,YAAYK,OAAOC,kBAC5CF,EAAYJ,YAAYK,OAAOC,iBAGhC9C,OAAOwC,YAAYE,IAAM,WACxB,OAAOD,KAAKC,MAAQE,GAItB,IAAIsH,EAAiBlK,OAAOmK,WAC3BC,EAAkBpK,OAAOqK,YACrBC,EAAoBtK,OAAOuK,cAC/BC,EAAmBxK,OAAOyK,aAC1BC,EAA4B1K,OAAO2K,sBACnCC,EAAU5K,OAAOyC,KAAKC,IACtBmI,EAAqB7K,OAAOwC,YAAYE,IACxCoI,EAAc9K,OAAOyC,KAAKf,UAAUiB,QAGjCoI,EAAQ,GAmFZ,SAASC,IACR/C,GAAa,EACbP,EAASuD,OAcT3B,EAAM,iBACNtJ,OAAOmK,WAAaD,EACpBlK,OAAOqK,YAAcD,EACrBpK,OAAOuK,cAAgBD,EACvBtK,OAAOyK,aAAeD,EACtBxK,OAAO2K,sBAAwBD,EAC/B1K,OAAOyC,KAAKf,UAAUiB,QAAUmI,EAChC9K,OAAOyC,KAAKC,IAAMkI,EAClB5K,OAAOwC,YAAYE,IAAMmI,EAlB1B,SAASK,EAAOC,EAAIC,GACnBlB,EAAgBiB,EAAI,EAAGC,GAGxB,SAAS3D,IAERyD,EAAOlB,GAwGR,SAASA,IAER,IAAI3B,EAAO,IAAOV,EAAU1C,UACxBoG,GAAOvD,EAAcC,EAA0BJ,EAAUO,kBAAqBG,EAElFhB,EAAQC,EAAa+D,EACrB9D,EAAmBC,EAAwB6D,EAE3CN,EAAMO,SAAS,SAAU3Q,GACxBA,EAAE4Q,YAAcF,EAAK,OAlGvB,WACC,IAAIG,EAAU1D,EAAcH,EAAU1C,WAChC0C,EAAUY,YAAcT,GAAeH,EAAUY,YAAkBZ,EAAUW,WAAakD,GAAW7D,EAAUW,aACpH0C,IACAS,KAED,IAAIC,EAAI,IAAIjJ,KAAM,MAClBiJ,EAAEC,WAAYH,GACV7D,EAAUO,iBAAmB,EAChCO,EAAamD,YAAc,YAAcjE,EAAUmC,OAAS,MAAQhC,EAAc,YAAcC,EAA0B,aAAgB2D,EAAEG,cAAc9G,OAAQ,GAAI,GAEtK0D,EAAamD,YAAc,YAAcjE,EAAUmC,OAAS,MAAQhC,EAAc,aAAgB4D,EAAEG,cAAc9G,OAAQ,GAAI,GA0F/H+G,GACAxC,EAAM,UAAYxB,EAAc,IAAMC,GAEtC,IAAK,IAAIgE,EAAI,EAAGA,EAAInE,EAAUrM,OAAQwQ,IACjC1E,GAASO,EAAWmE,GAAIC,cAC3Bd,EAAOtD,EAAWmE,GAAIlK,UAEtB+F,EAAUrI,OAAQwM,EAAG,IAKvB,IAASA,EAAI,EAAGA,EAAIlE,EAAWtM,OAAQwQ,IAClC1E,GAASQ,EAAYkE,GAAIC,cAC5Bd,EAAOrD,EAAYkE,GAAIlK,UACvBgG,EAAYkE,GAAIC,aAAenE,EAAYkE,GAAIE,MAMjDjE,EAAgCsD,SAAS,SAAUzF,GAC9CqF,EAAOrF,EAAIwB,EAAQtE,MAElBiF,EAAkC,GAIzC,SAASyD,EAAO5J,GAEVA,IACJA,EAAW,SAAUqF,GAEpB,OADAjH,EAAUiH,EAAMQ,EAAShE,SAAWgE,EAASxD,UAAWwD,EAASvD,WAC1D,IAGTuD,EAASwE,KAAMrK,GAIhB,SAASyH,EAAM6C,GACV/E,GAAWpV,QAAQgT,IAAKmH,GA0B7B,MAAO,CACNC,MA1MD,YA3EA,WAwDC,SAASC,IAOR,OANKxW,KAAKyW,UACTzW,KAAKyW,SAAU,EACfzW,KAAK0V,YAAc1V,KAAK0W,aAAe,EACvC1W,KAAK2W,QACLzB,EAAMpN,KAAM9H,OAENA,KAAK0V,YAAc5D,EAAUa,UA7DrCc,EAAM,kBAENhC,EAAatH,OAAOyC,KAAKC,MACzB2E,EAAQC,EAAaK,EAAUa,UAC/BhB,EAAwBxH,OAAOwC,YAAYE,MAC3C6E,EAAmBC,EAAwBG,EAAUa,UAErDxI,OAAOyC,KAAKf,UAAUiB,QAAU,WAC/B,OAAO0E,GAERrH,OAAOyC,KAAKC,IAAM,WACjB,OAAO2E,GAGRrH,OAAOmK,WAAa,SAAUtI,EAAUoK,GACvC,IAAIQ,EAAI,CACP5K,SAAUA,EACVoK,KAAMA,EACND,YAAa3E,EAAQ4E,GAIb,OAFTrE,EAAUjK,KAAM8O,GAChBnD,EAAM,kBAAoBmD,EAAER,MACZQ,GAEjBzM,OAAOyK,aAAe,SAAUiC,GAC/B,IAAK,IAAIX,EAAI,EAAGA,EAAInE,EAAUrM,OAAQwQ,IACjCnE,EAAWmE,IAAOW,IACrB9E,EAAUrI,OAAQwM,EAAG,GACrBzC,EAAM,qBAKTtJ,OAAOqK,YAAc,SAAUxI,EAAUoK,GACxC,IAAIQ,EAAI,CACP5K,SAAUA,EACVoK,KAAMA,EACND,YAAa3E,EAAQ4E,GAItB,OAFApE,EAAWlK,KAAM8O,GACjBnD,EAAM,mBAAqBmD,EAAER,MACtBQ,GAERzM,OAAOuK,cAAgB,SAAUmC,GAEhC,OADApD,EAAM,kBACC,MAERtJ,OAAO2K,sBAAwB,SAAU9I,GACxCmG,EAAgCrK,KAAMkE,IAEvC7B,OAAOwC,YAAYE,IAAM,WACxB,OAAO6E,GAaR,IACChH,OAAOqB,eAAgB+K,iBAAiBjL,UAAW,cAAe,CAAEkL,IAAKP,IACzE9L,OAAOqB,eAAgBiL,iBAAiBnL,UAAW,cAAe,CAAEkL,IAAKP,IACxE,MAAOS,GACRxD,EAAKwD,IAMNC,GACArF,EAAS0E,QACTnE,GAAa,GAwMb+E,QA1GD,SAAmBtG,GAEduB,IAECN,EAAUO,iBAAmB,GArDnC,SAAsBxB,GAEjB0C,EAAiB6D,QAAUvG,EAAOuG,OAAS7D,EAAiB8D,SAAWxG,EAAOwG,SACjF9D,EAAiB6D,MAAQvG,EAAOuG,MAChC7D,EAAiB8D,OAASxG,EAAOwG,OACjChE,EAAmB,IAAIiE,YAAa/D,EAAiB8D,OAAS9D,EAAiB6D,MAAQ,GACvF5D,EAAc+D,UAAY,KAC1B/D,EAAcgE,SAAU,EAAG,EAAGjE,EAAiB6D,MAAO7D,EAAiB8D,SAgDtEI,CAAa5G,GA3ChB,SAAsBA,GAIrB2C,EAAckE,UAAW7G,EAAQ,EAAG,GACpCyC,EAAYE,EAAcmE,aAAc,EAAG,EAAGpE,EAAiB6D,MAAO7D,EAAiB8D,QACvF,IAAK,IAAInB,EAAI,EAAGA,EAAI7C,EAAiB3N,OAAQwQ,GAAI,EAChD7C,EAAkB6C,IAAO5C,EAAUnD,KAAM+F,GACzC7C,EAAkB6C,EAAI,IAAO5C,EAAUnD,KAAM+F,EAAI,GACjD7C,EAAkB6C,EAAI,IAAO5C,EAAUnD,KAAM+F,EAAI,GAElDhE,IAiCE0F,CAAa/G,GAETqB,GAA2B,GAAKJ,EAAUO,iBA/BjD,WAGC,IADA,IAAIlC,EAAOmD,EAAUnD,KACZ+F,EAAI,EAAGA,EAAI7C,EAAiB3N,OAAQwQ,GAAI,EAChD/F,EAAM+F,GAA8B,EAAxB7C,EAAkB6C,GAAUpE,EAAUO,iBAClDlC,EAAM+F,EAAI,GAAkC,EAA5B7C,EAAkB6C,EAAI,GAAUpE,EAAUO,iBAC1DlC,EAAM+F,EAAI,GAAkC,EAA5B7C,EAAkB6C,EAAI,GAAUpE,EAAUO,iBAO3D,IALAmB,EAAcqE,aAAcvE,EAAW,EAAG,GAC1CzB,EAASvP,IAAKiR,GACdtB,IACAC,EAA0B,EAC1BuB,EAAM,kBAAoBxB,EAAc,IAAOT,GACtC0E,EAAI,EAAGA,EAAI7C,EAAiB3N,OAAQwQ,GAAI,EAChD7C,EAAkB6C,GAAM,EACxB7C,EAAkB6C,EAAI,GAAM,EAC5B7C,EAAkB6C,EAAI,GAAM,EAE7BvK,KAcGmM,GAEAlG,MAIDC,EAASvP,IAAKuO,GAEd4C,EAAM,kBADNxB,MA0FFmD,KAAMD,EACNkB,KAAMT,EACAtI,GA5BJ,SAAc7G,EAAO8G,GAEjBF,EAAU5G,GAAS8G,IAltB3BJ,EAAetB,UAAU0K,MAAQ,aACjCpJ,EAAetB,UAAUuJ,KAAO,aAChCjI,EAAetB,UAAUvJ,IAAM,aAC/B6K,EAAetB,UAAUwK,KAAO,aAChClJ,EAAetB,UAAU7I,QAAU,aACnCmK,EAAetB,UAAUkM,cAAgB,WAAY,OAAO,GAC5D5K,EAAetB,UAAU2G,KAAO,WAAarW,QAAQgT,IAAK,kBAkB1DZ,EAAa1C,UAAYnB,OAAOsN,OAAQ7K,EAAetB,WAEvD0C,EAAa1C,UAAU0K,MAAQ,WAE7BvW,KAAKgD,WAIPuL,EAAa1C,UAAUvJ,IAAM,SAAU+O,GAErC,IAAI4G,EAAa,IAAIC,WACrBD,EAAWE,OAAS,WAClBnY,KAAK0O,KAAK0J,OAAQ7M,EAAKvL,KAAK2O,OAAU3O,KAAKwO,cAAe,IAAIhC,WAAYyL,EAAWI,SAEjFrY,KAAKoN,SAASkL,aAAe,GAAOtY,KAAK6O,OAAS7O,KAAKoN,SAASgC,WAAepP,KAAKoN,SAASkL,aAC/FtY,KAAKqW,KAAM,SAAUhF,GACnBrR,KAAK6N,SAAW7N,KAAKyO,aAAe,SAAWlD,EAAKvL,KAAK4O,MACzDxE,EAAUiH,EAAMrR,KAAK6N,SAAW7N,KAAKqO,UAAWrO,KAAKsO,UACrD,IAAIK,EAAQ3O,KAAK2O,MACjB3O,KAAKgD,UACLhD,KAAK2O,MAAQA,EAAM,EACnB3O,KAAK4O,OACL5O,KAAK6N,SAAW7N,KAAKyO,aAAe,SAAWlD,EAAKvL,KAAK4O,MACzD5O,KAAK6O,OAAS,EACd7O,KAAKwS,QACL3C,KAAM7P,QAERA,KAAK2O,QACL3O,KAAK6O,SACL7O,KAAKwS,SAGP3C,KAAM7P,MACRiY,EAAWM,kBAAkBlH,IAI/B9C,EAAa1C,UAAUwK,KAAO,SAAUrK,GAEtCA,EAAUhM,KAAK0O,KAAK2H,SAItB9H,EAAa1C,UAAU7I,QAAU,WAE/BhD,KAAK0O,KAAO,IAAIzE,EAChBjK,KAAK2O,MAAQ,GAafG,EAAajD,UAAYnB,OAAOsN,OAAQzJ,EAAa1C,WAErDiD,EAAajD,UAAUvJ,IAAM,SAAUuO,GAEtCA,EAAO/E,OAAQ,SAAUuF,GACxB9C,EAAa1C,UAAUvJ,IAAIqL,KAAM3N,KAAMqR,IACtCxB,KAAM7P,MAAQA,KAAKpE,OActBmT,EAAclD,UAAYnB,OAAOsN,OAAQzJ,EAAa1C,WAEtDkD,EAAclD,UAAUvJ,IAAM,SAAUuO,GAEvCA,EAAO/E,OAAQ,SAAUuF,GACxB9C,EAAa1C,UAAUvJ,IAAIqL,KAAM3N,KAAMqR,IACtCxB,KAAM7P,MAAQA,KAAKpE,KAAMoE,KAAKiM,UAsCjC+C,EAAcnD,UAAYnB,OAAOsN,OAAQ7K,EAAetB,WAExDmD,EAAcnD,UAAU0K,MAAQ,SAAU1F,GAEzC7Q,KAAKgD,WAINgM,EAAcnD,UAAUvJ,IAAM,SAAUuO,GAEtC7Q,KAAKqP,YAAYmJ,SAAS3H,GAEvB7Q,KAAKoN,SAASkL,aAAe,GAAOtY,KAAK6O,OAAS7O,KAAKoN,SAASgC,WAAepP,KAAKoN,SAASkL,aAChGtY,KAAKqW,KAAM,SAAUhF,GACpBrR,KAAK6N,SAAW7N,KAAKyO,aAAe,SAAWlD,EAAKvL,KAAK4O,MACzDxE,EAAUiH,EAAMrR,KAAK6N,SAAW7N,KAAKqO,UAAWrO,KAAKsO,UACrDtO,KAAKgD,UACLhD,KAAK4O,OACL5O,KAAK6N,SAAW7N,KAAKyO,aAAe,SAAWlD,EAAKvL,KAAK4O,MACzD5O,KAAKwS,QACJ3C,KAAM7P,QAENA,KAAK6O,SACP7O,KAAKwS,SAKPxD,EAAcnD,UAAUwK,KAAO,SAAUrK,GAEvChM,KAAKqP,YAAYoJ,WAAWC,KAAK1M,IAInCgD,EAAcnD,UAAU7I,QAAU,SAAU6N,GAE3C7Q,KAAK6O,OAAS,EACb7O,KAAKqP,YAAc,IAAI/E,EAAW,CAChC2B,QAASjM,KAAKiM,QACdqD,WAAY,KACZC,GAAI,KACJC,UAAWxP,KAAKoP,aAiCpBK,EAAsB5D,UAAYnB,OAAOsN,OAAQ7K,EAAetB,WAEhE4D,EAAsB5D,UAAU0K,MAAQ,WAEvCvW,KAAK0P,QAAQ6G,MAAOvW,KAAKoN,WAI1BqC,EAAsB5D,UAAUvJ,IAAM,SAAUuO,GAE/C7Q,KAAK0P,QAAQpN,IAAKuO,IAInBpB,EAAsB5D,UAAUwK,KAAO,SAAUrK,GAE7ChM,KAAKgM,SAAWA,EAChBhM,KAAK0P,QAAQiJ,OAIjBlJ,EAAsB5D,UAAUkM,cAAgB,WAC5C,OAAO/X,KAAK0P,QAAQqI,iBAoBxBxH,EAAgB1E,UAAYnB,OAAOsN,OAAQ7K,EAAetB,WAE1D0E,EAAgB1E,UAAUvJ,IAAM,SAAUuO,GAEpC7Q,KAAKwQ,SACTxQ,KAAKwQ,OAASK,EAAO+H,cAAe5Y,KAAKoP,WACzCpP,KAAKyQ,cAAgB,IAAIoI,cAAe7Y,KAAKwQ,QAC7CxQ,KAAKyQ,cAAc8F,QAEnBvW,KAAKyQ,cAAcqI,gBAAkB,SAASC,GAC7C/Y,KAAK0Q,OAAO5I,KAAKiR,EAAE5I,OAClBN,KAAM7P,OAGTA,KAAKwS,QAINjC,EAAgB1E,UAAUwK,KAAO,SAAUrK,GAE1ChM,KAAKyQ,cAAcuI,OAAS,SAAUD,GACrC,IAAI1H,EAAO,IAAI3E,KAAM1M,KAAK0Q,OAAQ,CAAE,KAAS,eAC7C1Q,KAAK0Q,OAAS,GACd1E,EAAUqF,IAETxB,KAAM7P,MAERA,KAAKyQ,cAAc2E,QA4CpBzE,EAAa9E,UAAYnB,OAAOsN,OAAQ7K,EAAetB,WAEvD8E,EAAa9E,UAAUvJ,IAAM,SAAUuO,GAEjC7Q,KAAKgR,UACThR,KAAK0P,QAAQuJ,UAAW,QAAQpI,EAAOuG,OACvCpX,KAAK0P,QAAQuJ,UAAW,SAASpI,EAAOwG,QACxCrX,KAAKgR,SAAU,GAGhBhR,KAAK6Q,OAAOuG,MAAQvG,EAAOuG,MAC3BpX,KAAK6Q,OAAOwG,OAASxG,EAAOwG,OAC5BrX,KAAK8Q,IAAI4G,UAAW7G,EAAQ,EAAG,GAE/B7Q,KAAK0P,QAAQ8I,SAAUxY,KAAK8Q,IAAK,CAAEvQ,MAAM,EAAM2Y,MAAOlZ,KAAKoN,SAASoF,OACpExS,KAAKwS,QAUN7B,EAAa9E,UAAUwK,KAAO,SAAUrK,GAEpChM,KAAKgM,SAAWA,EAEnBhM,KAAK0P,QAAQyJ,WAqYb/N,GAAcF,GAAY,IAAIoG,SAAWA,OAMhC,KAAN8H,aACC,OAAO9H,GADF,8BAz5BR,K,uECAD,WACA,aAEA,IAAI+H,EAAS,CACX,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACnC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAErC,SAASC,EAAM5T,GACd,IAAI+D,EAAG8P,EAAS,IAAI/M,WAAW9G,GAC/B,IAAK+D,EAAI,EAAGA,EAAI/D,EAAQ+D,GAAK,EAC5B8P,EAAO9P,GAAK,EAEb,OAAO8P,EA8DRpP,OAAOqP,MAAQ,GACfrP,OAAOqP,MAAMF,MAAQA,EACrBnP,OAAOqP,MAAMjO,IApDb,SAAakO,EAAKC,EAAOC,GAExB,OADAF,EAAMA,EAAIvL,SAASyL,GAAQ,GACpB,eAAezK,OAAOuK,EAAI/T,OAAS,GAAKgU,GAASD,GAmDzDtP,OAAOqP,MAAMI,OA9Db,SAAgBC,EAAMnU,EAAQoU,EAAWC,GACxC,IACCR,EAASD,GAAO1O,UADHlF,EAASoU,GACaC,GAAc,GAAKA,GAIvD,OAFAR,EAAO7W,IAAImX,GAEJN,GAyDRpP,OAAOqP,MAAMQ,cAjDb,SAAwBC,EAAOC,EAAKnZ,GACnC,IAAI0I,EAAG/D,EAKP,IAHAwU,EAAMA,GAAOZ,EAAMW,EAAMvU,QAEzB3E,EAASA,GAAU,EACd0I,EAAI,EAAG/D,EAASuU,EAAMvU,OAAQ+D,EAAI/D,EAAQ+D,GAAK,EACnDyQ,EAAInZ,GAAUkZ,EAAMxN,WAAWhD,GAC/B1I,GAAU,EAGX,OAAOmZ,GAuCR/P,OAAOqP,MAAMW,cApCb,SAAuBC,GACtB,IAAI3Q,EAGH4Q,EAAM3U,EAEmB+T,EAJzBa,EAAaF,EAAM1U,OAAS,EAC5B6U,EAAS,GAQV,IAAK9Q,EAAI,EAAG/D,EAAS0U,EAAM1U,OAAS4U,EAAY7Q,EAAI/D,EAAQ+D,GAAK,EAChE4Q,GAAQD,EAAM3Q,IAAM,KAAO2Q,EAAM3Q,EAAI,IAAM,GAAM2Q,EAAM3Q,EAAI,GAC3D8Q,GANOlB,GADkBI,EAOCY,IANL,GAAK,IAAQhB,EAAOI,GAAO,GAAK,IAAQJ,EAAOI,GAAO,EAAI,IAAQJ,EAAa,GAANI,GAU/F,OAAQc,EAAO7U,OAAS,GACvB,KAAK,EACJ6U,GAAU,IACV,MACD,KAAK,EACJA,GAAU,KAMZ,OAAOA,GA7ER,GAwFA,WACA,aAwBA,IACCC,EADGhB,EAAQrP,OAAOqP,MAGnBgB,EAAe,CACd,CACC,MAAS,WACT,OAAU,KAEX,CACC,MAAS,WACT,OAAU,GAEX,CACC,MAAS,MACT,OAAU,GAEX,CACC,MAAS,MACT,OAAU,GAEX,CACC,MAAS,WACT,OAAU,IAEX,CACC,MAAS,QACT,OAAU,IAEX,CACC,MAAS,WACT,OAAU,GAEX,CACC,MAAS,OACT,OAAU,GAEX,CACC,MAAS,WACT,OAAU,KAEX,CACC,MAAS,QACT,OAAU,GAEX,CACC,MAAS,QACT,OAAU,IAEX,CACC,MAAS,QACT,OAAU,IAEX,CACC,MAAS,cACT,OAAU,GAEX,CACC,MAAS,cACT,OAAU,GAEX,CACC,MAAS,iBACT,OAAU,KAEX,CACC,MAAS,UACT,OAAU,KA0BZrQ,OAAOsQ,OAAS,GAChBtQ,OAAOsQ,OAAOC,UAAYF,EAC1BrQ,OAAOsQ,OAAOxG,OAxBd,SAAsB9D,EAAMH,GAC3B,IAAIuJ,EAASC,EAAMF,MAAM,KACxBvY,EAAS,EAcV,OAZAyZ,EAAa/E,SAAQ,SAAUhL,GAC9B,IACChB,EAAG/D,EADAiV,EAAMxK,EAAK1F,EAAMmQ,QAAU,GAG/B,IAAKnR,EAAI,EAAG/D,EAASiV,EAAIjV,OAAQ+D,EAAI/D,EAAQ+D,GAAK,EACjD8P,EAAOxY,GAAU4Z,EAAIlO,WAAWhD,GAChC1I,GAAU,EAGXA,GAAU0J,EAAM/E,OAAS+D,KAGR,oBAAPuG,EACHA,EAAGuJ,EAAQxY,GAEZwY,GAlHR,GA0HA,WACA,aAEA,IAGCsB,EAHGJ,EAAStQ,OAAOsQ,OACnBjB,EAAQrP,OAAOqP,MACfsB,EAAa,IAGd,SAAS7Q,EAAI8Q,GACZ/a,KAAKgb,QAAU,EACfH,GAAaE,GAAmB,IAAMD,EACtC9a,KAAKka,IAAMV,EAAMF,MAAMuB,GACvB7a,KAAKib,OAAS,GACdjb,KAAK0F,OAAS,EAGfuE,EAAI4B,UAAUuM,OAAS,SAAU8C,EAAUjB,EAAOkB,EAAMnP,GACvD,IAAImE,EACHiL,EACAC,EACAC,EACAC,EACAC,EACAC,EAED,GAAqB,kBAAVxB,EACVA,EAAQT,EAAMQ,cAAcC,QACtB,GAAIA,EAAMyB,cAAgBlP,WAAWX,UAAU6P,YACrD,KAAM,oCAAsCzB,EAAMyB,YAAYxN,WAAWyN,MAAM,6CAA6C,GAGzG,oBAATR,IACCA,EACXA,EAAO,IAKRE,GAFAF,EAAOA,GAAQ,IAEHE,MAA6B,KAArBzQ,SAAS,MAAO,GACpC0Q,EAAQH,EAAKG,OAASne,KAAK6Q,OAAO,IAAIpB,KAAS,KAC/C2O,EAAMJ,EAAKI,KAAO,EAClBC,EAAML,EAAKK,KAAO,EAElBrL,EAAO,CACNyL,SAAUV,EACVW,SAAUrC,EAAMjO,IAAI8P,EAAM,GAC1BE,IAAK/B,EAAMjO,IAAIgQ,EAAK,GACpBC,IAAKhC,EAAMjO,IAAIiQ,EAAK,GACpBM,SAAUtC,EAAMjO,IAAI0O,EAAMvU,OAAQ,IAClC4V,MAAO9B,EAAMjO,IAAI+P,EAAO,IACxBF,SAAU,WACVxf,KAAM,IACNmgB,MAAO,UACPC,MAAOb,EAAKa,OAAS,GACrBC,MAAOd,EAAKc,OAAS,IAItBb,EAAW,EACX1Q,OAAOvM,KAAKgS,GAAMsF,SAAQ,SAAUyG,GACnC,IAAIzS,EAAsB/D,EAAnB+E,EAAQ0F,EAAK+L,GAEpB,IAAKzS,EAAI,EAAG/D,EAAS+E,EAAM/E,OAAQ+D,EAAI/D,EAAQ+D,GAAK,EACnD2R,GAAY3Q,EAAMgC,WAAWhD,MAI/B0G,EAAKiL,SAAW5B,EAAMjO,IAAI6P,EAAU,GAAK,MAEzCK,EAAYhB,EAAOxG,OAAO9D,GAE1B,IAAIgM,EAAehf,KAAKif,KAAMX,EAAU/V,OAASoV,GAAeA,EAC5DuB,EAAclf,KAAKif,KAAMnC,EAAMvU,OAASoV,GAAeA,EAE3D9a,KAAKib,OAAOnT,KAAM,CAAE2S,OAAQgB,EAAWxB,MAAOA,EAAOkC,aAAcA,EAAcE,YAAaA,KAI/FpS,EAAI4B,UAAUwK,KAAO,WAEpB,IAAIiG,EAAU,GACV5L,EAAS,GACThL,EAAS,EACT3D,EAAM5E,KAAKuH,IAAK,EAAG,IAEnB6X,EAAQ,GA4BZ,OA3BAvc,KAAKib,OAAOxF,SAAS,SAAU+G,GAC1B9W,EAAS8W,EAAEL,aAAeK,EAAEH,YAActa,IAC7C2O,EAAO5I,KAAM,CAAEmT,OAAQsB,EAAO7W,OAAQA,IACtC6W,EAAQ,GACR7W,EAAS,GAEV6W,EAAMzU,KAAM0U,GACZ9W,GAAU8W,EAAEL,aAAeK,EAAEH,eAE9B3L,EAAO5I,KAAM,CAAEmT,OAAQsB,EAAO7W,OAAQA,IAEtCgL,EAAO+E,SAAS,SAAUgH,GAEzB,IAAIlD,EAAS,IAAI/M,WAAYiQ,EAAE/W,QAC3BsV,EAAU,EACdyB,EAAExB,OAAOxF,SAAS,SAAU+G,GAC3BjD,EAAO7W,IAAK8Z,EAAE/B,OAAQO,GACtBA,GAAWwB,EAAEL,aACb5C,EAAO7W,IAAK8Z,EAAEvC,MAAOe,GACrBA,GAAWwB,EAAEH,eAEdC,EAAQxU,KAAMyR,MAIf+C,EAAQxU,KAAM,IAAI0E,WAAY,OAEvB,IAAIE,KAAM4P,EAAS,CAAE1gB,KAAM,kBAInCqO,EAAI4B,UAAU6Q,MAAQ,WACrB1c,KAAKgb,QAAU,EACfhb,KAAKka,IAAMV,EAAMF,MAAMuB,IAGuC,qBAAnB9Q,EAAOC,QAClDD,EAAOC,QAAUC,EAEjBE,OAAOF,IAAMA,EA7Hd,I,qBClND,UAYEmP,EAAO,QAAD,6BAUA,WAEP,OAAO,SAAShP,EAAS+F,EAAMwM,EAAaC,GAE3C,IASCvL,EACAwL,EAVG1R,EAAOhB,OACV2S,EAAc,2BACdxO,EAAWsO,GAAeE,EAC1BC,EAAU5M,EACVL,GAAO6M,IAAgBC,GAAeG,EACtCC,EAAS3gB,SAAS4S,cAAc,KAChCf,EAAW,SAAS+O,GAAG,OAAOxR,OAAOwR,IACrCC,EAAU/R,EAAKuB,MAAQvB,EAAKgS,SAAWhS,EAAKiS,YAAclP,EAC1D0N,EAAWe,GAAe,WAY3B,GATAO,EAAQA,EAAOvP,KAAOuP,EAAOrN,KAAK1E,GAAQuB,KAExB,SAAfjB,OAAOzL,QAETsO,GADAyO,EAAQ,CAACA,EAASzO,IACD,GACjByO,EAAQA,EAAQ,IAIdjN,GAAOA,EAAIpK,OAAQ,OACrBkW,EAAW9L,EAAIzD,MAAM,KAAKgR,MAAMhR,MAAM,KAAK,GAC3C2Q,EAAOM,KAAOxN,GACmB,IAA9BkN,EAAOM,KAAKC,QAAQzN,IAAY,CAClC,IAAI0N,EAAK,IAAIC,eAOb,OANAD,EAAKE,KAAM,MAAO5N,GAAK,GACvB0N,EAAKG,aAAe,OACpBH,EAAKrF,OAAQ,SAASY,GACrB3O,EAAS2O,EAAErc,OAAOkhB,SAAUhC,EAAUkB,IAEvCxI,YAAW,WAAYkJ,EAAKK,SAAU,GAC/BL,EAMT,GAAG,iCAAiCM,KAAKf,GAAS,CAEjD,KAAGA,EAAQrX,OAAU,aAAoBwX,IAAWhP,GAInD,OAAO6P,UAAUC,WAChBD,UAAUC,WAAWC,EAAclB,GAAUnB,GAC7CsC,EAAMnB,GAJPzO,GADAyO,EAAQkB,EAAclB,IACLnhB,MAAQkhB,OAQ1B,GAAG,gBAAgBgB,KAAKf,GAAS,CAEhC,IADA,IAAItT,EAAE,EAAG0U,EAAW,IAAI3R,WAAWuQ,EAAQrX,QAAS0Y,EAAGD,EAAUzY,OAC3D+D,EAAE2U,IAAK3U,EAAG0U,EAAU1U,GAAIsT,EAAQtQ,WAAWhD,GACjDsT,EAAQ,IAAIG,EAAO,CAACiB,GAAY,CAACviB,KAAM0S,IAQzC,SAAS2P,EAAcI,GAUtB,IATA,IAAIC,EAAOD,EAAOhS,MAAM,SACvBzQ,EAAM0iB,EAAM,GAGZC,GADgC,UAAvBD,EADMD,EAAOd,QAAQ,WAAW,EAAI,EAAG,GACLpR,KAAOqS,oBAChCF,EAAMjB,OACxBe,EAAIG,EAAQ7Y,OACZ+D,EAAG,EACHgV,EAAO,IAAIjS,WAAW4R,GAEjB3U,EAAE2U,IAAK3U,EAAGgV,EAAMhV,GAAI8U,EAAQ9R,WAAWhD,GAE7C,OAAO,IAAIyT,EAAO,CAACuB,GAAQ,CAAC7iB,KAAMA,IAGnC,SAASsiB,EAAMpO,EAAK4O,GAEnB,GAAI,aAAc1B,EAgBjB,OAfAA,EAAOM,KAAOxN,EACdkN,EAAO2B,aAAa,WAAY/C,GAChCoB,EAAO4B,UAAY,mBACnB5B,EAAO6B,UAAY,iBACnB7B,EAAOzgB,MAAMgW,QAAU,OACvByK,EAAO7c,iBAAiB,SAAS,SAAS4Y,GACzCA,EAAE+F,kBACF9e,KAAKiD,oBAAoB,QAAS2K,UAAUmR,WAE7C1iB,SAAS8W,KAAKC,YAAY4J,GAC1B1I,YAAW,WACV0I,EAAOgC,QACP3iB,SAAS8W,KAAK8L,YAAYjC,IACb,IAAV0B,GAAgBpK,YAAW,WAAYnJ,EAAKgG,IAAI+N,gBAAgBlC,EAAOM,QAAS,OACjF,KACI,EAIR,GAAG,gDAAgDQ,KAAKC,UAAUoB,WAKjE,MAJG,SAASrB,KAAKhO,KAAMA,EAAI,QAAQA,EAAIsP,QAAQ,sBAAuBtC,IAClE3S,OAAOuT,KAAK5N,IACZuP,QAAQ,oGAAoGC,SAAShC,KAAKxN,IAEvH,EAIR,IAAIyP,EAAIljB,SAAS4S,cAAc,UAC/B5S,SAAS8W,KAAKC,YAAYmM,IAEtBb,GAAW,SAASZ,KAAKhO,KAC5BA,EAAI,QAAQA,EAAIsP,QAAQ,sBAAuBtC,IAEhDyC,EAAEC,IAAI1P,EACNwE,YAAW,WAAYjY,SAAS8W,KAAK8L,YAAYM,KAAO,KAOzD,GAjEAlO,EAAO0L,aAAmBG,EACzBH,EACA,IAAIG,EAAO,CAACH,GAAU,CAACnhB,KAAM0S,IA+D1ByP,UAAUC,WACb,OAAOD,UAAUC,WAAW3M,EAAMuK,GAGnC,GAAGzQ,EAAKgG,IACP+M,EAAM/S,EAAKgG,IAAIC,gBAAgBC,IAAO,OAClC,CAEJ,GAAmB,kBAATA,GAAqBA,EAAKqK,cAAcxN,EACjD,IACC,OAAOgQ,EAAO,QAAW5P,EAAa,WAAenD,EAAKsU,KAAKpO,IAC/D,MAAMpK,GACN,OAAOiX,EAAO,QAAW5P,EAAa,IAAMoR,mBAAmBrO,KAKjEwL,EAAO,IAAI3E,YACJC,OAAO,SAASY,GACtBmF,EAAMle,KAAKqY,SAEZwE,EAAO8C,cAActO,GAEtB,OAAO,KA7JD,gC,oBCZP,SAASoL,GAAG,SAASQ,EAAET,EAAE3G,GAAG,GAAG,GAAG+J,eAAejS,KAAKsP,EAAE4C,MAAMrD,GAAG,OAAOS,EAAE4C,MAAMrD,GAAG,IAAIzD,EAAEkE,EAAE6C,QAAQtD,GAAG,IAAIzD,EAAE,MAAM,IAAIgH,MAAM,4BAA4BvD,GAAG,IAAIC,EAAE,CAAC5F,GAAG2F,EAAEtS,QAAQ+S,EAAEpP,SAAS2O,EAAExS,QAAQ,GAAGgW,QAAO,EAAGC,OAAOpK,EAAEqK,SAAS,IAAIrK,GAAGA,EAAEqK,SAASpY,KAAK2U,GAAG,IAAI8C,EAAE/C,EAAE9Q,MAAM,EAAE8Q,EAAE2D,YAAY,KAAK,GAAG,OAAOlD,EAAE4C,MAAMrD,GAAGC,EAAEzS,QAAQ+O,EAAEpL,KAAK8O,EAAEzS,QAAQyS,EAAEA,EAAEzS,QAAQuV,EAAE/C,GAAGC,EAAEuD,QAAO,EAAG/C,EAAE4C,MAAMrD,GAAGC,EAAEzS,QAAQiT,EAAEmD,QAAQ,GAAGnD,EAAE4C,MAAM,GAAG5C,EAAE6C,QAAQ,SAAStD,GAAG,MAAM,GAAGoD,eAAejS,KAAKsP,EAAEmD,QAAQ5D,GAAGS,EAAEmD,QAAQ5D,QAAG,GAAQS,EAAE7D,OAAO,SAASoD,EAAEC,GAAGQ,EAAEmD,QAAQ5D,GAAGC,GAAG,IAAID,EAAE,SAASS,GAAG,OAAOA,EAAE,IAAI,CAACoD,MAAM,UAAUC,QAAQ,WAAWC,SAAQ,EAAGC,IAAI,GAAGC,KAAK,GAAGC,SAASjE,EAAEkE,cAAc,SAAS1D,GAAG3I,WAAW2I,EAAE,IAAI2D,IAAI,WAAW,OAAO3D,GAAG4D,MAAM,SAASrE,GAAGS,EAAET,IAA1L,GAAiMS,EAAE7D,OAAO,eAAc,SAASvD,EAAEiL,EAAEC,EAAEC,GAAG,SAASC,EAAEhE,EAAET,GAAG,MAAM,GAAGoD,eAAejS,KAAKsP,EAAET,GAAsP,IAAI0E,EAAEzE,EAAE8C,EAAE/C,EAAEzD,EAAEwG,EAAEtC,EAAE,SAASpH,GAAGsL,aAAaD,EAAEjE,EAAE,kBAAkBpH,GAAGkD,EAAE,SAASlD,GAAG,SAASoH,EAAEpH,GAAG,IAAIoH,EAAET,EAA8G,IAAIS,KAAhHjd,KAAKohB,SAAQ,EAAGphB,KAAKqhB,QAAQ,GAAGrhB,KAAK6O,OAAO,GAAG7O,KAAKshB,YAAY,GAAGthB,KAAKuhB,cAAc,GAAGvhB,KAAKwhB,WAAW3L,GAAY4G,EAAED,EAAEC,EAAEQ,GAAG,MAAMjd,KAAKqhB,QAAQpE,GAAGjd,KAAKqhB,QAAQpE,GAAGjd,KAAKqhB,QAAQpE,GAAGT,EAAE,OAA5b,SAAWS,EAAET,GAAG,SAAS3G,IAAI7V,KAAK0b,YAAYuB,EAAE,IAAI,IAAIR,KAAKD,EAAEyE,EAAEzE,EAAEC,KAAKQ,EAAER,GAAGD,EAAEC,IAAW5G,EAAEhK,UAAU2Q,EAAE3Q,UAAUoR,EAAEpR,UAAU,IAAIgK,EAAEoH,EAAEwE,UAAUjF,EAAE3Q,UAAiTpC,CAAEwT,EAAEpH,GAAG4G,EAAE,CAACvL,aAAa,gBAAgBN,QAAQ,EAAE8Q,OAAO,EAAEC,WAAW,OAAO1V,QAAQ,GAAGmL,MAAM,KAAKC,OAAO,KAAKuK,YAAY,MAAMpF,EAAE,CAACtD,MAAM,IAAI3Y,MAAK,GAAI0c,EAAEpR,UAAUoN,UAAU,SAASgE,EAAET,GAAG,OAAOxc,KAAKqhB,QAAQpE,GAAGT,EAAE,MAAMxc,KAAK6hB,SAAc,UAAJ5E,GAAiB,WAAJA,OAAgC,EAAlBjd,KAAK6hB,QAAQ5E,GAAGT,GAAUS,EAAEpR,UAAU2V,WAAW,SAAShF,GAAG,IAAIS,EAAER,EAAE,OAAO,SAAS5G,GAAG,IAAIoH,KAAKT,EAAOyE,EAAEzE,EAAES,KAAYR,EAAED,EAAES,GAAGpH,EAAE/N,KAAK9H,KAAKiZ,UAAUgE,EAAER,KAAI,OAAO5G,GAAGlI,KAAK3N,KAAK,KAAKid,EAAEpR,UAAU2M,SAAS,SAASyE,EAAEpH,GAAG,IAAI4G,EAAE1D,EAA8D,IAAIA,KAAhE,MAAMlD,IAAIA,EAAE,KAAI4G,EAAE,IAAKmF,YAAY5hB,KAAKqhB,QAAQO,YAAqBpF,EAAEC,EAAE1D,GAAGlD,EAAEkD,IAAIyD,EAAEzD,GAAG,GAAG,MAAM/Y,KAAKqhB,QAAQjK,OAAOpX,KAAKiZ,UAAU,QAAQgE,EAAE7F,OAAO,MAAMpX,KAAKqhB,QAAQhK,QAAQrX,KAAKiZ,UAAU,SAASgE,EAAE5F,QAAQ,qBAAqByK,WAAW,MAAMA,WAAW7E,aAAa6E,UAAUrF,EAAEtM,KAAK8M,EAAE9M,UAAU,GAAG,qBAAqB4R,0BAA0B,MAAMA,0BAA0B9E,aAAa8E,0BAA0B,qBAAqBC,uBAAuB,MAAMA,uBAAuB/E,aAAa+E,sBAAsBnM,EAAEtV,KAAKkc,EAAEtM,KAAKnQ,KAAKiiB,eAAehF,GAAGR,EAAEyF,QAAQjF,MAAO,IAAG,MAAMA,EAAEkF,WAA6D,MAAM,IAAIpC,MAAM,iBAAlElK,EAAEtV,KAAKkc,EAAEtM,KAAKnQ,KAAK2X,aAAasF,GAAGR,EAAE2F,MAAMnF,EAAwC,OAAOjd,KAAK6O,OAAO/G,KAAK2U,IAAIQ,EAAEpR,UAAUsN,OAAO,WAAW,IAAM8D,EAAE,GAAGjd,KAAKohB,QAAQ,MAAM,IAAIrB,MAAM,mBAAmB,GAAK,MAAM/f,KAAKqhB,QAAQjK,OAAO,MAAMpX,KAAKqhB,QAAQhK,OAAQ,MAAM,IAAI0I,MAAM,mDAAmD/f,KAAKohB,SAAQ,EAAGphB,KAAKqiB,UAAU,EAAEriB,KAAKsiB,eAAe,EAAEtiB,KAAKuiB,WAAW,SAAS9F,GAAG,IAAI,IAAID,EAAE,WAAW,IAAIA,EAAEA,EAAE,GAAG,IAAI,IAAIS,EAAE,EAAE,GAAGjd,KAAK6O,OAAOnJ,OAAOuX,EAAEjd,KAAK6O,OAAOnJ,OAAOuX,EAAEjd,KAAK6O,OAAOnJ,OAAO,GAAG1F,KAAK6O,OAAOnJ,SAASuX,IAAIA,EAAET,EAAE1U,KAAKmV,GAAG,OAAOT,GAAG/O,MAAMzN,KAAK4N,WAAWqP,EAAE,EAAElE,EAAEyD,EAAE9W,OAAOuX,EAAElE,IAAIkE,EAAIT,EAAES,GAAGR,EAAE3U,KAAK,MAAM,OAAO2U,GAAG9O,KAAK3N,KAAK,IAAIid,EAAEjd,KAAKwiB,eAAe,IAAI,IAAI/F,EAAE,WAAW,IAAIA,EAAEA,EAAE,GAAG,IAAI,IAAID,EAAE,EAAE,GAAGS,EAAET,EAAES,EAAET,EAAES,EAAE,GAAGA,IAAIT,IAAIA,EAAEC,EAAE3U,KAAK0U,GAAG,OAAOC,GAAGhP,MAAMzN,KAAK4N,WAAW4O,EAAE,EAAEzD,EAAE0D,EAAE/W,OAAO8W,EAAEzD,IAAIyD,EAAIC,EAAED,GAAGxc,KAAKyiB,kBAAkB,OAAOziB,KAAKwN,KAAK,SAASxN,KAAKwN,KAAK,WAAW,IAAIyP,EAAEpR,UAAU6W,MAAM,WAAiB,IAAN,IAAIzF,EAA8C,OAA/BA,EAAEjd,KAAKuhB,cAAcoB,UAAyBxmB,QAAQgT,IAAI,yBAAyB8N,EAAE2F,YAAY,OAAO5iB,KAAKohB,SAAQ,EAAGphB,KAAKwN,KAAK,UAAUyP,EAAEpR,UAAU2W,aAAa,WAAW,IAAIvF,EAAE,OAAOA,EAAE9f,KAAK2E,IAAI9B,KAAKqhB,QAAQzQ,QAAQ5Q,KAAK6O,OAAOnJ,QAAQ,WAAW,IAAI+W,EAAEA,EAAE,GAAG,IAAI,IAAID,EAAExc,KAAKshB,YAAY5b,OAAO1F,KAAKshB,YAAY5b,QAAQuX,EAAET,EAAES,EAAET,EAAES,EAAEjd,KAAKshB,YAAY5b,QAAQuX,IAAIT,IAAIA,EAAEC,EAAE3U,KAAK0U,GAAG,OAAOC,GAAGhP,MAAMzN,KAAK4N,WAAW6H,QAAQ,SAASwH,GAAG,OAAO,SAASR,GAAG,IAAID,EAAE,OAAOrgB,QAAQgT,IAAI,mBAAmBsN,IAAGD,EAAE,IAAIqG,OAAO5F,EAAEoE,QAAQnQ,eAAgB4R,UAAU,SAAS7F,GAAG,OAAO,SAASR,GAAG,OAAOQ,EAAEsE,cAAc7X,OAAOuT,EAAEsE,cAAchE,QAAQf,GAAG,GAAGS,EAAEqE,YAAYxZ,KAAK0U,GAAGS,EAAE8F,cAActG,EAAEtM,OAAnI,CAA2I8M,GAAGA,EAAEqE,YAAYxZ,KAAK0U,IAAhS,CAAqSxc,OAAOid,GAAGA,EAAEpR,UAAUkX,cAAc,SAAS9F,GAAG,OAAO9gB,QAAQgT,IAAI,SAAS8N,EAAE+F,MAAM,eAAehjB,KAAKuhB,cAAc7b,OAAO,WAAW1F,KAAKsiB,iBAAiBtiB,KAAKwN,KAAK,WAAWxN,KAAKsiB,eAAetiB,KAAK6O,OAAOnJ,QAAQ1F,KAAKuiB,WAAWtF,EAAE+F,OAAO/F,EAA97G,SAAWpH,EAAE2G,GAAG,IAAI,IAAIS,EAAE,EAAER,EAAED,EAAE9W,OAAOuX,EAAER,IAAIQ,EAAE,GAAGA,KAAKT,GAAGA,EAAES,KAAKpH,EAAE,OAAM,EAAG,OAAM,EAA82GK,CAAE,KAAKlW,KAAKuiB,YAAYviB,KAAKyiB,kBAAkBziB,KAAKijB,mBAAmBhG,EAAEpR,UAAUoX,gBAAgB,WAAW,IAAIlK,EAAEkE,EAAE+D,EAAEF,EAAEtE,EAAE3G,EAAEqL,EAAE1E,EAAE,EAAE,IAAI,IAAI+C,EAAE,EAAErJ,EAAElW,KAAKuiB,WAAW7c,OAAO6Z,EAAErJ,IAAIqJ,EAAuB/C,KAArBS,EAAEjd,KAAKuiB,WAAWhD,IAASpP,KAAKzK,OAAO,GAAGuX,EAAEiG,SAASjG,EAAEkG,OAAO3G,GAAGS,EAAEiG,SAASjG,EAAEkG,OAAOhnB,QAAQgT,IAAI,iCAAiChS,KAAKimB,MAAM5G,EAAE,KAAK,MAAMzD,EAAE,IAAIvM,WAAWgQ,GAAG3G,EAAE,EAAE,IAAI,IAAIoL,EAAE,EAAEF,EAAE/gB,KAAKuiB,WAAW7c,OAAOub,EAAEF,IAAIE,EAAwB,IAAI,IAAIxE,EAAE,EAAEhT,GAAjCwT,EAAEjd,KAAKuiB,WAAWtB,IAAmB9Q,KAAKzK,OAAO+W,EAAEhT,IAAIgT,EAAEyE,EAAEjE,EAAE9M,KAAKsM,GAAGuE,EAAEvE,EAAE1D,EAAErW,IAAIwe,EAAErL,GAAGmL,IAAI/D,EAAE9M,KAAKzK,OAAO,EAAEmQ,GAAGoH,EAAEkG,OAAOtN,GAAGoH,EAAEiG,SAAS,OAAOpC,EAAE,IAAIpU,KAAK,CAACqM,GAAG,CAACnd,KAAK,cAAcoE,KAAKwN,KAAK,WAAWsT,EAAE/H,IAAIkE,EAAEpR,UAAU4W,gBAAgB,WAAW,IAAIhG,EAAEQ,EAAET,EAAE,GAA6B,IAA1Bxc,KAAKshB,YAAY5b,OAAW,MAAM,IAAIqa,MAAM,mBAAmB,OAAO/f,KAAKqiB,WAAWriB,KAAK6O,OAAOnJ,YAAO,GAAQ+W,EAAEzc,KAAK6O,OAAO7O,KAAKqiB,aAAa7F,EAAExc,KAAKshB,YAAYqB,QAAQ1F,EAAEjd,KAAKqjB,QAAQ5G,GAAGtgB,QAAQgT,IAAI,mBAAmB8N,EAAE+F,MAAM,GAAG,OAAOhjB,KAAK6O,OAAOnJ,QAAQ1F,KAAKuhB,cAAczZ,KAAK0U,GAAGA,EAAE8G,YAAYrG,KAAKA,EAAEpR,UAAUoW,eAAe,SAAShF,GAAG,OAAOA,EAAEtF,aAAa,EAAE,EAAE3X,KAAKqhB,QAAQjK,MAAMpX,KAAKqhB,QAAQhK,QAAQlH,MAAM8M,EAAEpR,UAAU8L,aAAa,SAAS6E,GAAG,IAAIS,EAAE,OAAO,MAAMjd,KAAK6hB,UAAU7hB,KAAK6hB,QAAQxlB,SAAS4S,cAAc,UAAUjP,KAAK6hB,QAAQzK,MAAMpX,KAAKqhB,QAAQjK,MAAMpX,KAAK6hB,QAAQxK,OAAOrX,KAAKqhB,QAAQhK,SAAQ4F,EAAEjd,KAAK6hB,QAAQ9Q,WAAW,OAAQwS,QAAQvjB,KAAKqhB,QAAQM,WAAW1E,EAAEzF,SAAS,EAAE,EAAExX,KAAKqhB,QAAQjK,MAAMpX,KAAKqhB,QAAQhK,QAAQ4F,EAAEvF,UAAU8E,EAAE,EAAE,GAAGxc,KAAKiiB,eAAehF,IAAIA,EAAEpR,UAAUwX,QAAQ,SAASpG,GAAG,IAAIR,EAAED,EAAE,GAA4BA,EAAE,CAACwG,MAA5BvG,EAAEzc,KAAK6O,OAAO0O,QAAQN,GAAcuG,KAAK/G,IAAIzc,KAAK6O,OAAOnJ,OAAO,EAAEwT,MAAM+D,EAAE/D,MAAM0I,YAAY3E,EAAE2E,YAAYxK,MAAMpX,KAAKqhB,QAAQjK,MAAMC,OAAOrX,KAAKqhB,QAAQhK,OAAOpL,QAAQjM,KAAKqhB,QAAQpV,QAAQyV,OAAO1hB,KAAKqhB,QAAQK,OAAO+B,YAAqB,WAATvC,EAAEpT,MAAiB,MAAMmP,EAAE9M,KAAKqM,EAAErM,KAAK8M,EAAE9M,UAAU,GAAG,MAAM8M,EAAEiF,QAAQ1F,EAAErM,KAAKnQ,KAAKiiB,eAAehF,EAAEiF,aAAc,IAAG,MAAMjF,EAAEmF,MAA6C,MAAM,IAAIrC,MAAM,iBAAvDvD,EAAErM,KAAKnQ,KAAK2X,aAAasF,EAAEmF,OAA6C,OAAO5F,GAAGS,EAA5/J,CAA+/JsC,GAAG1J,EAAE7L,QAAQ+O,KAAIkE,EAAE7D,OAAO,mBAAkB,SAASmG,EAAE0B,EAAEC,EAAEzX,GAAG,IAAIwT,EAAEpH,EAAEkD,EAAE0D,EAAED,EAAEC,EAAEsB,UAAUoB,UAAUuE,cAAc3K,EAAEgF,UAAU4F,SAASD,cAA2I7N,EAAS,QAAtI2G,EAAEC,EAAEd,MAAM,gGAAgG,CAAC,KAAK,UAAU,IAAO,IAAWtf,SAASunB,cAAa3G,EAAE,CAACnP,KAAY,YAAP0O,EAAE,GAAeA,EAAE,GAAGA,EAAE,GAAG8D,QAAQzK,GAAGlL,WAAkB,UAAP6R,EAAE,IAAcA,EAAE,GAAGA,EAAE,GAAGA,EAAE,IAAImH,SAAS,CAAC7V,KAAK2O,EAAEd,MAAM,oBAAoB,OAAOc,EAAEd,MAAM,sBAAsB5C,EAAE4C,MAAM,kBAAkB,CAAC,UAAU,MAAOsB,EAAEnP,OAAM,EAAGmP,EAAEA,EAAEnP,KAAKlD,SAASqS,EAAEqD,QAAQ,MAAK,EAAGrD,EAAE0G,SAAS1G,EAAE0G,SAAS7V,OAAM,EAAGyR,EAAEvV,QAAQiT,KAAIA,EAAE7D,OAAO,UAAS,SAASmG,EAAExG,EAAEkI,EAAEC,GAAG1E,EAAE2E,eAAe3E,EAAE2E,aAAa,cAAc,IAAIlE,EAAElE,EAAEoI,aAAa3E,EAAE2E,aAAa1E,EAAyB,oBAAhB/O,MAAMmW,QAAqBnW,MAAMmW,QAAQ,SAAS5G,GAAG,MAA2C,mBAApCvS,OAAOmB,UAAUqC,SAASP,KAAKsP,IAA4BA,EAAEpR,UAAUiY,gBAAgB,SAAS7G,GAAGjd,KAAK+jB,UAAU/jB,KAAK+jB,QAAQ,IAAI/jB,KAAK+jB,QAAQC,aAAa/G,GAAGA,EAAEpR,UAAU2B,KAAK,SAAS+R,GAAG,GAAO,UAAJA,KAAgBvf,KAAK+jB,UAAS/jB,KAAK+jB,QAAQznB,OAAQmgB,EAAEzc,KAAK+jB,QAAQznB,SAAS0D,KAAK+jB,QAAQznB,MAAMoJ,QAAQ,MAAMkI,UAAU,aAAamS,MAAMnS,UAAU,GAAG,IAAImS,MAAM,wCAAwC,IAAI/f,KAAK+jB,QAAQ,OAAM,EAAG,IAAI9G,EAAEjd,KAAK+jB,QAAQxE,GAAG,IAAItC,EAAE,OAAM,EAAG,GAAe,mBAAHA,EAAe,IAAGR,EAAEQ,GAAG,CAA2D,IAA1D,IAAIT,EAAE9O,MAAM7B,UAAUH,MAAMiC,KAAKC,UAAU,GAAGmL,EAAEkE,EAAEvR,QAAgBmK,EAAE,EAAEoL,EAAElI,EAAErT,OAAOmQ,EAAEoL,EAAEpL,IAAIkD,EAAElD,GAAGpI,MAAMzN,KAAKwc,GAAG,OAAM,EAAQ,OAAM,EAAG,OAAO5O,UAAUlI,QAAQ,KAAK,EAAEuX,EAAEtP,KAAK3N,MAAM,MAAM,KAAK,EAAEid,EAAEtP,KAAK3N,KAAK4N,UAAU,IAAI,MAAM,KAAK,EAAEqP,EAAEtP,KAAK3N,KAAK4N,UAAU,GAAGA,UAAU,IAAI,MAAM,QAAY4O,EAAE9O,MAAM7B,UAAUH,MAAMiC,KAAKC,UAAU,GAAGqP,EAAExP,MAAMzN,KAAKwc,GAAG,OAAM,GAAIS,EAAEpR,UAAUoY,YAAY,SAAShH,EAAET,GAAG,GAAG,oBAAoBA,EAAE,MAAM,IAAIuD,MAAM,gDAAgD,GAAG/f,KAAK+jB,UAAU/jB,KAAK+jB,QAAQ,IAAI/jB,KAAKwN,KAAK,cAAcyP,EAAET,GAAIxc,KAAK+jB,QAAQ9G,GAA0B,GAAGR,EAAEzc,KAAK+jB,QAAQ9G,IAAI,CAA6B,IAAIlE,EAAhC,IAAI/Y,KAAK+jB,QAAQ9G,GAAGiH,QAAoDnL,OAAV7c,IAA5B8D,KAAK+jB,QAAQC,aAA2BhkB,KAAK+jB,QAAQC,aAAzmC,KAA6nCjL,EAAE,GAAG/Y,KAAK+jB,QAAQ9G,GAAGvX,OAAOqT,IAAI/Y,KAAK+jB,QAAQ9G,GAAGiH,QAAO,EAAG/nB,QAAQG,MAAM,mIAAmI0D,KAAK+jB,QAAQ9G,GAAGvX,QAAQvJ,QAAQgoB,SAASnkB,KAAK+jB,QAAQ9G,GAAGnV,KAAK0U,QAAQxc,KAAK+jB,QAAQ9G,GAAG,CAACjd,KAAK+jB,QAAQ9G,GAAGT,QAA3cxc,KAAK+jB,QAAQ9G,GAAGT,EAA8b,OAAOxc,MAAMid,EAAEpR,UAAUyB,GAAG2P,EAAEpR,UAAUoY,YAAYhH,EAAEpR,UAAUuY,KAAK,SAAS5H,EAAEC,GAAG,IAAIQ,EAAEjd,KAAK,OAAOid,EAAE3P,GAAGkP,GAAE,SAAS3G,IAAIoH,EAAEoH,eAAe7H,EAAE3G,GAAG4G,EAAEhP,MAAMzN,KAAK4N,cAAa5N,MAAMid,EAAEpR,UAAUwY,eAAe,SAASpH,EAAEpH,GAAG,GAAG,oBAAoBA,EAAE,MAAM,IAAIkK,MAAM,mDAAmD,IAAK/f,KAAK+jB,UAAS/jB,KAAK+jB,QAAQ9G,GAAI,OAAOjd,KAAK,IAAIwc,EAAExc,KAAK+jB,QAAQ9G,GAAG,GAAGR,EAAED,GAAG,CAAC,IAAIzD,EAAEyD,EAAEe,QAAQ1H,GAAG,GAAGkD,EAAE,EAAE,OAAO/Y,KAAKwc,EAAE9S,OAAOqP,EAAE,GAAa,GAAVyD,EAAE9W,eAAkB1F,KAAK+jB,QAAQ9G,QAAQjd,KAAK+jB,QAAQ9G,KAAKpH,UAAU7V,KAAK+jB,QAAQ9G,GAAG,OAAOjd,MAAMid,EAAEpR,UAAUyY,mBAAmB,SAASrH,GAAG,OAAOA,GAAGjd,KAAK+jB,SAAS/jB,KAAK+jB,QAAQ9G,KAAKjd,KAAK+jB,QAAQ9G,GAAG,MAAMjd,MAAMid,EAAEpR,UAAU0Y,UAAU,SAAStH,GAAG,OAAOjd,KAAK+jB,UAAU/jB,KAAK+jB,QAAQ,IAAI/jB,KAAK+jB,QAAQ9G,KAAKjd,KAAK+jB,QAAQ9G,GAAG,IAAIR,EAAEzc,KAAK+jB,QAAQ9G,MAAMjd,KAAK+jB,QAAQ9G,GAAG,CAACjd,KAAK+jB,QAAQ9G,KAAKjd,KAAK+jB,QAAQ9G,OAAMR,EAAEpS,IAAI4S,EAAE,iBAAgBtP,KAAK3N,KAAKA,O,mCCAluS,aAUA,WAEI,IAAI8J,EAA8E,qBAAnBC,EAAOC,QAOlEwa,EAAwB,SAAS9e,GACjC1F,KAAKmQ,KAAO,IAAI3D,WAAW9G,GAC3B1F,KAAKykB,IAAM,GAGfD,EAAsB3Y,UAAU6Y,KAAO,SAAS3jB,GAC5Cf,KAAKykB,IAAM1jB,GAGfyjB,EAAsB3Y,UAAU8Y,WAAa,SAASpY,GAClD,IAAK,IAAI9C,EAAI,EAAGA,EAAI8C,EAAI7G,OAAQ+D,IAC5BzJ,KAAKmQ,KAAKnQ,KAAKykB,OAASlY,EAAI9C,IAIpC+a,EAAsB3Y,UAAU+Y,UAAY,SAASpI,GACjDxc,KAAKmQ,KAAKnQ,KAAKykB,OAASjI,GAI5BgI,EAAsB3Y,UAAUgZ,QAAUL,EAAsB3Y,UAAU+Y,UAE1EJ,EAAsB3Y,UAAUiZ,WAAa,SAASC,GAClD/kB,KAAKmQ,KAAKnQ,KAAKykB,OAASM,GAAK,EAC7B/kB,KAAKmQ,KAAKnQ,KAAKykB,OAASM,GAG5BP,EAAsB3Y,UAAUmZ,cAAgB,SAASnP,GAIrD,IAHA,IACI6D,EAAQ,IAAIlN,WAAW,IAAIyY,aAAa,CAACpP,IAAI0D,QAExC9P,EAAIiQ,EAAMhU,OAAS,EAAG+D,GAAK,EAAGA,IACnCzJ,KAAK4kB,UAAUlL,EAAMjQ,KAI7B+a,EAAsB3Y,UAAUqZ,aAAe,SAASrP,GAIpD,IAHA,IACI6D,EAAQ,IAAIlN,WAAW,IAAI2Y,aAAa,CAACtP,IAAI0D,QAExC9P,EAAIiQ,EAAMhU,OAAS,EAAG+D,GAAK,EAAGA,IACnCzJ,KAAK4kB,UAAUlL,EAAMjQ,KAO7B+a,EAAsB3Y,UAAUuZ,YAAc,SAASC,GACnD,IAAK,IAAI5b,EAAI,EAAGA,EAAI4b,EAAE3f,OAAQ+D,IAC1BzJ,KAAKmQ,KAAKnQ,KAAKykB,OAASY,EAAE5Y,WAAWhD,IAa7C+a,EAAsB3Y,UAAUyZ,qBAAuB,SAAS7b,EAAG2N,GAC/D,OAAQA,GACJ,KAAK,EACDpX,KAAK6kB,QAAS,IAAUpb,GAC5B,MACA,KAAK,EACDzJ,KAAK6kB,QAAS,GAAWpb,GAAK,GAC9BzJ,KAAK6kB,QAAQpb,GACjB,MACA,KAAK,EACDzJ,KAAK6kB,QAAS,GAAWpb,GAAK,IAC9BzJ,KAAK6kB,QAAQpb,GAAK,GAClBzJ,KAAK6kB,QAAQpb,GACjB,MACA,KAAK,EACDzJ,KAAK6kB,QAAS,GAAWpb,GAAK,IAC9BzJ,KAAK6kB,QAAQpb,GAAK,IAClBzJ,KAAK6kB,QAAQpb,GAAK,GAClBzJ,KAAK6kB,QAAQpb,GACjB,MACA,KAAK,EAKDzJ,KAAK6kB,QAAS,EAAYpb,EAAI,WAAc,GAC5CzJ,KAAK6kB,QAAQpb,GAAK,IAClBzJ,KAAK6kB,QAAQpb,GAAK,IAClBzJ,KAAK6kB,QAAQpb,GAAK,GAClBzJ,KAAK6kB,QAAQpb,GACjB,MACA,QACI,MAAM,IAAI8b,iBAAiB,sBAAwBnO,KAO/DoN,EAAsB3Y,UAAU2Z,kBAAoB,SAASC,GACzD,GAAIA,EAAM,IAIN,OAAO,EACJ,GAAIA,EAAM,MACb,OAAO,EACJ,GAAIA,EAAM,QACb,OAAO,EACJ,GAAIA,EAAM,UACb,OAAO,EACJ,GAAIA,EAAM,YACb,OAAO,EAEP,MAAM,IAAIF,iBAAiB,gCAAkCE,IAIrEjB,EAAsB3Y,UAAU6Z,gBAAkB,SAASjc,GACvDzJ,KAAKslB,qBAAqB7b,EAAGzJ,KAAKwlB,kBAAkB/b,KAYxD+a,EAAsB3Y,UAAU8Z,mBAAqB,SAASZ,EAAG3N,GAM7D,YALclb,IAAVkb,IACAA,EAAQpX,KAAK4lB,mBAAmBb,IAI5B3N,GACJ,KAAK,EACDpX,KAAK6kB,QAAQ1nB,KAAK6Q,MAAM+W,EAAI,aAChC,KAAK,EACD/kB,KAAK6kB,QAAQE,GAAK,IACtB,KAAK,EACD/kB,KAAK6kB,QAAQE,GAAK,IACtB,KAAK,EACD/kB,KAAK6kB,QAAQE,GAAK,GACtB,KAAK,EACD/kB,KAAK6kB,QAAQE,GACjB,MACA,QACI,MAAM,IAAIQ,iBAAiB,iBAAmBnO,KAO1DoN,EAAsB3Y,UAAU+Z,mBAAqB,SAASH,GAE1D,OAAIA,EAAO,IACA,EACAA,EAAO,MACP,EACAA,EAAO,GAAK,GACZ,EACAA,EAAM,WACN,EAEA,GAOfjB,EAAsB3Y,UAAUga,eAAiB,WAC7C,GAAI7lB,KAAKykB,IAAMzkB,KAAKmQ,KAAK2V,WACrB,OAAO9lB,KAAKmQ,KAAK4V,SAAS,EAAG/lB,KAAKykB,KAC/B,GAAIzkB,KAAKykB,KAAOzkB,KAAKmQ,KAAK2V,WAC7B,OAAO9lB,KAAKmQ,KAEZ,KAAM,yDAIdhG,OAAOqa,sBAAwBA,EAclC,IAA0BwB,EAAtBC,GAAsBD,EA6MxBlc,EAAmBI,EAAQ,MAAQ,KA5M7B,SAASgc,GACf,IACC3M,EAAS,GACT4M,EAAeC,QAAQtG,UACvBxQ,EAAa,KACbC,EAAK,KAeN,SAAS8W,EAAiBhV,GACzB,OAAO,IAAI+U,SAAQ,SAAUtG,EAASwG,GACrC,IACCzJ,EAAS,IAAI3E,WAEd2E,EAAO1c,iBAAiB,WAAW,WAClC2f,EAAQjD,EAAOxE,WAGhBwE,EAAOtE,kBAAkBlH,MAI3B,SAASkV,EAAoBC,GAC5B,OAAO,IAAIJ,SAAQ,SAAUtG,EAASwG,GACjCE,aAAiBha,WACpBsT,EAAQ0G,GACEA,aAAiBC,aAAeA,YAAYC,OAAOF,GAC7D1G,EAAQ,IAAItT,WAAWga,IACbA,aAAiB9Z,KAC3BoT,EAAQuG,EAAiBG,GAAO9N,MAAK,SAAUa,GAC9C,OAAO,IAAI/M,WAAW+M,OAIvBuG,EAAQuG,EAAiB,IAAI3Z,KAAK,CAAC8Z,KAAS9N,MAAK,SAAUa,GAC1D,OAAO,IAAI/M,WAAW+M,UAM1B,SAASoN,EAAYxW,GACpB,IACCkI,EAASlI,EAAK2V,YAAc3V,EAAKzK,QAAUyK,EAAKJ,KAEjD,IAAK6W,OAAOC,UAAUxO,GACrB,KAAM,sCAGP,OAAOA,EArDkB,qBAAfyO,YAA8BZ,aAAuBY,WAC/DxX,EAAa4W,EACHF,GAAME,IAChB3W,EAAK2W,GAINlmB,KAAKykB,IAAM,EAGXzkB,KAAK0F,OAAS,EAoDd1F,KAAK0kB,KAAO,SAAU3jB,GACrB,GAAIA,EAAS,EACZ,KAAM,6BAGP,GAAIgmB,MAAMhmB,GACT,KAAM,wBAGP,GAAIA,EAASf,KAAK0F,OACjB,KAAM,gDAGP1F,KAAKykB,IAAM1jB,GASZf,KAAKgnB,MAAQ,SAAU7W,GACtB,IACC8W,EAAW,CACVlmB,OAAQf,KAAKykB,IACbtU,KAAMA,EACNzK,OAAQihB,EAAYxW,IAErB+W,EAAWD,EAASlmB,QAAUf,KAAK0F,OAEpC1F,KAAKykB,KAAOwC,EAASvhB,OACrB1F,KAAK0F,OAASvI,KAAK4E,IAAI/B,KAAK0F,OAAQ1F,KAAKykB,KAGzC0B,EAAeA,EAAazN,MAAK,WAChC,GAAInJ,EACH,OAAO,IAAI6W,SAAQ,SAAStG,EAASwG,GACpCC,EAAoBU,EAAS9W,MAAMuI,MAAK,SAASyO,GAChD,IACCC,EAAe,EACf7N,EAAS8N,EAAOC,KAAKH,EAAU5N,QAahCyM,EAAGgB,MAAMzX,EAAIgK,EAAQ,EAAGA,EAAO7T,OAAQuhB,EAASlmB,QAXzB,SAAtBwmB,EAA+BtQ,EAAK+D,EAASzB,IAC5C6N,GAAgBpM,IAEIzB,EAAO7T,OAC1Boa,IAGAkG,EAAGgB,MAAMzX,EAAIgK,EAAQ6N,EAAc7N,EAAO7T,OAAS0hB,EAAcH,EAASlmB,OAASqmB,EAAcG,YAOhG,GAAIjY,EACV,OAAO,IAAI8W,SAAQ,SAAUtG,EAASwG,GACrChX,EAAWkY,WAAa1H,EAExBxQ,EAAWoV,KAAKuC,EAASlmB,QACzBuO,EAAW0X,MAAM,IAAIta,KAAK,CAACua,EAAS9W,WAE/B,IAAK+W,EAIX,IAAK,IAAIzd,EAAI,EAAGA,EAAI8P,EAAO7T,OAAQ+D,IAAK,CACvC,IACCge,EAAQlO,EAAO9P,GAGhB,KAAMwd,EAASlmB,OAASkmB,EAASvhB,QAAU+hB,EAAM1mB,QAAUkmB,EAASlmB,QAAU0mB,EAAM1mB,OAAS0mB,EAAM/hB,QAAS,CAC3G,GAAIuhB,EAASlmB,OAAS0mB,EAAM1mB,QAAUkmB,EAASlmB,OAASkmB,EAASvhB,OAAS+hB,EAAM1mB,OAAS0mB,EAAM/hB,OAC9F,MAAM,IAAIqa,MAAM,qCAGjB,OAAIkH,EAASlmB,QAAU0mB,EAAM1mB,QAAUkmB,EAASvhB,QAAU+hB,EAAM/hB,YAE/D+hB,EAAMtX,KAAO8W,EAAS9W,MAKfoW,EAAoBkB,EAAMtX,MAC/BuI,MAAK,SAAUgP,GAGf,OAFAD,EAAMtX,KAAOuX,EAENnB,EAAoBU,EAAS9W,SAClCuI,MAAK,SAAUiP,GACjBV,EAAS9W,KAAOwX,EAEhBF,EAAMtX,KAAKzN,IAAIukB,EAAS9W,KAAM8W,EAASlmB,OAAS0mB,EAAM1mB,YAQ5DwY,EAAOzR,KAAKmf,OAYdjnB,KAAKyY,SAAW,SAAUnK,GAmBzB,OAjBC6X,EADG5W,GAAMD,EACM6W,EAAazN,MAAK,WAChC,OAAO,QAIOyN,EAAazN,MAAK,WAIhC,IAHA,IACCL,EAAS,GAED5O,EAAI,EAAGA,EAAI8P,EAAO7T,OAAQ+D,IAClC4O,EAAOvQ,KAAKyR,EAAO9P,GAAG0G,MAGvB,OAAO,IAAIzD,KAAK2L,EAAQ,CAAC/J,SAAUA,UASxCnE,OAAO8b,WAAaA,EAgBjB,IAAI3b,EAAa,SAASka,EAAuByB,GA+C7C,SAAS2B,EAAa/W,EAAQ5E,GAC1B,IA3B6B6D,EA4BzB+X,EAAQhX,EAAOzE,UAAU,aAAc,CAACH,QAASA,IAErD,QA7BmB,kBADU6D,EA8BE+X,KA7BC/X,EAAI6L,MAAM,gCAInCxR,OAAOgC,KAAK2D,EAAI3B,UAAU,0BAA2BzI,SA4BhE,SAASoiB,EAAwBC,GAE7B,IACIC,EAAqBD,EAAKxK,QAAQ,QAEtC,IAA2B,GAAvByK,EACA,KAAM,yDAMV,OAFAA,GAAsB,OAAOtiB,OAAS,EAE/BqiB,EAAK5Z,UAAU6Z,GAI1B,SAASC,EAAYxd,GACjBzK,KAAKyK,MAAQA,EAGjB,SAASyd,EAAYzd,GACjBzK,KAAKyK,MAAQA,EAUjB,SAAS0d,EAAU5O,EAAQ6O,EAAkBC,GAEzC,GAAI3a,MAAMmW,QAAQwE,GACd,IAAK,IAAI5e,EAAI,EAAGA,EAAI4e,EAAK3iB,OAAQ+D,IAC7B0e,EAAU5O,EAAQ6O,EAAkBC,EAAK5e,SAG1C,GAAoB,kBAAT4e,EACd9O,EAAO6L,YAAYiD,QAChB,GAAIA,aAAgB7b,WACvB+M,EAAOoL,WAAW0D,OACf,KAAIA,EAAKxR,GAuEZ,KAAM,4BAA8BwR,EAAKlY,KA5DrC,IACImY,EAASC,EAAWC,EAJ5B,GANAH,EAAKtnB,OAASwY,EAAOkL,IAAM2D,EAE3B7O,EAAOoM,mBAAmB0C,EAAKxR,IAI3BnJ,MAAMmW,QAAQwE,EAAKlY,OAMA,IAAfkY,EAAKtY,KAELwJ,EAAOqL,UAAU,MAEjB0D,EAAU/O,EAAOkL,IAMjBlL,EAAOoL,WAAW,CAAC,EAAG,EAAG,EAAG,KAGhC4D,EAAYhP,EAAOkL,IAEnB4D,EAAKI,WAAaF,EAAYH,EAC9BD,EAAU5O,EAAQ6O,EAAkBC,EAAKlY,OAEtB,IAAfkY,EAAKtY,OACLyY,EAAUjP,EAAOkL,IAEjB4D,EAAKtY,KAAOyY,EAAUD,EAEtBhP,EAAOmL,KAAK4D,GACZ/O,EAAO+L,qBAAqB+C,EAAKtY,KAAM,GAEvCwJ,EAAOmL,KAAK8D,SAEb,GAAyB,kBAAdH,EAAKlY,KACnBoJ,EAAOmM,gBAAgB2C,EAAKlY,KAAKzK,QACjC2iB,EAAKI,WAAalP,EAAOkL,IAAM2D,EAC/B7O,EAAO6L,YAAYiD,EAAKlY,WACrB,GAAyB,kBAAdkY,EAAKlY,KAEdkY,EAAKtY,OACNsY,EAAKtY,KAAOwJ,EAAOqM,mBAAmByC,EAAKlY,OAG/CoJ,EAAOmM,gBAAgB2C,EAAKtY,MAC5BsY,EAAKI,WAAalP,EAAOkL,IAAM2D,EAC/B7O,EAAOoM,mBAAmB0C,EAAKlY,KAAMkY,EAAKtY,WACvC,GAAIsY,EAAKlY,gBAAgB+X,EAC5B3O,EAAOmM,gBAAgB,GACvB2C,EAAKI,WAAalP,EAAOkL,IAAM2D,EAC/B7O,EAAOyL,cAAcqD,EAAKlY,KAAK1F,YAC5B,GAAI4d,EAAKlY,gBAAgB8X,EAC5B1O,EAAOmM,gBAAgB,GACvB2C,EAAKI,WAAalP,EAAOkL,IAAM2D,EAC/B7O,EAAO2L,aAAamD,EAAKlY,KAAK1F,WAC3B,MAAI4d,EAAKlY,gBAAgB3D,YAK5B,KAAM,4BAA8B6b,EAAKlY,KAJzCoJ,EAAOmM,gBAAgB2C,EAAKlY,KAAK2V,YACjCuC,EAAKI,WAAalP,EAAOkL,IAAM2D,EAC/B7O,EAAOoL,WAAW0D,EAAKlY,QASnC,OAAO,SAASkR,GACZ,IAKIqH,EAAYC,EAsBZC,EAMAC,EA7BAC,GAAgB,EAGhBC,EAAqB,GACrBC,EAAmB,EACnBC,EAAkB,EAYlBC,EAAa,CACTC,KAAM,CAACtS,GAAI,IAAIrK,WAAW,CAAC,GAAM,GAAM,IAAM,MAAQ4c,aAAc,MACnEC,YAAa,CAACxS,GAAI,IAAIrK,WAAW,CAAC,GAAM,GAAM,IAAM,MAAQ4c,aAAc,MAC1EE,OAAQ,CAACzS,GAAI,IAAIrK,WAAW,CAAC,GAAM,GAAM,IAAM,MAAQ4c,aAAc,OAIzEG,EAAkB,CACd,GAAM,MACN,KAAQ,IAAIrB,EAAY,IAK5BsB,EAAO,GAEPC,EAAa,IAAIxD,EAAW5E,EAAQ/R,YAAc+R,EAAQ9R,IAE9D,SAASma,EAA4BC,GACjC,OAAOA,EAAaf,EAAYH,WA8CpC,SAASmB,IACLf,EAtCJ,WACI,IACIgB,EAA2B,CACvB,GAAM,MACN,KAAQ,EACR,KAAQ,GAGZxR,EAAS,CACL,GAAM,UACN,KAAQ,IAGhB,IAAK,IAAIvK,KAAQob,EAAY,CACzB,IACIY,EAAYZ,EAAWpb,GAE3Bgc,EAAUV,aAAe1e,OAAOsN,OAAO6R,GAEvCxR,EAAOlI,KAAKrI,KAAK,CACZ,GAAM,MACN,KAAQ,CACH,CACI,GAAM,MACN,KAAQgiB,EAAUjT,IAEtBiT,EAAUV,gBAKxB,OAAO/Q,EAOI0R,GAEX,IAmCIC,EAAc,CACV,GAAM,UACN,KAAQ,CACJ,CACI,GAAM,QACN,KAAQ,KAEZ,CACI,GAAM,MACN,KAAQ,kBAEZ,CACI,GAAM,MACN,KAAQ,kBAEZT,IAIRU,EAAS,CACL,GAAM,UACN,KAAQ,CACJ,CACI,GAAM,IACN,KAAQ,CACJ,CACI,GAAM,IACN,KArJD,GAuJH,CACI,GAAM,MACN,KAzJD,GA2JH,CACI,GAAM,IACN,KAAQ,GAEZ,CACI,GAAM,QACN,KAAQ,OAEZ,CACI,GAAM,IACN,KAAQ,SAEZ,CACI,GAAM,QACN,KAAQ,OAEZ,CACI,GAAM,IACN,KAAQ,GAEZ,CACI,GAAM,IACN,KAAQ,CACJ,CACI,GAAM,IACN,KAAQvB,GAEZ,CACI,GAAM,IACN,KAAQC,SASxCC,EAAc,CACV,GAAM,UACN,MAAS,EACT,KAAQ,CACJC,EACAmB,EACAC,IAIR,IACIC,EAAe,IAAI1F,EAAsB,KAE7C2D,EAAU+B,EAAcT,EAAWhF,IAAK,CAtHvB,CACT,GAAM,UACN,KAAQ,CACJ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,QAEZ,CACI,GAAM,MACN,KAAQ,GAEZ,CACI,GAAM,MACN,KAAQ,KAyF6BmE,IACrDa,EAAWzC,MAAMkD,EAAarE,kBAG9BqD,EAAWG,YAAYD,aAAajZ,KAAOuZ,EAA4BM,EAAYjpB,QACnFmoB,EAAWI,OAAOF,aAAajZ,KAAOuZ,EAA4BO,EAAOlpB,QAW7E,SAASopB,EAAoBC,GACzB,IACIF,EAAe,IAAI1F,EAAsB,GAE7C,KAAM4F,EAASC,YAAc,GAAKD,EAASC,YAAc,KACrD,KAAM,oCAWV,OARAH,EAAaxE,gBAAgB0E,EAASC,aACtCH,EAAapF,WAAWsF,EAASE,UAGjCJ,EAAatF,UACT,KAGG,CACH,GAAM,IACN,KAAQ,CACHsF,EAAarE,iBACbuE,EAASvC,QAwEtB,SAAS0C,IACL,GAAiC,GAA7BxB,EAAmBrjB,OAAvB,CAQA,IAHA,IACI8kB,EAAe,EAEV/gB,EAAI,EAAGA,EAAIsf,EAAmBrjB,OAAQ+D,IAC3C+gB,GAAgBzB,EAAmBtf,GAAGoe,MAAMniB,OAGhD,IA7DiB+kB,EAAYC,EAAaC,EA8DtCpR,EAAS,IAAIiL,EAAsBgG,EAA2C,GAA5BzB,EAAmBrjB,QAErEklB,EA5ER,SAAuBA,GACnB,MAAO,CACH,GAAM,UACN,KAAQ,CACH,CACG,GAAM,IACN,KAAQztB,KAAKimB,MAAMwH,EAAQN,aAsEzBO,CAAc,CACpBP,SAAUntB,KAAKimB,MAAM4F,KAG7B,IAASvf,EAAI,EAAGA,EAAIsf,EAAmBrjB,OAAQ+D,IAC3CmhB,EAAQza,KAAKrI,KAAKqiB,EAAoBpB,EAAmBtf,KAG7D0e,EAAU5O,EAAQkQ,EAAWhF,IAAKmG,GAClCnB,EAAWzC,MAAMzN,EAAOsM,kBAzEP4E,EA1QM,EA0QMC,EA2EKvtB,KAAKimB,MAAM4F,GA3EH2B,EA2EsBC,EAAQ7pB,OA1ExEyoB,EAAK1hB,KAAK,CACN,GAAM,IACN,KAAQ,CACH,CACI,GAAM,IACN,KAAQ4iB,GAEZ,CACI,GAAM,IACN,KAAQ,CACH,CACI,GAAM,IACN,KAAQD,GAEZ,CACI,GAAM,IACN,KAAQf,EAA4BiB,SA4D1D5B,EAAqB,GACrBC,GAAoBC,EACpBA,EAAkB,GAsEtBjpB,KAAKwY,SAAW,SAAS3H,GACrB,GAAIiY,GACA,GAAIjY,EAAOuG,OAASsR,GAAc7X,EAAOwG,QAAUsR,EAC/C,KAAM,+CAGVD,EAAa7X,EAAOuG,MACpBuR,EAAc9X,EAAOwG,OAErBuS,IACAd,GAAgB,EAGpB,IArEuBjB,EAsEnBE,EAAOH,EAAa/W,EAAQ,CAAC5E,QAASoV,EAAQpV,UAElD,IAAK8b,EACD,KAAM,8DAzEaF,EA4EL,CACdA,MAAOC,EAAwBC,GAC/B+C,SAAUzJ,EAAQ0J,gBA7EhBV,YAxWiB,EA2WvBxC,EAAMyC,SAAWntB,KAAKimB,MAAM6F,GAE5BF,EAAmBjhB,KAAK+f,IAExBoB,GAAmBpB,EAAMiD,WAhXG,KAmXxBP,KA6ERvqB,KAAKyY,SAAW,WAOZ,OANA8R,IAzJJ,WACI,IACIlC,EAAO,CACH,GAAM,UACN,KAAQmB,GAGZwB,EAAa,IAAIxG,EAAsB,GAAmB,GAAdgF,EAAK9jB,QAErDyiB,EAAU6C,EAAYvB,EAAWhF,IAAK4D,GACtCoB,EAAWzC,MAAMgE,EAAWnF,kBAG5BqD,EAAWC,KAAKC,aAAajZ,KAAOuZ,EAA4BrB,EAAKtnB,QA8IrEkqB,GAvEJ,WACI,IACIC,EAAiB,IAAI1G,EAAsBqE,EAAS9Y,MACpDob,EAAS1B,EAAWhF,IAGxB0D,EAAU+C,EAAgBrC,EAASJ,WAAYI,EAAS1Y,MAGxDsZ,EAAW/E,KAAKmE,EAASJ,YACzBgB,EAAWzC,MAAMkE,EAAerF,kBAEhC4D,EAAW/E,KAAKyG,GA4DhBC,GAtDJ,WACI,IACI7R,EAAS,IAAIiL,EAAsB,GACnC2G,EAAS1B,EAAWhF,IAGxBlL,EAAOyL,cAAcgE,GAGrBS,EAAW/E,KAAK6E,EAAgBd,YAChCgB,EAAWzC,MAAMzN,EAAOsM,kBAExB4D,EAAW/E,KAAKyG,GA2ChBE,GAEO5B,EAAWhR,SAAS,eAG/BzY,KAAKsrB,eAAiB,WAClB,OAAO7B,EAAW/jB,QAGtB2b,EA1nBJ,SAAgB1H,EAAMxT,GAClB,IACIzJ,EAAS,GAUb,MARA,CAACid,EAAMxT,GAAKsP,SAAQ,SAAS8V,GACzB,IAAK,IAAIC,KAAQD,EACT7gB,OAAOmB,UAAU+T,eAAejS,KAAK4d,EAAKC,KAC1C9uB,EAAO8uB,GAAQD,EAAIC,OAKxB9uB,EA8mBGkd,CApcW,CACb3N,QAAS,IACTqD,WAAY,KACZC,GAAI,KAGJwb,cAAe,KACfvb,UAAW,MA6bc6R,GAAW,IAjH5C,WAEI,IAAKA,EAAQ0J,cAAe,CACxB,IAAI1J,EAAQ7R,UAGR,KAAM,sDAFN6R,EAAQ0J,cAAgB,IAAO1J,EAAQ7R,WA8GnDic,KAIJ3hB,EACHC,EAAOC,QAAUM,EAAWka,EAAuByB,GAEnD9b,OAAOG,WAAaA,EAAWka,EAAuByB,GArjC3D,K","file":"static/js/9.fcff3309.chunk.js","sourcesContent":["import {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3\n} from 'three';\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = { type: 'change' };\nconst _startEvent = { type: 'start' };\nconst _endEvent = { type: 'end' };\n\nclass OrbitControls extends EventDispatcher {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper();\n\n\t\tif ( domElement === undefined ) console.warn( 'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.' );\n\t\tif ( domElement === document ) console.error( 'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t\t// Set to false to disable this control\n\t\tthis.enabled = true;\n\n\t\t// \"target\" sets the location of focus, where the object orbits around\n\t\tthis.target = new Vector3();\n\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\n\t\tthis.minZoom = 0;\n\t\tthis.maxZoom = Infinity;\n\n\t\t// How far you can orbit vertically, upper and lower limits.\n\t\t// Range is 0 to Math.PI radians.\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\t// How far you can orbit horizontally, upper and lower limits.\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n\t\tthis.minAzimuthAngle = - Infinity; // radians\n\t\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t\t// Set to true to enable damping (inertia)\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\n\t\tthis.enableDamping = false;\n\t\tthis.dampingFactor = 0.05;\n\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t\t// Set to false to disable zooming\n\t\tthis.enableZoom = true;\n\t\tthis.zoomSpeed = 1.0;\n\n\t\t// Set to false to disable rotating\n\t\tthis.enableRotate = true;\n\t\tthis.rotateSpeed = 1.0;\n\n\t\t// Set to false to disable panning\n\t\tthis.enablePan = true;\n\t\tthis.panSpeed = 1.0;\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t\t// Set to true to automatically rotate around the target\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\t\tthis.autoRotate = false;\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n\t\t// The four arrow keys\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\n\n\t\t// Mouse buttons\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t// Touch fingers\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t\t// for reset\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// the target DOM element for key events\n\t\tthis._domElementKeyEvents = null;\n\n\t\t//\n\t\t// public methods\n\t\t//\n\n\t\tthis.getPolarAngle = function () {\n\n\t\t\treturn spherical.phi;\n\n\t\t};\n\n\t\tthis.getAzimuthalAngle = function () {\n\n\t\t\treturn spherical.theta;\n\n\t\t};\n\n\t\tthis.getDistance = function () {\n\n\t\t\treturn this.object.position.distanceTo( this.target );\n\n\t\t};\n\n\t\tthis.listenToKeyEvents = function ( domElement ) {\n\n\t\t\tdomElement.addEventListener( 'keydown', onKeyDown );\n\t\t\tthis._domElementKeyEvents = domElement;\n\n\t\t};\n\n\t\tthis.saveState = function () {\n\n\t\t\tscope.target0.copy( scope.target );\n\t\t\tscope.position0.copy( scope.object.position );\n\t\t\tscope.zoom0 = scope.object.zoom;\n\n\t\t};\n\n\t\tthis.reset = function () {\n\n\t\t\tscope.target.copy( scope.target0 );\n\t\t\tscope.object.position.copy( scope.position0 );\n\t\t\tscope.object.zoom = scope.zoom0;\n\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\tscope.update();\n\n\t\t\tstate = STATE.NONE;\n\n\t\t};\n\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\n\t\tthis.update = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\t// so camera.up is the orbit axis\n\t\t\tconst quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\t\tconst quatInverse = quat.clone().invert();\n\n\t\t\tconst lastPosition = new Vector3();\n\t\t\tconst lastQuaternion = new Quaternion();\n\n\t\t\tconst twoPI = 2 * Math.PI;\n\n\t\t\treturn function update() {\n\n\t\t\t\tconst position = scope.object.position;\n\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t\t// angle from z-axis around y-axis\n\t\t\t\tspherical.setFromVector3( offset );\n\n\t\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\t\trotateLeft( getAutoRotationAngle() );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scope.enableDamping ) {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t\t}\n\n\t\t\t\t// restrict theta to be between desired limits\n\n\t\t\t\tlet min = scope.minAzimuthAngle;\n\t\t\t\tlet max = scope.maxAzimuthAngle;\n\n\t\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\n\n\t\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\n\n\t\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\n\n\t\t\t\t\tif ( min <= max ) {\n\n\t\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\n\t\t\t\t\t\t\tMath.max( min, spherical.theta ) :\n\t\t\t\t\t\t\tMath.min( max, spherical.theta );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// restrict phi to be between desired limits\n\t\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\t\tspherical.makeSafe();\n\n\n\t\t\t\tspherical.radius *= scale;\n\n\t\t\t\t// restrict radius to be between desired limits\n\t\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n\t\t\t\t// move target to panned location\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tscope.target.add( panOffset );\n\n\t\t\t\t}\n\n\t\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t\t}\n\n\t\t\t\tscale = 1;\n\n\t\t\t\t// update condition is:\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\t\tif ( zoomChanged ||\n\t\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\t\tzoomChanged = false;\n\n\t\t\t\t\treturn true;\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.dispose = function () {\n\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu );\n\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\n\t\t\tscope.domElement.removeEventListener( 'pointercancel', onPointerCancel );\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\n\n\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\n\t\t\tif ( scope._domElementKeyEvents !== null ) {\n\n\t\t\t\tscope._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\n\n\t\t\t}\n\n\t\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t\t};\n\n\t\t//\n\t\t// internals\n\t\t//\n\n\t\tconst scope = this;\n\n\t\tconst STATE = {\n\t\t\tNONE: - 1,\n\t\t\tROTATE: 0,\n\t\t\tDOLLY: 1,\n\t\t\tPAN: 2,\n\t\t\tTOUCH_ROTATE: 3,\n\t\t\tTOUCH_PAN: 4,\n\t\t\tTOUCH_DOLLY_PAN: 5,\n\t\t\tTOUCH_DOLLY_ROTATE: 6\n\t\t};\n\n\t\tlet state = STATE.NONE;\n\n\t\tconst EPS = 0.000001;\n\n\t\t// current position in spherical coordinates\n\t\tconst spherical = new Spherical();\n\t\tconst sphericalDelta = new Spherical();\n\n\t\tlet scale = 1;\n\t\tconst panOffset = new Vector3();\n\t\tlet zoomChanged = false;\n\n\t\tconst rotateStart = new Vector2();\n\t\tconst rotateEnd = new Vector2();\n\t\tconst rotateDelta = new Vector2();\n\n\t\tconst panStart = new Vector2();\n\t\tconst panEnd = new Vector2();\n\t\tconst panDelta = new Vector2();\n\n\t\tconst dollyStart = new Vector2();\n\t\tconst dollyEnd = new Vector2();\n\t\tconst dollyDelta = new Vector2();\n\n\t\tconst pointers = [];\n\t\tconst pointerPositions = {};\n\n\t\tfunction getAutoRotationAngle() {\n\n\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t\t}\n\n\t\tfunction getZoomScale() {\n\n\t\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t\t}\n\n\t\tfunction rotateLeft( angle ) {\n\n\t\t\tsphericalDelta.theta -= angle;\n\n\t\t}\n\n\t\tfunction rotateUp( angle ) {\n\n\t\t\tsphericalDelta.phi -= angle;\n\n\t\t}\n\n\t\tconst panLeft = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\t\tv.multiplyScalar( - distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tconst panUp = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t\t}\n\n\t\t\t\tv.multiplyScalar( distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\t// deltaX and deltaY are in pixels; right and down are positive\n\t\tconst pan = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\t\tconst element = scope.domElement;\n\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t// perspective\n\t\t\t\t\tconst position = scope.object.position;\n\t\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\t\tlet targetDistance = offset.length();\n\n\t\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t// orthographic\n\t\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\t\tscope.enablePan = false;\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}();\n\n\t\tfunction dollyOut( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale /= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction dollyIn( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale *= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\t\t// event callbacks - update the object state\n\t\t//\n\n\t\tfunction handleMouseDownRotate( event ) {\n\n\t\t\trotateStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownDolly( event ) {\n\n\t\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownPan( event ) {\n\n\t\t\tpanStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseMoveRotate( event ) {\n\n\t\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMoveDolly( event ) {\n\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMovePan( event ) {\n\n\t\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseUp( /*event*/ ) {\n\n\t\t\t// no-op\n\n\t\t}\n\n\t\tfunction handleMouseWheel( event ) {\n\n\t\t\tif ( event.deltaY < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleKeyDown( event ) {\n\n\t\t\tlet needsUpdate = false;\n\n\t\t\tswitch ( event.code ) {\n\n\t\t\t\tcase scope.keys.UP:\n\t\t\t\t\tpan( 0, scope.keyPanSpeed );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.LEFT:\n\t\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.RIGHT:\n\t\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( needsUpdate ) {\n\n\t\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tscope.update();\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tfunction handleTouchStartRotate() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\trotateStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\trotateStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartPan() {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\n\n\t\t\t\tpanStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartDolly() {\n\n\t\t\tconst dx = pointers[ 0 ].pageX - pointers[ 1 ].pageX;\n\t\t\tconst dy = pointers[ 0 ].pageY - pointers[ 1 ].pageY;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyStart.set( 0, distance );\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyPan() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enablePan ) handleTouchStartPan();\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyRotate() {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\n\n\t\t\tif ( scope.enableRotate ) handleTouchStartRotate();\n\n\t\t}\n\n\t\tfunction handleTouchMoveRotate( event ) {\n\n\t\t\tif ( pointers.length == 1 ) {\n\n\t\t\t\trotateEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\trotateEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMovePan( event ) {\n\n\t\t\tif ( pointers.length === 1 ) {\n\n\t\t\t\tpanEnd.set( event.pageX, event.pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\t\tpanEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDolly( event ) {\n\n\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\tconst dx = event.pageX - position.x;\n\t\t\tconst dy = event.pageY - position.y;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyEnd.set( 0, distance );\n\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\t\tdollyOut( dollyDelta.y );\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enablePan ) handleTouchMovePan( event );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyRotate( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\n\n\t\t}\n\n\t\tfunction handleTouchEnd( /*event*/ ) {\n\n\t\t\t// no-op\n\n\t\t}\n\n\t\t//\n\t\t// event handlers - FSM: listen for events and reset state\n\t\t//\n\n\t\tfunction onPointerDown( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.setPointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.addEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.addEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\taddPointer( event );\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchStart( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseDown( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchMove( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseMove( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerUp( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchEnd();\n\n\t\t\t} else {\n\n\t\t\t\tonMouseUp( event );\n\n\t\t\t}\n\n\t\t\tremovePointer( event );\n\n\t\t\t//\n\n\t\t\tif ( pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.releasePointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerCancel( event ) {\n\n\t\t\tremovePointer( event );\n\n\t\t}\n\n\t\tfunction onMouseDown( event ) {\n\n\t\t\tlet mouseAction;\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase 0:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tmouseAction = - 1;\n\n\t\t\t}\n\n\t\t\tswitch ( mouseAction ) {\n\n\t\t\t\tcase MOUSE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseUp( event ) {\n\n\t\t\thandleMouseUp( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onMouseWheel( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\thandleMouseWheel( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction onKeyDown( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enablePan === false ) return;\n\n\t\t\thandleKeyDown( event );\n\n\t\t}\n\n\t\tfunction onTouchStart( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( pointers.length ) {\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tswitch ( scope.touches.ONE ) {\n\n\t\t\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tswitch ( scope.touches.TWO ) {\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyPan();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyRotate();\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchMove( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMovePan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchEnd( event ) {\n\n\t\t\thandleTouchEnd( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onContextMenu( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tfunction addPointer( event ) {\n\n\t\t\tpointers.push( event );\n\n\t\t}\n\n\t\tfunction removePointer( event ) {\n\n\t\t\tdelete pointerPositions[ event.pointerId ];\n\n\t\t\tfor ( let i = 0; i < pointers.length; i ++ ) {\n\n\t\t\t\tif ( pointers[ i ].pointerId == event.pointerId ) {\n\n\t\t\t\t\tpointers.splice( i, 1 );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction trackPointer( event ) {\n\n\t\t\tlet position = pointerPositions[ event.pointerId ];\n\n\t\t\tif ( position === undefined ) {\n\n\t\t\t\tposition = new Vector2();\n\t\t\t\tpointerPositions[ event.pointerId ] = position;\n\n\t\t\t}\n\n\t\t\tposition.set( event.pageX, event.pageY );\n\n\t\t}\n\n\t\tfunction getSecondPointerPosition( event ) {\n\n\t\t\tconst pointer = ( event.pointerId === pointers[ 0 ].pointerId ) ? pointers[ 1 ] : pointers[ 0 ];\n\n\t\t\treturn pointerPositions[ pointer.pointerId ];\n\n\t\t}\n\n\t\t//\n\n\t\tscope.domElement.addEventListener( 'contextmenu', onContextMenu );\n\n\t\tscope.domElement.addEventListener( 'pointerdown', onPointerDown );\n\t\tscope.domElement.addEventListener( 'pointercancel', onPointerCancel );\n\t\tscope.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\n\n\t\t// force an update at start\n\n\t\tthis.update();\n\n\t}\n\n}\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nclass MapControls extends OrbitControls {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper( object, domElement );\n\n\t\tthis.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\n\n\t\tthis.mouseButtons.LEFT = MOUSE.PAN;\n\t\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\n\n\t\tthis.touches.ONE = TOUCH.PAN;\n\t\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\n\n\t}\n\n}\n\nexport { OrbitControls, MapControls };\n",";(function() {\r\n\r\n\"use strict\";\r\n\r\nvar isNodeEnviroment = typeof module !== 'undefined' && typeof module.exports !== 'undefined';\r\n\r\nvar Tar = isNodeEnviroment ? require('./tar') : window.Tar;\r\nvar download = isNodeEnviroment ? require('./download') : window.download;\r\nvar GIF = isNodeEnviroment ? require('./gif').GIF : window.GIF;\r\nvar WebMWriter = isNodeEnviroment ? require('./webm-writer-0.2.0') : window.WebMWriter;\r\n\r\nvar objectTypes = {\r\n'function': true,\r\n'object': true\r\n};\r\n\r\nfunction checkGlobal(value) {\r\n    return (value && value.Object === Object) ? value : null;\r\n  }\r\n\r\n/** Built-in method references without a dependency on `root`. */\r\nvar freeParseFloat = parseFloat,\r\n  freeParseInt = parseInt;\r\n\r\n/** Detect free variable `exports`. */\r\nvar freeExports = (objectTypes[typeof exports] && exports && !exports.nodeType)\r\n? exports\r\n: undefined;\r\n\r\n/** Detect free variable `module`. */\r\nvar freeModule = (objectTypes[typeof module] && module && !module.nodeType)\r\n? module\r\n: undefined;\r\n\r\n/** Detect the popular CommonJS extension `module.exports`. */\r\nvar moduleExports = (freeModule && freeModule.exports === freeExports)\r\n? freeExports\r\n: undefined;\r\n\r\n/** Detect free variable `global` from Node.js. */\r\nvar freeGlobal = checkGlobal(freeExports && freeModule && typeof global == 'object' && global);\r\n\r\n/** Detect free variable `self`. */\r\nvar freeSelf = checkGlobal(objectTypes[typeof self] && self);\r\n\r\n/** Detect free variable `window`. */\r\nvar freeWindow = checkGlobal(objectTypes[typeof window] && window);\r\n\r\n/** Detect `this` as the global object. */\r\nvar thisGlobal = checkGlobal(objectTypes[typeof this] && this);\r\n\r\n/**\r\n* Used as a reference to the global object.\r\n*\r\n* The `this` value is used if it's the global object to avoid Greasemonkey's\r\n* restricted `window` object, otherwise the `window` object is used.\r\n*/\r\nvar root = freeGlobal ||\r\n((freeWindow !== (thisGlobal && thisGlobal.window)) && freeWindow) ||\r\n  freeSelf || thisGlobal || Function('return this')();\r\n\r\nif( !('gc' in window ) ) {\r\n\twindow.gc = function(){}\r\n}\r\n\r\nif (!HTMLCanvasElement.prototype.toBlob) {\r\n Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\r\n  value: function (callback, type, quality) {\r\n\r\n    var binStr = atob( this.toDataURL(type, quality).split(',')[1] ),\r\n        len = binStr.length,\r\n        arr = new Uint8Array(len);\r\n\r\n    for (var i=0; i<len; i++ ) {\r\n     arr[i] = binStr.charCodeAt(i);\r\n    }\r\n\r\n    callback( new Blob( [arr], {type: type || 'image/png'} ) );\r\n  }\r\n });\r\n}\r\n\r\n// @license http://opensource.org/licenses/MIT\r\n// copyright Paul Irish 2015\r\n\r\n\r\n// Date.now() is supported everywhere except IE8. For IE8 we use the Date.now polyfill\r\n//   github.com/Financial-Times/polyfill-service/blob/master/polyfills/Date.now/polyfill.js\r\n// as Safari 6 doesn't have support for NavigationTiming, we use a Date.now() timestamp for relative values\r\n\r\n// if you want values similar to what you'd get with real perf.now, place this towards the head of the page\r\n// but in reality, you're just getting the delta between now() calls, so it's not terribly important where it's placed\r\n\r\n\r\n(function(){\r\n\r\n  if (\"performance\" in window == false) {\r\n      window.performance = {};\r\n  }\r\n\r\n  Date.now = (Date.now || function () {  // thanks IE8\r\n\t  return new Date().getTime();\r\n  });\r\n\r\n  if (\"now\" in window.performance == false){\r\n\r\n    var nowOffset = Date.now();\r\n\r\n    if (performance.timing && performance.timing.navigationStart){\r\n      nowOffset = performance.timing.navigationStart\r\n    }\r\n\r\n    window.performance.now = function now(){\r\n      return Date.now() - nowOffset;\r\n    }\r\n  }\r\n\r\n})();\r\n\r\n\r\nfunction pad( n ) {\r\n\treturn String(\"0000000\" + n).slice(-7);\r\n}\r\n// https://developer.mozilla.org/en-US/Add-ons/Code_snippets/Timers\r\n\r\nvar g_startTime = window.Date.now();\r\n\r\nfunction guid() {\r\n\tfunction s4() {\r\n\t\treturn Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\r\n\t}\r\n\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\r\n}\r\n\r\nfunction CCFrameEncoder( settings ) {\r\n\r\n\tvar _handlers = {};\r\n\r\n\tthis.settings = settings;\r\n\r\n\tthis.on = function(event, handler) {\r\n\r\n\t\t_handlers[event] = handler;\r\n\r\n\t};\r\n\r\n\tthis.emit = function(event) {\r\n\r\n\t\tvar handler = _handlers[event];\r\n\t\tif (handler) {\r\n\r\n\t\t\thandler.apply(null, Array.prototype.slice.call(arguments, 1));\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.filename = settings.name || guid();\r\n\tthis.extension = '';\r\n\tthis.mimeType = '';\r\n\r\n}\r\n\r\nCCFrameEncoder.prototype.start = function(){};\r\nCCFrameEncoder.prototype.stop = function(){};\r\nCCFrameEncoder.prototype.add = function(){};\r\nCCFrameEncoder.prototype.save = function(){};\r\nCCFrameEncoder.prototype.dispose = function(){};\r\nCCFrameEncoder.prototype.safeToProceed = function(){ return true; };\r\nCCFrameEncoder.prototype.step = function() { console.log( 'Step not set!' ) }\r\n\r\nfunction CCTarEncoder( settings ) {\r\n\r\n  CCFrameEncoder.call( this, settings );\r\n\r\n  this.extension = '.tar'\r\n  this.mimeType = 'application/x-tar'\r\n  this.fileExtension = '';\r\n  this.baseFilename = this.filename;\r\n\r\n  this.tape = null\r\n  this.count = 0;\r\n  this.part = 1;\r\n  this.frames = 0;\r\n\r\n}\r\n\r\nCCTarEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCTarEncoder.prototype.start = function(){\r\n\r\n  this.dispose();\r\n\r\n};\r\n\r\nCCTarEncoder.prototype.add = function( blob ) {\r\n\r\n  var fileReader = new FileReader();\r\n  fileReader.onload = function() {\r\n    this.tape.append( pad( this.count ) + this.fileExtension, new Uint8Array( fileReader.result ) );\r\n\r\n    if( this.settings.autoSaveTime > 0 && ( this.frames / this.settings.framerate ) >= this.settings.autoSaveTime ) {\r\n      this.save( function( blob ) {\r\n        this.filename = this.baseFilename + '-part-' + pad( this.part );\r\n        download( blob, this.filename + this.extension, this.mimeType );\r\n        var count = this.count;\r\n        this.dispose();\r\n        this.count = count+1;\r\n        this.part++;\r\n        this.filename = this.baseFilename + '-part-' + pad( this.part );\r\n        this.frames = 0;\r\n        this.step();\r\n      }.bind( this ) )\r\n    } else {\r\n      this.count++;\r\n      this.frames++;\r\n      this.step();\r\n    }\r\n\r\n  }.bind( this );\r\n  fileReader.readAsArrayBuffer(blob);\r\n\r\n}\r\n\r\nCCTarEncoder.prototype.save = function( callback ) {\r\n\r\n  callback( this.tape.save() );\r\n\r\n}\r\n\r\nCCTarEncoder.prototype.dispose = function() {\r\n\r\n  this.tape = new Tar();\r\n  this.count = 0;\r\n\r\n}\r\n\r\nfunction CCPNGEncoder( settings ) {\r\n\r\n\tCCTarEncoder.call( this, settings );\r\n\r\n\tthis.type = 'image/png';\r\n\tthis.fileExtension = '.png';\r\n\r\n}\r\n\r\nCCPNGEncoder.prototype = Object.create( CCTarEncoder.prototype );\r\n\r\nCCPNGEncoder.prototype.add = function( canvas ) {\r\n\r\n\tcanvas.toBlob( function( blob ) {\r\n\t\tCCTarEncoder.prototype.add.call( this, blob );\r\n\t}.bind( this ), this.type )\r\n\r\n}\r\n\r\nfunction CCJPEGEncoder( settings ) {\r\n\r\n\tCCTarEncoder.call( this, settings );\r\n\r\n\tthis.type = 'image/jpeg';\r\n\tthis.fileExtension = '.jpg';\r\n\tthis.quality = ( settings.quality / 100 ) || .8;\r\n\r\n}\r\n\r\nCCJPEGEncoder.prototype = Object.create( CCTarEncoder.prototype );\r\n\r\nCCJPEGEncoder.prototype.add = function( canvas ) {\r\n\r\n\tcanvas.toBlob( function( blob ) {\r\n\t\tCCTarEncoder.prototype.add.call( this, blob );\r\n\t}.bind( this ), this.type, this.quality )\r\n\r\n}\r\n\r\n/*\r\n\r\n\tWebM Encoder\r\n\r\n*/\r\n\r\nfunction CCWebMEncoder( settings ) {\r\n\r\n\tvar canvas = document.createElement( 'canvas' );\r\n\tif( canvas.toDataURL( 'image/webp' ).substr(5,10) !== 'image/webp' ){\r\n\t\tconsole.log( \"WebP not supported - try another export format\" )\r\n\t}\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tthis.quality = ( settings.quality / 100 ) || .8;\r\n\r\n\tthis.extension = '.webm'\r\n\tthis.mimeType = 'video/webm'\r\n\tthis.baseFilename = this.filename;\r\n  this.framerate = settings.framerate;\r\n\r\n\tthis.frames = 0;\r\n\tthis.part = 1;\r\n\r\n  this.videoWriter = new WebMWriter({\r\n    quality: this.quality,\r\n    fileWriter: null,\r\n    fd: null,\r\n    frameRate: this.framerate\r\n  });\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCWebMEncoder.prototype.start = function( canvas ) {\r\n\r\n\tthis.dispose();\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype.add = function( canvas ) {\r\n\r\n  this.videoWriter.addFrame(canvas);\r\n\r\n\tif( this.settings.autoSaveTime > 0 && ( this.frames / this.settings.framerate ) >= this.settings.autoSaveTime ) {\r\n\t\tthis.save( function( blob ) {\r\n\t\t\tthis.filename = this.baseFilename + '-part-' + pad( this.part );\r\n\t\t\tdownload( blob, this.filename + this.extension, this.mimeType );\r\n\t\t\tthis.dispose();\r\n\t\t\tthis.part++;\r\n\t\t\tthis.filename = this.baseFilename + '-part-' + pad( this.part );\r\n\t\t\tthis.step();\r\n\t\t}.bind( this ) )\r\n\t} else {\r\n    this.frames++;\r\n\t\tthis.step();\r\n\t}\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype.save = function( callback ) {\r\n\r\n  this.videoWriter.complete().then(callback);\r\n\r\n}\r\n\r\nCCWebMEncoder.prototype.dispose = function( canvas ) {\r\n\r\n\tthis.frames = 0;\r\n  this.videoWriter = new WebMWriter({\r\n    quality: this.quality,\r\n    fileWriter: null,\r\n    fd: null,\r\n    frameRate: this.framerate\r\n  });\r\n\r\n}\r\n\r\nfunction CCFFMpegServerEncoder( settings ) {\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tsettings.quality = ( settings.quality / 100 ) || .8;\r\n\r\n\tthis.encoder = new FFMpegServer.Video( settings );\r\n    this.encoder.on( 'process', function() {\r\n        this.emit( 'process' )\r\n    }.bind( this ) );\r\n    this.encoder.on('finished', function( url, size ) {\r\n        var cb = this.callback;\r\n        if ( cb ) {\r\n            this.callback = undefined;\r\n            cb( url, size );\r\n        }\r\n    }.bind( this ) );\r\n    this.encoder.on( 'progress', function( progress ) {\r\n        if ( this.settings.onProgress ) {\r\n            this.settings.onProgress( progress )\r\n        }\r\n    }.bind( this ) );\r\n    this.encoder.on( 'error', function( data ) {\r\n        alert(JSON.stringify(data, null, 2));\r\n    }.bind( this ) );\r\n\r\n}\r\n\r\nCCFFMpegServerEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCFFMpegServerEncoder.prototype.start = function() {\r\n\r\n\tthis.encoder.start( this.settings );\r\n\r\n};\r\n\r\nCCFFMpegServerEncoder.prototype.add = function( canvas ) {\r\n\r\n\tthis.encoder.add( canvas );\r\n\r\n}\r\n\r\nCCFFMpegServerEncoder.prototype.save = function( callback ) {\r\n\r\n    this.callback = callback;\r\n    this.encoder.end();\r\n\r\n}\r\n\r\nCCFFMpegServerEncoder.prototype.safeToProceed = function() {\r\n    return this.encoder.safeToProceed();\r\n};\r\n\r\n/*\r\n\tHTMLCanvasElement.captureStream()\r\n*/\r\n\r\nfunction CCStreamEncoder( settings ) {\r\n\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tthis.framerate = this.settings.framerate;\r\n\tthis.type = 'video/webm';\r\n\tthis.extension = '.webm';\r\n\tthis.stream = null;\r\n\tthis.mediaRecorder = null;\r\n\tthis.chunks = [];\r\n\r\n}\r\n\r\nCCStreamEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCStreamEncoder.prototype.add = function( canvas ) {\r\n\r\n\tif( !this.stream ) {\r\n\t\tthis.stream = canvas.captureStream( this.framerate );\r\n\t\tthis.mediaRecorder = new MediaRecorder( this.stream );\r\n\t\tthis.mediaRecorder.start();\r\n\r\n\t\tthis.mediaRecorder.ondataavailable = function(e) {\r\n\t\t\tthis.chunks.push(e.data);\r\n\t\t}.bind( this );\r\n\r\n\t}\r\n\tthis.step();\r\n\r\n}\r\n\r\nCCStreamEncoder.prototype.save = function( callback ) {\r\n\r\n\tthis.mediaRecorder.onstop = function( e ) {\r\n\t\tvar blob = new Blob( this.chunks, { 'type' : 'video/webm' });\r\n\t\tthis.chunks = [];\r\n\t\tcallback( blob );\r\n\r\n\t}.bind( this );\r\n\r\n\tthis.mediaRecorder.stop();\r\n\r\n}\r\n\r\nfunction CCGIFEncoder( settings ) {\r\n\tCCFrameEncoder.call( this, settings );\r\n\r\n\tsettings.quality = 31 - ( ( settings.quality * 30 / 100 ) || 10 );\r\n\tsettings.workers = settings.workers || 4;\r\n\r\n\tthis.extension = '.gif'\r\n\tthis.mimeType = 'image/gif'\r\n\r\n  \tthis.canvas = document.createElement( 'canvas' );\r\n  \tthis.ctx = this.canvas.getContext( '2d' );\r\n  \tthis.sizeSet = false;\r\n\r\n\tvar gifWorkerText = \"(function(b){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c},a.define('/gif.worker.coffee',function(d,e,f,g){var b,c;b=a('/GIFEncoder.js',d),c=function(a){var c,e,d,f;return c=new b(a.width,a.height),a.index===0?c.writeHeader():c.firstFrame=!1,c.setTransparent(a.transparent),c.setRepeat(a.repeat),c.setDelay(a.delay),c.setQuality(a.quality),c.addFrame(a.data),a.last&&c.finish(),d=c.stream(),a.data=d.pages,a.cursor=d.cursor,a.pageSize=d.constructor.pageSize,a.canTransfer?(f=function(c){for(var b=0,d=a.data.length;b<d;++b)e=a.data[b],c.push(e.buffer);return c}.call(this,[]),self.postMessage(a,f)):self.postMessage(a)},self.onmessage=function(a){return c(a.data)}}),a.define('/GIFEncoder.js',function(e,h,i,j){function c(){this.page=-1,this.pages=[],this.newPage()}function b(a,b){this.width=~~a,this.height=~~b,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new c}var f=a('/TypedNeuQuant.js',e),g=a('/LZWEncoder.js',e);c.pageSize=4096,c.charMap={};for(var d=0;d<256;d++)c.charMap[d]=String.fromCharCode(d);c.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(c.pageSize),this.cursor=0},c.prototype.getData=function(){var d='';for(var a=0;a<this.pages.length;a++)for(var b=0;b<c.pageSize;b++)d+=c.charMap[this.pages[a][b]];return d},c.prototype.writeByte=function(a){this.cursor>=c.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=a},c.prototype.writeUTFBytes=function(b){for(var c=b.length,a=0;a<c;a++)this.writeByte(b.charCodeAt(a))},c.prototype.writeBytes=function(b,d,e){for(var c=e||b.length,a=d||0;a<c;a++)this.writeByte(b[a])},b.prototype.setDelay=function(a){this.delay=Math.round(a/10)},b.prototype.setFrameRate=function(a){this.delay=Math.round(100/a)},b.prototype.setDispose=function(a){a>=0&&(this.dispose=a)},b.prototype.setRepeat=function(a){this.repeat=a},b.prototype.setTransparent=function(a){this.transparent=a},b.prototype.addFrame=function(a){this.image=a,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},b.prototype.finish=function(){this.out.writeByte(59)},b.prototype.setQuality=function(a){a<1&&(a=1),this.sample=a},b.prototype.writeHeader=function(){this.out.writeUTFBytes('GIF89a')},b.prototype.analyzePixels=function(){var g=this.pixels.length,d=g/3;this.indexedPixels=new Uint8Array(d);var a=new f(this.pixels,this.sample);a.buildColormap(),this.colorTab=a.getColormap();var b=0;for(var c=0;c<d;c++){var e=a.lookupRGB(this.pixels[b++]&255,this.pixels[b++]&255,this.pixels[b++]&255);this.usedEntry[e]=!0,this.indexedPixels[c]=e}this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent))},b.prototype.findClosest=function(e){if(this.colorTab===null)return-1;var k=(e&16711680)>>16,l=(e&65280)>>8,m=e&255,c=0,d=16777216,j=this.colorTab.length;for(var a=0;a<j;){var f=k-(this.colorTab[a++]&255),g=l-(this.colorTab[a++]&255),h=m-(this.colorTab[a]&255),i=f*f+g*g+h*h,b=parseInt(a/3);this.usedEntry[b]&&i<d&&(d=i,c=b),a++}return c},b.prototype.getImagePixels=function(){var a=this.width,g=this.height;this.pixels=new Uint8Array(a*g*3);var b=this.image,c=0;for(var d=0;d<g;d++)for(var e=0;e<a;e++){var f=d*a*4+e*4;this.pixels[c++]=b[f],this.pixels[c++]=b[f+1],this.pixels[c++]=b[f+2]}},b.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var b,a;this.transparent===null?(b=0,a=0):(b=1,a=2),this.dispose>=0&&(a=dispose&7),a<<=2,this.out.writeByte(0|a|0|b),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},b.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},b.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},b.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes('NETSCAPE2.0'),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},b.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var b=768-this.colorTab.length;for(var a=0;a<b;a++)this.out.writeByte(0)},b.prototype.writeShort=function(a){this.out.writeByte(a&255),this.out.writeByte(a>>8&255)},b.prototype.writePixels=function(){var a=new g(this.width,this.height,this.indexedPixels,this.colorDepth);a.encode(this.out)},b.prototype.stream=function(){return this.out},e.exports=b}),a.define('/LZWEncoder.js',function(e,g,h,i){function f(y,D,C,B){function w(a,b){r[f++]=a,f>=254&&t(b)}function x(b){u(a),k=i+2,j=!0,l(i,b)}function u(b){for(var a=0;a<b;++a)h[a]=-1}function A(z,r){var g,t,d,e,y,w,s;for(q=z,j=!1,n_bits=q,m=p(n_bits),i=1<<z-1,o=i+1,k=i+2,f=0,e=v(),s=0,g=a;g<65536;g*=2)++s;s=8-s,w=a,u(w),l(i,r);a:while((t=v())!=c){if(g=(t<<b)+e,d=t<<s^e,h[d]===g){e=n[d];continue}if(h[d]>=0){y=w-d,d===0&&(y=1);do if((d-=y)<0&&(d+=w),h[d]===g){e=n[d];continue a}while(h[d]>=0)}l(e,r),e=t,k<1<<b?(n[d]=k++,h[d]=g):x(r)}l(e,r),l(o,r)}function z(a){a.writeByte(s),remaining=y*D,curPixel=0,A(s+1,a),a.writeByte(0)}function t(a){f>0&&(a.writeByte(f),a.writeBytes(r,0,f),f=0)}function p(a){return(1<<a)-1}function v(){if(remaining===0)return c;--remaining;var a=C[curPixel++];return a&255}function l(a,c){g&=d[e],e>0?g|=a<<e:g=a,e+=n_bits;while(e>=8)w(g&255,c),g>>=8,e-=8;if((k>m||j)&&(j?(m=p(n_bits=q),j=!1):(++n_bits,n_bits==b?m=1<<b:m=p(n_bits))),a==o){while(e>0)w(g&255,c),g>>=8,e-=8;t(c)}}var s=Math.max(2,B),r=new Uint8Array(256),h=new Int32Array(a),n=new Int32Array(a),g,e=0,f,k=0,m,j=!1,q,i,o;this.encode=z}var c=-1,b=12,a=5003,d=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=f}),a.define('/TypedNeuQuant.js',function(A,F,E,D){function C(A,B){function I(){o=[],q=new Int32Array(256),t=new Int32Array(a),y=new Int32Array(a),z=new Int32Array(a>>3);var c,d;for(c=0;c<a;c++)d=(c<<b+8)/a,o[c]=new Float64Array([d,d,d,0]),y[c]=e/a,t[c]=0}function J(){for(var c=0;c<a;c++)o[c][0]>>=b,o[c][1]>>=b,o[c][2]>>=b,o[c][3]=c}function K(b,a,c,e,f){o[a][0]-=b*(o[a][0]-c)/d,o[a][1]-=b*(o[a][1]-e)/d,o[a][2]-=b*(o[a][2]-f)/d}function L(j,e,n,l,k){var h=Math.abs(e-j),i=Math.min(e+j,a),g=e+1,f=e-1,m=1,b,d;while(g<i||f>h)d=z[m++],g<i&&(b=o[g++],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c),f>h&&(b=o[f--],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c)}function C(p,s,q){var h=2147483647,k=h,d=-1,m=d,c,j,e,n,l;for(c=0;c<a;c++)j=o[c],e=Math.abs(j[0]-p)+Math.abs(j[1]-s)+Math.abs(j[2]-q),e<h&&(h=e,d=c),n=e-(t[c]>>i-b),n<k&&(k=n,m=c),l=y[c]>>g,y[c]-=l,t[c]+=l<<f;return y[d]+=x,t[d]-=r,m}function D(){var d,b,e,c,h,g,f=0,i=0;for(d=0;d<a;d++){for(e=o[d],h=d,g=e[1],b=d+1;b<a;b++)c=o[b],c[1]<g&&(h=b,g=c[1]);if(c=o[h],d!=h&&(b=c[0],c[0]=e[0],e[0]=b,b=c[1],c[1]=e[1],e[1]=b,b=c[2],c[2]=e[2],e[2]=b,b=c[3],c[3]=e[3],e[3]=b),g!=f){for(q[f]=i+d>>1,b=f+1;b<g;b++)q[b]=d;f=g,i=d}}for(q[f]=i+n>>1,b=f+1;b<256;b++)q[b]=n}function E(j,i,k){var b,d,c,e=1e3,h=-1,f=q[i],g=f-1;while(f<a||g>=0)f<a&&(d=o[f],c=d[1]-i,c>=e?f=a:(f++,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3])))),g>=0&&(d=o[g],c=i-d[1],c>=e?g=-1:(g--,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3]))));return h}function F(){var c,f=A.length,D=30+(B-1)/3,y=f/(3*B),q=~~(y/w),n=d,o=u,a=o>>h;for(a<=1&&(a=0),c=0;c<a;c++)z[c]=n*((a*a-c*c)*m/(a*a));var i;f<s?(B=1,i=3):f%l!==0?i=3*l:f%k!==0?i=3*k:f%p!==0?i=3*p:i=3*j;var r,t,x,e,g=0;c=0;while(c<y)if(r=(A[g]&255)<<b,t=(A[g+1]&255)<<b,x=(A[g+2]&255)<<b,e=C(r,t,x),K(n,e,r,t,x),a!==0&&L(a,e,r,t,x),g+=i,g>=f&&(g-=f),c++,q===0&&(q=1),c%q===0)for(n-=n/D,o-=o/v,a=o>>h,a<=1&&(a=0),e=0;e<a;e++)z[e]=n*((a*a-e*e)*m/(a*a))}function G(){I(),F(),J(),D()}function H(){var b=[],g=[];for(var c=0;c<a;c++)g[o[c][3]]=c;var d=0;for(var e=0;e<a;e++){var f=g[e];b[d++]=o[f][0],b[d++]=o[f][1],b[d++]=o[f][2]}return b}var o,q,t,y,z;this.buildColormap=G,this.getColormap=H,this.lookupRGB=E}var w=100,a=256,n=a-1,b=4,i=16,e=1<<i,f=10,B=1<<f,g=10,x=e>>g,r=e<<f-g,z=a>>3,h=6,t=1<<h,u=z*t,v=30,o=10,d=1<<o,q=8,m=1<<q,y=o+q,c=1<<y,l=499,k=491,p=487,j=503,s=3*j;A.exports=C}),a('/gif.worker.coffee')}.call(this,this))\"\r\n\tvar workerBlob = new Blob([gifWorkerText], {\r\n\t\ttype: 'application/javascript'\r\n\t\t})\r\n\tvar workerScript = URL.createObjectURL(workerBlob)\r\n\r\n  \tthis.encoder = new GIF({\r\n\t\tworkers: settings.workers,\r\n\t\tquality: settings.quality,\r\n\t\tworkerScript: workerScript\r\n\t} );\r\n\r\n    this.encoder.on( 'progress', function( progress ) {\r\n        if ( this.settings.onProgress ) {\r\n            this.settings.onProgress( progress )\r\n        }\r\n    }.bind( this ) );\r\n\r\n    this.encoder.on('finished', function( blob ) {\r\n        var cb = this.callback;\r\n        if ( cb ) {\r\n            this.callback = undefined;\r\n            cb( blob );\r\n        }\r\n    }.bind( this ) );\r\n}\r\n\r\nCCGIFEncoder.prototype = Object.create( CCFrameEncoder.prototype );\r\n\r\nCCGIFEncoder.prototype.add = function( canvas ) {\r\n\r\n\tif( !this.sizeSet ) {\r\n\t\tthis.encoder.setOption( 'width',canvas.width );\r\n\t\tthis.encoder.setOption( 'height',canvas.height );\r\n\t\tthis.sizeSet = true;\r\n\t}\r\n\r\n\tthis.canvas.width = canvas.width;\r\n\tthis.canvas.height = canvas.height;\r\n\tthis.ctx.drawImage( canvas, 0, 0 );\r\n\r\n\tthis.encoder.addFrame( this.ctx, { copy: true, delay: this.settings.step } );\r\n\tthis.step();\r\n\r\n\t/*this.encoder.setSize( canvas.width, canvas.height );\r\n\tvar readBuffer = new Uint8Array(canvas.width * canvas.height * 4);\r\n\tvar context = canvas.getContext( 'webgl' );\r\n\tcontext.readPixels(0, 0, canvas.width, canvas.height, context.RGBA, context.UNSIGNED_BYTE, readBuffer);\r\n\tthis.encoder.addFrame( readBuffer, true );*/\r\n\r\n}\r\n\r\nCCGIFEncoder.prototype.save = function( callback ) {\r\n\r\n    this.callback = callback;\r\n\r\n\tthis.encoder.render();\r\n\r\n}\r\n\r\nfunction CCapture( settings ) {\r\n\r\n\tvar _settings = settings || {},\r\n\t\t_date = new Date(),\r\n\t\t_verbose,\r\n\t\t_display,\r\n\t\t_time,\r\n\t\t_startTime,\r\n\t\t_performanceTime,\r\n\t\t_performanceStartTime,\r\n\t\t_step,\r\n        _encoder,\r\n\t\t_timeouts = [],\r\n\t\t_intervals = [],\r\n\t\t_frameCount = 0,\r\n\t\t_intermediateFrameCount = 0,\r\n\t\t_lastFrame = null,\r\n\t\t_requestAnimationFrameCallbacks = [],\r\n\t\t_capturing = false,\r\n        _handlers = {};\r\n\r\n\t_settings.framerate = _settings.framerate || 60;\r\n\t_settings.motionBlurFrames = 2 * ( _settings.motionBlurFrames || 1 );\r\n\t_verbose = _settings.verbose || false;\r\n\t_display = _settings.display || false;\r\n\t_settings.step = 1000.0 / _settings.framerate ;\r\n\t_settings.timeLimit = _settings.timeLimit || 0;\r\n\t_settings.frameLimit = _settings.frameLimit || 0;\r\n\t_settings.startTime = _settings.startTime || 0;\r\n\r\n\tvar _timeDisplay = document.createElement( 'div' );\r\n\t_timeDisplay.style.position = 'absolute';\r\n\t_timeDisplay.style.left = _timeDisplay.style.top = 0\r\n\t_timeDisplay.style.backgroundColor = 'black';\r\n\t_timeDisplay.style.fontFamily = 'monospace'\r\n\t_timeDisplay.style.fontSize = '11px'\r\n\t_timeDisplay.style.padding = '5px'\r\n\t_timeDisplay.style.color = 'red';\r\n\t_timeDisplay.style.zIndex = 100000\r\n\tif( _settings.display ) document.body.appendChild( _timeDisplay );\r\n\r\n\tvar canvasMotionBlur = document.createElement( 'canvas' );\r\n\tvar ctxMotionBlur = canvasMotionBlur.getContext( '2d' );\r\n\tvar bufferMotionBlur;\r\n\tvar imageData;\r\n\r\n\t_log( 'Step is set to ' + _settings.step + 'ms' );\r\n\r\n    var _encoders = {\r\n\t\tgif: CCGIFEncoder,\r\n\t\twebm: CCWebMEncoder,\r\n\t\tffmpegserver: CCFFMpegServerEncoder,\r\n\t\tpng: CCPNGEncoder,\r\n\t\tjpg: CCJPEGEncoder,\r\n\t\t'webm-mediarecorder': CCStreamEncoder\r\n    };\r\n\r\n    var ctor = _encoders[ _settings.format ];\r\n    if ( !ctor ) {\r\n\t\tthrow \"Error: Incorrect or missing format: Valid formats are \" + Object.keys(_encoders).join(\", \");\r\n    }\r\n    _encoder = new ctor( _settings );\r\n    _encoder.step = _step\r\n\r\n\t_encoder.on('process', _process);\r\n    _encoder.on('progress', _progress);\r\n\r\n    if (\"performance\" in window == false) {\r\n    \twindow.performance = {};\r\n    }\r\n\r\n\tDate.now = (Date.now || function () {  // thanks IE8\r\n\t\treturn new Date().getTime();\r\n\t});\r\n\r\n\tif (\"now\" in window.performance == false){\r\n\r\n\t\tvar nowOffset = Date.now();\r\n\r\n\t\tif (performance.timing && performance.timing.navigationStart){\r\n\t\t\tnowOffset = performance.timing.navigationStart\r\n\t\t}\r\n\r\n\t\twindow.performance.now = function now(){\r\n\t\t\treturn Date.now() - nowOffset;\r\n\t\t}\r\n\t}\r\n\r\n\tvar _oldSetTimeout = window.setTimeout,\r\n\t\t_oldSetInterval = window.setInterval,\r\n\t    \t_oldClearInterval = window.clearInterval,\r\n\t\t_oldClearTimeout = window.clearTimeout,\r\n\t\t_oldRequestAnimationFrame = window.requestAnimationFrame,\r\n\t\t_oldNow = window.Date.now,\r\n\t\t_oldPerformanceNow = window.performance.now,\r\n\t\t_oldGetTime = window.Date.prototype.getTime;\r\n\t// Date.prototype._oldGetTime = Date.prototype.getTime;\r\n\r\n\tvar media = [];\r\n\r\n\tfunction _init() {\r\n\r\n\t\t_log( 'Capturer start' );\r\n\r\n\t\t_startTime = window.Date.now();\r\n\t\t_time = _startTime + _settings.startTime;\r\n\t\t_performanceStartTime = window.performance.now();\r\n\t\t_performanceTime = _performanceStartTime + _settings.startTime;\r\n\r\n\t\twindow.Date.prototype.getTime = function(){\r\n\t\t\treturn _time;\r\n\t\t};\r\n\t\twindow.Date.now = function() {\r\n\t\t\treturn _time;\r\n\t\t};\r\n\r\n\t\twindow.setTimeout = function( callback, time ) {\r\n\t\t\tvar t = {\r\n\t\t\t\tcallback: callback,\r\n\t\t\t\ttime: time,\r\n\t\t\t\ttriggerTime: _time + time\r\n\t\t\t};\r\n\t\t\t_timeouts.push( t );\r\n\t\t\t_log( 'Timeout set to ' + t.time );\r\n            return t;\r\n\t\t};\r\n\t\twindow.clearTimeout = function( id ) {\r\n\t\t\tfor( var j = 0; j < _timeouts.length; j++ ) {\r\n\t\t\t\tif( _timeouts[ j ] == id ) {\r\n\t\t\t\t\t_timeouts.splice( j, 1 );\r\n\t\t\t\t\t_log( 'Timeout cleared' );\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\twindow.setInterval = function( callback, time ) {\r\n\t\t\tvar t = {\r\n\t\t\t\tcallback: callback,\r\n\t\t\t\ttime: time,\r\n\t\t\t\ttriggerTime: _time + time\r\n\t\t\t};\r\n\t\t\t_intervals.push( t );\r\n\t\t\t_log( 'Interval set to ' + t.time );\r\n\t\t\treturn t;\r\n\t\t};\r\n\t\twindow.clearInterval = function( id ) {\r\n\t\t\t_log( 'clear Interval' );\r\n\t\t\treturn null;\r\n\t\t};\r\n\t\twindow.requestAnimationFrame = function( callback ) {\r\n\t\t\t_requestAnimationFrameCallbacks.push( callback );\r\n\t\t};\r\n\t\twindow.performance.now = function(){\r\n\t\t\treturn _performanceTime;\r\n\t\t};\r\n\r\n\t\tfunction hookCurrentTime() { \r\n\t\t\tif( !this._hooked ) {\r\n\t\t\t\tthis._hooked = true;\r\n\t\t\t\tthis._hookedTime = this.currentTime || 0;\r\n\t\t\t\tthis.pause();\r\n\t\t\t\tmedia.push( this );\r\n\t\t\t}\r\n\t\t\treturn this._hookedTime + _settings.startTime;\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tObject.defineProperty( HTMLVideoElement.prototype, 'currentTime', { get: hookCurrentTime } )\r\n\t\t\tObject.defineProperty( HTMLAudioElement.prototype, 'currentTime', { get: hookCurrentTime } )\r\n\t\t} catch (err) {\r\n\t\t\t_log(err);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _start() {\r\n\t\t_init();\r\n\t\t_encoder.start();\r\n\t\t_capturing = true;\r\n\t}\r\n\r\n\tfunction _stop() {\r\n\t\t_capturing = false;\r\n\t\t_encoder.stop();\r\n\t\t_destroy();\r\n\t}\r\n\r\n\tfunction _call( fn, p ) {\r\n\t\t_oldSetTimeout( fn, 0, p );\r\n\t}\r\n\r\n\tfunction _step() {\r\n\t\t//_oldRequestAnimationFrame( _process );\r\n\t\t_call( _process );\r\n\t}\r\n\r\n\tfunction _destroy() {\r\n\t\t_log( 'Capturer stop' );\r\n\t\twindow.setTimeout = _oldSetTimeout;\r\n\t\twindow.setInterval = _oldSetInterval;\r\n\t\twindow.clearInterval = _oldClearInterval;\r\n\t\twindow.clearTimeout = _oldClearTimeout;\r\n\t\twindow.requestAnimationFrame = _oldRequestAnimationFrame;\r\n\t\twindow.Date.prototype.getTime = _oldGetTime;\r\n\t\twindow.Date.now = _oldNow;\r\n\t\twindow.performance.now = _oldPerformanceNow;\r\n\t}\r\n\r\n\tfunction _updateTime() {\r\n\t\tvar seconds = _frameCount / _settings.framerate;\r\n\t\tif( ( _settings.frameLimit && _frameCount >= _settings.frameLimit ) || ( _settings.timeLimit && seconds >= _settings.timeLimit ) ) {\r\n\t\t\t_stop();\r\n\t\t\t_save();\r\n\t\t}\r\n\t\tvar d = new Date( null );\r\n\t\td.setSeconds( seconds );\r\n\t\tif( _settings.motionBlurFrames > 2 ) {\r\n\t\t\t_timeDisplay.textContent = 'CCapture ' + _settings.format + ' | ' + _frameCount + ' frames (' + _intermediateFrameCount + ' inter) | ' +  d.toISOString().substr( 11, 8 );\r\n\t\t} else {\r\n\t\t\t_timeDisplay.textContent = 'CCapture ' + _settings.format + ' | ' + _frameCount + ' frames | ' +  d.toISOString().substr( 11, 8 );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _checkFrame( canvas ) {\r\n\r\n\t\tif( canvasMotionBlur.width !== canvas.width || canvasMotionBlur.height !== canvas.height ) {\r\n\t\t\tcanvasMotionBlur.width = canvas.width;\r\n\t\t\tcanvasMotionBlur.height = canvas.height;\r\n\t\t\tbufferMotionBlur = new Uint16Array( canvasMotionBlur.height * canvasMotionBlur.width * 4 );\r\n\t\t\tctxMotionBlur.fillStyle = '#0'\r\n\t\t\tctxMotionBlur.fillRect( 0, 0, canvasMotionBlur.width, canvasMotionBlur.height );\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _blendFrame( canvas ) {\r\n\r\n\t\t//_log( 'Intermediate Frame: ' + _intermediateFrameCount );\r\n\r\n\t\tctxMotionBlur.drawImage( canvas, 0, 0 );\r\n\t\timageData = ctxMotionBlur.getImageData( 0, 0, canvasMotionBlur.width, canvasMotionBlur.height );\r\n\t\tfor( var j = 0; j < bufferMotionBlur.length; j+= 4 ) {\r\n\t\t\tbufferMotionBlur[ j ] += imageData.data[ j ];\r\n\t\t\tbufferMotionBlur[ j + 1 ] += imageData.data[ j + 1 ];\r\n\t\t\tbufferMotionBlur[ j + 2 ] += imageData.data[ j + 2 ];\r\n\t\t}\r\n\t\t_intermediateFrameCount++;\r\n\r\n\t}\r\n\r\n\tfunction _saveFrame(){\r\n\r\n\t\tvar data = imageData.data;\r\n\t\tfor( var j = 0; j < bufferMotionBlur.length; j+= 4 ) {\r\n\t\t\tdata[ j ] = bufferMotionBlur[ j ] * 2 / _settings.motionBlurFrames;\r\n\t\t\tdata[ j + 1 ] = bufferMotionBlur[ j + 1 ] * 2 / _settings.motionBlurFrames;\r\n\t\t\tdata[ j + 2 ] = bufferMotionBlur[ j + 2 ] * 2 / _settings.motionBlurFrames;\r\n\t\t}\r\n\t\tctxMotionBlur.putImageData( imageData, 0, 0 );\r\n\t\t_encoder.add( canvasMotionBlur );\r\n\t\t_frameCount++;\r\n\t\t_intermediateFrameCount = 0;\r\n\t\t_log( 'Full MB Frame! ' + _frameCount + ' ' +  _time );\r\n\t\tfor( var j = 0; j < bufferMotionBlur.length; j+= 4 ) {\r\n\t\t\tbufferMotionBlur[ j ] = 0;\r\n\t\t\tbufferMotionBlur[ j + 1 ] = 0;\r\n\t\t\tbufferMotionBlur[ j + 2 ] = 0;\r\n\t\t}\r\n\t\tgc();\r\n\r\n\t}\r\n\r\n\tfunction _capture( canvas ) {\r\n\r\n\t\tif( _capturing ) {\r\n\r\n\t\t\tif( _settings.motionBlurFrames > 2 ) {\r\n\r\n\t\t\t\t_checkFrame( canvas );\r\n\t\t\t\t_blendFrame( canvas );\r\n\r\n\t\t\t\tif( _intermediateFrameCount >= .5 * _settings.motionBlurFrames ) {\r\n\t\t\t\t\t_saveFrame();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_step();\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\t_encoder.add( canvas );\r\n\t\t\t\t_frameCount++;\r\n\t\t\t\t_log( 'Full Frame! ' + _frameCount );\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _process() {\r\n\r\n\t\tvar step = 1000 / _settings.framerate;\r\n\t\tvar dt = ( _frameCount + _intermediateFrameCount / _settings.motionBlurFrames ) * step;\r\n\r\n\t\t_time = _startTime + dt;\r\n\t\t_performanceTime = _performanceStartTime + dt;\r\n\r\n\t\tmedia.forEach( function( v ) {\r\n\t\t\tv._hookedTime = dt / 1000;\r\n\t\t} );\r\n\r\n\t\t_updateTime();\r\n\t\t_log( 'Frame: ' + _frameCount + ' ' + _intermediateFrameCount );\r\n\r\n\t\tfor( var j = 0; j < _timeouts.length; j++ ) {\r\n\t\t\tif( _time >= _timeouts[ j ].triggerTime ) {\r\n\t\t\t\t_call( _timeouts[ j ].callback )\r\n\t\t\t\t//console.log( 'timeout!' );\r\n\t\t\t\t_timeouts.splice( j, 1 );\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor( var j = 0; j < _intervals.length; j++ ) {\r\n\t\t\tif( _time >= _intervals[ j ].triggerTime ) {\r\n\t\t\t\t_call( _intervals[ j ].callback );\r\n\t\t\t\t_intervals[ j ].triggerTime += _intervals[ j ].time;\r\n\t\t\t\t//console.log( 'interval!' );\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_requestAnimationFrameCallbacks.forEach( function( cb ) {\r\n     \t\t_call( cb, _time - g_startTime );\r\n        } );\r\n        _requestAnimationFrameCallbacks = [];\r\n\r\n\t}\r\n\r\n\tfunction _save( callback ) {\r\n\r\n\t\tif( !callback ) {\r\n\t\t\tcallback = function( blob ) {\r\n\t\t\t\tdownload( blob, _encoder.filename + _encoder.extension, _encoder.mimeType );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t_encoder.save( callback );\r\n\r\n\t}\r\n\r\n\tfunction _log( message ) {\r\n\t\tif( _verbose ) console.log( message );\r\n\t}\r\n\r\n    function _on( event, handler ) {\r\n\r\n        _handlers[event] = handler;\r\n\r\n    }\r\n\r\n    function _emit( event ) {\r\n\r\n        var handler = _handlers[event];\r\n        if ( handler ) {\r\n\r\n            handler.apply( null, Array.prototype.slice.call( arguments, 1 ) );\r\n\r\n        }\r\n\r\n    }\r\n\r\n    function _progress( progress ) {\r\n\r\n        _emit( 'progress', progress );\r\n\r\n    }\r\n\r\n\treturn {\r\n\t\tstart: _start,\r\n\t\tcapture: _capture,\r\n\t\tstop: _stop,\r\n\t\tsave: _save,\r\n        on: _on\r\n\t}\r\n}\r\n\r\n(freeWindow || freeSelf || {}).CCapture = CCapture;\r\n\r\n  // Some AMD build optimizers like r.js check for condition patterns like the following:\r\n  if (typeof define == 'function' && typeof define.amd == 'object' && define.amd) {\r\n    // Define as an anonymous module so, through path mapping, it can be\r\n    // referenced as the \"underscore\" module.\r\n    define(function() {\r\n    \treturn CCapture;\r\n    });\r\n}\r\n  // Check for `exports` after `define` in case a build optimizer adds an `exports` object.\r\n  else if (freeExports && freeModule) {\r\n    // Export for Node.js.\r\n    if (moduleExports) {\r\n    \t(freeModule.exports = CCapture).CCapture = CCapture;\r\n    }\r\n    // Export for CommonJS support.\r\n    freeExports.CCapture = CCapture;\r\n}\r\nelse {\r\n    // Export to the global object.\r\n    root.CCapture = CCapture;\r\n}\r\n\r\n}());\r\n","(function () {\n\t\"use strict\";\n\n\tvar lookup = [\n\t\t\t'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',\n\t\t\t'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',\n\t\t\t'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',\n\t\t\t'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',\n\t\t\t'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',\n\t\t\t'o', 'p', 'q', 'r', 's', 't', 'u', 'v',\n\t\t\t'w', 'x', 'y', 'z', '0', '1', '2', '3',\n\t\t\t'4', '5', '6', '7', '8', '9', '+', '/'\n\t\t];\n\tfunction clean(length) {\n\t\tvar i, buffer = new Uint8Array(length);\n\t\tfor (i = 0; i < length; i += 1) {\n\t\t\tbuffer[i] = 0;\n\t\t}\n\t\treturn buffer;\n\t}\n\n\tfunction extend(orig, length, addLength, multipleOf) {\n\t\tvar newSize = length + addLength,\n\t\t\tbuffer = clean((parseInt(newSize / multipleOf) + 1) * multipleOf);\n\n\t\tbuffer.set(orig);\n\n\t\treturn buffer;\n\t}\n\n\tfunction pad(num, bytes, base) {\n\t\tnum = num.toString(base || 8);\n\t\treturn \"000000000000\".substr(num.length + 12 - bytes) + num;\n\t}\t\n\t\n\tfunction stringToUint8 (input, out, offset) {\n\t\tvar i, length;\n\n\t\tout = out || clean(input.length);\n\n\t\toffset = offset || 0;\n\t\tfor (i = 0, length = input.length; i < length; i += 1) {\n\t\t\tout[offset] = input.charCodeAt(i);\n\t\t\toffset += 1;\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tfunction uint8ToBase64(uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length;\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn lookup[num >> 18 & 0x3F] + lookup[num >> 12 & 0x3F] + lookup[num >> 6 & 0x3F] + lookup[num & 0x3F];\n\t\t};\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2]);\n\t\t\toutput += tripletToBase64(temp);\n\t\t}\n\n\t\t// this prevents an ERR_INVALID_URL in Chrome (Firefox okay)\n\t\tswitch (output.length % 4) {\n\t\t\tcase 1:\n\t\t\t\toutput += '=';\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\toutput += '==';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn output;\n\t}\n\n\twindow.utils = {}\n\twindow.utils.clean = clean;\n\twindow.utils.pad = pad;\n\twindow.utils.extend = extend;\n\twindow.utils.stringToUint8 = stringToUint8;\n\twindow.utils.uint8ToBase64 = uint8ToBase64;\n}());\n\n(function () {\n\t\"use strict\";\n\t\n/*\nstruct posix_header {             // byte offset\n\tchar name[100];               //   0\n\tchar mode[8];                 // 100\n\tchar uid[8];                  // 108\n\tchar gid[8];                  // 116\n\tchar size[12];                // 124\n\tchar mtime[12];               // 136\n\tchar chksum[8];               // 148\n\tchar typeflag;                // 156\n\tchar linkname[100];           // 157\n\tchar magic[6];                // 257\n\tchar version[2];              // 263\n\tchar uname[32];               // 265\n\tchar gname[32];               // 297\n\tchar devmajor[8];             // 329\n\tchar devminor[8];             // 337\n\tchar prefix[155];             // 345\n                                  // 500\n};\n*/\n\n\tvar utils = window.utils,\n\t\theaderFormat;\n\t\n\theaderFormat = [\n\t\t{\n\t\t\t'field': 'fileName',\n\t\t\t'length': 100\n\t\t},\n\t\t{\n\t\t\t'field': 'fileMode',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'uid',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'gid',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'fileSize',\n\t\t\t'length': 12\n\t\t},\n\t\t{\n\t\t\t'field': 'mtime',\n\t\t\t'length': 12\n\t\t},\n\t\t{\n\t\t\t'field': 'checksum',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'type',\n\t\t\t'length': 1\n\t\t},\n\t\t{\n\t\t\t'field': 'linkName',\n\t\t\t'length': 100\n\t\t},\n\t\t{\n\t\t\t'field': 'ustar',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'owner',\n\t\t\t'length': 32\n\t\t},\n\t\t{\n\t\t\t'field': 'group',\n\t\t\t'length': 32\n\t\t},\n\t\t{\n\t\t\t'field': 'majorNumber',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'minorNumber',\n\t\t\t'length': 8\n\t\t},\n\t\t{\n\t\t\t'field': 'filenamePrefix',\n\t\t\t'length': 155\n\t\t},\n\t\t{\n\t\t\t'field': 'padding',\n\t\t\t'length': 12\n\t\t}\n\t];\n\n\tfunction formatHeader(data, cb) {\n\t\tvar buffer = utils.clean(512),\n\t\t\toffset = 0;\n\n\t\theaderFormat.forEach(function (value) {\n\t\t\tvar str = data[value.field] || \"\",\n\t\t\t\ti, length;\n\n\t\t\tfor (i = 0, length = str.length; i < length; i += 1) {\n\t\t\t\tbuffer[offset] = str.charCodeAt(i);\n\t\t\t\toffset += 1;\n\t\t\t}\n\n\t\t\toffset += value.length - i; // space it out with nulls\n\t\t});\n\n\t\tif (typeof cb === 'function') {\n\t\t\treturn cb(buffer, offset);\n\t\t}\n\t\treturn buffer;\n\t}\n\t\n\twindow.header = {}\n\twindow.header.structure = headerFormat;\n\twindow.header.format = formatHeader;\n}());\n\n(function () {\n\t\"use strict\";\n\n\tvar header = window.header,\n\t\tutils = window.utils,\n\t\trecordSize = 512,\n\t\tblockSize;\n\t\n\tfunction Tar(recordsPerBlock) {\n\t\tthis.written = 0;\n\t\tblockSize = (recordsPerBlock || 20) * recordSize;\n\t\tthis.out = utils.clean(blockSize);\n\t\tthis.blocks = [];\n\t\tthis.length = 0;\n\t}\n\n\tTar.prototype.append = function (filepath, input, opts, callback) {\n\t\tvar data,\n\t\t\tchecksum,\n\t\t\tmode,\n\t\t\tmtime,\n\t\t\tuid,\n\t\t\tgid,\n\t\t\theaderArr;\n\n\t\tif (typeof input === 'string') {\n\t\t\tinput = utils.stringToUint8(input);\n\t\t} else if (input.constructor !== Uint8Array.prototype.constructor) {\n\t\t\tthrow 'Invalid input type. You gave me: ' + input.constructor.toString().match(/function\\s*([$A-Za-z_][0-9A-Za-z_]*)\\s*\\(/)[1];\n\t\t}\n\n\t\tif (typeof opts === 'function') {\n\t\t\tcallback = opts;\n\t\t\topts = {};\n\t\t}\n\n\t\topts = opts || {};\n\n\t\tmode = opts.mode || parseInt('777', 8) & 0xfff;\n\t\tmtime = opts.mtime || Math.floor(+new Date() / 1000);\n\t\tuid = opts.uid || 0;\n\t\tgid = opts.gid || 0;\n\n\t\tdata = {\n\t\t\tfileName: filepath,\n\t\t\tfileMode: utils.pad(mode, 7),\n\t\t\tuid: utils.pad(uid, 7),\n\t\t\tgid: utils.pad(gid, 7),\n\t\t\tfileSize: utils.pad(input.length, 11),\n\t\t\tmtime: utils.pad(mtime, 11),\n\t\t\tchecksum: '        ',\n\t\t\ttype: '0', // just a file\n\t\t\tustar: 'ustar  ',\n\t\t\towner: opts.owner || '',\n\t\t\tgroup: opts.group || ''\n\t\t};\n\n\t\t// calculate the checksum\n\t\tchecksum = 0;\n\t\tObject.keys(data).forEach(function (key) {\n\t\t\tvar i, value = data[key], length;\n\n\t\t\tfor (i = 0, length = value.length; i < length; i += 1) {\n\t\t\t\tchecksum += value.charCodeAt(i);\n\t\t\t}\n\t\t});\n\n\t\tdata.checksum = utils.pad(checksum, 6) + \"\\u0000 \";\n\n\t\theaderArr = header.format(data);\n\n\t\tvar headerLength = Math.ceil( headerArr.length / recordSize ) * recordSize; \n\t\tvar inputLength = Math.ceil( input.length / recordSize ) * recordSize;\n\n\t\tthis.blocks.push( { header: headerArr, input: input, headerLength: headerLength, inputLength: inputLength } );\n\n\t};\n\n\tTar.prototype.save = function() {\n\n\t\tvar buffers = [];\n\t\tvar chunks = [];\n\t\tvar length = 0;\n\t\tvar max = Math.pow( 2, 20 );\n\n\t\tvar chunk = [];\n\t\tthis.blocks.forEach( function( b ) {\n\t\t\tif( length + b.headerLength + b.inputLength > max ) {\n\t\t\t\tchunks.push( { blocks: chunk, length: length } );\n\t\t\t\tchunk = [];\n\t\t\t\tlength = 0;\n\t\t\t}\n\t\t\tchunk.push( b );\n\t\t\tlength += b.headerLength + b.inputLength;\n\t\t} );\n\t\tchunks.push( { blocks: chunk, length: length } );\n\n\t\tchunks.forEach( function( c ) {\n\n\t\t\tvar buffer = new Uint8Array( c.length );\n\t\t\tvar written = 0;\n\t\t\tc.blocks.forEach( function( b ) {\n\t\t\t\tbuffer.set( b.header, written );\n\t\t\t\twritten += b.headerLength;\n\t\t\t\tbuffer.set( b.input, written );\n\t\t\t\twritten += b.inputLength;\n\t\t\t} );\n\t\t\tbuffers.push( buffer );\n\n\t\t} );\n\n\t\tbuffers.push( new Uint8Array( 2 * recordSize ) );\n\n\t\treturn new Blob( buffers, { type: 'octet/stream' } );\n\t\t\n\t};\n\n\tTar.prototype.clear = function () {\n\t\tthis.written = 0;\n\t\tthis.out = utils.clean(blockSize);\n\t};\n\n\tif (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n\t\tmodule.exports = Tar;\n\t} else {\n\t\twindow.Tar = Tar;\n\t}\n}());\n","//download.js v4.21, by dandavis; 2008-2018. [MIT] see http://danml.com/download.html for tests/usage\n// v1 landed a FF+Chrome compatible way of downloading strings to local un-named files, upgraded to use a hidden frame and optional mime\n// v2 added named files via a[download], msSaveBlob, IE (10+) support, and window.URL support for larger+faster saves than dataURLs\n// v3 added dataURL and Blob Input, bind-toggle arity, and legacy dataURL fallback was improved with force-download mime and base64 support. 3.1 improved safari handling.\n// v4 adds AMD/UMD, commonJS, and plain browser support\n// v4.1 adds url download capability via solo URL argument (same domain/CORS only)\n// v4.2 adds semantic variable names, long (over 2MB) dataURL support, and hidden by default temp anchors\n// https://github.com/rndme/download\n\n(function (root, factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD. Register as an anonymous module.\n\t\tdefine([], factory);\n\t} else if (typeof exports === 'object') {\n\t\t// Node. Does not work with strict CommonJS, but\n\t\t// only CommonJS-like environments that support module.exports,\n\t\t// like Node.\n\t\tmodule.exports = factory();\n\t} else {\n\t\t// Browser globals (root is window)\n\t\troot.download = factory();\n\t}\n}(this, function () {\n\n\treturn function download(data, strFileName, strMimeType) {\n\n\t\tvar self = window, // this script is only for browsers anyway...\n\t\t\tdefaultMime = \"application/octet-stream\", // this default mime also triggers iframe downloads\n\t\t\tmimeType = strMimeType || defaultMime,\n\t\t\tpayload = data,\n\t\t\turl = !strFileName && !strMimeType && payload,\n\t\t\tanchor = document.createElement(\"a\"),\n\t\t\ttoString = function(a){return String(a);},\n\t\t\tmyBlob = (self.Blob || self.MozBlob || self.WebKitBlob || toString),\n\t\t\tfileName = strFileName || \"download\",\n\t\t\tblob,\n\t\t\treader;\n\t\tmyBlob= myBlob.call ? myBlob.bind(self) : Blob ;\n\n\t\tif(String(this)===\"true\"){ //reverse arguments, allowing download.bind(true, \"text/xml\", \"export.xml\") to act as a callback\n\t\t\tpayload=[payload, mimeType];\n\t\t\tmimeType=payload[0];\n\t\t\tpayload=payload[1];\n\t\t}\n\n\n\t\tif(url && url.length< 2048){ // if no filename and no mime, assume a url was passed as the only argument\n\t\t\tfileName = url.split(\"/\").pop().split(\"?\")[0];\n\t\t\tanchor.href = url; // assign href prop to temp anchor\n\t\t\tif(anchor.href.indexOf(url) !== -1){ // if the browser determines that it's a potentially valid url path:\n\t\t\t\tvar ajax=new XMLHttpRequest();\n\t\t\t\tajax.open( \"GET\", url, true);\n\t\t\t\tajax.responseType = 'blob';\n\t\t\t\tajax.onload= function(e){\n\t\t\t\t\tdownload(e.target.response, fileName, defaultMime);\n\t\t\t\t};\n\t\t\t\tsetTimeout(function(){ ajax.send();}, 0); // allows setting custom ajax headers using the return:\n\t\t\t\treturn ajax;\n\t\t\t} // end if valid url?\n\t\t} // end if url?\n\n\n\t\t//go ahead and download dataURLs right away\n\t\tif(/^data:([\\w+-]+\\/[\\w+.-]+)?[,;]/.test(payload)){\n\n\t\t\tif(payload.length > (1024*1024*1.999) && myBlob !== toString ){\n\t\t\t\tpayload=dataUrlToBlob(payload);\n\t\t\t\tmimeType=payload.type || defaultMime;\n\t\t\t}else{\n\t\t\t\treturn navigator.msSaveBlob ?  // IE10 can't do a[download], only Blobs:\n\t\t\t\t\tnavigator.msSaveBlob(dataUrlToBlob(payload), fileName) :\n\t\t\t\t\tsaver(payload) ; // everyone else can save dataURLs un-processed\n\t\t\t}\n\n\t\t}else{//not data url, is it a string with special needs?\n\t\t\tif(/([\\x80-\\xff])/.test(payload)){\n\t\t\t\tvar i=0, tempUiArr= new Uint8Array(payload.length), mx=tempUiArr.length;\n\t\t\t\tfor(i;i<mx;++i) tempUiArr[i]= payload.charCodeAt(i);\n\t\t\t\tpayload=new myBlob([tempUiArr], {type: mimeType});\n\t\t\t}\n\t\t}\n\t\tblob = payload instanceof myBlob ?\n\t\t\tpayload :\n\t\t\tnew myBlob([payload], {type: mimeType}) ;\n\n\n\t\tfunction dataUrlToBlob(strUrl) {\n\t\t\tvar parts= strUrl.split(/[:;,]/),\n\t\t\t\ttype= parts[1],\n\t\t\t\tindexDecoder = strUrl.indexOf(\"charset\")>0 ? 3: 2,\n\t\t\t\tdecoder= parts[indexDecoder] == \"base64\" ? atob : decodeURIComponent,\n\t\t\t\tbinData= decoder( parts.pop() ),\n\t\t\t\tmx= binData.length,\n\t\t\t\ti= 0,\n\t\t\t\tuiArr= new Uint8Array(mx);\n\n\t\t\tfor(i;i<mx;++i) uiArr[i]= binData.charCodeAt(i);\n\n\t\t\treturn new myBlob([uiArr], {type: type});\n\t\t}\n\n\t\tfunction saver(url, winMode){\n\n\t\t\tif ('download' in anchor) { //html5 A[download]\n\t\t\t\tanchor.href = url;\n\t\t\t\tanchor.setAttribute(\"download\", fileName);\n\t\t\t\tanchor.className = \"download-js-link\";\n\t\t\t\tanchor.innerHTML = \"downloading...\";\n\t\t\t\tanchor.style.display = \"none\";\n\t\t\t\tanchor.addEventListener('click', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.removeEventListener('click', arguments.callee);\n\t\t\t\t});\n\t\t\t\tdocument.body.appendChild(anchor);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tanchor.click();\n\t\t\t\t\tdocument.body.removeChild(anchor);\n\t\t\t\t\tif(winMode===true){setTimeout(function(){ self.URL.revokeObjectURL(anchor.href);}, 250 );}\n\t\t\t\t}, 66);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// handle non-a[download] safari as best we can:\n\t\t\tif(/(Version)\\/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari\\//.test(navigator.userAgent)) {\n\t\t\t\tif(/^data:/.test(url))\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t\tif(!window.open(url)){ // popup blocked, offer direct download:\n\t\t\t\t\tif(confirm(\"Displaying New Document\\n\\nUse Save As... to download, then click back to return to this page.\")){ location.href=url; }\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//do iframe dataURL download (old ch+FF):\n\t\t\tvar f = document.createElement(\"iframe\");\n\t\t\tdocument.body.appendChild(f);\n\n\t\t\tif(!winMode && /^data:/.test(url)){ // force a mime that will download:\n\t\t\t\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t}\n\t\t\tf.src=url;\n\t\t\tsetTimeout(function(){ document.body.removeChild(f); }, 333);\n\n\t\t}//end saver\n\n\n\n\n\t\tif (navigator.msSaveBlob) { // IE10+ : (has Blob, but not a[download] or URL)\n\t\t\treturn navigator.msSaveBlob(blob, fileName);\n\t\t}\n\n\t\tif(self.URL){ // simple fast and modern way using Blob and URL:\n\t\t\tsaver(self.URL.createObjectURL(blob), true);\n\t\t}else{\n\t\t\t// handle non-Blob()+non-URL browsers:\n\t\t\tif(typeof blob === \"string\" || blob.constructor===toString ){\n\t\t\t\ttry{\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \";base64,\"  +  self.btoa(blob)  );\n\t\t\t\t}catch(y){\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \",\" + encodeURIComponent(blob)  );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Blob but not URL support:\n\t\t\treader=new FileReader();\n\t\t\treader.onload=function(e){\n\t\t\t\tsaver(this.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(blob);\n\t\t}\n\t\treturn true;\n\t}; /* end download() */\n}));","(function(c){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c};var b=function(a){return a='/',{title:'browser',version:'v0.10.26',browser:!0,env:{},argv:[],nextTick:c.setImmediate||function(a){setTimeout(a,0)},cwd:function(){return a},chdir:function(b){a=b}}}();a.define('/gif.coffee',function(d,m,l,k){function g(a,b){return{}.hasOwnProperty.call(a,b)}function j(d,b){for(var a=0,c=b.length;a<c;++a)if(a in b&&b[a]===d)return!0;return!1}function i(a,b){function d(){this.constructor=a}for(var c in b)g(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a}var h,c,f,b,e;f=a('events',d).EventEmitter,h=a('/browser.coffee',d),e=function(d){function a(d){var a,b;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(d);for(a in c)b=c[a],null!=this.options[a]?this.options[a]:this.options[a]=b}return i(a,d),c={workerScript:'gif.worker.js',workers:2,repeat:0,background:'#fff',quality:10,width:null,height:null,transparent:null},b={delay:500,copy:!1},a.prototype.setOption=function(a,b){return this.options[a]=b,null!=this._canvas&&(a==='width'||a==='height')?this._canvas[a]=b:void 0},a.prototype.setOptions=function(b){var a,c;return function(d){for(a in b){if(!g(b,a))continue;c=b[a],d.push(this.setOption(a,c))}return d}.call(this,[])},a.prototype.addFrame=function(a,d){var c,e;null==d&&(d={}),c={},c.transparent=this.options.transparent;for(e in b)c[e]=d[e]||b[e];if(null!=this.options.width||this.setOption('width',a.width),null!=this.options.height||this.setOption('height',a.height),'undefined'!==typeof ImageData&&null!=ImageData&&a instanceof ImageData)c.data=a.data;else if('undefined'!==typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&a instanceof CanvasRenderingContext2D||'undefined'!==typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&a instanceof WebGLRenderingContext)d.copy?c.data=this.getContextData(a):c.context=a;else if(null!=a.childNodes)d.copy?c.data=this.getImageData(a):c.image=a;else throw new Error('Invalid image');return this.frames.push(c)},a.prototype.render=function(){var d,a;if(this.running)throw new Error('Already running');if(!(null!=this.options.width&&null!=this.options.height))throw new Error('Width and height must be set prior to rendering');this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(c){for(var b=function(){var b;b=[];for(var a=0;0<=this.frames.length?a<this.frames.length:a>this.frames.length;0<=this.frames.length?++a:--a)b.push(a);return b}.apply(this,arguments),a=0,e=b.length;a<e;++a)d=b[a],c.push(null);return c}.call(this,[]),a=this.spawnWorkers();for(var c=function(){var c;c=[];for(var b=0;0<=a?b<a:b>a;0<=a?++b:--b)c.push(b);return c}.apply(this,arguments),b=0,e=c.length;b<e;++b)d=c[b],this.renderNextFrame();return this.emit('start'),this.emit('progress',0)},a.prototype.abort=function(){var a;while(!0){if(a=this.activeWorkers.shift(),!(null!=a))break;console.log('killing active worker'),a.terminate()}return this.running=!1,this.emit('abort')},a.prototype.spawnWorkers=function(){var a;return a=Math.min(this.options.workers,this.frames.length),function(){var c;c=[];for(var b=this.freeWorkers.length;this.freeWorkers.length<=a?b<a:b>a;this.freeWorkers.length<=a?++b:--b)c.push(b);return c}.apply(this,arguments).forEach(function(a){return function(c){var b;return console.log('spawning worker '+c),b=new Worker(a.options.workerScript),b.onmessage=function(a){return function(c){return a.activeWorkers.splice(a.activeWorkers.indexOf(b),1),a.freeWorkers.push(b),a.frameFinished(c.data)}}(a),a.freeWorkers.push(b)}}(this)),a},a.prototype.frameFinished=function(a){return console.log('frame '+a.index+' finished - '+this.activeWorkers.length+' active'),this.finishedFrames++,this.emit('progress',this.finishedFrames/this.frames.length),this.imageParts[a.index]=a,j(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},a.prototype.finishRendering=function(){var e,a,k,m,b,d,h;b=0;for(var f=0,j=this.imageParts.length;f<j;++f)a=this.imageParts[f],b+=(a.data.length-1)*a.pageSize+a.cursor;b+=a.pageSize-a.cursor,console.log('rendering finished - filesize '+Math.round(b/1e3)+'kb'),e=new Uint8Array(b),d=0;for(var g=0,l=this.imageParts.length;g<l;++g){a=this.imageParts[g];for(var c=0,i=a.data.length;c<i;++c)h=a.data[c],k=c,e.set(h,d),k===a.data.length-1?d+=a.cursor:d+=a.pageSize}return m=new Blob([e],{type:'image/gif'}),this.emit('finished',m,e)},a.prototype.renderNextFrame=function(){var c,a,b;if(this.freeWorkers.length===0)throw new Error('No free workers');return this.nextFrame>=this.frames.length?void 0:(c=this.frames[this.nextFrame++],b=this.freeWorkers.shift(),a=this.getTask(c),console.log('starting frame '+(a.index+1)+' of '+this.frames.length),this.activeWorkers.push(b),b.postMessage(a))},a.prototype.getContextData=function(a){return a.getImageData(0,0,this.options.width,this.options.height).data},a.prototype.getImageData=function(b){var a;return null!=this._canvas||(this._canvas=document.createElement('canvas'),this._canvas.width=this.options.width,this._canvas.height=this.options.height),a=this._canvas.getContext('2d'),a.setFill=this.options.background,a.fillRect(0,0,this.options.width,this.options.height),a.drawImage(b,0,0),this.getContextData(a)},a.prototype.getTask=function(a){var c,b;if(c=this.frames.indexOf(a),b={index:c,last:c===this.frames.length-1,delay:a.delay,transparent:a.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:h.name==='chrome'},null!=a.data)b.data=a.data;else if(null!=a.context)b.data=this.getContextData(a.context);else if(null!=a.image)b.data=this.getImageData(a.image);else throw new Error('Invalid frame');return b},a}(f),d.exports=e}),a.define('/browser.coffee',function(f,g,h,i){var a,d,e,c,b;c=navigator.userAgent.toLowerCase(),e=navigator.platform.toLowerCase(),b=c.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/)||[null,'unknown',0],d=b[1]==='ie'&&document.documentMode,a={name:b[1]==='version'?b[3]:b[1],version:d||parseFloat(b[1]==='opera'&&b[4]?b[4]:b[2]),platform:{name:c.match(/ip(?:ad|od|hone)/)?'ios':(c.match(/(?:webos|android)/)||e.match(/mac|win|linux/)||['other'])[0]}},a[a.name]=!0,a[a.name+parseInt(a.version,10)]=!0,a.platform[a.platform.name]=!0,f.exports=a}),a.define('events',function(f,e,g,h){b.EventEmitter||(b.EventEmitter=function(){});var a=e.EventEmitter=b.EventEmitter,c=typeof Array.isArray==='function'?Array.isArray:function(a){return Object.prototype.toString.call(a)==='[object Array]'},d=10;a.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._events.maxListeners=a},a.prototype.emit=function(f){if(f==='error'&&(!(this._events&&this._events.error)||c(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error(\"Uncaught, unspecified 'error' event.\");if(!this._events)return!1;var a=this._events[f];if(!a)return!1;if(!(typeof a=='function'))if(c(a)){var b=Array.prototype.slice.call(arguments,1),e=a.slice();for(var d=0,g=e.length;d<g;d++)e[d].apply(this,b);return!0}else return!1;switch(arguments.length){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:var b=Array.prototype.slice.call(arguments,1);a.apply(this,b)}return!0},a.prototype.addListener=function(a,b){if('function'!==typeof b)throw new Error('addListener only takes instances of Function');if(this._events||(this._events={}),this.emit('newListener',a,b),!this._events[a])this._events[a]=b;else if(c(this._events[a])){if(!this._events[a].warned){var e;this._events.maxListeners!==undefined?e=this._events.maxListeners:e=d,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[a].length),console.trace())}this._events[a].push(b)}else this._events[a]=[this._events[a],b];return this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(b,c){var a=this;return a.on(b,function d(){a.removeListener(b,d),c.apply(this,arguments)}),this},a.prototype.removeListener=function(a,d){if('function'!==typeof d)throw new Error('removeListener only takes instances of Function');if(!(this._events&&this._events[a]))return this;var b=this._events[a];if(c(b)){var e=b.indexOf(d);if(e<0)return this;b.splice(e,1),b.length==0&&delete this._events[a]}else this._events[a]===d&&delete this._events[a];return this},a.prototype.removeAllListeners=function(a){return a&&this._events&&this._events[a]&&(this._events[a]=null),this},a.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),c(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]}}),c.GIF=a('/gif.coffee')}.call(this,this))\r\n//# sourceMappingURL=gif.js.map\r\n// gif.js 0.1.6 - https://github.com/jnordberg/gif.js","/**\n * A tool for presenting an ArrayBuffer as a stream for writing some simple data types.\n * \n * By Nicholas Sherlock\n * \n * Released under the WTFPLv2 https://en.wikipedia.org/wiki/WTFPL\n */\n\n\"use strict\";\n\n(function(){\n\n    var isNodeEnviroment = typeof module !== 'undefined' && typeof module.exports !== 'undefined';\n\n    /**\n     * Create an ArrayBuffer of the given length and present it as a writable stream with methods\n     * for writing data in different formats.\n     */\n\n    var ArrayBufferDataStream = function(length) {\n        this.data = new Uint8Array(length);\n        this.pos = 0;\n    };\n    \n    ArrayBufferDataStream.prototype.seek = function(offset) {\n        this.pos = offset;\n    };\n\n    ArrayBufferDataStream.prototype.writeBytes = function(arr) {\n        for (var i = 0; i < arr.length; i++) {\n            this.data[this.pos++] = arr[i];\n        }\n    };\n\n    ArrayBufferDataStream.prototype.writeByte = function(b) {\n        this.data[this.pos++] = b;\n    };\n    \n    //Synonym:\n    ArrayBufferDataStream.prototype.writeU8 = ArrayBufferDataStream.prototype.writeByte;\n    \n    ArrayBufferDataStream.prototype.writeU16BE = function(u) {\n        this.data[this.pos++] = u >> 8;\n        this.data[this.pos++] = u;\n    };\n\n    ArrayBufferDataStream.prototype.writeDoubleBE = function(d) {\n        var \n            bytes = new Uint8Array(new Float64Array([d]).buffer);\n        \n        for (var i = bytes.length - 1; i >= 0; i--) {\n            this.writeByte(bytes[i]);\n        }\n    };\n\n    ArrayBufferDataStream.prototype.writeFloatBE = function(d) {\n        var \n            bytes = new Uint8Array(new Float32Array([d]).buffer);\n        \n        for (var i = bytes.length - 1; i >= 0; i--) {\n            this.writeByte(bytes[i]);\n        }\n    };\n\n    /**\n     * Write an ASCII string to the stream\n     */\n    ArrayBufferDataStream.prototype.writeString = function(s) {\n        for (var i = 0; i < s.length; i++) {\n            this.data[this.pos++] = s.charCodeAt(i);\n        }\n    };\n\n    /**\n     * Write the given 32-bit integer to the stream as an EBML variable-length integer using the given byte width \n     * (use measureEBMLVarInt).\n     * \n     * No error checking is performed to ensure that the supplied width is correct for the integer.\n     * \n     * @param i Integer to be written\n     * @param width Number of bytes to write to the stream\n     */\n    ArrayBufferDataStream.prototype.writeEBMLVarIntWidth = function(i, width) {\n        switch (width) {\n            case 1:\n                this.writeU8((1 << 7) | i);\n            break;\n            case 2:\n                this.writeU8((1 << 6) | (i >> 8));\n                this.writeU8(i);\n            break;\n            case 3:\n                this.writeU8((1 << 5) | (i >> 16));\n                this.writeU8(i >> 8);\n                this.writeU8(i);\n            break;\n            case 4:\n                this.writeU8((1 << 4) | (i >> 24));\n                this.writeU8(i >> 16);\n                this.writeU8(i >> 8);\n                this.writeU8(i);\n            break;\n            case 5:\n                /* \n                 * JavaScript converts its doubles to 32-bit integers for bitwise operations, so we need to do a \n                 * division by 2^32 instead of a right-shift of 32 to retain those top 3 bits\n                 */\n                this.writeU8((1 << 3) | ((i / 4294967296) & 0x7)); \n                this.writeU8(i >> 24);\n                this.writeU8(i >> 16);\n                this.writeU8(i >> 8);\n                this.writeU8(i);\n            break;\n            default:\n                throw new RuntimeException(\"Bad EBML VINT size \" + width);\n        }\n    };\n    \n    /**\n     * Return the number of bytes needed to encode the given integer as an EBML VINT.\n     */\n    ArrayBufferDataStream.prototype.measureEBMLVarInt = function(val) {\n        if (val < (1 << 7) - 1) { \n            /* Top bit is set, leaving 7 bits to hold the integer, but we can't store 127 because\n             * \"all bits set to one\" is a reserved value. Same thing for the other cases below:\n             */\n            return 1;\n        } else if (val < (1 << 14) - 1) {\n            return 2;\n        } else if (val < (1 << 21) - 1) {\n            return 3;\n        } else if (val < (1 << 28) - 1) {\n            return 4;\n        } else if (val < 34359738367) { // 2 ^ 35 - 1 (can address 32GB)\n            return 5;\n        } else {\n            throw new RuntimeException(\"EBML VINT size not supported \" + val);\n        }\n    };\n    \n    ArrayBufferDataStream.prototype.writeEBMLVarInt = function(i) {\n        this.writeEBMLVarIntWidth(i, this.measureEBMLVarInt(i));\n    };\n    \n    /**\n     * Write the given unsigned 32-bit integer to the stream in big-endian order using the given byte width.\n     * No error checking is performed to ensure that the supplied width is correct for the integer.\n     * \n     * Omit the width parameter to have it determined automatically for you.\n     * \n     * @param u Unsigned integer to be written\n     * @param width Number of bytes to write to the stream\n     */\n    ArrayBufferDataStream.prototype.writeUnsignedIntBE = function(u, width) {\n        if (width === undefined) {\n            width = this.measureUnsignedInt(u);\n        }\n        \n        // Each case falls through:\n        switch (width) {\n            case 5:\n                this.writeU8(Math.floor(u / 4294967296)); // Need to use division to access >32 bits of floating point var\n            case 4:\n                this.writeU8(u >> 24);\n            case 3:\n                this.writeU8(u >> 16);\n            case 2:\n                this.writeU8(u >> 8);\n            case 1:\n                this.writeU8(u);\n            break;\n            default:\n                throw new RuntimeException(\"Bad UINT size \" + width);\n        }\n    };\n    \n    /**\n     * Return the number of bytes needed to hold the non-zero bits of the given unsigned integer.\n     */\n    ArrayBufferDataStream.prototype.measureUnsignedInt = function(val) {\n        // Force to 32-bit unsigned integer\n        if (val < (1 << 8)) {\n            return 1;\n        } else if (val < (1 << 16)) {\n            return 2;\n        } else if (val < (1 << 24)) {\n            return 3;\n        } else if (val < 4294967296) {\n            return 4;\n        } else {\n            return 5;\n        }\n    };\n\n    /**\n     * Return a view on the portion of the buffer from the beginning to the current seek position as a Uint8Array.\n     */\n    ArrayBufferDataStream.prototype.getAsDataArray = function() {\n        if (this.pos < this.data.byteLength) {\n            return this.data.subarray(0, this.pos);\n        } else if (this.pos == this.data.byteLength) {\n            return this.data;\n        } else {\n            throw \"ArrayBufferDataStream's pos lies beyond end of buffer\";\n        }\n    };\n\n    window.ArrayBufferDataStream = ArrayBufferDataStream;\n\n    /**\n     * Allows a series of Blob-convertible objects (ArrayBuffer, Blob, String, etc) to be added to a buffer. Seeking and\n     * overwriting of blobs is allowed.\n     *\n     * You can supply a FileWriter, in which case the BlobBuffer is just used as temporary storage before it writes it\n     * through to the disk.\n     *\n     * By Nicholas Sherlock\n     *\n     * Released under the WTFPLv2 https://en.wikipedia.org/wiki/WTFPL\n     */\n\n\tvar BlobBuffer = function(fs) {\n\t\treturn function(destination) {\n\t\t\tvar\n\t\t\t\tbuffer = [],\n\t\t\t\twritePromise = Promise.resolve(),\n\t\t\t\tfileWriter = null,\n\t\t\t\tfd = null;\n\t\t\t\n\t\t\tif (typeof FileWriter !== \"undefined\" && destination instanceof FileWriter) {\n\t\t\t\tfileWriter = destination;\n\t\t\t} else if (fs && destination) {\n\t\t\t\tfd = destination;\n\t\t\t}\n\t\t\t\n\t\t\t// Current seek offset\n\t\t\tthis.pos = 0;\n\t\t\t\n\t\t\t// One more than the index of the highest byte ever written\n\t\t\tthis.length = 0;\n\t\t\t\n\t\t\t// Returns a promise that converts the blob to an ArrayBuffer\n\t\t\tfunction readBlobAsBuffer(blob) {\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tvar\n\t\t\t\t\t\treader = new FileReader();\n\t\t\t\t\t\n\t\t\t\t\treader.addEventListener(\"loadend\", function () {\n\t\t\t\t\t\tresolve(reader.result);\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\treader.readAsArrayBuffer(blob);\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tfunction convertToUint8Array(thing) {\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tif (thing instanceof Uint8Array) {\n\t\t\t\t\t\tresolve(thing);\n\t\t\t\t\t} else if (thing instanceof ArrayBuffer || ArrayBuffer.isView(thing)) {\n\t\t\t\t\t\tresolve(new Uint8Array(thing));\n\t\t\t\t\t} else if (thing instanceof Blob) {\n\t\t\t\t\t\tresolve(readBlobAsBuffer(thing).then(function (buffer) {\n\t\t\t\t\t\t\treturn new Uint8Array(buffer);\n\t\t\t\t\t\t}));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Assume that Blob will know how to read this thing\n\t\t\t\t\t\tresolve(readBlobAsBuffer(new Blob([thing])).then(function (buffer) {\n\t\t\t\t\t\t\treturn new Uint8Array(buffer);\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tfunction measureData(data) {\n\t\t\t\tvar\n\t\t\t\t\tresult = data.byteLength || data.length || data.size;\n\t\t\t\t\n\t\t\t\tif (!Number.isInteger(result)) {\n\t\t\t\t\tthrow \"Failed to determine size of element\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\t\n\t\t\t/**\n\t\t\t * Seek to the given absolute offset.\n\t\t\t *\n\t\t\t * You may not seek beyond the end of the file (this would create a hole and/or allow blocks to be written in non-\n\t\t\t * sequential order, which isn't currently supported by the memory buffer backend).\n\t\t\t */\n\t\t\tthis.seek = function (offset) {\n\t\t\t\tif (offset < 0) {\n\t\t\t\t\tthrow \"Offset may not be negative\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (isNaN(offset)) {\n\t\t\t\t\tthrow \"Offset may not be NaN\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (offset > this.length) {\n\t\t\t\t\tthrow \"Seeking beyond the end of file is not allowed\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.pos = offset;\n\t\t\t};\n\t\t\t\n\t\t\t/**\n\t\t\t * Write the Blob-convertible data to the buffer at the current seek position.\n\t\t\t *\n\t\t\t * Note: If overwriting existing data, the write must not cross preexisting block boundaries (written data must\n\t\t\t * be fully contained by the extent of a previous write).\n\t\t\t */\n\t\t\tthis.write = function (data) {\n\t\t\t\tvar\n\t\t\t\t\tnewEntry = {\n\t\t\t\t\t\toffset: this.pos,\n\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\tlength: measureData(data)\n\t\t\t\t\t},\n\t\t\t\t\tisAppend = newEntry.offset >= this.length;\n\t\t\t\t\n\t\t\t\tthis.pos += newEntry.length;\n\t\t\t\tthis.length = Math.max(this.length, this.pos);\n\t\t\t\t\n\t\t\t\t// After previous writes complete, perform our write\n\t\t\t\twritePromise = writePromise.then(function () {\n\t\t\t\t\tif (fd) {\n\t\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\t\tconvertToUint8Array(newEntry.data).then(function(dataArray) {\n\t\t\t\t\t\t\t\tvar\n\t\t\t\t\t\t\t\t\ttotalWritten = 0,\n\t\t\t\t\t\t\t\t\tbuffer = Buffer.from(dataArray.buffer),\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\thandleWriteComplete = function(err, written, buffer) {\n\t\t\t\t\t\t\t\t\t\ttotalWritten += written;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (totalWritten >= buffer.length) {\n\t\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t// We still have more to write...\n\t\t\t\t\t\t\t\t\t\t\tfs.write(fd, buffer, totalWritten, buffer.length - totalWritten, newEntry.offset + totalWritten, handleWriteComplete);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tfs.write(fd, buffer, 0, buffer.length, newEntry.offset, handleWriteComplete);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (fileWriter) {\n\t\t\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t\t\tfileWriter.onwriteend = resolve;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfileWriter.seek(newEntry.offset);\n\t\t\t\t\t\t\tfileWriter.write(new Blob([newEntry.data]));\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (!isAppend) {\n\t\t\t\t\t\t// We might be modifying a write that was already buffered in memory.\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Slow linear search to find a block we might be overwriting\n\t\t\t\t\t\tfor (var i = 0; i < buffer.length; i++) {\n\t\t\t\t\t\t\tvar\n\t\t\t\t\t\t\t\tentry = buffer[i];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// If our new entry overlaps the old one in any way...\n\t\t\t\t\t\t\tif (!(newEntry.offset + newEntry.length <= entry.offset || newEntry.offset >= entry.offset + entry.length)) {\n\t\t\t\t\t\t\t\tif (newEntry.offset < entry.offset || newEntry.offset + newEntry.length > entry.offset + entry.length) {\n\t\t\t\t\t\t\t\t\tthrow new Error(\"Overwrite crosses blob boundaries\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (newEntry.offset == entry.offset && newEntry.length == entry.length) {\n\t\t\t\t\t\t\t\t\t// We overwrote the entire block\n\t\t\t\t\t\t\t\t\tentry.data = newEntry.data;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// We're done\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn convertToUint8Array(entry.data)\n\t\t\t\t\t\t\t\t\t\t.then(function (entryArray) {\n\t\t\t\t\t\t\t\t\t\t\tentry.data = entryArray;\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\treturn convertToUint8Array(newEntry.data);\n\t\t\t\t\t\t\t\t\t\t}).then(function (newEntryArray) {\n\t\t\t\t\t\t\t\t\t\t\tnewEntry.data = newEntryArray;\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\tentry.data.set(newEntry.data, newEntry.offset - entry.offset);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Else fall through to do a simple append, as we didn't overwrite any pre-existing blocks\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tbuffer.push(newEntry);\n\t\t\t\t});\n\t\t\t};\n\t\t\t\n\t\t\t/**\n\t\t\t * Finish all writes to the buffer, returning a promise that signals when that is complete.\n\t\t\t *\n\t\t\t * If a FileWriter was not provided, the promise is resolved with a Blob that represents the completed BlobBuffer\n\t\t\t * contents. You can optionally pass in a mimeType to be used for this blob.\n\t\t\t *\n\t\t\t * If a FileWriter was provided, the promise is resolved with null as the first argument.\n\t\t\t */\n\t\t\tthis.complete = function (mimeType) {\n\t\t\t\tif (fd || fileWriter) {\n\t\t\t\t\twritePromise = writePromise.then(function () {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// After writes complete we need to merge the buffer to give to the caller\n\t\t\t\t\twritePromise = writePromise.then(function () {\n\t\t\t\t\t\tvar\n\t\t\t\t\t\t\tresult = [];\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor (var i = 0; i < buffer.length; i++) {\n\t\t\t\t\t\t\tresult.push(buffer[i].data);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn new Blob(result, {mimeType: mimeType});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn writePromise;\n\t\t\t};\n\t\t};\n\t}(isNodeEnviroment ? require('fs') : null);\n\t\n\twindow.BlobBuffer = BlobBuffer;\n\n    /**\n     * WebM video encoder for Google Chrome. This implementation is suitable for creating very large video files, because\n     * it can stream Blobs directly to a FileWriter without buffering the entire video in memory.\n     *\n     * When FileWriter is not available or not desired, it can buffer the video in memory as a series of Blobs which are\n     * eventually returned as one composite Blob.\n     *\n     * By Nicholas Sherlock.\n     *\n     * Based on the ideas from Whammy: https://github.com/antimatter15/whammy\n     *\n     * Released under the WTFPLv2 https://en.wikipedia.org/wiki/WTFPL\n     */\n\n    var WebMWriter = function(ArrayBufferDataStream, BlobBuffer) {\n        function extend(base, top) {\n            var\n                target = {};\n            \n            [base, top].forEach(function(obj) {\n                for (var prop in obj) {\n                    if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n                        target[prop] = obj[prop];\n                    }\n                }\n            });\n            \n            return target;\n        }\n        \n        /**\n         * Decode a Base64 data URL into a binary string.\n         *\n         * Returns the binary string, or false if the URL could not be decoded.\n         */\n        function decodeBase64WebPDataURL(url) {\n            if (typeof url !== \"string\" || !url.match(/^data:image\\/webp;base64,/i)) {\n                return false;\n            }\n            \n            return window.atob(url.substring(\"data:image\\/webp;base64,\".length));\n        }\n        \n        /**\n         * Convert a raw binary string (one character = one output byte) to an ArrayBuffer\n         */\n        function stringToArrayBuffer(string) {\n            var\n                buffer = new ArrayBuffer(string.length),\n                int8Array = new Uint8Array(buffer);\n            \n            for (var i = 0; i < string.length; i++) {\n                int8Array[i] = string.charCodeAt(i);\n            }\n            \n            return buffer;\n        }\n        \n        /**\n         * Convert the given canvas to a WebP encoded image and return the image data as a string.\n         */\n        function renderAsWebP(canvas, quality) {\n            var\n                frame = canvas.toDataURL('image/webp', {quality: quality});\n            \n            return decodeBase64WebPDataURL(frame);\n        }\n        \n        function extractKeyframeFromWebP(webP) {\n            // Assume that Chrome will generate a Simple Lossy WebP which has this header:\n            var\n                keyframeStartIndex = webP.indexOf('VP8 ');\n            \n            if (keyframeStartIndex == -1) {\n                throw \"Failed to identify beginning of keyframe in WebP image\";\n            }\n            \n            // Skip the header and the 4 bytes that encode the length of the VP8 chunk\n            keyframeStartIndex += 'VP8 '.length + 4;\n            \n            return webP.substring(keyframeStartIndex);\n        }\n        \n        // Just a little utility so we can tag values as floats for the EBML encoder's benefit\n        function EBMLFloat32(value) {\n            this.value = value;\n        }\n        \n        function EBMLFloat64(value) {\n            this.value = value;\n        }\n        \n        /**\n         * Write the given EBML object to the provided ArrayBufferStream.\n         *\n         * The buffer's first byte is at bufferFileOffset inside the video file. This is used to complete offset and\n         * dataOffset fields in each EBML structure, indicating the file offset of the first byte of the EBML element and\n         * its data payload.\n         */\n        function writeEBML(buffer, bufferFileOffset, ebml) {\n            // Is the ebml an array of sibling elements?\n            if (Array.isArray(ebml)) {\n                for (var i = 0; i < ebml.length; i++) {\n                    writeEBML(buffer, bufferFileOffset, ebml[i]);\n                }\n            // Is this some sort of raw data that we want to write directly?\n            } else if (typeof ebml === \"string\") {\n                buffer.writeString(ebml);\n            } else if (ebml instanceof Uint8Array) {\n                buffer.writeBytes(ebml);\n            } else if (ebml.id){\n                // We're writing an EBML element\n                ebml.offset = buffer.pos + bufferFileOffset;\n                \n                buffer.writeUnsignedIntBE(ebml.id); // ID field\n                \n                // Now we need to write the size field, so we must know the payload size:\n                \n                if (Array.isArray(ebml.data)) {\n                    // Writing an array of child elements. We won't try to measure the size of the children up-front\n                    \n                    var\n                        sizePos, dataBegin, dataEnd;\n                    \n                    if (ebml.size === -1) {\n                        // Write the reserved all-one-bits marker to note that the size of this element is unknown/unbounded\n                        buffer.writeByte(0xFF);\n                    } else {\n                        sizePos = buffer.pos;\n                        \n                        /* Write a dummy size field to overwrite later. 4 bytes allows an element maximum size of 256MB,\n                         * which should be plenty (we don't want to have to buffer that much data in memory at one time\n                         * anyway!)\n                         */\n                        buffer.writeBytes([0, 0, 0, 0]);\n                    }\n                    \n                    dataBegin = buffer.pos;\n                    \n                    ebml.dataOffset = dataBegin + bufferFileOffset;\n                    writeEBML(buffer, bufferFileOffset, ebml.data);\n                    \n                    if (ebml.size !== -1) {\n                        dataEnd = buffer.pos;\n                        \n                        ebml.size = dataEnd - dataBegin;\n                        \n                        buffer.seek(sizePos);\n                        buffer.writeEBMLVarIntWidth(ebml.size, 4); // Size field\n                        \n                        buffer.seek(dataEnd);\n                    }\n                } else if (typeof ebml.data === \"string\") {\n                    buffer.writeEBMLVarInt(ebml.data.length); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeString(ebml.data);\n                } else if (typeof ebml.data === \"number\") {\n                    // Allow the caller to explicitly choose the size if they wish by supplying a size field\n                    if (!ebml.size) {\n                        ebml.size = buffer.measureUnsignedInt(ebml.data);\n                    }\n                    \n                    buffer.writeEBMLVarInt(ebml.size); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeUnsignedIntBE(ebml.data, ebml.size);\n                } else if (ebml.data instanceof EBMLFloat64) {\n                    buffer.writeEBMLVarInt(8); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeDoubleBE(ebml.data.value);\n                } else if (ebml.data instanceof EBMLFloat32) {\n                    buffer.writeEBMLVarInt(4); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeFloatBE(ebml.data.value);\n                } else if (ebml.data instanceof Uint8Array) {\n                    buffer.writeEBMLVarInt(ebml.data.byteLength); // Size field\n                    ebml.dataOffset = buffer.pos + bufferFileOffset;\n                    buffer.writeBytes(ebml.data);\n                } else {\n                    throw \"Bad EBML datatype \" + typeof ebml.data;\n                }\n            } else {\n                throw \"Bad EBML datatype \" + typeof ebml.data;\n            }\n        }\n        \n        return function(options) {\n            var\n                MAX_CLUSTER_DURATION_MSEC = 5000,\n                DEFAULT_TRACK_NUMBER = 1,\n            \n                writtenHeader = false,\n                videoWidth, videoHeight,\n                \n                clusterFrameBuffer = [],\n                clusterStartTime = 0,\n                clusterDuration = 0,\n                \n                optionDefaults = {\n                    quality: 0.95,       // WebM image quality from 0.0 (worst) to 1.0 (best)\n                    fileWriter: null,    // Chrome FileWriter in order to stream to a file instead of buffering to memory (optional)\n                    fd: null,            // Node.JS file descriptor to write to instead of buffering (optional)\n                    \n                    // You must supply one of:\n                    frameDuration: null, // Duration of frames in milliseconds\n                    frameRate: null,     // Number of frames per second\n                },\n                \n                seekPoints = {\n                    Cues: {id: new Uint8Array([0x1C, 0x53, 0xBB, 0x6B]), positionEBML: null},\n                    SegmentInfo: {id: new Uint8Array([0x15, 0x49, 0xA9, 0x66]), positionEBML: null},\n                    Tracks: {id: new Uint8Array([0x16, 0x54, 0xAE, 0x6B]), positionEBML: null},\n                },\n                \n                ebmlSegment,\n                segmentDuration = {\n                    \"id\": 0x4489, // Duration\n                    \"data\": new EBMLFloat64(0)\n                },\n                \n                seekHead,\n                \n                cues = [],\n                \n                blobBuffer = new BlobBuffer(options.fileWriter || options.fd);\n    \n            function fileOffsetToSegmentRelative(fileOffset) {\n                return fileOffset - ebmlSegment.dataOffset;\n            }\n            \n            /**\n             * Create a SeekHead element with descriptors for the points in the global seekPoints array.\n             *\n             * 5 bytes of position values are reserved for each node, which lie at the offset point.positionEBML.dataOffset,\n             * to be overwritten later.\n             */\n            function createSeekHead() {\n                var\n                    seekPositionEBMLTemplate = {\n                        \"id\": 0x53AC, // SeekPosition\n                        \"size\": 5, // Allows for 32GB video files\n                        \"data\": 0 // We'll overwrite this when the file is complete\n                    },\n                    \n                    result = {\n                        \"id\": 0x114D9B74, // SeekHead\n                        \"data\": []\n                    };\n                \n                for (var name in seekPoints) {\n                    var\n                        seekPoint = seekPoints[name];\n                \n                    seekPoint.positionEBML = Object.create(seekPositionEBMLTemplate);\n                    \n                    result.data.push({\n                         \"id\": 0x4DBB, // Seek\n                         \"data\": [\n                              {\n                                  \"id\": 0x53AB, // SeekID\n                                  \"data\": seekPoint.id\n                              },\n                              seekPoint.positionEBML\n                         ]\n                    });\n                }\n                \n                return result;\n            }\n            \n            /**\n             * Write the WebM file header to the stream.\n             */\n            function writeHeader() {\n                seekHead = createSeekHead();\n                \n                var\n                    ebmlHeader = {\n                        \"id\": 0x1a45dfa3, // EBML\n                        \"data\": [\n                            {\n                                \"id\": 0x4286, // EBMLVersion\n                                \"data\": 1\n                            },\n                            {\n                                \"id\": 0x42f7, // EBMLReadVersion\n                                \"data\": 1\n                            },\n                            {\n                                \"id\": 0x42f2, // EBMLMaxIDLength\n                                \"data\": 4\n                            },\n                            {\n                                \"id\": 0x42f3, // EBMLMaxSizeLength\n                                \"data\": 8\n                            },\n                            {\n                                \"id\": 0x4282, // DocType\n                                \"data\": \"webm\"\n                            },\n                            {\n                                \"id\": 0x4287, // DocTypeVersion\n                                \"data\": 2\n                            },\n                            {\n                                \"id\": 0x4285, // DocTypeReadVersion\n                                \"data\": 2\n                            }\n                        ]\n                    },\n                    \n                    segmentInfo = {\n                        \"id\": 0x1549a966, // Info\n                        \"data\": [\n                            {\n                                \"id\": 0x2ad7b1, // TimecodeScale\n                                \"data\": 1e6 // Times will be in miliseconds (1e6 nanoseconds per step = 1ms)\n                            },\n                            {\n                                \"id\": 0x4d80, // MuxingApp\n                                \"data\": \"webm-writer-js\",\n                            },\n                            {\n                                \"id\": 0x5741, // WritingApp\n                                \"data\": \"webm-writer-js\"\n                            },\n                            segmentDuration // To be filled in later\n                        ]\n                    },\n                    \n                    tracks = {\n                        \"id\": 0x1654ae6b, // Tracks\n                        \"data\": [\n                            {\n                                \"id\": 0xae, // TrackEntry\n                                \"data\": [\n                                    {\n                                        \"id\": 0xd7, // TrackNumber\n                                        \"data\": DEFAULT_TRACK_NUMBER\n                                    },\n                                    {\n                                        \"id\": 0x73c5, // TrackUID\n                                        \"data\": DEFAULT_TRACK_NUMBER\n                                    },\n                                    {\n                                        \"id\": 0x9c, // FlagLacing\n                                        \"data\": 0\n                                    },\n                                    {\n                                        \"id\": 0x22b59c, // Language\n                                        \"data\": \"und\"\n                                    },\n                                    {\n                                        \"id\": 0x86, // CodecID\n                                        \"data\": \"V_VP8\"\n                                    },\n                                    {\n                                        \"id\": 0x258688, // CodecName\n                                        \"data\": \"VP8\"\n                                    },\n                                    {\n                                        \"id\": 0x83, // TrackType\n                                        \"data\": 1\n                                    },\n                                    {\n                                        \"id\": 0xe0,  // Video\n                                        \"data\": [\n                                            {\n                                                \"id\": 0xb0, // PixelWidth\n                                                \"data\": videoWidth\n                                            },\n                                            {\n                                                \"id\": 0xba, // PixelHeight\n                                                \"data\": videoHeight\n                                            }\n                                        ]\n                                    }\n                                ]\n                            }\n                        ]\n                    };\n                \n                ebmlSegment = {\n                    \"id\": 0x18538067, // Segment\n                    \"size\": -1, // Unbounded size\n                    \"data\": [\n                        seekHead,\n                        segmentInfo,\n                        tracks,\n                    ]\n                };\n                \n                var\n                    bufferStream = new ArrayBufferDataStream(256);\n                    \n                writeEBML(bufferStream, blobBuffer.pos, [ebmlHeader, ebmlSegment]);\n                blobBuffer.write(bufferStream.getAsDataArray());\n                \n                // Now we know where these top-level elements lie in the file:\n                seekPoints.SegmentInfo.positionEBML.data = fileOffsetToSegmentRelative(segmentInfo.offset);\n                seekPoints.Tracks.positionEBML.data = fileOffsetToSegmentRelative(tracks.offset);\n            };\n            \n            /**\n             * Create a SimpleBlock keyframe header using these fields:\n             *     timecode    - Time of this keyframe\n             *     trackNumber - Track number from 1 to 126 (inclusive)\n             *     frame       - Raw frame data payload string\n             *\n             * Returns an EBML element.\n             */\n            function createKeyframeBlock(keyframe) {\n                var\n                    bufferStream = new ArrayBufferDataStream(1 + 2 + 1);\n                \n                if (!(keyframe.trackNumber > 0 && keyframe.trackNumber < 127)) {\n                    throw \"TrackNumber must be > 0 and < 127\";\n                }\n    \n                bufferStream.writeEBMLVarInt(keyframe.trackNumber); // Always 1 byte since we limit the range of trackNumber\n                bufferStream.writeU16BE(keyframe.timecode);\n                \n                // Flags byte\n                bufferStream.writeByte(\n                    1 << 7 // Keyframe\n                );\n                \n                return {\n                    \"id\": 0xA3, // SimpleBlock\n                    \"data\": [\n                         bufferStream.getAsDataArray(),\n                         keyframe.frame\n                    ]\n                };\n            }\n            \n            /**\n             * Create a Cluster node using these fields:\n             *\n             *    timecode    - Start time for the cluster\n             *\n             * Returns an EBML element.\n             */\n            function createCluster(cluster) {\n                return {\n                    \"id\": 0x1f43b675,\n                    \"data\": [\n                         {\n                            \"id\": 0xe7, // Timecode\n                            \"data\": Math.round(cluster.timecode)\n                         }\n                    ]\n                };\n            }\n            \n            function addCuePoint(trackIndex, clusterTime, clusterFileOffset) {\n                cues.push({\n                    \"id\": 0xBB, // Cue\n                    \"data\": [\n                         {\n                             \"id\": 0xB3, // CueTime\n                             \"data\": clusterTime\n                         },\n                         {\n                             \"id\": 0xB7, // CueTrackPositions\n                             \"data\": [\n                                  {\n                                      \"id\": 0xF7, // CueTrack\n                                      \"data\": trackIndex\n                                  },\n                                  {\n                                      \"id\": 0xF1, // CueClusterPosition\n                                      \"data\": fileOffsetToSegmentRelative(clusterFileOffset)\n                                  }\n                             ]\n                         }\n                    ]\n                });\n            }\n            \n            /**\n             * Write a Cues element to the blobStream using the global `cues` array of CuePoints (use addCuePoint()).\n             * The seek entry for the Cues in the SeekHead is updated.\n             */\n            function writeCues() {\n                var\n                    ebml = {\n                        \"id\": 0x1C53BB6B,\n                        \"data\": cues\n                    },\n                    \n                    cuesBuffer = new ArrayBufferDataStream(16 + cues.length * 32); // Pretty crude estimate of the buffer size we'll need\n                \n                writeEBML(cuesBuffer, blobBuffer.pos, ebml);\n                blobBuffer.write(cuesBuffer.getAsDataArray());\n                \n                // Now we know where the Cues element has ended up, we can update the SeekHead\n                seekPoints.Cues.positionEBML.data = fileOffsetToSegmentRelative(ebml.offset);\n            }\n            \n            /**\n             * Flush the frames in the current clusterFrameBuffer out to the stream as a Cluster.\n             */\n            function flushClusterFrameBuffer() {\n                if (clusterFrameBuffer.length == 0) {\n                    return;\n                }\n    \n                // First work out how large of a buffer we need to hold the cluster data\n                var\n                    rawImageSize = 0;\n                \n                for (var i = 0; i < clusterFrameBuffer.length; i++) {\n                    rawImageSize += clusterFrameBuffer[i].frame.length;\n                }\n                \n                var\n                    buffer = new ArrayBufferDataStream(rawImageSize + clusterFrameBuffer.length * 32), // Estimate 32 bytes per SimpleBlock header\n    \n                    cluster = createCluster({\n                        timecode: Math.round(clusterStartTime),\n                    });\n                    \n                for (var i = 0; i < clusterFrameBuffer.length; i++) {\n                    cluster.data.push(createKeyframeBlock(clusterFrameBuffer[i]));\n                }\n                \n                writeEBML(buffer, blobBuffer.pos, cluster);\n                blobBuffer.write(buffer.getAsDataArray());\n                \n                addCuePoint(DEFAULT_TRACK_NUMBER, Math.round(clusterStartTime), cluster.offset);\n                \n                clusterFrameBuffer = [];\n                clusterStartTime += clusterDuration;\n                clusterDuration = 0;\n            }\n            \n            function validateOptions() {\n                // Derive frameDuration setting if not already supplied\n                if (!options.frameDuration) {\n                    if (options.frameRate) {\n                        options.frameDuration = 1000 / options.frameRate;\n                    } else {\n                        throw \"Missing required frameDuration or frameRate setting\";\n                    }\n                }\n            }\n            \n            function addFrameToCluster(frame) {\n                frame.trackNumber = DEFAULT_TRACK_NUMBER;\n                \n                // Frame timecodes are relative to the start of their cluster:\n                frame.timecode = Math.round(clusterDuration);\n    \n                clusterFrameBuffer.push(frame);\n                \n                clusterDuration += frame.duration;\n                \n                if (clusterDuration >= MAX_CLUSTER_DURATION_MSEC) {\n                    flushClusterFrameBuffer();\n                }\n            }\n            \n            /**\n             * Rewrites the SeekHead element that was initially written to the stream with the offsets of top level elements.\n             *\n             * Call once writing is complete (so the offset of all top level elements is known).\n             */\n            function rewriteSeekHead() {\n                var\n                    seekHeadBuffer = new ArrayBufferDataStream(seekHead.size),\n                    oldPos = blobBuffer.pos;\n                \n                // Write the rewritten SeekHead element's data payload to the stream (don't need to update the id or size)\n                writeEBML(seekHeadBuffer, seekHead.dataOffset, seekHead.data);\n                \n                // And write that through to the file\n                blobBuffer.seek(seekHead.dataOffset);\n                blobBuffer.write(seekHeadBuffer.getAsDataArray());\n    \n                blobBuffer.seek(oldPos);\n            }\n            \n            /**\n             * Rewrite the Duration field of the Segment with the newly-discovered video duration.\n             */\n            function rewriteDuration() {\n                var\n                    buffer = new ArrayBufferDataStream(8),\n                    oldPos = blobBuffer.pos;\n                \n                // Rewrite the data payload (don't need to update the id or size)\n                buffer.writeDoubleBE(clusterStartTime);\n                \n                // And write that through to the file\n                blobBuffer.seek(segmentDuration.dataOffset);\n                blobBuffer.write(buffer.getAsDataArray());\n        \n                blobBuffer.seek(oldPos);\n            }\n            \n            /**\n             * Add a frame to the video. Currently the frame must be a Canvas element.\n             */\n            this.addFrame = function(canvas) {\n                if (writtenHeader) {\n                    if (canvas.width != videoWidth || canvas.height != videoHeight) {\n                        throw \"Frame size differs from previous frames\";\n                    }\n                } else {\n                    videoWidth = canvas.width;\n                    videoHeight = canvas.height;\n    \n                    writeHeader();\n                    writtenHeader = true;\n                }\n    \n                var\n                    webP = renderAsWebP(canvas, {quality: options.quality});\n                \n                if (!webP) {\n                    throw \"Couldn't decode WebP frame, does the browser support WebP?\";\n                }\n                \n                addFrameToCluster({\n                    frame: extractKeyframeFromWebP(webP),\n                    duration: options.frameDuration\n                });\n            };\n            \n            /**\n             * Finish writing the video and return a Promise to signal completion.\n             *\n             * If the destination device was memory (i.e. options.fileWriter was not supplied), the Promise is resolved with\n             * a Blob with the contents of the entire video.\n             */\n            this.complete = function() {\n                flushClusterFrameBuffer();\n                \n                writeCues();\n                rewriteSeekHead();\n                rewriteDuration();\n                \n                return blobBuffer.complete('video/webm');\n            };\n            \n            this.getWrittenSize = function() {\n                return blobBuffer.length;\n            };\n    \n            options = extend(optionDefaults, options || {});\n            validateOptions();\n        };\n    };\n\n    if (isNodeEnviroment) {\n\t    module.exports = WebMWriter(ArrayBufferDataStream, BlobBuffer);\n    } else {\n\t    window.WebMWriter = WebMWriter(ArrayBufferDataStream, BlobBuffer);\n    }\n})();\n"],"sourceRoot":""}